                                                        CANONICAL BASES AND QUIVER VARIETIES
arXiv:math/0107177v5 [math.RT] 1 Jul 2003




                                                                Michela Varagnolo and Eric Vasserot


                                                   Abstract. We prove the existence of canonical bases in the K-theory of quiver
                                                   varieties. This existence was conjectured by Lusztig.




                                                                                   Contents
                                              1.   Introduction
                                              2.   The algebra U
                                              3.   The braid group
                                              4.   Reminder on quiver varieties
                                              5.   The involution on the convolution algebra
                                              6.   The metric and the involution on standard modules
                                              7.   Construction of the signed basis
                                              8.   Example


                                                                               1. Introduction
                                                Lusztig proposed in [16] to construct a signed basis of the equivariant K-theory
                                            of a quiver variety. As in [14], this signed basis should be characterized by an
                                            involution and a metric. He suggested a formula for the involution and the metric
                                            and he conjectured the existence of the signed basis. This signed basis should
                                            also satisfy some positivity property, related, hopefully, to the positivity of the
                                            structural constants of the product and the coproduct of the modified quantum
                                            algebra in the canonical basis, for all simply laced types. The main purpose of this
                                            paper is to give a precise definition of this signed basis and to prove its existence.
                                            It was conjectured in [24] that the K-theory of the quiver variety, with the action
                                            of the quantized enveloping algebra of affine type defined in [20] (see also [23] for
                                            the type A case), is isomorphic to the ’maximal integrable module’ introduced by
                                            Kashiwara in [8]. This module has a canonical basis, see loc. cit. The conjectures in
                                            [9, §13] suggest that Kashiwara’s canonical basis and the geometric one are related,
                                            see Remark 7.2.2.
                                                We thank the referee for useful suggestions.

                                              Both authors are partially supported by EU grant # ERB FMRX-CT97-0100.

                                                                                                                 Typeset by AMS-TEX
                                                                                        1
2                   MICHELA VARAGNOLO AND ERIC VASSEROT

                                        2. The algebra U
2.1. Let g be a simple, simply laced, complex Lie algebra. Let (aij )i,j∈I be the
Cartan matrix. The quantum loop algebra associated to g is the Q(q)-algebra U′
generated by x±       ±     ±1
                ir , kis , ki  = k±                       ×
                                  i0 (i ∈ I, r ∈ Z, s ∈ ±N ) modulo the following
defining relations

                             ki k−1
                                 i  = 1 = ki−1 ki ,         [k±       ε
                                                              i,±r , kj,εs ] = 0,


                                       ki x±   −1
                                           jr ki  = q ±aij x±
                                                            jr ,


                (w − q ±aji z) kεj (w) x±
                                        i (z) = (q
                                                   ±aji
                                                        w − z) x±      ε
                                                                i (z) kj (w),


                (z − q ±aij w)x±     ±
                               i (z)xj (w) = (q
                                                ±aij
                                                     z − w)x±     ±
                                                            j (w)xi (z),


                                                         k+         −
                                                          i,r+s − ki,r+s
                                  [x+     −
                                    ir , xjs ] = δij                     ,
                                                             q − q −1
        m                     
       XX            p       m ±
                (−1)             xirw(1) x±             ±       ± ±                 ±
                                          irw(2) · · · xirw(p) xjs xirw(p+1) · · · xirw(m) = 0,
                             p
        w p=0

where i 6= j, m = 1 − aij , r1 , ..., rm ∈ Z, and w ∈ Sm . We have set [n] =
q 1−n + q 3−n + ... + q n−1 if n ≥ 0, [n]! = [n][n − 1]...[2], and
                                               
                                              m          [m]!
                                                  =              .
                                              p     [p]![m − p]!

We have also set ε = + or −, and
                                    X                                   X
                     k±
                      i (z) =             k±
                                           i,±r z
                                                  ∓r
                                                     ,     x±
                                                            i (z) =           x±
                                                                               ir z
                                                                                    ∓r
                                                                                       .
                                    r≥0                                 r∈Z


2.2. Put A = Z[q, q −1 ]. Consider the A-subalgebra U ⊂ U′ generated by the
quantum divided powers (x± ir )
                               (n)
                                   = (x±   n                            ±1
                                       ir ) /[n]!, the Cartan elements ki , and the
coefficients of the series
                                                     X h        
                                                          i,±s s
                                X
                                      pi,±s z s = exp         z ,
                                                         [s]
                                s≥0                         s≥1


where the elements his are such that
                                                   X           
                       k±        ±1
                        i (z) = ki exp ±(q − q
                                               −1
                                                  )   hi,±s z ∓s .
                                                                  s≥1


Observe that U coincides with the A-subalgebra generated by the elements (ei )n /[n]!,
(fi )n /[n]!, and ki±1 , i ∈ I ∪ {0}, where ei , fi , k±1
                                                       i  are the Kac-Moody generators,
see [3, Proposition 2.2 and 2.6].
                      CANONICAL BASES AND QUIVER VARIETIES                                            3

2.3. Let ∆ be the coproduct of U′ defined in terms of the Kac-Moody generators
as follows

     ∆(ei ) = ei ⊗ 1 + ki ⊗ ei ,          ∆(fi ) = fi ⊗ k−1
                                                         i + 1 ⊗ fi ,            ∆(ki ) = ki ⊗ ki .

Let τ, ψ, S be the anti-automorphisms of U′ such that

                τ (ei ) = fi ,      τ (fi ) = ei ,   τ (ki ) = k−1
                                                                i ,        τ (q) = q −1 ,

             ψ(ei ) = qki fi ,       ψ(fi ) = qk−1
                                                i ei ,        ψ(ki ) = ki ,      ψ(q) = q,
           S(ei ) =   −ei k−1
                           i ,         S(fi ) = −ki fi ,      S(ki ) =    k−1
                                                                           i ,    S(q) = q.
The map S is the antipode. Let x 7→ x̄ be the algebra automorphism of U′ such
that
                   ēi = ei , f̄i = fi , k̄i = k−1
                                                i , q̄ = q −1 .
2.4. Let U̇′ be the modified algebra of U′ , and let U̇ be the corresponding A-form.
Let ηλ ∈ U̇ be the idempotent denoted by 1λ in [13, §23.1].

                                       3. The braid group
3.1. Let P, Q, be the integral weight lattice, and the root lattice of g. Let ωi , αi ,
i ∈ I, be the fundamental weights and the simple roots. Let Q+ ⊂ Q, P + ⊂ P
be the subsemigroups
               P          generated by the simple roots and the fundamental weights.
We set ρ = i∈I ωi . Let ai , i ∈ I, be the positive integers such that the element
θ = i∈I ci αi ∈ Q+ is the highest root. The integer c = 1 + i ci is the Coxeter
      P                                                            P
number of g.
    Let δ be the smallest positive imaginary root of the corresponding affine root
system. Recall that the affine root α0 is δ − θ. We set P̂ = P ⊕ Zδ.
    Let W be the Weyl group of g. Let w0 ∈ W be the longest element. The extended
affine Weyl group is the semi-direct product W̃ = W ⋉ P . For any element w ∈ W̃
let l(w) be the length of w. Let si ∈ W̃ , i ∈ I ∪ {0}, be the affine simple reflexions.
The affine Weyl group is the normal subgroup Ŵ ⊂ W̃ generated by the elements
si , i ∈ I ∪ {0}. Let Γ be the quotient group W̃ /Ŵ . It is identified with a group of
diagram automorphisms of the extended Dynkin diagram of g. In particular Γ acts
on U, W̃ in the obvious way.
    Let BW , BW̃ be the braid groups of W , W̃ . The group BW̃ is generated by
elements Tw , w ∈ W̃ , with the relation Tw Tw′ = Tww′ whenever l(ww′ ) = l(w) +
l(w′ ). The group BW is the subgroup generated by the elements Tw , w ∈ W . For
simplicity we set Ti = Tsi for any i ∈ I ∪ {0}, and θi = Tωi for any i ∈ I. The
group BW̃ acts on U by algebra automorphisms. Let Ti be the operator denoted
       ′′
by Ti,1   in [13, §37.1.3]. If i 6= j we have

                            −aij
                                                (−aij −s)      (s)
                            X
              Ti (ej ) =           (−1)s q −s ei            ej ei ,     Ti (ei ) = −fi ki ,
                            s=0

                            −aij
                                              (s)    (−aij −s)
                            X
               Ti (fj ) =          (−1)s q s fi fj fi            ,    Ti (fi ) = −k−1
                                                                                   i ei .
                            s=0
4                  MICHELA VARAGNOLO AND ERIC VASSEROT

                             −a
We have also Ti (kj ) = kj ki ij for all i, j.
    For a future use, we introduce the following notations :
    – let σ be the automorphism of BW̃ such that σ(Tw ) = Tw−1      −1 for all w ∈ W̃ ;

    – for any α ∈ Q, let Uα ⊂ U be the subset of the elements x such that ki x k−1   i  =
q (α,αi ) x for all i;
    – for any i ∈ I let i ∈ I be the unique element such that w0 (αi ) = −αi ;
    – let (, ) : P × P → Q be the pairing    such that (ωi , αj ) = δij ;
    – for any α ∈ Q we set |α|2 = i (ωi , α)2 .
                                    P

3.2. Let γsi1 si2 · · · sik be a reduced expression for the element ωi ∈ W̃ . Set
                                   k
                                   X
                           γi =          γsi1 · · · siℓ−1 (αiℓ ) ∈ P̂ .
                                   ℓ=1

Lemma. We have (γi , αi ) = −c.
                                                                        ˆ± ⊂
                 L
Proof. Let ∆± ⊂ i∈I Zαi be the sets of positive and negative roots. Let ∆
∆ + Zδ be the sets of positive and negative affine roots. We put ∆ = ∆+ ⊔ ∆− ,
ˆ =∆
∆    ˆ+ ⊔ ∆ˆ − and ∆(ω
                   ˆ i) = ∆ ˆ + ∩ ωi (∆
                                      ˆ − ). Then,
                                         X
                                 γi =          β.
                                                 ˆ i)
                                               β∈∆(ω

Recall that
              ˆ + = ∆+ ∪                          ˆ − = ∆− ∪
                            [                                       [
              ∆                   (nδ + ∆),       ∆                       (−nδ + ∆),
                            n≥1                                    n≥1

and that ωi (α) = α − (ωi , α)δ for all affine root α. Thus,

                   ˆ i ) = {α − (n − ai )δ | α ∈ ∆− , ai > n ≥ 0},
                   ∆(ω

where we set ai = −(ωi , α). Thus,
                                     X                  1 + ai 
                             γi =             ai α +          δ .
                                                          2
                                     α∈∆−

Let κ be the Killing form. We get
                                       P
                         (γi , αi ) = − α∈∆+ (ωi , α) · (αi , α)
                                    = −κ(ωi , αi )/2
                                    = −c,

see [6, Exercice 6.2].                                                                 ⊓
                                                                                       ⊔
    We fix the Drinfeld generators of U in such a way that

(3.2.1)                   x−     r r
                           ir = oi θi (fi ),      x+     r −r
                                                   ir = oi θi (ei ),

where oi = ±1 and oi + oj = 0 if aij < 0, see [2, Definition 4.6]. Note that there
is exactly two choices for the map i 7→ oi . A case-by-case computation shows that
the integer oi oi does not depend on i : it is equal to (−1)c .
                     CANONICAL BASES AND QUIVER VARIETIES                                  5

Proposition.
  (1) There are unique A-algebra automorphisms A, B : U → U such that

            A(x±
               ir ) = −q
                         ∓1 ±
                           xir ,         B(x+        +
                                            ir ) = −xir ki ,     B(x−        −1 −
                                                                    ir ) = −ki xir .

   (2) We have τ (x±       ∓          ±       ∓
                   ir ) = xi,−r , τ (kir ) = ki,−r .
   (3) We have ψ(x±
                  ir ) = q
                           −rc
                               Tw0 A(x±        ±     rc      ∓
                                      i,−r ), xir = q Tw0 B(xir ).

Proof. Claim 2 is known, see [2]. Claim 1 is a consequence of the identities 3.
Let us prove 3. Let T i , ψ Ti be the automorphisms of the algebra U such that
ψ(Ti (x)) = ψ Ti (ψ(x)), T i (x) = Ti (x) for all x ∈ U. By [13, §37] we have T i = Ti,−1
                                                                                      ′′
                                                                                          .
                                            ψ        ′′
A case-by-case computation gives also Ti = Ti,−1 . If x ∈ Uα , α ∈ Q, we have
                                  ′′
                                Ti,−1 (x) = (−q)−(α,αi ) Ti−1 (x)

for all i, see [13, §37]. Thus,
                                ψ
                                    θi (x)   = θ i (x)
                                             = (−q)−(α,βi ) σ(θi )(x)
                                             = (−q)(α,γi ) σ(θi )(x),

where βi = αik + sik (αik−1 ) + · · · + sik · · · si2 (αi1 ). Note that (α, γi ) = −(α, βi )
since γi = −ωi (βi ). The weight ωi beeing dominant we have Tw0 Tωi = T−ωi Tw0 ,
i.e. Tw0 θi Tw−1
               0
                 = σ(θi )−1 . Recall that

         Tw0 (ei ) = −fi ki ,       Tw0 (fi ) = −k−1
                                                  i ei ,     Tw0 (ki ) = k−1
                                                                          i ,   ∀i 6= 0.

Note that θi (ki ) = ki , see [2]. Using (3.2.1) we get

                            (x+       r     rc
                              ir ) = oi (−q) σ(θi )
                                                    −r
                                                        (ei )
                                   = −oi (−q) Tw0 θi (k−1
                                         r     rc     r
                                                           i fi )
                                   = −q rc Tw0 (k−1
                                                  i x−
                                                     ir ).

Similarly we have
                          ψ(x+
                             ir )        = ori (−q)−rc σ(θi )−r (qki fi )
                                         = −ori (−q)−rc Tw0 θir (q −1 ei )
                                         = −q −1−rc Tw0 (x+ i,−r ).

The case of x−
             ir is identical.                                                              ⊓
                                                                                           ⊔

                         4. Reminder on quiver varieties
4.1. Let the couple (J, H) denote the quiver such that J is the set of vertices, H
is the set of arrows. If h ∈ H let h′ , h′′ ∈ J be the incoming and the outcoming
vertex of h. Let h denote the arrow opposite to h. We will consider the following
cases :
   - Π = (I, H) where I is as in 2.1 and H is such that there are 2δij − aij arrows
from i to j for all i, j. Then, let Ω ⊂ H be any set such that H = Ω ⊔ Ω̄. Let nij
(resp. n̄ij ) be the number of arrows in Ω (resp. Ω̄) from i to j. Note that nij = n̄ji .
                                      ∼
   - Fix a set I 1 with a bijection I → I 1 , i 7→ i1 . The quiver Πe = (I e , H e ) is such
that I e = I ⊔ I 1 , H e = H ⊔ {i → i1 , i1 → i | i ∈ I}.
6                  MICHELA VARAGNOLO AND ERIC VASSEROT

                        C ai , W =           Cℓ i .
               L                     L
4.2. Fix V =      i∈I                  i∈I

                             I                                              +    +
Convention. Fix (mi ) ∈ ZP     . Hereafter let
                                            P µ, λ, α denote
                                                         P elements in P , P , Q
respectively such that µ = i mi ωi , λ = i ℓi ωi , α = i ai αi . The dimension of
the graded vector space V is identified with the root α while the dimension of W
is identified with the weight λ.

The space                 M                           M                            
                Mλα =           Mah′ ah′′ (C) ⊕             Mai ℓi (C) ⊕ Mℓi ai (C)
                          h∈H                         i∈I

is identified with the set of representations of the quiver Πe on V ⊕ W . For any
(B, p, q) ∈ Mλα let Bh be the component of the element B ∈ Hom (Vh′′ , Vh′ ) and
set                            X                     M
               mλα (B, p, q) =     ε(h)Bh Bh + pq ∈      Hom (Vi , Vi ),
                                  h∈H                                i

      ε is a function ε : H → C× such that ε(h) + ε(h) = 0. Put Gλ =
                                                                                       Q
where Q                                                                                i   GLℓi ,
Gα = i GLai . The group C× × Gλ × Gα acts on Mλα by

                (z, gλ , gα ) · (B, p, q) = (zgα Bgα−1 , zgα pgλ−1 , zgλ qgα−1 ).

Following [19] , we consider the varieties

                 (µ)                         (µ) 
                                                      and Nλα = m−1
                                 L
               Qλα = Proj            n≥0   An                    λα (0)//Gα ,


where // is the categorical quotient,

                      −1
          A(µ)                                           −n
                                                                    	
           n = f ∈ C[mλα (0)] f gα · (B, p, q) = χµ (gα )   f (B, p, q) ,
                             

                                                                      (µ)
and χµ (gα ) = i Det (gai )mi . The obvious projection πλα : Qλα → Nλα is a
                Q
projective map. If µ, µ′ are such that mi , m′i > 0 for all i, or mi , m′i < 0 for all i,
                     (µ)  (µ′ )
then the varieties Qλα , Qλα are canonically isomorphic. There is an open subset
m−1
  λα (0)
        (µ)
            ⊂ m−1
               λα (0) whose points are called µ-semistable, such that there is a good
              −1
quotient of mλα (0)(µ) by the group Gα and we have

                                                               (µ)
(4.2.1)                            m−1
                                    λα (0)
                                          (µ)
                                              //Gα = Qλα ,

see [18, §1.7] for instance. Moreover, if µ is a regular weight then (4.2.1) is a
                                      (µ)
geometric quotient and the variety Qλα is smooth, see [21, Proposition 2.6]. If µ is
                                                          (µ)
regular dominant, i.e. if mi > 0 for all i, we set Qλα = Qλα .

Convention. Hereafter, we assume that (µ, α) 6= 0 for any root α.
4.3. Put dλα = dim Qλα . It is known that dλα = (α, 2λ−α). If α ≥ β the extension
by zero of representations of the quiver gives a closed embedding Nλβ ֒→ Nλα . For
any α, α′ , we consider the fiber product

                                   Zλαα′ = Qλα ×π Qλα′ .
                    CANONICAL BASES AND QUIVER VARIETIES                                   7

If α′ = α + nαi , n > 0, let Xλαα′ ⊂ Zλαα′ be the set of pairs (x, x′ ) which are the
Gα -orbits of Πe -modules y, y ′ in Mλα, Mλα′ with y a subrepresentation of y ′ . If
α′ = α − nαi , put Xλαα′ = φ Xλα′ α ⊂ Zλαα′ , where φ is the automorphism of
Qλ × Qλ taking an element (x, y) to (y, x). The variety Xλαα′ is smooth, see [20,
§5.3]. Consider the following varieties
       [                G                G                 G                    G
Nλ =     Nλα , Qλ =        Qλα , Zλ =       Zλαα′ , Xλ =       Xλαα′ , Fλ =        Fλα ,
          α              α                  α,α′              α,α′                     α

                                                          −1
where α, α′ take all the possible values in Q+ and Fλα = πλα (0).
4.4. For any complex algebraic linear group G, and any quasi-projective G-variety
X let KG (X) be the Grothendieck group of G-equivariant coherent sheaves on X.
We put RG = KG (point). Let XG ⊂ RG be the set of the simple modules.        V If the
                                            i
G-equivariant sheaf E is locally free,
                                    V  let ∧  E is its i-th wedge power, and  E be its
maximal wedge power. Note that E is still defined, in the obvious way, whenever
E is a G-equivariant complex on X.

Convention. Hereafter, let f∗ , f ∗ , ⊗, denote the derived functors Rf∗ , Lf ∗ , ⊗L
when they exist. Here ⊗ is the tensor product of coherent sheaves. We use the
same notation for a sheaf and its class in the Grothendieck group.
4.5. Set G̃λ = Gλ × C× . Let q denote also the character of the group C× such
that z 7→ z. The canonical bundle of the variety Qλα is

(4.5.1)                             ΩQλα = q −dλα ,

see [24, §6.4] for instance. Let Vi , Wi be the vectorial representations of the groups
GLai , GLℓi . Consider the following elements in RG̃λ ×Gα
                                       X
       Fi+ = q −1 Wi − q −2 Vi + q −1        Vj , Fi− = −Vi , Fi = Fi+ + Fi− .
                                     aij =−1

                                        (µ)
The group G̃λ acts on the variety Qλα . If E is a G̃λ × Gα -module, let E (µ) =
                                                (µ)
m−1
 λα (0)
       (µ)
           ×Gα E be the induced G̃λ -bundle on Qλα . There is a unique ring homo-
morphism
                                                (µ)
                            RG̃λ ×Gα → KG̃λ (Qλα )
                                                                     (µ)
such that E 7→ E (µ) for all E.L            L we set Vi = Vi
                                If µ is dominant                           and similarly for
Wi , Fi± , Fi . We set also V = i Vi , W = i Wi .
                                      (µ)                    (µ)
Convention. The restriction to Qλα of a sheaf E on Qλ              is denoted by Eα . For
simplicity we set Fi;α = (Fi )α , etc.

4.6. Consider the map

              † : Mλα → Mλα , (B, p, q) 7→ (B, p, q)† = (−εt B, −t q, t p),

where the upperscript t stands for the transpose map. Note that † does not commute
to the action of the group G̃λ × Gα . Let † be the group automorphism of G̃λ × Gα
such that
                   † : (z, gλ , gα ) 7→ (z, gλ , gα )† = (z, t gλ−1 , t gα−1 ).
8                   MICHELA VARAGNOLO AND ERIC VASSEROT

                                                                                          (µ)
Then (g · x)† = g † · x† for all g ∈ G̃λ × Gα , x ∈ Mλα . The induced map † : Qλα →
 (−µ)
Qλα is an isomorphism of algebraic varieties. Let

                              † : RG̃λ ×Gα → RG̃λ ×Gα , E 7→ E †

be the ring automorphism induced by the group automorphism †. For any element
                                      (µ)                                      (−µ)
E ∈ RG̃λ ×Gα , let (E (µ) )† ∈ KG̃λ (Qλα ) be the pull-back of E (−µ) ∈ KG̃λ (Qλα )
by the automorphism †. We have

(4.6.1)                                   (E (µ) )† = (E † )(µ) .

   For any w ∈ W we set w ∗ α = λ − w(λ) + w(α). The element w ∗ α depends
on the weight λ. However, since λ is fixed in the whole paper the notation w ∗ α
should not make any confusion. There is a G̃λ -equivariant isomorphism of algebraic
                (µ)    (w(µ))
varieties Sw : Qλα → Qλ,w∗α for each w, such that

                Si2 = 1   and Sww′ = Sw Sw′ if l(ww′ ) = l(w) + l(w′ ),

see [15], [18], [21] (for simplicity we set Si = Ssi , where si is the simple reflexion
with respect to the root αi ). The precise definition of Sw is given in the proof of
Lemma 4.6. Consider the composed map ω = Sw0 † . This choice is motivated by
[16] and [21, Theorem 11.7]. The map ω is an isomorphism of algebraic varieties
      ∼
Qλα → Qλ,w0 ∗α .
Lemma.
    (1) We have ω ∗ (Fi ) = −q c Fi† , ω ∗ (Wi ) = Wi† and

                              [aij ] ω ∗ (Vj ) + q c Vj† = Wi† + q c Wi† .
                          X                             
                          j


    (2) We have ω 2 = Id .
    (3) We have ω(Fλα ) = Fλ,w0 ∗α .

Proof. We use the construction of the operator Sw P     given in [18], see also [15]. Let
us recall it briefly. Set α′ = si ∗ α, µ′ = si (µ), µ′ = i m′i ωi . Let first assume that
mi < 0. Then m′i > 0. Following [15, §3.2], let

                               Ziµ ⊂ m−1
                                                                      ′

                                      λα (0)
                                            (µ)
                                                × m−1
                                                   λα′ (0)
                                                          (µ )



be the set of pairs (x, x′ ), where x = (B, p, q), x′ = (B ′ , p′ , q ′ ) are such that
   – the sequence of G̃λ × Gα -modules

                                 a(x′ )                     M         b(x)
                  0 −→ q −2 Vi′ −→ q −1 Wi ⊕ q −1                   Vj −→ Vi −→ 0
                                                          aij =−1


such that a(x′ ) = (qi′ , Bh′ ), b(x) = pi + εh̄ Bh is exact,
   – we have a(x)b(x) − a(x′ )b(x′ ) = 0,
   – we have Bh = Bh′ if h′ , h′′ 6= i, and pj = p′j , qj = qj′ if j 6= i.
                    CANONICAL BASES AND QUIVER VARIETIES                                                                     9

Note that a(x′ ) is injective and b(x) is surjective, see [18, Lemma 38]. Thus Ziµ
                        −1    (µ)    −1    (µ′ )
         Q subset of mλα (0) × mλα′ (0) . Consider the group Gαα = GLai ×
is a closed                                                            ′

GLa′i × j6=i GLaj . The categorical quotient

                                             Qµi = Ziµ //Gαα′ ,

is a smooth variety. Moreover, the obvious projections are isomorphisms of algebraic
varieties
                       (µ)       ∼   (µ)    (µ′ )     ∼    (µ′ )
                      p1,α : Qµi → Qλα , p2,α′ : Qµi → Qλα′ ,

see [18, Proposition 40]. The group G̃λ acts in the obvious way on Qµi , making the
        (µ)  (µ′ )
maps p1,α , p2,α′ equivariant. By construction, for any i 6= j we have

                       (µ)         (µ)                    (µ)                (µ′ )                     (µ′ )
                    (p1α )∗ (Fi          + q −2 Vi              ) = (p2α′ )∗ (q −2 Vi                          ),
(4.6.2)
                       (µ)         (µ)                 (µ′ )             (µ′ )
                    (p1α )∗ (Vj          ) = (p2α′ )∗ (Vj                        ).

We set (recall that mi < 0)

                                         (µ′ )     (µ)                     (µ)              (µ′ )
                             Si = p2α′ (p1α )−1 : Qλα → Qλα′ .

If mi > 0 we set
                                         (µ′ )     (µ)                     (µ)              (µ′ )
                             Si = p1α′ (p2α )−1 : Qλα → Qλα′ .
Using (4.6.2) we get, if mi < 0 and i 6= j,

                         (µ′ )                   (µ)           (µ)                     (µ′ )               (µ)
                   Si∗ (Vi       ) = q 2 Fi            + Vi          ,       Si∗ (Vj           ) = Vj               .

Note that the map Si commutes to the action of the group G̃λ . Thus,

                                                         (µ)                (µ′ )
                                           Si∗ (Wj ) = Wj

for all j. Set εi = +1 if mi > 0, εi = −1 if mi < 0. A case-by-case analysis gives
                                   (µ′ )
the following equalities in KG̃λ (Qλ )
                               2ε (µ′ )
                               −q ′ Fj                                               if     i=j
                                     i
                              
                         (µ)
                   Si∗ (Fj ) = Fj(µ )                                                 if     aij = 0
                              
                               (µ′ )       (µ′ )
                                Fj + q εi Fi                                          if     aij = −1.

The general formula is

                                      (µ)                 (µ′ )                            (µ′ )
(4.6.3)                      Si∗ (Fj ) = Fj                       − q εi [aij ]Fi                  .

                                                                                                   (µ)
We now assume that the weight µ is dominant. Thus, Fj                                                    = Fj . Fix an element
w in the Weyl group. Let us prove that

                                     ∗                                                     (w −1 (µ))
(4.6.4)               w(αi ) = αj ⇒ Sw (Fj ) = q a(w,i) Fi                                                ,
10                      MICHELA VARAGNOLO AND ERIC VASSEROT

where
                                               1         X
                                  a(w, i) =                           (αi , α)2 .
                                               2
                                                   α∈∆+ ∩w −1 ∆−

We may assume that l(w) > 0 and that (4.6.4) holds for any x with l(x) < l(w). Fix
k ∈ I such that w(αk ) ∈ −Q+ . Let hsi , sk i be the subgroup generated by si , sk . Let
x be the element of minimal length in the set whsi , sk i. Then, x(αi ), x(αk ) ∈ Q+ .
One of the following two cases holds, see [12, Proof of Proposition 1.8].
   – Either aik = 0, w = xsk , l(w) = l(x) + 1. Then, x(αi ) = αj . Using (4.6.4) for
x, and (4.6.3), we get

                           ∗                             (x−1 (µ))                        (µ)
                          Sw (Fj ) = q a(x,i) Sk∗ (Fi                ) = q a(x,i) Fi            .

Using the identity

                           ∆+ ∩ w−1 ∆− = sk (∆+ ∩ x−1 ∆− ) ∪ {αk }

we get also a(w, i) = a(x, i). Thus (4.6.4) holds.
   – Either aik = −1, w = xsi sk , l(w) = l(x) + 2. Then, x(αk ) = αj . Using (4.6.4)
for x we get
                         ∗                            (x−1 (µ))
                        Sw (Fj ) = q a(x,k) Sk∗ Si∗ (Fk         ).
We are reduced to the A2 case. Set ν = x−1 (µ). We have w−1 (µ) = sk si (ν) <
si (ν) < ν. A direct computation using (4.6.3) gives
                                                   (ν)         (sk si (ν))
                                       Sk∗ Si∗ (Fk ) = qFi                   .

Using the identity

                      ∆+ ∩ w−1 ∆− = sk si (∆+ ∩ x−1 ∆− ) ∪ {αk , αi + αk }

we get also a(w, i) = a(x, k) + 1. Thus (4.6.4) holds.
     Setting w, i, j → w0 si , i, i in (4.6.4) and using the formula for Si∗ , we get Sw
                                                                                       ∗
                                                                                         0
                                                                                           (Fi ) =
                  (w0 (µ))
−q a(w0 si ,i)+2 Fi           . Thus

(4.6.5)                                ω ∗ (Fi ) = −q a(w0 si ,i)+2 Fi† ,

see (4.6.1). Moreover we have, see 3.2,
                                                    1                       2
                                                         P
                                a(w0 si , i)   =    2   α∈∆+ \{αi } (αi , α)
                                                    1
                                    =               4 κ(αi , αi ) − 2
                                    = c − 2.
                                         P
  By definition we have qFi = Wi − j [aij ]Vj . Using (4.6.1), (4.6.5) and the
equality aij = aij we get the identity

                               [aij ]ω ∗ (Vj ) = Wi† + q c Wi† − q c                 [aij ]Vj† .
                         X                                                 X

                          j                                                      j
                            CANONICAL BASES AND QUIVER VARIETIES                                      11

Claim 1 is proved.
  From the definition of the operator Si we get †Si = Si † for all i. Claim 2 follows
immediately.
    We now prove Claim 3. Using Claim 2 it is sufficient to prove that ω(Fλα ) ⊆
Fλ,w0 ∗α . Assume that α′ = si ∗ α, µ′ = si (µ) as above. It is sufficient to prove that
     (µ)       (µ′ )
Si (Fλα ) ⊆ Fλα′ . By [10,§1.3] the ring of Gα -invariant polynomials on m−1    λα (0) is
generated by the following two types of functions :
       (i) tr Vj (Bh1 Bh2 · · · Bhn ) for any sequence h1 , h2 , ..., hn ∈ H such that j = h′1 ,
h′′1   = h′2 ,..., h′′n−1 = h′n , h′′n = j,
     (ii) ϕ(qj Bh1 Bh2 · · · Bhn pk ) for any sequence h1 , h2 , ..., hn ∈ H such that j =
h′1 , h′′1 = h′2 ,..., h′′n−1 = h′n , h′′n = k, and any linear form ϕ on Hom (Wk , Wj ).
We may assume that mi < 0. Fix an element (x, x′ ) in Ziµ . Set x = (Bh , pj , qj ),
x′ = (Bh′ , p′j , qj′ ). In particular we have

                    Bh = Bh′ if h′ , h′′ 6= i;   Bh1 Bh2 = Bh′ 1 Bh′ 2 if h′′1 = h′2 = i.

Thus any function of type (i) coincide on x and x′ . We have also

                               qj = qj′ , pj = p′j if j 6= i;   qi pi = qi′ p′i ;


                          qi Bh = qi′ Bh′ if h′ = i;   Bh pi = Bh′ p′i if h′′ = i.
                                                                                                (µ)
Thus any function of type (ii) coincide on x and x′ . In particular x ∈ Fλα iff
              ′
           (µ )
x′ ∈ Fλα′ . We are done.                                                                              ⊓
                                                                                                      ⊔
                                                                 (µ)
Remark. The dual of the G̃λ -bundle E (µ) on Qλ is (E ∗ )(µ) , where E ∗ is the
dual module, obtained by composing the G̃λ -action by the group automorphism
(z, gλ , gα ) 7→ (z −1 , t gλ−1 , t gα−1 ). Note that, in the particular case where E = Vi , Wi
we have Vi† = Vi∗ , Wi† = Wi∗ .

Convention. Put 1λα = OFλα , 1′λα = OQλα . It is convenient to set also 1λ = 1λ0 ,
1′λ = 1′λ0 . To simplify the notations we put ν = w0 ∗ 0.

                      5. The involution on the convolution algebra
5.1. Given smooth quasi-projective G-varieties X1 , X2 , X3 , consider the projection
pab : X1 × X2 × X3 → Xa × Xb for all 1 ≤ a, b ≤ 3, a 6= b. Fix closed subvarieties
Zab ⊂ Xa × Xb such that the restriction of p13 to p−1           −1
                                                    12 Z12 ∩ p23 Z23 is proper and
maps to Z13 . The convolution product is the map

                  KG (Z12 ) × KG (Z23 ) → KG (Z13 ),        (E, F ) 7→ p13 ∗ (p∗12 E) ⊗ (p∗23 F ) .
                                                                                                 
        ⋆ :

If Z12 = Z23 = Z13 = Z, the map ⋆ endows KG (Z) with the structure of an
RG -algebra. See [4] for more details.
12                 MICHELA VARAGNOLO AND ERIC VASSEROT

5.2. Let DXa be the Serre-Grothendieck duality operator on KG (Xa ). Assume
that Xa is connected. Let ΩXa be the canonical bundle of Xa , and let OXa be the
structural sheaf. We have

                             DXa (E) = (−1)dim Xa E ∗ ⊗ ΩXa

for any G-equivariant locally free sheaf E on Xa . Assume that there is a character
q of the group G such that ΩXa = q − dim Xa for all a. Consider the operator
DZab = q dab DZab , where dab = (dim Xa + dim Xb )/2. Recall that the automorphism
φ : Xa × Xb → Xb × Xa is the flip.
Lemma. Fix x ∈ KG (Z12 ), y ∈ KG (Z23 ).
  (1) φ∗ (x⋆y) = φ∗ (y)⋆φ∗ (x), DZ12 (x)⋆DZ23 (y) = DZ13 (x⋆y), φ∗ DZab = DZba φ∗ .
  (2) If Z12 = Z23 = Zλ then (ω × ω)∗ (x) ⋆ (ω × ω)∗ (y) = (ω × ω)∗ (x ⋆ y).
  (3) If Z12 = Zλ , Z23 = Qλ or Fλ then (ω × ω)∗ (x) ⋆ ω ∗ (y) = ω ∗ (x ⋆ y).

See [14] for more details.
5.3. We consider the maps γλ , γλ′ , Γλ , ζλ on KG̃λ (Fλ ), KG̃λ (Qλ ), KG̃λ (Zλ ) such
that
              γλ = α q dλα /2 ω ∗ DFλα , γλ′ = α q 3dλα /2 ω ∗ DQλα ,
                   L                            L

                Γλ = α,α′ (ω × ω)∗ DZλαα′ , ζλ = (ω × ω)∗ φ∗
                     L

(see Lemma 4.6.3 for γλ ). Let

                               ¯ : RG̃λ → RG̃λ , V 7→ V̄

be the ring automorphism induced by the group automorphism G̃λ → G̃λ , (z, gλ ) 7→
(z −1 , gλ ). By Lemma 4.6.1 the operators ω ∗ , ζλ are †-semilinear automorphisms
of RG̃λ -modules, and γλ , γλ′ , Γλ are ¯-semilinear. Let κ : Fλ ֒→ Qλ be the closed
embedding.
Lemma. The following identities hold :
  (1) ω ∗ DFλ = DFλ ω ∗ , ω ∗ DQλ = DQλ ω ∗ , (ω × ω)∗ DZλ = DZλ (ω × ω)∗ ,
  (2) κ∗ ω ∗ = ω ∗ κ∗ , (ω × ω)∗ φ∗ = φ∗ (ω × ω)∗ , (κ∗ × κ∗ )φ∗ = φ∗ (κ∗ × κ∗ ),
  (3) γλ (u ⋆ x) = Γλ (u) ⋆ γλ (x), for any x ∈ KG̃λ (Fλ ), u ∈ KG̃λ (Zλ ),
  (4) γλ′ (u⋆x) = q dλα −dλα′ Γλ (u)⋆γλ′ (x), for any x ∈ KG̃λ (Qλα′ ), u ∈ KG̃λ (Zλαα′ ).

5.4. Let Aλαα′ be the quotient
                        L       of the RG̃λ -module KG̃λ (Zλαα′ ) by its torsion
submodule. We set Aλ =     α,α′ Aλαα′ . Setting Z12 = Z23 = Zλ in 5.1, we get
                                                           ×
an associative product on the space Aλ . The rings RC , A are identified as in 4.5.
An A-algebra homomorphism Φλ : U → Aλ is given in [20]. In this subsection
we fix a particular normalization for Φλ . Let δ : Qλ ֒→ Qλ × Qλ be the diagonal
embedding, and let p, p′ : Qλ × Qλ → Qλ be the first and the second projection.
            ±                                  ±
Let fi;α , fi;α , vi;α be the ranks of Fi;α , Fi;α , Vi;α . We have
                                            −
                    fi;α = (αi , λ − α),   fi;α = −vi;α = −(ωi , α).

Set tα = (α, 2λ − α)/2 + |α|2 , and
         +                                         −
                                P                                P                
        ri;α = (λ, αi ) − ωi − j nij ωj , α ,     ri;α = − ωi −     j   n̄ij ωj , α .
                      CANONICAL BASES AND QUIVER VARIETIES                                                               13

Let 1λαα′ ∈ Aλ be the class of the structural sheaf of Xλαα′ . For any r ∈ Z we put
                                    +                                     −
                                   ri;α             V−1                r+fi;α             ∗ V−1        Vtα′ −tα
                   X
x+      (1−c)r
                                            (q −1                                  ⊗ p′
                                                                 V
 ir = q                     (−1)        ′
                                                        V   ⊠        V)
                                                                              ′
                                                                                             Fi+
                                                                                                   ⊗     W        ⊗ 1λαα′ ,
                 α′ =α+αi

                                 −                                        +
                                ri;α                            V−1    r+fi;α             ∗ V−1        Vtα′ −tα
                   X
x−      (1−c)r
                                            (q −1                                 ⊗ p′
                                                    V
 ir = q                     (−1)     ′
                                                     V      ⊠     V   )       ′
                                                                                             Fi−
                                                                                                   ⊗     W        ⊗ 1λαα′ .
                 α′ =α−αi

Let also ki± (z) be the expansion at z = ∞ or 0 of
          X                                                                −1
              q fi;α           −c
                                  /z)r ∧r Fi;α ⊗          2−c
                                                              /z)r ∧r Fi;α
                     P                          P
       δ∗              r≥0 (−q                    r≥0 (−q                      .
           α

The map Φλ takes x±      ±         ±      ±
                  ir to xir , and kir to kir . For a future use, let us mention the
following.
Lemma. For any n > 0 we have
                                                                   −
                                              V−1                 fi;α            ∗ V−n        Vtα′ −tα
                        X
      (x+   (n)
                                    (q −n                                  ⊗ p′
                                                            V
        i0 )    =±                              V       ⊠       V)
                                                                       ′
                                                                                     Fi+
                                                                                           ⊗     W        ⊗ 1λαα′ ,
                     α′ =α+nαi


and similarly for (x−
                    i0 )
                        (n)
                            .
Proof. By the same argument as in [20, §11.1-3] it is enough to check this relation
for type A1 . In this case, using the faithful representation introduced in [22] the
formula follows from a direct computation : the formula for the action of the
operator (x+
           i0 )
               (n)
                   may be found in [20, Lemma 12.1.1], its relation with the identity
above is proved as in [22].                                                         ⊓
                                                                                    ⊔

                                                                                       ∗
Convention. Hereafter we may omit the maps δ∗ , p∗ , p′ , ⊗, hoping that it makes
no confusion.
5.5. Let Hλ ⊆ Gλ be any closed subgroup. Set H̃λ = Hλ × C× . For simplicity
we set WHλ ,α = KH̃λ (Fλα ), WH ′
                                  λ ,α
                                       = KH̃λ (Qλα ), WHλ = ⊕α WHλ ,α , WH
                                                                         ′
                                                                           λ
                                                                             =
     ′
⊕α WHλ ,α . Taking Z12 = Zλ , X3 = {point}, and Z13 = Z23 = Qλ or Fλ in 5.1 we
                                                ′
get a left U-action on the RH̃λ -modules WHλ , WH λ
                                                    such that

                                      (u, x) 7→ u · x = Φλ (u) ⋆ x.

Taking Z23 = Zλ , X1 = {point}, and Z12 = Z13 = Qλ or Fλ we get a right U-action
            ′
on WHλ , WH   λ
                such that x · u = x ⋆ Φλ (u) = φ∗ Φλ (u) ⋆ x, see Lemma 5.2. We fix
a maximal torus Tλ ⊂ Gλ .
Lemma.
                                   ′
  (1) The RH̃λ -modules WHλ , WH       λ
                                         are free of finite type, and we have WHλ =
                          ′          ′
                    H̃λ
      WGλ ⊗Rλ R , WHλ = WGλ ⊗Rλ RH̃λ . Moreover, there is a canonical
      action of the Weyl group of Gλ on WTλ , WT′ λ such that the forgetful map
                          ′
      identifies WGλ , WG   λ
                              with the subspaces of invariant elements in WTλ ,
         ′
      WTλ .
  (2) We have WHλ = U · (RHλ ⊗ 1λ ).
  (3) We have WGλ = U · 1λ .
14                      MICHELA VARAGNOLO AND ERIC VASSEROT

Proof. Claim 1 is proved in [20, Theorem 7.3.5]. See also [4, Chapter 5]. Claim
2 is proved as in [20, Proposition 12.3.2]. Let us prove that, if Hλ = Gλ , then
RGλ ⊗ 1λ ∈ U · 1λ . By construction k±i (z) · 1λ is the expansion of

                                                                         −1
               q fi;0                  r
                                               ∧r Wi ⊗             r r
                        P                             P
                            r≥0 (−1/qz)                  r≥0 (−q/z) ∧ Wi


in RG̃λ [[z −1 ]]. Thus, the elements pi,s ∈ RGLℓi are the elementary symmetric
polynomials or zero. Claim 3 follows.                                        ⊓
                                                                             ⊔

Convention. Although most of our constructions are meaningful for any closed
subgroup Hλ ⊆ Gλ , hereafter Hλ will be either Gλ or Tλ . For simplicity, if Hλ = Gλ
we put Wλ = WGλ , Wλ′ = WG    ′
                                λ
                                  , Rλ = RG̃λ , Xλ = XGλ .
5.6. The same construction as in 5.5 yields also a left and a right action of Aλ on
           ′                   ′
WHλ , WH     λ
               . Since WHλ , WH  λ
                                   are integrable left U-modules, they admit a left
  H̃λ
R -linear action of the group BW . We normalize this action in such a way that
                                               ′′
the element Ti ∈ BW acts as the operator Ti,1     in [13, §5.2.1]. Similarly let Ťw be
the left action of the element Tw ∈ BW associated to the right U-action.
Proposition.
     (1) There is a unique action of the group BW on Aλ by RH̃λ -algebra automor-
         phisms such that
                                                                          ′
         Tw (x ⋆ y) = Tw (x) ⋆ Tw (y),              ∀x ∈ Aλ , y ∈ WHλ or WH λ
                                                                              , w ∈ W.

     (2) We have Tw Φλ = Φλ Tw , and Ťw (y ⋆ x) = Ťw (y) ⋆ σ(Tw )(x) for any x, y as
         above.
     (3) There is an invertible element rλ ∈ RH̃λ such that Tw0 (1′λν ) = rλ ⊗ 1′λ ,
         Tw0 (1λν ) = rλ ⊗ 1λ .
     (4) There is an invertible element sλ ∈ RH̃λ such that Tw0 (1′λ ) = sλ ⊗ 1′λν ,
         Tw0 (1λ ) = sλ ⊗ 1λν .
                                                                               Vt
     (5) There is an invertible element ϑ ∈ A such that rλ ⊗ 1λν = ϑ ⊗ Wν ⊗
         N V−vi;ν                          (ρ,ν)               2
           i   Vi;ν . Moreover rλ sλ = (−q)      and ϑ = ±q |ν| /2+c(λ,λ)/2 .

Proof. Let us prove Claim 1. We fix elements i ∈ I, λ ∈ P + . Let U′i ⊂ U′ be the
subalgebra generated by ei , fi , ki±1 . The proof uses an element τi′ introduced in
[17]. The element τi′ belongs to a ring completion of U′i , is invertible, and satisfies
the following identity
                                               −1
                               τi′ · x · τi′            ′
                                                    = Ti,1 (x),   ∀x ∈ U.

Let us recall the construction of τi′ , following [5].
                                                                                   ∗
   For any Q(q)-vector space V we set V ∗ = Hom Q(q) (V, Q(q)). Let R′i ⊂ U′i
be the Q(q)-space spanned by thePmatrix elements of the finite dimensional U′i -
                                                                                   ′
modules. It is a Hopf algebra. Let x0 ⊗x1 denote the image of the  Pelement x ∈ Ri
                                  ∗
by the coproduct. The space R′i is a ring such that (f · g)(x) = f (x0 ) g(x1 ) for
                                             ∗
all x ∈ R′i . The canonical map U′i → R′i is a ring homomorphism. An integrable
U′ -module V restricts to an integrable U′i -module via the canonical embedding
U′i ⊂ U′ . It is also a R′i -comodule for the co-action V → R′i ⊗ V , v 7→
                                                                           P
                                                                             v1 ⊗ v2
                    CANONICAL BASES AND QUIVER VARIETIES                              15

                                                                              ∗
                          v1 (x) v2 for all x ∈ U′i . Therefore the ring R′i acts on V
                      P
such that xP· v =
by f · v =     f (v1 ) v2 . This action restricts to the original U′i -action via the map
         ′∗                  ∗
Ui → Ri . Let τi ∈ R′i be the element denoted by t in [5, §1.6]. It is invertible.
  ′

Let ti be the operator on V taking v to τi · v. It is invertible and the inverse takes
v to τi−1 · v. We have
                               ′′
                    ti (v) = Ti,−1 (v),     ti xt−1        ′′
                                                 i (v) = Ti,−1 (x) · v,

for all x ∈ U′ and v ∈ V , by [5, §2]. Therefore

                          τi · x · τi −1 = Ti,−1
                                             ′′
                                                 (x),      ∀x ∈ U′ ,

where we take the product in the ring R′i ∗ in the left hand side.
    For any n ∈ N let Λi (n) be the simple U′i -module with highest weightL nωi . Let
Rin ⊂ R′i be the subspace spanned by matrix elements of the module n′ ≤n Λi (n′ ).
  ′

It is a subcoalgebra. Let I′in ⊂ U′i be the annihilator of n′ ≤n Λi (n′ ). It is a two-
                                                              L
                                                   ∗
sided ideal. The canonical map U′i → R′i factorizes through an isomorphism
          ∼
U′i /I′in → (R′in )∗ . Since R′i = lim R′in , we get a Q(q)-algebra isomorphism
                                 −→ n

                                                  ∼        ∗
                                  lim (U′i /I′in ) → R′i .
                                  ←− n

For each n we choose τin ∈ U′i such that

                              τin − τi ∈ lim         (I′in /I′in′ ).
                                          ←− n′ ≥n


   Since U′i embeds in U′ , the space Aλ ⊗A Q(q) is a U′i ⊗A RH̃λ -bimodule of finite
type over RH̃λ ⊗A Q(q). In particular there is an integer n such that the ideal I′in
                                                                               ′′
acts trivially on Aλ ⊗A Q(q). Fix such an integer n. Then the operator Ti,−1       acts
on Aλ ⊗A Q(q) via the conjugation by the element Φλ (τin ) ∈ Aλ ⊗A Q(q). Moreover,
the formulas in [5, §2] imply that the left and right product by Φλ (τin ), Φλ (τin −1 )
preserves the subspace Aλ ⊂ Aλ ⊗A Q(q).
                                               ′′
   Recall that Ti acts as Lusztig’s operator Ti,1 . The element τi′ yielding the action
     ′′
of Ti,1 on Aλ can be constructed as τi , using the identity

                             ′′
                           Ti,1 (x) = (−q)(α,αi ) (Ti,−1
                                                     ′′
                                                         )−1 (x)

for any x ∈ Uα , see [13, §37.2.4].
   Recall that Nλ is a cone over the point 0 equal to the class of the trivial rep-
                                                       ×
resentation, and that the fixed points subset (Nλ )C is reduced to {0}. Hence
Aλ ⊗A Q(q) coincides with the tensor product (WGλ ⊗RG̃λ WGλ ) ⊗A Q(q) by the
Kunneth isomorphism, see [4, 5.6] and [20,§7]. Since Aλ is torsion free over A, it
embeds in Aλ ⊗A Q(q). Then, a standard argument implies that WGλ is a faithful
                                                               ′
Aλ -module, see [4, §5] for more details. For the same reason WH λ
                                                                   is also a faithful
Aλ -module. The unicity in Claim 1 follows.
   Claim 2 is obvious from the previous construction. Claims 3,4 are obvious either
since Tw0 is an invertible RH̃λ -linear homomorphism from WH  ′
                                                                λ ,0
                                                                         ′
                                                                     to WH λ ,ν
                                                                                , and
both RH̃λ -modules are free of rank one, generated by 1′λ , 1′λν respectively.
16                 MICHELA VARAGNOLO AND ERIC VASSEROT

   Let us prove Claim 5. Part two of the claim follows from [11, 5.4.(a) and
                                                ′
Corollary
     P 5.9] (note thatP the formula for s in [11, 5.4.(a)] should be replaced by
 ′
s = i,j aij ti tj /2 − i ti (1 + di )). Let us prove Part one. Consider an element
w ∈ W such that l(w) > 0. Fix i ∈ I such that l(si w) = l(w) − 1. Put w′ = si w.
Set α′ = w′ ∗ ν, α = w ∗ ν, n = (ww0 (λ), αi ). Thus n > 0 and α = α′ − nαi . We
have
                                               (n)
                                Ti (1′λα′ ) = ei (1′λα′ ),

see [11, Lemma 5.6]. Let rw ∈ RH̃λ be the unique element such that Tw (1′λν ) =
rw 1′λα . The varieties Qλα , Qλα′ are reduced to a point. Thus, using Lemma 5.4 we
get
                                  V V fi;α  − V
                                                  −n Vtα′ −tα
               Tw (1′λν ) = ± q −n −1
                                    V α V α′
                                               ′
                                                  F+     W    (rw′ 1′λα ).
                                                                   i;α′

                                                            +
The classes of the H̃λ -equivariant sheaves Vi;α , Vi;α′ , Fi;α′ are identified with ele-

ments of RH̃λ in the obvious way. Let first assume that we have

                                                                ∈ RH̃λ .
                                     V                 V
(5.6.1)                                    +
                                          Fi;α ′
                                                   =     Vi;α


Then
                      V−vi;α′ Vvi;α Vtα′ −tα
          rw = ±q s      Vi;α′     Vi;α    W           rw′ , where s = (α′ − α, ωi )(α′ , ωi ).

By induction on l(w) we get
                                             Vtν −tα Y V−vj;ν Vvj;α
(5.6.2)                          rw ∈ ±q Z         W             Vj;ν      Vj;α .
                                                           j

                                            Vt Q V−v
Setting w = w0 in (5.6.2) we get rλ = ϑ Wν i Vi;νi;ν , with ϑ ∈ ±q Z . A direct
computation gives ϑ ∈ ±q t , where

                        t = |ν|2 /2 + α∈∆+ (λ, α)2 /2
                                         P

                             = |ν|2 /2 + c(λ, λ)/2,

see [6, Exercice 6.2].
                                                                                           (µ)    (µ′ )
   Finally, we prove (5.6.1). We have an isomorphism of G̃λ -varieties Qλα → Qλα′ ,
see the proof of Lemma 4.6 and the notations therein. This isomorphism takes
  (µ)                                                                  (µ)
      to (Fi+ )(µ ) . Assume that µ is regular dominant, so that Qλα = Qλα and
                 ′
Vi
  (µ)
Vi    = Vi;α . Since the G̃λ -variety Qλα′ is reduced to a point, it is canonicaly
                   (µ′ )                          +          + (µ′ )
isomorphic to Qλα′ , and the isomorphism takes Fi;α ′ to (Fi )       .          ⊓
                                                                                ⊔
5.7. For each i, α we consider the elements
                                      +          +       −
                  gi;α = −1 + (c − 1)fi;w0 ∗α
                                              + fi;α − cfi;w0 ∗α
                                                                 ∈ Z,

                           +                               −
                   hi;α = ri;w0 ∗α
                                   + dλ,w0 ∗α−αi ,w0 ∗α + ri;α ∈ Z/2Z.
                            ±
Convention. The elements ri;α   depend on the choice of the orientation Ω. Here-
after we assume that nij = nij for all i, j if c is even, and nij = n̄ij for all i, j if
                       CANONICAL BASES AND QUIVER VARIETIES                                       17

c is odd (i.e. if g is of type A2n ). The existence of such an orientation is checked
case-by-case.

Using the convention above, a direct computation gives

          gi;α+αj + gj;α = gj;α+αi + gi;α ,         hi;α+αj + hj;α = hj;α+αi + hi;α

for all i, j. Thus there are unique quadratic maps x : Q → Z, y : Q → Z/2Z such
that

               x(ν) = (c − 1)|ν|2 − c(λ, λ),           x(α + αi ) − x(α) = cvi;ν − gi;α ,
(5.7.1)
               y(ν) = 0,                               y(α + αi ) − y(α) = hi;α ,

for all α, i. Put ξ(α) = q x(α) , ̺(α) = (−1)y(α) , tαα′ = tw0 ∗α′ − tα′ − tw0 ∗α + tα .
Consider the element
                         2 Vt      N V2vi;ν V                   
    cλα = ̺(α)ξ(α)q −c|α| W0α ⊗ i        Vi;α ⊗    V ⊗ω V
                                                     ∗   ∗ ∗       ⊗ rλ ∈ WH ′
                                                                                λ ,α
                                                                                     .
                                                            i;α         i;w0 ∗α

           P
Put cλ =     α cλα .

Lemma.
   (1) If α′ = α − αj then the restriction of c−1
                                               λ ⊠ cλ to Xλαα′ is

                           V−1 −f + ′ −f + ′ Vt      ∗V
    (−1)hj;α′ q gj;α′ ( V ⊠ V ) j;α j;w0 ∗α Wαα′ ⊗ p′ F − +qc ω∗ F −∗ ⊗ 1λαα′ .
                       V
                                                                          j               j



   (2) We have ω ∗ (cλα ) = cλ,w0 ∗α , cλν = rλ−1 ⊗ 1′λν .

Proof. Fix α, α′ such that α′ = α−αj . For any i we consider the following elements
     ′
in WH  λ
         :
                    Ui = q c ω ∗ (Vi∗ ) + Vi , c′λ = i qc V ∗ ⊗ω∗ V ∗ .
                                                    N V
                                                                    i          i


The rank of Ui;α is vi;α + vi;w0 ∗α = vi;ν . From Lemma 4.6.1 we have
                                 X
                                      [aij ]Uj;α = q c Wi;α + Wi;α .
                                  j


The quantum Cartan matrix (i.e. the I × I-matrix whose (i, j)-th entry is [aij ]) is
invertible over Q(q). Thus, for any α, α′ , i we get

(5.7.2)        (1λα ⊠ Ui;α′ )|Xλαα′ = (Ui;α ⊠ 1λα′ )|Xλαα′ ∈ KH̃λ (Xλαα′ ).

We have c′λ =                    and Fi− = −Vi . Thus, using (5.7.2) we get
                 N V
                   i   Vi∗ ⊗Ui

               −1                      V−1                   ∗V
           (c′ λ ⊠ c′λ )|Xλαα′ = ( Vα ⊠ Vα′ )vj;ν |Xλαα′ ⊗ p′ F − +qc ω∗ F −∗ .
                                  V
                                                                               j              j



Note that                                            N V2vi;ν                 Vt0α
                   cλα = ξ(α)̺(α)rλ ⊗ c′λα ⊗            i   q−c/2 Vi;α
                                                                         ⊗        W   .
18                       MICHELA VARAGNOLO AND ERIC VASSEROT

                                                              +       +
Thus Claim 1 follows, using (5.7.1) and the identity vj;ν = fj;α′ + fj;w ∗α′ . Let us
                                                                        0

prove Claim 2. By definition of cλ we have ω (cλα ) = cλ,w0 ∗α and cλ0 = 1′λ . Thus,
                                 ′           ∗ ′        ′           ′

using Proposition 5.6.4 we get
                                 V ν N V2vi;ν
                 cλν = ϑ−2 rλ ⊗ −2tW   ⊗ i Vi;ν = rλ−1 ⊗ 1′λν .
                                                          V
Since Qλν is a point, we identify the equivariant sheaf Vi;ν with an element in
RH̃λ in the obvious way. Using (5.7.2) we get
                                                                        
     N V2vi;ν                            N V2vi;ν
        i  q−c/2 ω ∗ (Vi;α )+qc/2 V ∗
                                      =   i   q−c/2 ω ∗ (Vi;0 )+qc/2 V ∗
                                                                           ⊗ 1′λ,w0 ∗α
                                        i;w0 ∗α                                                 i;ν

                                                               2            V−2tν
                                                   = ϑ−2 q |ν| c rλ2 ⊗         W         ⊗ 1′λ,w0 ∗α .
                             2
Thus, ω ∗ (rλ ) = ϑ2 q −|ν| c rλ−1 and
              V−t      N V2vi;ν                                   2               Vtν         N V2vi;ν
   ω ∗ rλ ⊗ W ν ⊗ i q−c/2            Vi;α
                                                      = ϑ2 q −|ν| c rλ−1 ⊗              W   ⊗         i   q−c/2 ω ∗ Vi;α
                                                               V−tν            N V2vi;ν
                                                      = rλ ⊗        W      ⊗        i    q−c/2 Vi;w0 ∗α
                                                                                                              .

A direct computation (see the Appendix) shows that ξ(α) = ξ(w0 ∗ α), ̺(α) =
̺(w0 ∗ α) for all α. We are done.                                         ⊓
                                                                          ⊔
     Let Cλ be the Rλ -linear automorphism of Aλ such that

                                         Cλ (x) = x ⊗ (cλ ⊠ c−1
                                                             λ ).

Proposition.
  (1) The map Cλ Γλ is an algebra involution of Aλ such that Cλ Γλ (q) = q −1 ,
      Cλ Γλ (x±        rc ∓
               ir ) = q xir .
  (2) The map Cλ ζλ is an algebra anti-involution of Aλ such that Cλ ζλ (q) = q,
      Cλ ζλ (x±
              ir ) = q
                       −rc ±
                          xi,−r .

Proof. The variety Xλαα′ is smooth of dimension dλαα′ := (dλα + dλα′ )/2. Let
Ωλαα′ be its canonical bundle. If α′ = α + αi , using (4.5.1), Lemma 4.6.1 and
Remark 4.6 we get
                                         V−1 V                ∗ V−1
(5.7.3)       Ωλαα′ = q fi;α′ −dλα′ (q −1 Vα ⊠ Vα′ )fi;α′ ⊗ p′ Fi;α′ ,


(5.7.4)                                dλαα′ − dλα′ + fi;α′ = −1,

                                                  V−1                                  V−1
                       (ω × ω)∗                            = qc
                                   V                              V
(5.7.5)                                Vi;α   ⊠    Vi;α′            Vi;w0 ∗α   ⊠         Vi;w0 ∗α′ .

Using (5.7.3-4) we get
DZλ (x+
      ir ) =
               r + +d                       V−1 V −r−f − ′     ∗V     Vtα −tα′
    X
=          (−1) i;α′ λαα′ q rc−r+dλαα′ (q −1 V ⊠ V )  i;α ⊗ p′
                                                                 F+ ⊗  W       ⊗ Ωλαα′
                                                                                                          i
     α′ =α+αi
                    +                                                       +
                   ri;α ′ +dλαα′                  −1 V−1                −r+fi;α             ′ ∗ V−1           Vtα −tα′
       X
                                   q rc−r−1 (q
                                                               V
=               (−1)                                   V   ⊠       V)
                                                                                ′
                                                                                    ⊗p           Fi−
                                                                                                          ⊗       W      ⊗ 1λαα′ .
     α′ =α+αi
                         CANONICAL BASES AND QUIVER VARIETIES                                                    19

Thus, using (5.7.5) we get
      Γλ (x+
           ir ) =
                                     +                        +
                              −1−r+cfi;w               V−1 r−fi;w         ′ ∗ ∗ V−1
                  (−1)ei;α′ q
           X                                     V
      =                                  0 ∗α (q                  0 ∗α ⊗ p ω        ⊗
                                                        V )
                                             ′                        ′
                                                   V ⊠                           F−                      i
          α′ =α−αi
               Vt     ′ −tw0 ∗α
             ⊗ Ww0 ∗α               ⊗ 1λαα′
                                                 +                                           +       +
                                      rc−1+(c−2)fi;w                               V−1     −fi;α ′ −fi;w ∗α′
                 X
      = x−              (−1)hi;α′ q                               (q −1
                                                                          V
         ir ⊗                                                                  ⊠     V α′ )                  ⊗
                                                              ′
                                                       0 ∗α                                             0
                                                                          Vα
                 α,α′
                Vtαα′  ∗V
            ⊗    W ⊗ p′ F − +ω∗ F −∗
                           i        i
                                                     +       +
                                                   −fi;α ′ −fi;w ∗α′
                                      ( Vα ⊠ −1
                          hi;α′ gi;α′ V
                   X
      = q rc x−
                                            V
              ir ⊗   (−1)      q             V α′ )
                                                                0    ⊗
                     α,α′
                Vtαα′          ∗V
            ⊗    W      ⊗ p′     Fi− +qc ω ∗ Fi−∗ ,
               +
where ei;α′ = ri;w0 ∗α
                      ′ + dλ,w0 ∗α,w0 ∗α′ , and gi;α , hi;α are as at the beginning of 5.7.

Using Lemma 5.7.1 we get
                                  Cλ Γλ (x+          rc −
                                             ir ) = q xir .
Using Lemma 5.2.1 and Lemma 5.3.1-2 we get
                  ζλ = Γλ φ∗ DZλ = φ∗ DZλ Γλ ,                    Cλ φ∗ DZλ = φ∗ DZλ Cλ .
Thus, (Cλ Γλ )2 = (Cλ ζλ )2 . Using Lemma 5.7.2 we get
(5.7.6)                                   (Cλ Γλ )2 = (Cλ ζλ )2 = Id .
Thus, Cλ Γλ (x−       rc +                      ∗
              ir ) = q xir either. Recall that φ DZλ Φλ = Φλ τ , see [24, Lemma
6.5]. Then Claim 2 follows from Proposition 3.2.2 and (5.7.6).                ⊓
                                                                              ⊔
5.8. Let Aλ , Bλ : Aλ → Aλ be the Rλ -algebra automorphisms such that
                                      ′                                        ′      ′         ′
          Aλ (x) = (−q)(ρ,α−α ) x,             Bλ (x) = (−q)(ρ,α−α ) q (α −α,2λ−α −α)/2 x,
for any element x ∈ Aλαα′ . Then
(5.8.1)                            Φλ A = Aλ Φλ ,        Φλ B = Bλ Φλ .
We consider the automorphisms βZλ , ψZλ of the ring Aλ such that
(5.8.2)                     βZλ = Tw0 Bλ Cλ Γλ ,         ψZλ = Tw0 Aλ Cλ ζλ .
Corollary.
  (1) The map βZλ is ¯-semilinear, the map ψZλ is †-semilinear. Moreover, we
      have βZ2 λ = ψZ
                    2
                      λ
                        = Id .
  (2) For any u ∈ U we have Φλ (ū) = βZλ Φλ (u), Φλ ψ(u) = ψZλ Φλ (u).

Proof. From Proposition 5.7.2 the map Cλ ζλ is an antihomomorphism of Aλ such
that q 7→ q, x±      ±
              i0 7→ xi0 for all i. Thus, using [13, §37] we get

(5.8.3)         Aλ Cλ ζλ = Cλ ζλ Aλ ,           Tw0 A−1
                                                     λ = Aλ Tw0 ,                  Tw0 Cλ ζλ = Cλ ζλ Tw−1
                                                                                                        0
                                                                                                          .
Thus ψZλ is an idempotent. From Proposition 5.7.1 and [13, §37] we get also
(5.8.4)           Bλ Cλ Γλ Tw0 = Cλ Γλ Tw0 Bλ−1 ,                  Tw0 Cλ Γλ = Cλ Γλ Tw−1
                                                                                        0
                                                                                          .
Thus βZλ is an idempotent. Claim 2 is immediate.                                                                 ⊓
                                                                                                                 ⊔
20                 MICHELA VARAGNOLO AND ERIC VASSEROT

         6. The metric and the involution on standard modules
6.1. Set aλα = (−q)(ρ,α) , bλα = (−q)(ρ,α−2λ) q −dλα /2 . Let aλ , bλ be the auto-
morphisms of the RH̃λ -module WHλ (resp. of WH     ′
                                                     λ
                                                       ) such that aλ (x) = aλα x,
                                                     ′
bλ (x) = bλα x for any element x ∈ Wλα (resp. x ∈ Wλα   ). Using (5.8.1) we get

                 bλ (u · x) = B(u) · bλ (x),       aλ (u · x) = A(u) · aλ (x).

Let βλ , βλ′ be the automorphisms of WHλ , WH
                                            ′
                                              λ
                                                respectively such that

                          βλ = Tw0 bλ cλ γλ ,          βλ′ = Tw0 bλ cλ γλ′ .

Proposition.
  (1) We have βλ (u ⋆ x) = βZλ (u) ⋆ βλ (x) for any u ∈ Aλ , x ∈ WHλ .
  (2) We have βλ′ (u ⋆ x) = q dλα −dλα′ βZλ (u) ⋆ βλ′ (x), for any u ∈ KH̃λ (Zλαα′ ),
             ′
      x ∈ WH   λ ,α
                   ′.
                                                                           2
  (3) The maps βλ , βλ′ are ¯-semilinear. Moreover we have βλ2 = Id , βλ′ = Id .
  (4) We have βλ (1λ ) = 1λ , βλ′ (1′λ ) = 1′λ .
Proof. Claim 1 follows from Lemma 5.3.3. Claim 2 follows from Lemma 5.3.4.
Claim 3 follows from Corollary 5.8.1 and the equality Fλα = Zλα0 . Using Lemma
5.7.2 we get

             γλ (1λ ) = 1λν ,    γλ′ (1′λ ) = 1′λν ,      bλν = 1,     cλν = rλ−1 1′λν .

Thus Claim 4 follows from Proposition 5.6.3.                                               ⊓
                                                                                           ⊔
Remark. For any closed subgroup           Hλ′
                                     ⊂ Hλ , the forgetful maps WHλ → WHλ′ ,
  ′       ′
WH  λ
      → W H ′ commute  with the involutions βλ , βλ′ .
             λ


6.2. For any A-module M , let M̂ be the set of formal series in q −1 with coefficients
in M . We get (see 5.5)

              ŴHλ = WHλ ⊗RH̃λ R̂H̃λ ,                  ′
                                                       WH λ
                                                               ′
                                                            = WH λ
                                                                   ⊗RH̃λ R̂H̃λ .

Recall that if λ = λ1 + λ2 in P + then the direct sum of representations of the quiver
Πe gives an embedding ̟ : Qλ1 × Qλ2 ֒→ Qλ . Fix a pair of ring isomorphisms

                  RTλ1 ≃ Z[x±1        ±1
                            1 , ..., xℓ1 ],            RTλ2 ≃ Z[y1±1 , ..., yℓ±1
                                                                              2
                                                                                 ].

We have RTλ ≃ RTλ1 ⊗ RTλ2 . Set

                  R̂λ1 /λ2 = Z[[q −1 , yi /xj ; i, j]] ⊗Z[q−1 ,yi /xj ;i,j] RT̃λ .

where 1 ≤ i ≤ ℓ1 and 1 ≤ j ≤ ℓ2 . Recall that κ is the closed embedding Fλ ֒→ Qλ .
Lemma.
                                                     ∼    ′
  (1) The direct image map κ∗ is an isomorphism ŴHλ → ŴH  λ
                                                              .
                                    +
  (2) Assume that λ = λ1 + λ2 in P . Then, there is a unique isomorphism of
      R̂λ1 /λ2 ⊗ U-modules
                                                                  ∼
          ̟λ1 /λ2 : R̂λ1 /λ2 ⊗RT̃λ (WTλ1 ⊗A WTλ2 ) → R̂λ1 /λ2 ⊗RT̃λ WTλ

       such that 1λ1 ⊗ 1λ2 7→ 1λ .
                   CANONICAL BASES AND QUIVER VARIETIES                                21

                                                                          P
Proof. Let first prove Claim 1. Assume that Hλ = Tλ . We set ℓ = i ℓi . There
is an isomorphism of rings RTλ ≃ Z[z1±1 , ..., zℓ±1 ]. Fix RT̃λ -bases in Wλ , Wλ′ . By
Thomason’s concentration theorem in equivariant K-theory and by [20, Proposition
4.2.2], the determinant of the map κ∗ in those bases belongs to the set
                                    × Y
                             RT̃λ     · (1 − q nk zik /zjk )
                                         k

for some ik , jk ∈ [1, ℓ], nk ∈ Z \ {0}. We can assume that nk < 0 for all k. Thus this
determinant is invertible in the ring R̂T̃λ . The case of a general group Hλ follows
from Lemma 5.5. Let us prove Claim 2. In [24, Proposition 7.10.(v)] we define an
embedding of RTλ ⊗ U-modules

                          ∆W : WTλ → WTλ1 ⊗A WTλ2 .

By [24, Theorem 7.12] the map ∆W is an isomorphism whenever q, xj , yi are spe-
                                                      / q 1+N for all i, j. Hence it
cialized to non-zero complex numbers such that yi /xj ∈
yields an isomorphism of R̂λ1 /λ2 ⊗ U-modules
                                                  ∼
               R̂λ1 /λ2 ⊗RT̃λ (WTλ1 ⊗A WTλ2 ) → R̂λ1 /λ2 ⊗RT̃λ WTλ .

The unicity follows from Lemma 5.5.                                                    ⊓
                                                                                       ⊔
6.3. Let a be the map from Qλ to the point. We consider the pairing of RH̃λ -
modules
                                        ′
                         ( : ) : WHλ × WH λ
                                            → RH̃λ
given by (x : y) = a∗ (x ⊗ y), where ⊗ is the tor-product relative to the smooth
                                                                 ′
variety Qλ . The pairing ( : ) is perfect, see [20]. Note that, WH λ
                                                                     beeing a free
                                     ′        ′
A-module, there is an embedding WHλ ⊂ ŴHλ Let us consider the pairings

                                            ′
                            ( || ) : WHλ × WH λ
                                                → RH̃λ ,

            ( | ) : WHλ × WHλ → RH̃λ ,        ( | )′ : WH
                                                        ′
                                                          λ
                                                               ′
                                                            × WH λ
                                                                   → R̂H̃λ
such that

    (x||y) = (c−1        ∗ −1
               λ aλ x : ω Tw0 (y)),     (x|y) = (x||κ∗ (y)),   (x|y)′ = (κ−1
                                                                          ∗ (x)||y),


see Lemma 6.2.1. Let ∂ : RH̃λ → A be the group homomorphism such that
∂(q) = q, and ∂(V ) = 0 if V is a non trivial simple Hλ -module.
Proposition.
  (1) We have (x|y) = (y|x)† .
  (2) We have (x1λ |y1λ ) = xy † , for all x, y ∈ RH̃λ .
  (3) We have (u · x|y) = (x|ψ(u) · y).
  (4) The pairing ( | ) is uniquely determined by conditions 2 and 3.
  (5) We have (βλ (x)||y) = (x||βλ′ (y)).
  (6) The pairing of A-modules ∂( || ) is perfect.
  (7) Claims 1 and 2 hold for the pairing ( | )′ also.
22                   MICHELA VARAGNOLO AND ERIC VASSEROT

Proof. First, note that aλ0 = 1. By Lemma 5.7.2 we have cλ0 = (rλ† )−1 1′λ . By
Proposition 5.6.3 we have ω ∗ Tw−1
                                 0
                                   (1λ ) = (rλ† )−1 1λ . Thus
                                        −1
                        (x1λ |y1λ ) = (cλ0   aλ0 x1λ : ω ∗ Tw−1
                                                              0
                                                                (y1λ )),
                                    = (x1λ : y † 1λ ),
                                    = xy † .
                                                ′
Claim 2 is proved. Fix u ∈ U, x ∈ WHλ ,α , y ∈ WH λ ,α
                                                       . For all w ∈ W let
1λ,w∗0 ⊠ x ∈ KH̃λ (Zλ,w∗0,α ) be the obvious element. We have

                              (1λ,w∗0 ⊠ x) ⋆ y = (x : y)1λ,w∗0 .

Thus, the associativity of ⋆ gives

                   (x · u : y)1λ = (1λ ⊠ x) ⋆ Φλ (u) ⋆ y = (x : u · y)1λ .

Thus we get

(6.3.0)                        (u · x : y) = (x : φ∗ Φλ (u) ⋆ y).

Assume now that x ∈ WHλ ,α′ , y ∈ WHλ ,α . Using (6.3.0), Lemma 5.2.3, Proposi-
tion 5.6.1, (5.7.6) and (5.8.3) we get

                (u · x|y)   = (c−1                   ∗ −1
                                λα aλα Φλ (u) ⋆ x : ω Tw0 κ∗ (y))
                                −1               −1
                            = (cλα′ aλα′ x : φ∗ Cλ Aλ Φλ (u) ⋆ ω ∗ Tw−1
                                                                      0
                                                                        κ∗ (y))
                                          −1
                            = (x|Tw0 ζλ Cλ Aλ Φλ (u) ⋆ y)
                            = (x|Tw0 Aλ Cλ ζλ Φλ (u) ⋆ y)
                            = (x|ψZλ Φλ (u) ⋆ y).

Then, apply Corollary 5.8.2. Claim 3 is proved. Claim 4 follows from Lemma 5.5.2.
                                     ′
Assume now that x ∈ WHλ ,α , y ∈ WH    λ ,α
                                            as above. For all w we have

                                 1λ,w∗0 ⋆ (1λ,w∗0 ⊠ x) = x.

Fix uλ such that Ťw0 (1λν ) = uλ 1λ . Using Proposition 5.6 we get

       uλ 1λ ⋆ Tw−1
                  0
                    (1λν ⊠ x) = Ťw0 (x),       Tw−1
                                                   0
                                                     (1λν ⊠ x) ⋆ Tw−1
                                                                    0
                                                                      (y) = s−1
                                                                             λ (x : y)1λ ,

i.e.
                        Tw−1
                           0
                             (1λν ⊠ x) = u−1
                                          λ 1λ ⊠ Ťw0 (x),
(6.3.1)
                        (1λ ⊠ Ťw0 (x)) ⋆ Tw−1
                                             0
                                               (y) = uλ s−1
                                                         λ (x : y)1λ .

This yields

(6.3.2)                     (Ťw0 (x) : Tw−1
                                           0
                                             (y)) = uλ sλ−1 (x : y).

Claim 5 is analoguous to [14, Lemma 12.15]. First, using (4.5.1) one gets
                                            †
(6.3.3)                     (x : DQλα (y)) = q dλα (DFλα (x) : y).
                     CANONICAL BASES AND QUIVER VARIETIES                                23

Note that

(6.3.4)                              bλ,w0 ∗α aλα = q −dλα /2 .

Using (6.3.0), Lemma 5.7.2, (6.3.4) and (6.3.3) we get

                (x||βλ′ (y))    = q −3dλα /2 (c−1
                                               λα aλα x : cλα bλ,w0 ∗α DQλα (y))
                                    −dλα
                                =q       (x : DQλα (y))
                                = (DFλα (x) : y)† .

Using Lemma 5.7.2 and (6.3.1) we get

          Tw−1
             0
               Cλ ζλ (x ⊠ 1λ ) = Tw−1
                                    0
                                      Cλ (1λν ⊠ ω ∗ x) = u−1 −1           −1 ∗
                                                          λ rλ 1λ ⊠ Ťw0 cλ ω x.

The same argument as for (6.3.1) gives

                               Tw0 (x ⊠ 1λ ) = s−1
                                                λ Tw0 (x) ⊠ 1λν .


Recall that ω is †-linear, (rλ sλ )† = rλ sλ , and cλ0 = (rλ† )−1 1′λ . Thus we get

                     Cλ ζλ Tw0 (x ⊠ 1λ ) = rλ−1 s−1       −1 ∗
                                                 λ (1λ ⊠ cλ ω Tw0 x).

Thus, (5.8.3) gives Ťw0 c−1 ∗          −1 −1 ∗
                          λ ω (x) = uλ sλ cλ ω Tw0 (x), i.e.

(6.3.5)                        Tw0 cλ ω ∗ (x) = cλ ω ∗ Ťw0 (u−1
                                                              λ sλ x)

for all x ∈ WHλ . Using (6.3.4), (6.3.5), (6.3.2) we get

       (βλ (x)||y)   = q dλα /2 (c−1                            ∗            ∗ −1
                                  λα aλα Tw0 bλ,w0 ∗α cλ,w0 ∗α ω DFλα (x) : ω Tw0 (y))
                                       ∗              −1 ∗ −1
                     = (Tw0 cλ,w0 ∗α ω DFλα (x) : cλα ω Tw0 (y))
                     = (u−1                       −1
                          λ sλ Ťw0 DFλα (x) : Tw0 (y))
                                                          †
                                       †
                     = (DFλα (x) : y) .

Claim 5 is proved. Claim 1 follows from (6.3.2), (6.3.5) and Lemma 5.7.2. Indeed

                        (x|y)      = (c−1        ∗ −1
                                       λ aλ x : ω Tw0 κ∗ (y))
                                           −1 −1 ∗ −1
                                   = (uλ sλ Ťw0 ω cλ aλ κ∗ (x) : y)†
                                   = (ω ∗ c−1 −1
                                           λ Tw0 aλ κ∗ (x) : y)
                                                               †
                                           †
                                   = (y|x) .

Claim 6 follows from the Schur Lemma and the fact that ( : ) is a perfect pairing of
RH̃λ -modules.                                                                    ⊓
                                                                                  ⊔
Remarks.
  (1) The pairings ( | ), ( | )′ are obviously compatible with the forgetful maps, see
      Remark 6.1.
                          ′                                                         ∗
  (2) The U-module WH        λ
                                has the following algebraic interpretation : let WH   λ
                                                                                        be
         ′                                                                   ∗
      WHλ with the new action of U, denoted by ⋄, such that u⋄x = φ Φλ S(u)⋆x,
                                                           ∗
      where S is the antipode; then, the U-module WH         λ
                                                               is the right dual of WHλ .
24                  MICHELA VARAGNOLO AND ERIC VASSEROT

                      7. Construction of the signed basis
7.1. Following Lusztig we consider the sets

              ′           ′
             BH λ
                  = {b ∈ WH λ
                              | βλ′ (b) = b, ∂(b|b)′ ∈ 1 + q −1 Z[[q −1 ]]},

              BHλ = {b ∈ WHλ | βλ (b) = b, ∂(b|b) ∈ 1 + q −1 Z[q −1 ]}.
We also set Bλ′ = BG
                   ′
                     λ
                       , B λ = B Gλ .
Proposition.
     (1) If the subset B ⊂ BHλ satisfies:
             - B is a basis of the A-module WHλ ,
             - for any elements b, b′ ∈ B we have ∂(b|b′ ) ∈ δb,b′ + q −1 Z[q −1 ].
                                                               ′
         Then BHλ = ±B. The similar statement holds for BH       λ
                                                                   .
                                             ′        ′     ′
     (2) We have x1λ , xrλ 1λν ∈ BHλ , and x1λ , xrλ 1λν ∈ BHλ , for any x ∈ XHλ .

Proof. Claim 1 is standard, see [14, §12.20] for instance. We reproduce  Pa proof here
for the convenience of the reader. Fix an element b ∈ BHλ . Set b = i pi bi where
bi ∈ B and pi ∈ A. Fix n ∈ Z such that pi ∈ q n Z[q −1 ] for all i and pi ∈
                                                                          / q n−1 Z[q −1 ]
                                                                 n   n−1
for
P some     i. For all i let pin ∈ Z be such that pi ∈ pin q + q          Z[q −1 ]. Then,
      2
   i pin > 0. Thus,
                          ∂(b|b) ∈ q 2n i p2in + q 2n−1 Z[q −1 ].
                                       P

On the other hand, we have ∂(b|b) ∈ 1 + q −1 Z[q −1 ]. It follows that n = 0 and
      2
P
   i pin = 1. Since βλ (b) = b and β     λ (bi ) = bi for all i, we must have p̄i = pi for
all i. Hence pi ∈ Z for all i. Then i p2i = 1. Thus b ∈ ±B. Let us prove Claim
                                        P
2. By Proposition 6.1.4 and 6.3.2 we have x1λ ∈ BHλ , x1′λ ∈ BH         ′
                                                                          λ
                                                                            . Hence, using
[11] we get Tw−10
                  (x1 λ ) ∈ B Hλ , T −1
                                     w0 (x1 ′
                                            λ ) ∈ B ′
                                                    Hλ . Finally,  Proposition  5.6.3 gives
  −1
Tw0 (x1λ ) = xrλ 1λν . We are done.                                                      ⊓
                                                                                         ⊔
Remark. In general 1λα ∈
                       / BHλ .
7.2. For any λ ∈ P + let V (λ) be Kashiwara’s maximal integrable module. By
definition, V (λ) is the free A-module with the action of the algebra U such that
there is a weight vector vλ of weight λ which generates V (λ) and satisfies the
following defining relations :

                   Uα (vλ ) = 0 for any α ∈ Q \ {0} s.t. (α, λ) ≥ 0,
(7.2.1)
                                                     1+(θ,λ)
                      fi1+ℓi (vλ ) = 0 if i 6= 0,   e0         (vλ ) = 0,

see [9, §5.1]. It is proved in [8] that the module V (λ) admits a global basis. Let B(λ)
be this basis. The element vλ belongs to B(λ). Let¯ : V (λ) → V (λ) be the unique
A-antilinear map such that b̄ = b for all elements b ∈ B(λ). It is conjectured
in [24, Remark 7.19] that there is an isomorphism of U-modules V (λ) → Wλ
such that vλ 7→ 1λ . Let us first consider the case λ = ωi . Let W (ωi )′ be the
fundamental simple finite dimensional U′ -module associated to the weight ωi , see
[9, (5.7)], [1,§1.3]. Let W (ωi ) ⊂ W (ωi )′ be the corresponding A-form For any U-
module M and any formal variable z, let Mz be the representation of U on the
space M [z ±1 ] such that (x±   jr )
                                    (n)
                                        7→ (x±
                                             jr )
                                                 (n)
                                                     ⊗ z r , k±      ±     r
                                                              jr 7→ kjr ⊗ z . Fix a weight
                            CANONICAL BASES AND QUIVER VARIETIES                                              25

vector wωi ∈ W (ωi ) of weight ωi . By [9, Theorem 5.15.(viii)] there is a unique
isomorphism of U-modules
                                                        ∼
(7.2.2)                                         V (ωi ) → W (ωi )z

such that vωi 7→ wωi . The product by z is an automorphism of U-modules. It
preserves the basis B(ωi ). There is a unique basis B0 (ωi ) of W (ωi ) such that the
map (7.2.2) takes B(ωi ) to n∈Z z n B0 (ωi ), see [9, Theorem 5.15.(iii)].
                            F

   The group Gωi being isomorphic to C× we identify RGωi with Z[zi±1 ] in the
usual way.
Theorem A.
  (1) There is a unique element ai ∈ Q(q)× and a unique isomorphism of U-
                          ∼
      modules φ : V (ωi ) → Wωi such that vωi 7→ 1ωi and the multiplication by z
      is mapped to the multiplication by ai zi . Moreover ai = ±1.1
  (2) Assume that h | i : V (ωi ) × V (ωi ) → A is a symmetric perfect pairing of
      A-modules such that hz n vωi |z m vωi i = δn,m and hu · x|yi = hx|ψ(u) · yi. Then

                    ±B(ωi ) = {b ∈ V (ωi ) | b̄ = b, hb|bi ∈ 1 + q −1 Z[q −1 ]}.

       Moreover, hb|b′ i ∈ q −1 Z[q −1 ] if b, b′ ∈ B(ωi ) and b 6= b′ .
   (3) BGωi = ±φ(B(ωi )). It is a signed basis of Wωi .
                                                                ×
Proof. Let us prove Claim 1. We identify KC (Fωi ) with the specialization of the
U-module Wωi at the maximal ideal of RGωi associated to 1 ∈ Gωi . There is
a unique element ai ∈ Q(q)× and a unique isomorphism of U′ -modules Q(q) ⊗A
    ×      ∼
KC (Fωi ) → W (ωi )′ai such that 1ωi 7→ wωi , since both U′ -modules are simple, see
                           ×
[20]. The U-modules KC (Fωi ), W (ωi )ai beeing cyclic generated by 1ωi , wωi , we
                         ×         ∼
get an isomorphism KC (Fωi ) → W (ωi )ai such that 1ωi 7→ wωi . The identification
                          ×
of the group Gωi with C is such that for any (B, p, q) ∈ Mωi α and any gωi ∈ Gωi
we have
                        (1, gωi , 1) · (B, p, q) = (B, gω−1
                                                          i
                                                            p, gωi q).
Since pj = 0, qj = 0 if j 6= i we have

                              (1, gωi , 1) · (B, p, q) = (1, 1, gα ) · (B, p, q)

for gα = (gaj )j with gaj = gω−1
                               i
                                 Id Caj . Then the group Gωi acts trivially on Fωi and
the natural isomorphism of A[zi±1 ]-modules
                                                    ×          ∼     ×
                              Wωi = KGωi ×C (Fωi ) → KC (Fωi )[zi±1 ]

takes Vj to Vj ⊗ zi , and Wj to Wj ⊗ zi . In particular we have

                                (ρ,α)                               f+                                 f−
                                                               ⊗ zi j;α ,                          ⊗ zi j;α
          V             V                   V           V                   V               V
              Vα   7→   Vα   ⊗ zi       ,    +
                                            Fj;α   7→    +
                                                        Fj;α                     −
                                                                                Fj;α   7→    −
                                                                                            Fj;α

   1 H. Nakajima remarked that Theorem A.1 was not stated correctly in a previous version of
                                                                             ∼
the paper. He also mentioned to us that the isomorphism of U-modules V (ωi ) → Wωi was known
to him.
26                  MICHELA VARAGNOLO AND ERIC VASSEROT

and x±          ±     r    ±      ±        r                            +      −
        jr 7→ xjr ⊗ zi , kjr 7→ kjr ⊗ zi , because tα+αj − tα = fj;α − fj;α . Hence
Wωi ≃ (W (ωi )ai )zi ≃ W (ωi )ai zi .
   The map φ takes the involution v 7→ v̄ on V (ωi ) to the involution βωi on Wωi
since both U-modules are cyclic and the involutions are compatible with u 7→ ū on
U. The map βωi is zi linear by Corollary 5.8.1, the map v 7→ v̄ on V (ωi ) is z linear
since product by z preserves B(ωi ). Hence āi = ai . The j-th Drinfeld polynomial
       ×
of KC (Fωi ) is Pj (t) = (t − q −c )δij . Hence the j-th Drinfeld polynomial of W (ωi )
is Pj (t) = (t − a−1
                  i q
                      −c δij
                         ) . An easy computation shows that the elements hi,±1 act
on the vector wωi ∈ W (ωi ) as follows hi,±1 (wωi ) = ai±1 q ±c wωi . Since hi,±1 belongs
to U the element ai q −c belongs to A and is invertible. Thus ai = ±1 because
ai ∈ ±q Z and ai = āi .
   Let us prove Claim 2. We first recall some well-known fact. Let Ḃ be the
canonical basis of U̇, see [13, §25.2]. By [8, §8] there is a subset I(λ) ⊂ Ḃ such
                          L
that the space I(λ) = b∈I(λ) A b ⊂ U̇ηλ is a left U̇-submodule, and such that
there is a unique isomorphism of U̇-modules U̇ηλ /I(λ) → V (λ) which takes ηλ
to vλ . The U-module V (λ) beeing integrable, Kashiwara’s modified operators ẽj ,
f˜j , j ∈ I ∪ {0}, act on V (λ). Let L(λ) ⊂ V (λ) be the Z[q −1 ]-lattice linearly
spanned by B(λ). It is stable by the operators ẽj , f˜j , see [8, Proposition 9.1], and
contains the element vλ . The induced operators on the quotient L(λ)/q −1 L(λ) are
still denoted by ẽj , f˜j . Let π : L(λ) → L(λ)/q −1 L(λ) be the projection. We set
B(λ) = π B(λ) . It is known that ẽj , f˜j take B(λ) to B(λ) ⊔ {0}.
                  

     We now assume that λ = ωi . Then the operators ẽj , f˜j are z-linear. Let L0 (ωi )
be the Z[q −1 ]-module spanned by B0 (ωi ). Let B 0 (ωi ) be the projection of B0 (ωi )
in L0 (ωi )/q −1 L0 (ωi ). There is an isomorphism of crystals

                          B 0 (ωi ), L0 (ωi ) ≃ B(ωi ), L(ωi ) /(z − 1).
                                                             


Any element in B 0 (ωi ) can be reached at wωi after applying a monomial in the
operators ẽj , j ∈ I ∪ {0}, see [1, Lemma 1.5.(1) and (2)] and [9, Proposition
5.4.(i)]. Thus any element in B(ωi ) can be reached at {z m vωi ; m ∈ Z} after
                  S in the operators ẽj , j ∈ I ∪ {0}.
applying a monomial
   Set L(ωi )∞ = k≥0 L(ωi )k , where

                                                 Z[q −1 , z ±1 ] f˜j1 · · · f˜jℓ (vωi ).
                                 X X
                     L(ωi )k =
                                 ℓ≤k j1 ,...jℓ

We claim that

(7.2.3)                        L(ωi ) = L(ωi )∞ + q −1 L(ωi ),


(7.2.4)         hL(ωi ) | L(ωi )i ⊆ Z[q −1 ],        hf˜j (x)|yi ∈ hx|ẽj (y)i + q −1 Z[q −1 ],

∀j ∈ I ∪ {0}, ∀x, y ∈ L(ωi ). Claim (7.2.3) is obvious. To prove (7.2.4) we use the
following Lemma, whose proof is given after the proof of the proposition.
Lemma. Fix j ∈ I ∪ {0}. For any x ∈ V (ωi ) fix elements xr ∈ V (ωi ), r ∈ [0, t],
             Pt    (r)
such that x = r=0 fj (xr ) and ej (xr ) = 0.
     (1) If x ∈ L(ωi ) then xr ∈ L(ωi ).
                             CANONICAL BASES AND QUIVER VARIETIES                                       27

    (2) If x ∈ B(ωi ) then there is r0 ∈ [0, t] such that xr0 ∈ B(ωi ) + q −1 L(ωi ) and
        xr ∈ q −1 L(ωi ) if r 6= r0 .
    (3) Fix λ, µ ∈ P . Assume that x ∈ L(ωi )λ , and hx | L(ωi )i ⊆ Z[q −1 ]. Fix
        y ∈ L(ωi )µ , with µ = λ − αj and fix elements ys ∈ V (ωi ), s ∈ [0, u], such
                           (s)
        that y = us=0 fj (ys ) and ej (ys ) = 0. Then hxr | ys i ∈ Z[q −1 ] for all r, s.
                  P


   The U-module V (ωi ) is endowed with its P̂ -gradation, see [9]. For any µ̂ ∈ P̂
let V (ωi )µ̂ ⊂ V (ωi ), L(ωi )µ̂ = L(ωi ) ∩ V (ωi )µ̂ and L(ωi )kµ̂ = L(ωi )k ∩ V (ωi )µ̂ be
the corresponding weight subspaces. Then

                              hV (ωi )µ̂1 | V (ωi )µ̂2 i =
                                                         6 0 ⇒ µ̂1 − µ̂2 ∈ Zδ,
                                            P ˜         k−1
                              L(ωi )kµ̂ =
                                                             
(7.2.5)                                      j fj L(ωi )µ̂+αj ,
                                          
                              ẽj L(ωi )µ̂ ⊆ L(ωi )µ̂+αj .

   We first prove by induction on k that

(7.2.6)                                  hL(ωi )k | L(ωi )i ⊆ Z[q −1 ],


(7.2.7)                            hf˜j (x)|yi ∈ hx|ẽj (y)i + q −1 Z[q −1 ],

∀j ∈ I ∪ {0}, ∀x ∈ L(ωi )k , ∀y ∈ L(ωi ). We have L(ωi )0 = Z[q −1 , z ±1 ]vωi , and
L(ωi )ωi +nδ = Z[q −1 ]z n vωi . Thus, (7.2.6) for k = 0 reduces to

                                 hZ[q −1 ]z m vωi | Z[q −1 ]z n vωi i ⊆ Z[q −1 ],

which follows from hz m vωi | z n vωi i = δmn . Similarly, (7.2.7) for k = 0 reduces to

(7.2.8)                       hf˜j (z n vωi )|yi ∈ hz n vωi |ẽj (y)i + q −1 Z[q −1 ].

This is obvious
           L         if j = 0 because hf˜j (z n vωi )|yi 6= 0 or hz n vωi |ẽj (y)i 6= 0 implies
that y ∈ n V (ωi )ωi +θ+nδ , and V (ωi )ωi +θ+nδ = {0} for all n, see [9, Proposition
5.14.(i)] for instance. If j 6= 0, (7.2.8) is proved as follows. Since ej (z n vωi ) = 0, we
have f˜j (z n vωi ) = fj (z n vωi ). Fix elements ys ∈ V (ωi ), s ∈ [0, u], as in Lemma 7.2.3.
Then, ys ∈ L(ωi ) by Lemma 7.2.1. We must show that
                                     (s)                              (s−1)
          hfj (z n vωi ) |                      ∈ hz n vωi |                         + q −1 Z[q −1 ].
                             P                                 P
                                s≥0 fj (ys )i                    s≥1 fj     (ys )i

The computation in [13, Proposition 19.1.3] gives the result, since hz n vωi | ys i ∈
Z[q −1 ] for all s, by (7.2.6) for k = 0. We may therefore assume that (7.2.6), (7.2.7)
are already known for k − 1 with k > 0. Using (7.2.5) we see that (7.2.6) for k
follows from (7.2.6), (7.2.7) for k − 1. Finally, (7.2.7) for k is proved as in [13,
Proposition 19.1.3] using (7.2.6) for k, and Lemma 7.2.3.
   From (7.2.6) we get
                                 hL(ωi )∞ | L(ωi )i ⊆ Z[q −1 ].
On the other hand there is a positive integer a such that

                                        hL(ωi ) | L(ωi )i ⊆ q a Z[q −1 ]
28                   MICHELA VARAGNOLO AND ERIC VASSEROT

because B0 (ωi ) is finite. Using (7.2.3) it yields

                                   hL(ωi ) | L(ωi )i ⊆ Z[q −1 ].

Similarly, given x, y ∈ L(ωi ) we fix x∞ ∈ L(ωi )∞ such that x − x∞ ∈ q −1 L(ωi ), see
(7.2.3). Then (7.2.7) yields

                          hf˜j (x∞ )|yi ∈ hx∞ |ẽj (y)i + q −1 Z[q −1 ].

Thus

           hf˜j (x)|yi ∈ hf˜j (x∞ )|yi + q −1 Z[q −1 ] = hx∞ |ẽj (y)i + q −1 Z[q −1 ]

                                                           = hx|ẽj (y)i + q −1 Z[q −1 ].

We have proved (7.2.4).
  Then, Claim 2 is proved as in [13, Lemma 19.1.4], using (7.2.3), (7.2.4) and
Proposition 7.1.1. More precisely for any element b ∈ B(ωi ), let ℓ(b) be the
smallest k ≥ 0 such that b ∈ L(ωi )k + q −1 L(ωi ), see (7.2.3). For any b, b′ ∈ B(ωi )
we prove by induction on ℓ(b) that

(7.2.9)                         hb | b′ i ∈ q −1 Z[q −1 ] if b 6= b′ ,


(7.2.10)                            hb | bi ∈ 1 + q −1 Z[q −1 ].

If ℓ(b) = 0 then b = z n vωi for some n ∈ Z. Thus, if hb | b′ i 6= 0 then b′ = z m vωi for
some m and both statements are obvious. Fix k > 0. Assume that (7.2.9), (7.2.10)
hold for any b, b′ such that ℓ(b) < k. Fix b, b′ such that ℓ(b) = k. By (7.2.3) there
is an integer j ∈ I ∪{0} and an element b1 ∈ B(ωi ) such that f˜j (b1 ) ∈ b+q −1 L(ωi )
and ℓ(b1 ) = k − 1. Using (7.2.4) we get

           hb | b′ i ∈ hf˜j (b1 ) | b′ i + q −1 Z[q −1 ] = hb1 | ẽj (b′ )i + q −1 Z[q −1 ].

We have ẽj (b) ∈ b1 + q −1 L(ωi ). Thus,

                               hb | bi ∈ hb1 | b1 i + q −1 Z[q −1 ].

Hence (7.2.10) for k follows from (7.2.10) for k − 1. If b 6= b′ , either ẽj (b′ ) ∈
q −1 L(ωi ), and then
                               hb | b′ i ∈ q −1 Z[q −1 ]
by (7.2.4), or there is an element b′1 ∈ B(ωi ) such that ẽj (b′ ) ∈ b′1 + q −1 L(ωi ). In
the last case b1 6= b′1 (else applying f˜j we would get b ∈ b′ + q −1 L(ωi ), and thus
b = b′ ). Hence (7.2.9) for k follows from (7.2.9) for k − 1. Finally, Claim 2 follows
from (7.2.9), (7.2.10) and Proposition 7.1.1.
   Claim 3 is obvious from Claim 1 and Claim 2.                                           ⊓
                                                                                          ⊔
Proof of Lemma 7.2. Claims 1,2 generalize [13, Lemma 18.2.2] to the non-highest
weight module case. The proof follows [13, Lemma 18.2.2]. Note that we only use
Claim 1; Claim 2 is given for the sake of completness.
                      CANONICAL BASES AND QUIVER VARIETIES                                             29

   We prove Claim 1 by induction on t. It is obvious if t = 0. Since
                                     t−1
                                            (r)
                                     X
                       ẽj (x) =           fj (xr+1 ),       ẽj (L(ωi )) ⊆ L(ωi ),
                                     r=0
         Pt−1   (r)
we get     r=0 fj (xr+1 )   ∈ L(ωi ). The induction hypothesis for t − 1 gives xr+1 ∈
                                                              (r+1)
L(ωi ) for all r ∈ [0, t − 1]. Since ej (xr+1 ) = 0 we have fj      (xr+1 ) = f˜jr+1 (xr+1 ).
                                     (r+1)                                        (r)
Since f˜j (L(ωi )) ⊂ L(ωi ) we get f       (xr+1 ) ∈ L(ωi ). Using x ∈ L(ωi ), f (xr ) ∈
                                              j                                                    j
L(ωi ) for all r ∈ [1, t] we get x0 ∈ L(ωi ).
   We prove Claim 2 by induction on t. It is obvious if t = 0. Since x ∈ B(ωi ) we
have ẽj (x) ∈ B(ωi ) + q −1 L(ωi ) or ẽj (x) ∈ q −1 L(ωi ). In the second case we get,
using Claim 1, xr ∈ q −1 L(ωi ) for all r ∈ [1, t]. Thus x0 ∈ x + q −1 L(ωi ) and we are
done. Consider now the first case. Using the induction hypothesis for t − 1 we get
an integer r0 ∈ [0, t − 1] such that xr0 +1 ∈ B(ωi ) + q −1 L(ωi ) and xr+1 ∈ q −1 L(ωi )
for all r ∈ [0, t − 1] \ {r0 }. Thus ẽj (x) ∈ f˜jr0 (xr0 +1 ) + q −1 L(ωi ). Hence

                  x ∈ f˜j ẽj (x) + q −1 L(ωi ) = f˜jr0 +1 (xr0 +1 ) + q −1 L(ωi ).
Hence, necessarily x0 ∈ q −1 L(ωi ). We are done.
    We prove Claim 3. To simplify we set xr = ys = 0 if r > t, s > u. For any
a, b ≥ 0 we have, see [13, Proposition 19.1.3],
                            (a)         (b)
                          hfj (xr ) | fj (ys )i = δa,b δr+1,s Ca,s hxr | ys i,
where                                                                           
                                        2                        (µ + sαj , αj )
                           Ca,s = q a       −a(µ+sαj ,αj )
                                                                                   .
                                                                       a
From Claim 1 we have ys ∈ L(ωi )µ+sαj for all s. Since ej (ys ) = 0 we have
 (s−1)                                       (s−1)                                 (s−1)
fj     (ys ) = f˜js−1 (ys ). In particular, fj     (ys ) ∈ L(ωi )µ+αj . Thus hx | fj     (ys )i ∈
Z[q −1 ]. On the other hand,
                                     t
                  (s−1)                       (r)          (s−1)
                                     X
            hx | fj       (ys )i =         hfj (xr ) | fj          (ys )i = Cs−1,s hxs−1 | ys i.
                                     r=0

Now
                                                                          
                      (s−1)2 −(s−1)(µ+sαj ,αj )            (µ + sαj , αj )
         Cs−1,s = q                                                          ∈ 1 + q −1 Z[q −1 ].
                                                               s−1
Thus hxs−1 | ys i ∈ Z[q −1 ] for all s ≥ 1. If s 6= r + 1 then hxr | ys i = 0 since xr , ys
have different weights.                                                                  ⊓
                                                                                         ⊔
Here is the main result of the paper.
Theorem B.
  (1) The sets BTλ , BT′ λ are signed basis of WTλ , WT′ λ . Moreover, for any b, b′ ∈
      BTλ (resp. b, b′ ∈ BT′ λ ) we have
         ∂(b|b′ ) ∈ δb,b′ + q −1 Z[q −1 ]           (resp. ∂(b|b′ )′ ∈ δb,b′ + q −1 Z[[q −1 ]]).
    (2) The signed basis BTλ , BT′ λ are dual with respect to the pairing ∂( || ) in the
        following sense : for all b ∈ BTλ there is a unique element b′ ∈ BT′ λ such
        that ∂(b||b′ ) = 1, and we have ∂(b||b′′ ) = 0 whenever b′′ 6= ±b′ .
30                        MICHELA VARAGNOLO AND ERIC VASSEROT

                                                  Pℓ
Proof. Fix a decomposition λ =                         k=1   ωik . We set vi1 ,...,iℓ = vω1 ⊗ · · · ⊗ vωℓ . By
[9, §8] the U-submodule

                                N := U · (RTλ ⊗ vi1 ,...,iℓ ) ⊂
                                                                          N
                                                                              k   V (ωik )

admits a unique involution cnor such that

           cnor (vi1 ,...,iℓ ) = vi1 ,...,iℓ ,     cnor (u · vi1 ,...,iℓ ) = ū · vi1 ,...,iℓ ,   ∀u ∈ U.
         Tωi
Set R      k   = Z[zk±1 ] for all k. Set also

                     R̂i1 /.../iℓ = Z[[q −1 , zk+1 /zk ; k]] ⊗Z[q−1 ,zk+1 /zk ;k] RT̃λ ,

where k takes all possible values in [1, ℓ]. The tensor product
                               N̂                                          N
                                    k WTωik      := R̂i1 /.../iℓ ⊗RT̃λ         k   WTωi
                                                                                         k



is endowed with the unique pairing of R̂i1 /.../iℓ -modules such that
                 N      N                  N
                ( k xk | k yk )i1 /.../iℓ = k (xk | yk ),                      ∀xk , yk ∈ WTωi ,
                                                                                                    k


and the pairing ( | ) on each factor is as in 6.3. As in 7.1 let ∂( | )i1 /.../iℓ be the
corresponding pairing

                                                                      → Z((q −1 )).
                                    N̂                 N̂
                                      k WTωik      ×     k WTωik


We have an isomorphism of U-modules WTωi ≃ V (ωi ) such that 1ωi 7→ vωi , see
Theorem 7.2.A.1. By Theorem 7.2.A.2 we have

                               −1
                                                                        | ∂(b|b)i1 /.../iℓ = 1 + q −1Z[[q −1 ]]}.
     N               N̂                                 N̂
±    k   B(ωik ) +        kq        L(ωik ) = {b ∈           k WTωik


Thus, by [9, Theorem 8.5 and Proposition 8.6] the set

                    {b ∈ N | cnor (b) = b, ∂(b|b)i1 /.../iℓ = 1 + q −1 Z[q −1 ]}

is a signed basis of N. Iterating (ℓ − 1)-times the map in Lemma 6.2.2 we get an
isomorphism of U-modules
                          N̂               ∼
          ̟i1 /.../iℓ :         k WTωik    → R̂i1 /.../iℓ ⊗RT̃λ WTλ ,               vω1 ⊗ · · · vωℓ 7→ 1λ .

The U-module WTλ is generated by RTλ ⊗1λ by Lemma 5.5.2. Thus ̟i1 /.../iℓ (N) =
WTλ . By [7] the pairing ( | )i1 /.../iℓ still satisfies Proposition 6.3.3 with 1λ instead of
vi1 ,...,iℓ . It is easy to see that Proposition 6.3.2 also holds in this setting. Thus, by
Proposition 6.3.4 the pairings ( | )i1 /.../iℓ and ( | ) on N and WTλ coincide. Moreover,
Proposition 6.1 and Corollary 5.8.2 give ̟i1 /.../iℓ cnor = βλ ̟i1 /.../iℓ . Thus,

           ̟i1 /.../iℓ {b ∈ N | cnor (b) = b, ∂(b|b)i1 /.../iℓ = 1 + q −1 Z[q −1 ]} =
                                                                                   


                     = {b ∈ WTλ | βλ (b) = b, ∂(b|b) ∈ 1 + q −1 Z[q −1 ]}.
                      CANONICAL BASES AND QUIVER VARIETIES                               31

In particular, BTλ is a signed basis of WTλ such that

(7.2.11)                          ∂(b|b′ ) ∈ δb,b′ + q −1 Z[q −1 ]

for all b, b′ ∈ BTλ . By Proposition 6.3.6 there is a signed basis BT∗λ ⊂ WT′ λ dual
to BTλ with respect to the pairing ∂( || ). Let b∗ ∈ BT∗λ be the element dual to
b ∈ BTλ . Let E : WTλ → WT′ λ be the unique A-modules isomorphism such that
E(b) = b∗ for all b ∈ BTλ . Using (7.2.11) we get

                                            Z[q −1 ]b ⊂ b∈BT q −1 Z[q −1 ]b∗ .
                              L                       L
                  (κ∗ − E)       b∈BTλ                             λ



Thus, the map κ∗ : ŴTλ → ŴT′ λ is invertible (see also Lemma 6.2.1) and we have
                                     X                                    n
                         (κ∗ )−1 =          (−1)n E −1 (κ∗ − E)E −1            .
                                     n≥0


In particular we get
                                               ∗
                         ∂ (κ∗ )−1 (b∗ )|b′         ∈ δb,b′ + q −1 Z[[q −1 ]],

i.e.
                                        ∗
                              ∂(b∗ |b′ )′ ∈ δb,b′ + q −1 Z[[q −1 ]],
for all b, b′ ∈ BTλ . Using Proposition 6.3.5 we get also βλ′ (b∗ ) = b∗ for all b ∈ BTλ .
Thus BT∗λ ⊂ BT′ λ . Then, apply Proposition 7.1.1. We are done.                        ⊓
                                                                                       ⊔
Remarks.
       (1) It is easy to see that XTλ is a subgroup of the multiplicative group of RT̃λ
           such that XTλ BTλ = BTλ . Thus there is a subset B0Tλ ⊂ BTλ which is an
           RT̃λ -basis of WTλ . In particular for any maximal ideal I ⊂ RT̃λ the set
           B0Tλ ⊗ 1 is a Z-basis of WTλ ⊗RT̃λ (RT̃λ /I). If †(I) = I then the involution
           βTλ and the metric ∂( | ) descend to WTλ ⊗RT̃λ (RT̃λ /I). It is not clear if
           ±B0Tλ ⊗ 1 admits a similar characterization as BTλ in 7.1.
       (2) Probably the sets Bλ , Bλ′ are signed bases of Wλ , Wλ′ . The conjectures in
           [9, §13] and the previous theorem suggest that Kashiwara’s canonical basis
           of V (λ) coincide with Bλ , Bλ′ , up to signs.

7.3. We do not assume any more that g is simply laced. Fix i ∈ I. The funda-
mental module W (ωi ) is as in [9]. Let W (ωi )[z ±1 ] be the affinized module, see [9,
§4.2]. Set di = max(1, (αi , αi )/2). Then V (ωi ) is isomorphic to the U-submodule
W (ωi )[z ±di ] ⊂ W (ωi )[z ±1 ], see [9, Theorem 5.15.(viii)]. Set zi = z di Id : V (ωi ) →
V (ωi ). Let us mention the following fact, which is not used in the paper.
Proposition. For any g (not necessarily simply laced) and any i ∈ I there is a
unique pairing of A-modules h | i : V (ωi ) × V (ωi ) → A such that

                     hzin vωi |zim vωi i = δn,m ,     hu · x|yi = hx|ψ(u) · yi.

This pairing is perfect and symmetric.
32                    MICHELA VARAGNOLO AND ERIC VASSEROT

Proof. The proof is similar to the proof of [13, Proposition 19.1.2]. By [9, Propo-
sition 5.14.(iii)] the space V (ωi )µ̂ is finite-dimensional for any µ̂ ∈ P̂ . Set
                                             M
                                V (ωi )∗ =           Hom (V (ωi )µ̂ , A).
                                             µ̂∈P̂


Since ψ is an antiautomorphism, there is a unique U-module structure on V (ωi )∗
such that

(7.3.1)              (u · f )(x) = f (ψ(u) · x),          ∀u ∈ U, ∀x ∈ V (ωi ).

The U-module V (ωi )∗ is endowed with the P̂ -grading such that

                               V (ωi )∗µ+nδ = Hom (V (ωi )µ+nδ , A).

Recall that V (ωi )ωi = A · vωi . Let fωi ∈ V (ωi )∗ be the unique linear form such that
fωi (vωi ) = 1, and fωi (v) = 0 for all v ∈ V (ωi )µ̂ with µ̂ 6= ωi . Hence, fωi ∈ V (ωi )∗ωi .
We must prove that there is a unique morphism of U-modules V (ωi ) → V (ωi )∗
which takes vωi to fωi , and that it is invertible. The spaces V (ωi )µ̂ , V (ωi )∗µ̂ have the
same dimension for all µ̂. Thus the set of the weights µ ∈ P such that V (ωi )∗µ+nδ 6=
                                                 P
{0} for some n ∈ Z is contained in ωi − j∈I N αj , since this is true for V (ωi ).
Hence fωi is an extremal vector of weight ωi , see [9, Theorem 5.3]. By the universal
property of V (ωi ), there is a unique morphism of U-modules φ : V (ωi ) → U·fωi ⊆
V (ωi )∗ which takes vωi to fωi . Moreover, we have φ(V (ωi )µ̂ ) ⊆ V (ωi )∗µ̂ for all µ̂ ∈ P̂ .
Since V (ωi )µ̂ is finite dimensional it is sufficient to prove that the map φ is injective.
Let the operator zi acts on V (ωi )∗ by

                   (zi · f )(x) = f (zi−1 · x),        ∀x ∈ V (ωi ), ∀f ∈ V (ωi )∗ .

Then φ commutes to zi . Since W (ωi ) ≃ V (ωi )/(zi − 1)V (ωi ), the map φ induces
a non-zero morphism of U-modules W (ωi ) → W (ωi ). It is injective since W (ωi ) is
simple. Thus φ is injective.
   The pairing is symmetric because it is unique and ψ 2 = Id .                   ⊓
                                                                                  ⊔

                                          8. Example
   We assume that Π = ({1}, ∅). We set λ = ℓω1 , α = aα1 . To simplify we omit
the subscripts 1 and we set Qℓa = Qλα , dℓa = dλα , etc. Set
                   X              ′       ′ V−r−ℓ+a′  Vr+ℓ−a    V−1
          x̃+
            r =            (−1)ℓ−a q −2r−a ( V       ⊠ V     ) ⊗ W ⊗ 1ℓaa′ ,
                  a′ =a+1

                                                      ′
                                  (−1)a q −2r+a ( r−a   ⊠ −r+a
                             X         ′       ′ V
                   x̃−
                                                         V
                     r =                           V      V    ) ⊗ 1ℓaa′ .
                            a′ =a−1

We have Qℓa 6= ∅ if and only if 0 ≤ a ≤ ℓ. More precisely Fℓa is smooth and iso-
morphic the Grassmanian of a-dimensional subspaces in Cℓ , and Qℓa = T ∗ Fℓa . An
element in Qℓa may be viewed as a couple (V, u), where V ⊆ Cℓ is a a-dimensional
subspace, and u ∈ End (Cℓ ) is a nilpotent map such that Im u ⊆ V ⊆ Ker u. The
element z ∈ C∗ acts on T ∗ Fℓa by multiplication by the scalar z 2 along the fibers.
                         CANONICAL BASES AND QUIVER VARIETIES                                                  33

The automorphism ω : Qℓa → Qℓ,ℓ−a takes the couple (V, u) to (V ⊥ , t u), where
V ⊥ ⊆ Cℓ is the subspace orthogonal to V , with respect to the canonical scalar
product on Cℓ . Let Ea′ be the tautological rank a vector bundle on T ∗ Fℓa . L  Let Ea
                        ′                ′          ′
be the restriction of E a to Fℓa . Set Q a = W a /E a , Q a = W a /E a . Set E =   a Ea ,
E ′ = a Ea′ , etc. We have
     L

                                     V−ℓ         V−ℓ Vℓ                     V−ℓ        Vℓ Vℓ
               V = qE ′ ,    x̃+
                               r =    E′    x+
                                             r    W     E′ ,     x̃−
                                                                   r =       E′   x−
                                                                                   r       W   E′ .

Hereafter we omit the operators κ∗ and ⊗. The following lemma is immediate, see
for instance [22].
Lemma.
  (1) We have x̃+                                −
                0 (1ℓa ) = [ℓ − a + 1]1ℓ,a−1 , x̃0 (1ℓa ) = [a + 1]1ℓ,a+1 .
                     Pa(ℓ−a)                          ∗
  (2) We have 1ℓa = i=0 (−1)i q −2i ∧i Q′ a Ea′ .

A direct computation gives
Proposition.
                                         V−1
      (1) We have B1′ = B1 = ±{x110 , x W 111 ; x ∈ X1 }.
                                     −2            V−2        V−4          V2
      (2) We have B2′ = ±{x1′20 , x W 1′21 , q −1 x W Q′21 , x W 1′22 ; x ∈ E ′ ⊗ X2 },
                                   V
                                                                              2
                         V−2            V−2        V−4         V2
          B2 = ±{x120 , x W 121 , q −1 x W E21 , x W 122 ; x ∈ E2 ⊗ X2 }.

                                                Appendix
   Let us check that x(w0 ∗ α) = x(α) and y(w0 ∗ α) = y(α), for all α ∈ Q, where
x : Q → Z and y : Q → Z/2Z are the quadratic maps which satisfy (5.7.1). We
give the proof for the map x, the case of the map y is left to the reader. Set
                 X               X                             X
            α=       aj αj , λ =    ℓj ωj , ν = λ − w0 (λ) =       kj αj .
                     j                      j                                          j

Write x(α) = Q(α) + L(α) + a, where Q is a quadratic form, L is a linear form and
a ∈ Z. Put                  X                      X
                    Q(α) =      qij ai aj , L(α) =    b j aj .
                                      i,j                               j
                                                  P
A direct computation gives gi;α = ci +                j cij aj   with

           ci = −1 + (2 − c)ℓi + (2c − 1)ki ,            cij = (c − 2)aij + δij (2 − 2c).

Using the relation x(α + αi ) − x(α) = cki − gi;α , we get
                                        1
                         bi = cki − ci + cii = (c − 2)ℓi + (1 − c)ki ,
                                        2

                                   1          c
(1)                         qij = − cij = (1 − )aij + δij (c − 1),
                                   2          2
that is
                             c                                                                        X
(2) Q(α) = (c − 1)|α|2 + (1 − )(α, α),                L(α) = (c − 2)(λ, α) + (1 − c)                      kj aj .
                             2                                                                        j
34                   MICHELA VARAGNOLO AND ERIC VASSEROT

The identity Q(ν) + L(ν) + a = x(ν) = (c − 1)|ν|2 − c(λ, λ), gives
                 c
 a = −c(λ, λ) + ( − 1)(ν, ν) − (c − 2)(λ, ν) + (c − 1)|ν|2 = (c − 1)|ν|2 − c(λ, λ),
                 2
since 2(λ, ν) = (ν, ν). In particular

                                       a = x(0) = x(ν).

We want now to check that x(w0 ∗ α) = x(α). Since x(ν) = x(0), we have Q(ν) +
L(ν) = 0. Moreover (2) gives Q(α) = Q(w0 (α)). Thus it is enough to prove that
                                                       X
                             L(w0 (α)) − L(α) = 2                ki qij aj .
                                                           i,j


By (2), the left hand side is equal to
                                                     X
                          (2 − c)(ν, α) + (c − 1)            kj (aj + aj ).
                                                       j


By (1), the right hand side is equal to
                                                             X
                              (2 − c)(ν, α) + 2(c − 1)               kj aj .
                                                                 j


Since w0 (ν) = −ν we have kj = kj . We are done.



                                         References
 1. Akasaka, T., Kashiwara, M., Finite dimensional representations of quantum affine algebras,
    Publ. R.I.M.S. 33 (1997), 839-867.
 2. Beck, J., Braid group action and quantum affine algebras, Commun. Math. Phys. 165 (1994),
    555-568.
 3. Beck, J., Chari, V., Pressley, A., An algebraic characterization of the affine canonical basis,
    Duke Math. J. 99 (1999), 455-487.
 4. Chriss, N., Ginzburg, V., Representation theory and complex geometry, Birkhäuser, Boston-
    Basel-Berlin, 1997.
 5. De Concini, C., Lyubashenko, V., Quantum function algebra at roots of unity, Adv. Math.
    108 (1994), 205-262.
 6. Kac, V., Infinite-dimensional Lie algebras, third edition, Cambridge University Press, 1990.
 7. Kashiwara, M., On crystal bases for q-analogue of universal enveloping algebra, Duke Math.
    J. 63 (1991), 465-516.
 8. Kashiwara, M., Crystal bases of the modified quantized enveloping algebra, Duke Math. J. 73
    (1994), 383-413.
 9. Kashiwara, M., On level zero representations of quantized affine algebras., QA/0010293.
10. Lusztig, G., On quiver varieties, Adv. Math. 136 (1998), 141-182.
11. Lusztig, G., Canonical bases arising from quantized enveloping algebras, II, Common trends
    in mathematics and quantum field theories (T. Eguchi et. al., ed.), vol. 102, Progr. Theor.
    Phys. Suppl., 1990, pp. 175-201.
12. Lusztig, G., Finite dimensional Hopf algebras arising from quantized universal enveloping
    algebras, Journal of the A.M.S. 3 (1990), 257-296.
13. Lusztig, G., Introduction to quantum groups, Birkhäuser, Boston-Basel-Berlin, 1994.
14. Lusztig, G., Bases in equivariant K-theory, Represent. Theory 2 (1998), 298-369.
                     CANONICAL BASES AND QUIVER VARIETIES                                    35

15. Lusztig, G., Quiver varieties and Weyl group actions, Ann. Inst. Fourier 50 (2000), 461-489.
16. Lusztig, G., Remarks on quiver varieties, Duke. Math. J. 105 (2000), 239-265.
17. Levendorskii, S., Soibelman, I., Some applications of quantum Weyl groups, J. Geom. and
    Phys. 7 (1990), 241-254.
18. Maffei, A., A remark on quiver varieties and Weyl groups, AG/0003159.
19. Nakajima, H., Quiver varieties and Kac-Moody algebras, Duke Math. J. 91 (1998), 515-560.
20. Nakajima, H., Quiver varieties and finite dimensional representations of quantum affine al-
    gebras, Journal of the A.M.S. 14 (2000), 145-238.
21. Nakajima, H., Reflection functor for quiver varieties, Preprint (2000).
22. Vasserot, E., Représentations de groupes quantiques et permutations, Annales Sci. ENS 26
    (1993), 747-773.
23. Vasserot, E., Affine quantum groups and equivariant K-theory, Transformation Groups 3
    (1998), 269-299.
24. Varagnolo, M., Vasserot, E., Standard modules of quantum affine algebras, Duke Math. J. (to
    appear).




  D épartement de mathématique, Université de Cergy-Pontoise, 2, av. A. Chauvin,
BP 222, 95302 Cergy-Pontoise cedex, France
  E-mail address: michela.varagnolo@math.u-cergy.fr

  D épartement de mathématique, Université de Cergy-Pontoise, 2, av. A. Chauvin,
BP 222, 95302 Cergy-Pontoise cedex, France
  E-mail address: eric.vasserot@math.u-cergy.fr
