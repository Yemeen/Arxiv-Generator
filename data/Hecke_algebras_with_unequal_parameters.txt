                                                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS
arXiv:math/0208154v2 [math.RT] 10 Jun 2014




                                                                                  G. Lusztig


                                                                                Introduction
                                                This is revised version of my book “Hecke algebra with unequal parameters”,
                                             CRM monograph series vol.18, Amer.Math.Soc. 2003. (That book was based on
                                             the Aisenstadt lectures given at the CRM, Université de Montréal, in May/June
                                             2002; and included material from lectures given at MIT during the Fall of 1999
                                             [L15].)
                                                This version updates the book by taking into account the recent results of Elias
                                             and Williamson [EW] which allow us to present the results in a more general setup.
                                             In particular the chapter on the quasisplit case (§16) is more general than that in
                                             the book; it makes use of results in the Appendix. In §9 a discussion of double
                                             cosets in a Coxeter group with respect to two parabolic subgroups has been added.
                                             The definition of the ring J (§18) is now done in more generality than in the book.
                                             Since in that generality J may not have a unit element, an imbedding of J into a
                                             ring with unit is described. A discussion of a (tensor) category version of J is given
                                             in 18.15-18.20 where it is shown how this leads to a new construction of a simple
                                             algebraic group from an affine Weyl group which, unlike earlier constructions, does
                                             not use perverse sheaves on an affine Grassmannian.
                                                I am very grateful to Meinolf Geck and Darij Grinberg for supplying a list of
                                             misprints and minor errors.
                                                 Hecke algebras arise as endomorphism algebras of representations of groups
                                             induced by representations of subgroups. In these notes we are mainly interested
                                             in a particular kind of Hecke algebras, which arise in the representation theory of
                                             reductive algebraic groups over finite or p-adic fields (see 0.3, 0.6). These Hecke
                                             algebras are specializations of certain algebras (known as Iwahori-Hecke algebras)
                                             which can be defined without reference to algebraic groups, namely by explicit
                                             generators and relations (see 3.2) in terms of a Coxeter group W (see 3.1) and
                                             a weight function L : W −  → Z (see 3.1), that is, a weighted Coxeter group. An
                                             Iwahori-Hecke algebra is completely specified by a weighted Coxeter graph, that
                                             is, the Coxeter graph of W (see 1.1) where for each vertex we specify the value of
                                             L at the corresponding simple reflection.

                                               Supported in part by the National Science Foundation

                                                                                                               Typeset by AMS-TEX
                                                                                        1
2                                    G. LUSZTIG

   A particularly simple kind of Iwahori-Hecke algebras corresponds to the case
where the weight function is constant on the set of simple reflections (equal param-
eter case). In this case one has the theory of the ”new basis” [KL1] and cells [KL1],
[L7], [L9]. The main goal of these notes is to try to extend as much as possible the
theory of the new basis to the general case (of not necessarily equal parameters).
We give a number of conjectures for what should happen in the general case and
we present some evidence for these conjectures.
    We now review the contents of these notes.
   §1 introduces Coxeter groups following [Bo]. We also give a realization of the
classical affine Weyl groups as periodic permutations of Z following an idea of [L4].
§2 contains some standard results on the partial order on a Coxeter group. In §3
we introduce the Iwahori-Hecke algebra attached to a weighted Coxeter group.
Useful references for this are [Bo],[GP]. In §4 we define the bar operator following
[KL1]. This is used in §5 to define the ”new basis” (cw ) of an Iwahori-Hecke
algebra following [KL1] for equal parameters and [L3] in general. In §6 we study
some multiplicative properties of the new basis, following [KL1] and [L3]. In §7 we
compute explicitly the ”new basis” in the case of dihedral groups. In §8 we define
left, right and two-sided cells. In §9 we study the behaviour of the new basis in
relation to a given parabolic subgroup. In §10,§12 we study a ”basis” dual to the
new basis. In §11 we consider the case of finite Coxeter groups. In §13 we study
the function a on certain weighted Coxeter groups following an idea from [L7]. In
§14 we present a list of conjectures concerning cells and the function a and we
show that they can be deduced from a much shorter list of conjectures. These
conjectures are established in a ”split case” in §15 (following [L9]), in a ”quasisplit
case” in §16 and for an infinite dihedral group in §17. Note that in the first two
cases the proof requires arguments from the theory of Soergel modules while in
the third case the argument is computational. In §18, assuming the truth of these
conjectures we develop the theory of J-rings in the weighted case, following an idea
from [L9]; we also discuss a tensor category version of a J-ring. §19,§20,§21 (where
W is assumed to be a Weyl group) are in preparation for §22 where the class of
constructible representations of W is introduced and studied in the weighted case
(conjecturally these are the representations of W carried by left cells), for §23 where
two-sided cells are discussed and for §24 where certain virtual representations of
W (”virtual cells) are discussed. In §25 we discuss the weighted Coxeter groups
which arise in the examples 0.3 and 0.6. We formulate a conjecture (25.3) which
relates the two-sided cells of such a weighted Coxeter group to the two-sided cells
of a larger Coxeter group with the weight function given by the length. In §26
we state (following [L16]) the classification of irreducible representations of Hecke
algebras of the type discussed in 0.6 in terms of the geometry of the dual group.
In §27 we give a new realization of a Hecke algebra as in 0.3 or 0.6 as a space of
functions on the rational points of an algebraic variety defined over Fq . This leads
us to a (partly conjectural) geometrical interpretation of the coefficients py,w of the
new basis of the Hecke algebra in terms of intersection cohomology, generalizing
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                        3

the results of [KL2]. We expect that this geometrical interpretation should play
a role in the proof of the conjectures in §14 in the cases arising from algebraic
groups as in 0.3, 0.6. In the Appendix we discuss Coxeter groups with a given
automorphism which preserve the set of simple reflections.
0.1. In 0.1-0.8 we give a survey of the theory of Hecke algebras arising from
reductive groups.
   Let Γ be a group acting transitively on a set X. If E is a Γ-equivariant C-
vector bundle over X (with discrete topology) then the fibre Ex of E at x ∈ X is
naturally a representation of Γx = {g ∈ Γ; gx = x}. Moreover, for x ∈ X, E 7→ Ex
is an equivalence from the category of Γ-equivariant vector bundles on X of finite
dimension and that of finite dimensional Γx -modules over C.
   Let E be a Γ-equivariant C-vector bundle of finite dimension over X. Then
Γ acts naturally on the vector space ⊕x∈X Ex . (This is the representation of Γ
induced by the representation of Γx on Ex , for any x ∈ X.) The C-algebra

                         H = H(Γ, X, E) = EndΓ (⊕x∈X Ex )

is called the Hecke algebra. The image of the obvious imbedding
                        Y
               H⊂             Hom(Ex , Ex′ ), φ 7→ (φxx′ )(x,x′ )∈X×X
                     (x,x′ )∈X×X


consists of all (fxx′ ) ∈ (x,x′ )∈X×X Hom(Ex , Ex′ ) such that
                         Q

  for any x ∈ X we have fxx′ = 0 for all but finitely many x′ ∈ X;
                                                                    f x′   g
  for any g ∈ Γ and any (x, x′ ) ∈ X × X, the compositions Ex −−x→ Ex′ −
                                                                       → Egx′ ,
             gx
    g       fgx′
Ex −→ Egx −−→ Egx′ coincide.
For any Γ-orbit C in X × X we set

             HC = H(Γ, X, E)C = {φ ∈ H; φxx′ 6= 0 =⇒ (x′ , x) ∈ C}.

Then HC = 0 unless C is finitary in the following sense:
   for some (or any) x ∈ X, the set {x′ ∈ X; (x′ , x) ∈ C} is finite,
in which case
                         ∼
                     HC −→ HomΓx ∩Γx′ (Ex , Ex′ ), φ 7→ φxx′
for (x′ , x) ∈ C. Moreover,
   (a) H = ⊕C finitary HC .
0.2. To explain how Hecke algebras arise from reductive algebraic groups we need
the notion of ”unipotent cuspidal representation”.
   Let p be a prime number and let F be an algebraic closure of the finite field
with p elements. Let q be a power of p and let Fq be the subfield of F with q
elements. Let G be a connected reductive algebraic group over F with a fixed Fq
structure and let F : G −
                        → G be the corresponding Frobenius map.
4                                   G. LUSZTIG

   We refer to [DL] for the notion of unipotent cuspidal representation of the
finite group GF = G(Fq ). We will only give here the definition assuming that q
is sufficiently large. Let E be an irreducible representation over C of GF and let
χE : GF −  → C be its character. We say that E is unipotent if, for any F -stable
maximal torus T of G, the restriction of χE to the set of regular elements in T F
is a constant, say cT ∈ Z. We say that E is unipotent cuspidal if, in addition, for
any T as above that is contained in some proper F -stable parabolic subgroup of
G, we have cT = 0.
   The unipotent cuspidal representations of GF are classified in [L6]. For example,
if G is a torus times a symplectic group of rank n ≥ 0 then GF has (up to
isomorphism) a unique unipotent cuspidal representation if n = k 2 + k for some
integer k ≥ 0, and none, otherwise.
0.3. Let G, F be as in 0.2. For any parabolic subgroup P of G let UP be the
unipotent radical of P and let P̄ = P/UP . Let P be an F -stable G-conjugacy
class of parabolic subgroups of G and let E be a GF -equivariant vector bundle
over P F (a GF -homogeneous space) such that for some (or any) P ∈ P F , the
P F -action on the fibre EP of E at P factors through a unipotent, cuspidal P̄ F -
module. (To give such E is the same as to give, for some P ∈ P F , a unipotent
cuspidal representation of P̄ F .) The Hecke algebra H(GF , P F , E) is defined.
   Let W be the set of G-orbits on the set of ordered pairs of Borel subgroups in
G; it is known that W may be naturally regarded as a finite Coxeter group (see
1.1) with a set S of simple reflections. Now any Borel subgroup of G is contained
in a unique subgroup in P; this defines a (surjective) map from W to G\(P × P),
the set of G-orbits in P × P. The inverse image of the diagonal orbit under this
map is the subgroup WJ of W generated by a subset J of S and W −      → G\(P × P)
factors through a bijection
                                          ∼
(a)                         WJ \W/WJ −→ G\(P × P).

Let W be the set of all w ∈ W such that wWJ = WJ w and w has minimal length
in wWJ = WJ w. Then W is a subgroup of W . The Frobenius map u : W −            →W
restricts to an isomorphism u : W −   → W whose fixed point set W u is naturally
a Coxeter group with simple reflections indexed by u\(S − J) (set of orbits of
u:S−J −     → S − J). See 25.1(a). A G-orbit O on P × P is said to be good if for
(P, P ′ ) ∈ O we have (P ∩P ′ )UP = P or equivalently (P ∩P ′ )UP ′ = P ′ . Otherwise,
O is said to be bad. If O is a good, F -stable G-orbit on P × P then OF is a GF -
orbit on P F × P F and dim H(GF , P F , E)OF = 1. If O is an F -stable bad G-orbit
on P × P then OF is a GF -orbit on P F × P F and dim H(GF , P F , E)OF = 0. Now
the bijection (a) restricts (via the imbedding W u ⊂ WJ \W/WJ , w 7→ WJ wWJ )
to a bijection w 7→ Ow of W u onto the set of good, F -stable G-orbits on P × P.
It follows that 0.1(a) becomes in our case

(b)                 H(GF , P F , E) = ⊕w∈W u H(GF , P F , E)Ow
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                  5

with

(c)                   dim H(GF , P F , E)Ow = 1 for all w ∈ W u .

Let τk be the generator of W u corresponding to k ∈ u\(S − J). There is a unique
basis element Tτk of H(GF , P F , E)Oτk such that

(d)                        (Tτk + q −Nk /2 )(Tτk − q Nk /2 ) = 0

for some Nk ∈ Z>0 . (Nk is uniquely determined.) The elements Tτk (k ∈ u\(S−J))
generate the C-algebra H(GF , P F , E). They satisfy identities of the form

(e)                         Tτk Tτk′ Tτk · · · = Tτk′ Tτk Tτk′ . . .

for k 6= k ′ in u\(S − J); both products have a number of factors equal to the order
of τk τk′ in W u . Now Tτk 7→ Tτk gives an isomorphism from an Iwahori-Hecke
                                       √
algebra (see 3.2) specialized at v = q to the algebra H(GF , P F , E).
    The function k 7→ Nk coincides with the function k 7→ L(τk ) in 25.2.
    (The results in this subsection appeared in [L2,L1]. In the special case where P
is the set of Borel subgroups of G and E is the trivial vector bundle C, they were
first proved by Iwahori [I]; if, in addition, u = 1 on W then Nk = 1 for all k.)
0.4. Let V be an Fq -vector space of dimension n ≥ 2. Then G = SL(F ⊗
V ) has a natural Fq -structure. Let P be the set of all Borel subgroups of G.
Then P F may be identified as a set with GF -action with the set F of all flags
V∗ = (V0 ⊂ V1 ⊂ V2 ⊂ . . . ⊂ Vn ) of subspaces of V (dim Vi = i for all i).
   Let V∗ = (V0 ⊂ V1 ⊂ V2 ⊂ . . . ⊂ Vn ), V∗′ = (V0′ ⊂ V1′ ⊂ V2′ ⊂ . . . ⊂ Vn′ ) be
                                                          Vi′ ∩Vj
flags in F . For i ∈ [0, n], j ∈ [1, n] we set dij = dim V ′ ∩Vj−1
                                                                   ∈ {0, 1}. For i ∈ [0, n]
                                                          i
we set Xi = {j ∈ [1, n]; dij = 1}. Then ∅ = X0 ⊂ X1 ⊂ X2 ⊂ . . . ⊂ Xn = [1, n]
and for i ∈ [1, n] there is a unique ai ∈ [1, n] such that Xi = Xi−1 ⊔ {ai }. Also,
i 7→ ai is a permutation of [1, n]. Now (V∗ , V∗′ ) 7→ (ai ) defines a bijection of
GF \(P F × P F ) = GF \(F × F ) with the symmetric group Sn . Let E be the trivial
GF -equivariant vector bundle C on P F = F . Then H(GF , P F , E) is defined. In
our case we have W = W = W u = Sn .
0.5. Let V, n be as in 0.4. Assume that n = 2m and that V has a fixed non-
degenerate symplectic form h, i : V × V − → Fq . Then G = Sp(F ⊗ V ) has a natural
                                        2
Fq -structure. Assume that m = r + k + k where k ∈ N, r ∈ Z>0 . Let F be the set
of all flags V∗ = (V0 ⊂ V1 ⊂ V2 ⊂ . . . ⊂ Vr ) of isotropic subspaces of V (dim Vi = i
for all i). There is a unique G-conjugacy class P of parabolic subgroups of G such
that, if V∗ ∈ F , then

                        {g ∈ G; g(F ⊗ Vj ) = F ⊗ Vj          ∀j} ∈ P.

We may identify P F = F as spaces with GF -action.
6                                       G. LUSZTIG

   Let U 7→ Dk (U ) be a functor from the category of symplectic vector spaces of
dimension 2k 2 + 2k over Fq (and isomorphisms between them) to the category
of C-vector spaces (and isomorphisms between them) such that for any U , the
Sp(U )-module Dk (U ) is unipotent, cuspidal. (Such a functor exists and is unique
up to isomorphism.) Let E be the vector bundle over P F (or equivalently F )
whose fibre at V∗ = (V0 ⊂ V1 ⊂ V2 ⊂ . . . ⊂ Vr ) ∈ F F is Dk (Vr⊥ /Vr ). (Here
Vs⊥ = {x ∈ V ; hx, Vs i = 0}.)
   This vector bundle is naturally GF -equivariant (since Dk is a functor). Hence
H(GF , P F , E) is defined.
   Let V∗ = (V0 ⊂ V1 ⊂ V2 ⊂ . . . ⊂ Vr ), V∗′ = (V0′ ⊂ V1′ ⊂ V2′ ⊂ . . . ⊂ Vr′ ) be flags
in F . The G-orbit of the point of P × P corresponding to (V∗ , V∗′ ) is good if the
following three equivalent conditions hold:
   Vr ∩ Vr′ = Vr ∩ Vr′ ⊥ ,
   Vr ∩ Vr′ = Vr⊥ ∩ Vr′ ,
   Vr ∩ Vr′ = (Vr⊥ ∩ Vr′ ⊥ ) ∩ (Vr + Vr′ ).
If these conditions hold, we can define an isomorphism ψVVr′ : Vr⊥ /Vr −    → Vr′ ⊥ /Vr′
                                                              r
by requiring that the diagram
                                               =
                (Vr⊥ ∩ Vr′ ⊥ )/(Vr ∩ Vr′ ) −−−−→ (Vr⊥ ∩ Vr′ ⊥ )/(Vr ∩ Vr′ )
                                                            
                                                            
                            y                                y
                                               Vr
                                              ψV ′
                         Vr⊥ /Vr              r
                                           −−−−→             Vr′ ⊥ /Vr′

(where the vertical maps are the isomorphisms induced by the inclusion) is com-
mutative. In this case, to (V∗ , V∗′ ) we associate an element σ of the group Wr of
permutations of S = {1, 2, . . . , r, r ′ , . . . , 2′ , 1′ } that commute with the involution
f :S−→ S, j 7→ j ′ , j ′ 7→ j. For j ∈ [1, r] we set

Aj = {h ∈ [1, r]; Vh−1 ∩ Vj′ 6= Vh ∩ Vj′ },                          ⊥
                                                Bj = f {h ∈ [1, r]; Vh−1 ∩ Vj′ 6= Vh⊥ ∩ Vj′ }.

Then ♯(Aj ∩ Bj ) = j, A1 ∩ B1 ⊂ A2 ∩ B2 ⊂ . . . ⊂ As ∩ Bs and h ∈ Aj =⇒ h′ ∈      / Bj .
For j ∈ [1, r] define aj ∈ S by Aj ∪ Bj = {a1 , a2 , . . . , aj }. Then σ is defined by
the condition that σ(j) = aj for j ∈ [1, r]. We see that in our case, W = W u may
be identified with Wr . In our case, the Iwahori-Hecke algebra corresponds to the
weighted Coxeter graph

                               •2k+1 = •1 − •1 − · · · − •1

(r vertices); in the case where r = 1 this should be interpreted as a graph with
one vertex marked by 2k + 1.
0.6. Let ǫ be an indeterminate. Let K be the subfield of F((ǫ)) generated by
Fq ((ǫ)) and F. Let G be a split connected simply connected almost simple alge-
braic group over K with a fixed Fq ((ǫ))-rational structure. We identify G with its
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                               7

 group of K-points. There is a ”Frobenius map” F : G −   → G whose fixed point set
is G(Fq ((ǫ))). Let B be the set of all Iwahori subgroups of G. (This concept will
be illustrated in 0.7.) A subgroup of G is said to be a parahoric subgroup if it is
6= G and it contains some Iwahori subgroup. If P is a parahoric subgroup then P
 has a ”pro-unipotent radical” UP and P̄ = P/UP is a connected, reductive group
 over F. Let P be an F -stable G-conjugacy class of parahoric subgroups of G and
 let E be a GF -equivariant vector bundle over P F (a GF -homogeneous space) such
 that for some (or any) P ∈ P F , the P F -action on the fibre EP of E at P factors
 through a unipotent, cuspidal P̄ F -module. (To give such E is the same as to give,
 for some P ∈ P F , a unipotent cuspidal representation of P̄ F .) The Hecke algebra
 H(GF , P F , E) is defined.
    Let W be the set of G-orbits on B × B; it is known that W may be naturally
 regarded as a Coxeter group (more precisely, an affine Weyl group, see 1.15) with
 a set S of simple reflections. Now any Iwahori subgroup of G is contained in a
 unique subgroup in P; this defines a (surjective) map from W to G\(P × P), the
 set of G-orbits in P × P. The inverse image of the diagonal orbit under this map
 is the subgroup WJ of W generated by a subset J of S and W −         → G\(P × P)
 factors through a bijection
                                           ∼
(a)                         WJ \W/WJ −→ G\(P × P).

Let W be the set of all w ∈ W such that wWJ = WJ w and w has minimal length
in wWJ = WJ w. Then W is a subgroup of W . The Frobenius map u : W −             →W
                                                                     u
restricts to an isomorphism u : W −→ W whose fixed point set W is naturally an
infinite Coxeter group with simple reflections indexed by u\(S −J) (set of orbits of
u : S −J − → S − J). (We make the additional assumption that ♯(u\(S − J)) ≥ 2.)
See 25.1(a). A G-orbit O on P × P is said to be good if for (P, P ′ ) ∈ O we have
(P ∩ P ′ )UP = P or equivalently (P ∩ P ′ )UP ′ = P ′ . Otherwise, O is said to be bad.
If O is a good, F -stable G-orbit on P × P then OF is a GF -orbit on P F × P F
and dim H(GF , P F , E)OF = 1. If O is an F -stable bad G-orbit on P × P then
OF is a GF -orbit on P F × P F and dim H(GF , P F , E)OF = 0. Now the bijection
(a) restricts (via the imbedding W u ⊂ WJ \W/WJ , w 7→ WJ wWJ ) to a bijection
w 7→ Ow of W u onto the set of good, F -stable G-orbits on P × P. It follows that
0.1(a) becomes in our case

(b)                 H(GF , P F , E) = ⊕w∈W u H(GF , P F , E)Ow

with

(c)                  dim H(GF , P F , E)Ow = 1 for all w ∈ W u .

Let τk be the generator of W u corresponding to k ∈ u\(S − J). There is a unique
basis element Tτk of H(GF , P F , E)Oτk such that

(d)                       (Tτk + q −Nk /2 )(Tτk − q Nk /2 ) = 0
8                                     G. LUSZTIG

for some Nk ∈ Z>0 . (Nk is uniquely determined.) The elements Tτk (k ∈ u\(S−J))
generate the C-algebra H(GF , P F , E). They satisfy identities of the form

                          Tτk Tτk′ Tτk · · · = Tτk′ Tτk Tτk′ . . .

for k 6= k ′ in u\(S − J) with τk τk′ of order mk,k′ < ∞ in W u (both products
have mk,k′ factors). Now Tτk 7→ Tτk gives an isomorphism from an Iwahori-Hecke
                                    √
algebra (see 3.2) specialized at v = q to the algebra H(GF , P F , E). The function
k 7→ Nk coincides with the function k 7→ L(τk ) in 25.2.
   (The results in this subsection appeared in [L11,L13]. In the special case where
P = B, u = 1 and E is the trivial vector bundle C, they were first proved by
Iwahori-Matsumoto [IM]; in this case, Nk = 1 for all k.)

0.7. Let V be an Fq ((ǫ))-vector space of dimension n ∈ [2, ∞) with a fixed volume
form ω. Then G = SL(F ⊗Fq V ) is as in 0.6. Let A = Fq [[ǫ]]. A lattice in V is
an A-submodule of V of rank n which generates V . For a lattice L in V we set
vol(L) = r where m ∈ Z is defined by the condition that the n-th exterior power
of L (an A-module) has ǫ−r ω as basis element. Let F be the set of all sequences
of lattices (Lj )j∈Z such that

                       Lj−1 ⊂ Lj , vol(Lj ) = j, ǫLj = Lj−n

for all j. We may identify BF with F as sets with (transitive) GF -action.
   Let L∗ = (Lj )j∈Z , L′∗ = (L′j )j∈Z be elements of F . For i, j ∈ Z we set

                                           L′i ∩ Lj
                           dij = dim                 ∈ {0, 1}.
                                          L′i ∩ Lj−1

For i ∈ Z let Xi = {j ∈ Z; dij = 1}. Then Xi−1 ⊂ Xi for all i and ♯(Xi −Xi−1 ) = 1
for all i. Define ai ∈ Z by Xi = Xi−1 ⊔ {ai }. Now Xi−n = Xi − n. Hence

(a)                         ai+n = ai + n for all i ∈ Z.

One can check that i 7→ ai is a bijection Z −
                                            → Z. Using the fact that vol(Lj ) =
     ′
vol(Lj ) = j we see that

                                    n
                                    X
(b)                                       (ai − i) = 0.
                                    i=1

                                                                     ∼
This gives a bijection of W onto the group of all bijections Z −→ Z that satisfy
(a),(b) (see 1.12).
               HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                             9

0.8. Let V, n be as in 0.7. Assume that n = 2m and that V has a fixed non-
degenerate symplectic form h, i : V × V −  → Fq ((ǫ)). Then G = Sp(F ⊗Fq V ) is
                                         ♯
as in 0.6. If L is a lattice in V then L = {x ∈ V ; hx, Li ∈ A} is again a lattice;
moreover, (L♯ )♯ = L. Assume that m = r + k 2 + k + l2 + l where k, l, r ∈ N, r ≥ 1.
Let N be the set of all integers of the form a + 2mt where t ∈ Z and

          k 2 + k ≤ a ≤ k 2 + k + r or − (k 2 + k + r) ≤ a ≤ −(k 2 + k).

Let F be the set of all sequences of lattices (Lj )j∈N such that
   Lj ⊂ Lj ′ if j ≤ j ′ in N ,
   L♯j = L−j for all j ∈ N ,
   ǫLj = Lj−2m for all j ∈ N ,
   vol(Lj ) = j for all j ∈ N .
Here the volume of a lattice is defined in terms of the volume form on V attached to
the symplectic form. There is a unique G-conjugacy class P of parahoric subgroups
of G such that, if (Lj )j∈N ∈ F , then

                   {g ∈ G; g(F ⊗ Lj ) = F ⊗ Lj    ∀j ∈ N } ∈ P.

We may identify P F and F as sets with GF -action. If (Lj )j∈N ∈ F , then
the Fq -vector space Lk2 +k /L−k2 −k (of dimension 2k 2 + 2k) has a natural non-
degenerate symplectic form induced by x, y 7→ Reshx, yi and the Fq -vector space
L2m−k2 −k−r /Lk2 +k+r (of dimension 2l2 + 2l) has a natural non-degenerate sym-
plectic form induced by x, y 7→ Reshx, ǫyi. Here Res : Fq ((ǫ)) − → Fq denotes
residue at 0.
   Let Dk be a functor as in 0.5 and let Dl be an analogous functor obtained by
replacing k by l. Let E be the vector bundle over P F (or equivalently F ) whose
fibre at (Lj )j∈N ∈ F is

                Dk (Lk2 +k /L−k2 −k ) ⊗ Dl (L2m−k2 −k−r /Lk2 +k+r ).

This vector bundle is naturally GF -equivariant (since Dk , Dl are functors). Hence
H(GF , P F , E) is defined. In our case, the Iwahori-Hecke algebra corresponds to
the weighted Coxeter graph

                        •2k+1 = •1 − •1 − · · · − •1 = •2l+1

(r + 1 vertices); in the case where r = 1 this should be interpreted as a Coxeter
graph with 2 vertices marked by 2k + 1, 2l + 1, joined by a quadruple edge.

0.9. Notation. We set [a, b] = {z ∈ Z; a ≤ z ≤ b}, [a, b) = {z ∈ Z; a ≤ z < b}. If
X is a subset of a group G, we denote by hXi the subgroup of G generated by X.
10                                   G. LUSZTIG

                                     Contents
     1. Coxeter groups
     2. Partial order on W
     3. The algebra H
     4. The bar operator
     5. The elements cw
     6. Left or right multiplication by cs
     7. Dihedral groups
     8. Cells
     9. Cosets of parabolic subgroups
     10. Inversion
     11. The longest element for a finite W
     12. Examples of elements Dw
     13. The function a
     14. Conjectures
     15. Example: the split case
     16. Example: the quasisplit case
     17. Example: the infinite dihedral case
     18. The ring J
     19. Algebras with trace form
     20. The function aE
     21. Study of a left cell
     22. Constructible representations
     23. Two-sided cells
     24. Virtual cells
     25. Relative Coxeter groups
     26. Representations
     27. A new realization of Hecke algebras
     Appendix

                               1. Coxeter groups
1.1. Let S be a finite set and let (ms,s′ )(s,s′ )∈S×S be a matrix with entries in
N ∪ {∞} such that ms,s = 1 for all s and ms,s′ = ms′ ,s ≥ 2 for all s 6= s′ . (A
Coxeter matrix.) In the case where ms,s′ ∈ {2, 3, 4, 6, ∞} for all s 6= s′ , the matrix
(ms,s′ )(s,s′ )∈S×S is completely described by a graph (the Coxeter graph) with set
of vertices in bijection with S where the vertices corresponding to s 6= s′ are joined
by an edge if ms,s′ = 3, by a double edge if ms,s′ = 4, by a triple edge if ms,s′ = 6,
by a quadruple edge if ms,s′ = ∞.
   Let W be the group defined by the generators s(s ∈ S) and relations

                                    (ss′ )ms,s′ = 1
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                 11

for any s, s′ in S such that ms,s′ < ∞. We say that W, S is a Coxeter group. Note
that the Coxeter matrix is uniquely determined by W, S (see 1.3(b) below). We
sometimes refer to W itself as a Coxeter group. In W we have s2 = 1 for all s.
Clearly, there is a unique homomorphism
                                  sgn : W −
                                          → {1, −1}

such that sgn(s) = −1 for all s. (”Sign representation”.)
    For w ∈ W let l(w) be the smallest integer q ≥ 0 such that w = s1 s2 . . . sq with
s1 , s2 , . . . , sq in S. (We then say that w = s1 s2 . . . sq is a reduced expression and
l(w) is the length of w.) Now l(1) = 0, l(s) = 1 for s ∈ S. (Indeed, s 6= 1 in W
since sgn(s) = −1, sgn(1) = 1.)
Lemma 1.2. Let w ∈ W, s ∈ S.
  (a) We have either l(sw) = l(w) + 1 or l(sw) = l(w) − 1.
  (b) We have either l(ws) = l(w) + 1 or l(ws) = l(w) − 1.
   Clearly, sgn(w) = (−1)l(w) . Since sgn(sw) = −sgn(w), we have (−1)l(sw) =
−(−1)l(w) . Hence l(sw) 6= l(w). This, together with the obvious inequalities
l(w) − 1 ≤ l(sw) ≤ l(w) + 1 gives (a). The proof of (b) is similar.
Proposition 1.3. Let E be an R-vector space with basis (es )s∈S . For s ∈ S
define a linear map σs : E −  → E by σs (es′ ) = es′ + 2 cos mπ ′ es for all s′ ∈ S.
                                                              s,s
   (a) There is a unique homomorphism σ : W −       → GL(E) such that σ(s) = σs for
all s ∈ S.
   (b) If s 6= s′ in S, then ss′ has order ms,s′ in W . In particular, s 6= s′ in W .
  We have σs (es ) = −es and σs induces the identity map on E/Res . Hence
  = 1. Now let s 6= s′ in S, m = ms,s′ , Φ = σs σs′ . We have
σs2
                   π                π
  Φ(es ) = (4 cos2 m − 1)es + 2 cos m es′ ,
                   π
  Φ(es′ ) = −2 cos m es − es′ .
Hence Φ restricts to an endomorphism φ of Res ⊕ Res′ whose characteristic poly-
nomial is
                           2π                 √               √
             X 2 − 2 cos      X + 1 = (X − e2π −1/m )(X − e−2π −1/m ).
                           m
It follows that, if 2 < m < ∞, then 1 + φ + φ2 + · · · + φm−1 = 0. The same holds
if m = 2 (in this case we see directly that φ = −1). Since Φ induces the identity
map on E/(Res ⊕ Res′ ), it follows that Φ : E − → E has order m (if m < ∞). If
                                       2
m = ∞, we have φ 6= 1 and (φ − 1) = 0, hence φ has infinite order and Φ has
also infinite order. Now (a), (b) follow.
Corollary 1.4. Let s1 6= s2 in S. For k ≥ 0 let 1k = s1 s2 s1 . . . (k factors),
2k = s2 s1 s2 . . . (k factors).
    (a) Assume that m = ms1 ,s2 < ∞. Then hs1 , s2 i consists of the elements
1k , 2k (k = 0, 1, . . . , m); these elements are distinct except for the equalities 10 =
20 , 1m = 2m . For k ∈ [0, m] we have l(1k ) = l(2k ) = k.
12                                             G. LUSZTIG

   (b) Assume that ms1 ,s2 = ∞. Then hs1 , s2 i consists of the elements 1k , 2k
(k = 0, 1, . . . ); these elements are distinct except for the equality 10 = 20 . For all
k ≥ 0 we have l(1k ) = l(2k ) = k.
   This follows immediately from 1.3(b).
   We identify S with a subset of W (see 1.3(b)) said to be the set of simple
reflections. Let
                            T = ∪w∈W wSw−1 ⊂ W.
Proposition 1.5. Let R = {1, −1} × T . For s ∈ S define Us : R −    → R by
                  δs,t
Us (ǫ, t) = (ǫ(−1) , sts) where δ is the Kronecker symbol. There is a unique
homomorphism U of W into the group of permutations of R such that U (s) = Us
for all s ∈ S.
   We have Us2 (ǫ, t) = (ǫ(−1)δs,t +δs,sts , t) = (ǫ, t) since the conditions s = t, s = sts
are equivalent. Thus, Us2 = 1. For s 6= s′ in S with m = ms,s′ < ∞ we have
                            Us Us′ (ǫ, t) = (ǫ(−1)δs′ ,t +δs,s′ ts′ , ss′ ts′ s)
hence
                  (Us Us′ )m (ǫ, t) = (ǫ(−1)κ , (ss′ )m t(s′ s)m ) = (ǫ(−1)κ , t)
where
        κ = δs′ ,t + δs,s′ ts′ + δs′ ,ss′ ts′ s + · · · = δs′ ,t + δs′ ss′ ,t + δs′ ss′ ss′ ,t + . . .
(both sums have exactly 2m terms). It is enough to show that κ is even, or that
t appears an even number of times in the 2m-term sequence s′ , s′ ss′ , s′ ss′ ss′ , . . . .
This follows from the fact that in this sequence the k-th term is equal to the
(k + m)-th term for k = 1, 2, . . . , m.
Proposition 1.6. Let w ∈ W . Let w = s1 s2 . . . sq be a reduced expression.
   (a) The elements s1 , s1 s2 s1 , s1 s2 s3 s2 s1 , . . . , s1 s2 . . . sq . . . s2 s1 are distinct.
   (b) These elements form a subset of T that depends only on w, not on the choice
of reduced expression for it.
  Assume that s1 s2 . . . si . . . s2 s1 = s1 s2 . . . sj . . . s2 s1 for some 1 ≤ i < j ≤ q.
Then si = si+1 si+2 . . . sj . . . si+2 si+1 hence
      s1 s2 . . . sq = s1 s2 . . . si−1 (si+1 si+2 . . . sj . . . si+2 si+1 )si+1 . . . sj sj+1 . . . sq
                     = s1 s2 . . . si−1 si+1 si+2 . . . sj−1 sj+1 . . . sq ,
which shows that l(w) ≤ q − 2, contradiction. This proves (a).
  For (ǫ, t) ∈ R we have (see 1.5) U (w−1 )(ǫ, t) = (ǫη(w, t), w−1 tw) where η(w, t) =
±1 depends only on w, t. On the other hand,
          U (w−1 )(ǫ, t) = Usq . . . Us1 (ǫ, t)
                            = (ǫ(−1)δs1 ,t +δs2 ,s1 ts1 +···+δsq ,sq−1 ...s1 ts1 ...sq−1 , w−1 tw)
                            = (ǫ(−1)δs1 ,t +δs1 s2 s1 ,t +···+δs1 ...sq ...s1 ,t , w−1 tw).
                         HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                                      13

Thus, η(w, t) = (−1)δs1 ,t +δs1 s2 s1 ,t +···+δs1 ...sq ...s1 ,t . Using (a), we see that for t ∈ T ,
the sum δs1 ,t + δs1 s2 s1 ,t + · · · + δs1 ...sq ...s1 ,t is 1 if t belongs to the subset in (b)
and is 0, otherwise. Hence the subset in (b) is just {t ∈ T ; η(w, t) = −1}. This
completes the proof.
Proposition 1.7. Let w ∈ W, s ∈ S be such that l(sw) = l(w) − 1. Let w =
s1 s2 . . . sq be a reduced expression. Then there exists j ∈ [1, q] such that
    ss1 s2 . . . sj−1 = s1 s2 . . . sj .
    Let w′ = sw. Let w′ = s′1 s′2 . . . s′q−1 be a reduced expression. Then w =
ss′1 s′2
       . . . s′q−1 is another reduced expression. By 1.6(b), the q-term sequences

                         s1 , s1 s2 s1 , s1 s2 s3 s2 s1 , . . . and s, ss′1 s, ss′1 s′2 s′1 s, . . .

coincide up to rearranging terms. In particular, s = s1 s2 . . . sj . . . s2 s1 for some
j ∈ [1, q]. The proposition follows.
1.8. Let X be the set of all sequences (s1 , s2 , . . . , sq ) in S such that s1 s2 . . . sq
is a reduced expression in W . We regard X as the vertices of a graph in which
(s1 , s2 , . . . , sq ), (s′1 , s′2 , . . . , s′q ′ ) are joined if one is obtained from the other by re-
placing m consecutive entries of form s, s′ , s, s′ , . . . by the m entries s′ , s, s′ , s, . . . ;
here s 6= s′ in S are such that m = ms,s′ < ∞. We use the notation

                                      (s1 , s2 , . . . , sq ) ∼ (s′1 , s′2 , . . . , s′q ′ )

for ”(s1 , s2 , . . . , sq ), (s′1 , s′2 , . . . , s′q ′ ) are in the same connected component of X”.
(When this holds we have necessarily q = q ′ and s1 s2 . . . sq = s′1 s′2 . . . s′q in W .)
    The following result is due to Matsumoto and Tits.
Theorem 1.9. Let s = (s1 , s2 , . . . , sq ), s′ = (s′1 , s′2 , . . . , s′q ) in X be such that
s1 s2 . . . sq = s′1 s′2 . . . s′q = w ∈ W . Then s ∼ s′ .
   Let C (resp. C ′ ) be the connected component of X that contains s (resp. s′ ).
For i ∈ [1, q] we set
   s(i) = (. . . , s′1 , s1 , s′1 , s1 , s2 , s3 , . . . , si ) (a q-element sequence in S),
   s(i) = . . . s′1 s1 s′1 s1 s2 s3 . . . si ∈ W (the product of this sequence).
Let Ci be the connected component of X that contains s(i). Then s = s(q). Hence
C = Cq .
   We argue by induction on q. The theorem is obvious for q ∈ {0, 1}. We now
assume that q ≥ 2 and that the theorem is known for q − 1. We first prove the
following weaker statement.
   (A) In the setup of the theorem we have either s ∼ s′ or

(a)        s1 s2 . . . sq = s′1 s1 s2 . . . sq−1 and (s′1 , s1 , s2 , . . . , sq−1 ) ∼ (s′1 , s′2 , . . . , s′q ).
14                                                 G. LUSZTIG

We have l(s′1 w) = l(w) − 1. By 1.7 we have s′1 s1 s2 . . . si−1 = s1 s2 . . . si for some
i ∈ [1, q], so that w = s′1 s1 s2 . . . si−1 si+1 . . . sq . In particular,

                              (s′1 , s1 , s2 , . . . , si−1 , si+1 , . . . , sq ) ∈ X.

By the induction hypothesis, (s1 , s2 , . . . , si−1 , si+1 , . . . , sq ) ∼ (s′2 , . . . , s′q ). Hence


(b)                 (s′1 , s1 , s2 , . . . , si−1 , si+1 , . . . , sq ) ∼ (s′1 , s′2 , . . . , s′q ).

Assume first that i < q. Then from s′1 s1 s2 . . . si−1 si+1 . . . sq−1 = s1 s2 . . . sq−1 and
the induction hypothesis we deduce that
    (s′1 , s1 , s2 , . . . , si−1 , si+1 , . . . , sq−1 ) ∼ (s1 , s2 , . . . , sq−1 ), hence
    (s′1 , s1 , s2 , . . . , si−1 , si+1 , . . . , sq−1 , sq ) ∈ C.
Combining this with (b) we deduce that C = C ′ .
    Assume next that i = q so that s1 s2 . . . sq = s′1 s1 s2 . . . sq−1 . Then (b) shows
that (a) holds. Thus, (A) is proved.
    Next we prove for p ∈ [0, q − 2] the following generalization of (A).
    (A′p ) In the setup of the theorem we have either C = C ′ or:
    for i ∈ [q − p − 1, q] we have s(i) ∈ X, s(i) = w, Ci = C if i − q ∈ 2Z, Ci = C ′
if i − q ∈  / 2Z.
For p = 0 this reduces to (A). Assume now that p > 0 and that (A′p−1 ) is already
known. We prove that (A′p ) holds.
    If C = C ′ , then we are done. Hence by (A′p−1 ) we may assume that: for
i ∈ [q − p, q] we have s(i) ∈ X, s(i) = w, Ci = C if i − q ∈ 2Z, Ci = C ′ if i − q ∈         / 2Z.
                                                                                        ′
    Applying (A) to s(q − p), s(q − p + 1) (instead of s, s ), we see that either
Cq−p = Cq−p+1 or:
    s(q − p), s(q − p − 1) are in X, s(q − p) = s(q − p − 1) and Cq−p−1 = Cq−p+1 .
In both cases, we see that (A′p ) holds.
    This completes the inductive proof of (A′p ). In particular, (A′q−2 ) holds. In
other words, in the setup of the theorem, either C = C ′ holds or:
    (c) for i ∈ [1, q] we have s(i) ∈ X, s(i) = w, Ci = C if i − q ∈ 2Z, Ci = C ′ if
i−q ∈   / 2Z.
If C = C ′ , then we are done. Hence we may assume that (c) holds. In particular,

(d)                                s(2) ∈ X, s(1) ∈ X, s(2) = s(1).

From s(1) ∈ X and q ≥ 2 we see that s′1 6= s1 and that q ≤ m = ms1 ,s′1 . From
s(2) = s(1) we see that s2 ∈ hs1 , s′1 i, hence s2 is either s1 or s′1 . In fact we cannot
have s2 = s1 since this would contradict s(2) ∈ X. Hence s2 = s′1 . We see that
s(2) = (. . . , s′1 , s1 , s′1 , s1 , s′1 ) (the number of terms is q, q ≤ m). Since s(2) = s(1),
it follows that q = m, so that s(2), s(1) are joined in X. It follows that C2 = C1 .
By (c), for some permutation a, b of 1, 2 we have Ca = C, Cb = C ′ . Since Ca = Cb
it follows that C = C ′ . The theorem is proved.
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                     15

Proposition 1.10. Let w ∈ W and let s, t ∈ S be such that l(swt) = l(w), l(sw) =
l(wt). Then sw = wt.
    Let w = s1 s2 . . . sq be a reduced expression.
    Assume first that l(wt) = q +1. Then s1 s2 . . . sq t is a reduced expression for wt.
Now l(swt) = l(wt)−1 hence by 1.7 there exists i ∈ [1, q] such that ss1 s2 . . . si−1 =
s1 s2 . . . si or else ss1 s2 . . . sq = s1 s2 . . . sq t. If the second alternative occurs, we
are done. If the first alternative occurs, we have sw = s1 s2 . . . si−1 si+1 . . . sq hence
l(sw) ≤ q − 1. This contradicts l(sw) = l(wt).
    Assume next that l(wt) = q − 1. Let w′ = wt. Then l(sw′ t) = l(w′ ), l(sw′ ) =
l(w′ t). We have l(w′ t) = l(w′ ) + 1 hence the first part of the proof applies and
gives sw′ = w′ t. Hence sw = wt. The proposition is proved.
1.11. We can regard S as the set of vertices of a graph in which s, s′ are joined
if ms,s′ > 2. We say that W is irreducible if this graph is connected. It is easy
to see that in general, W is naturally a product of irreducible Coxeter groups,
corresponding to the connected components of S.
    In the setup of 1.3, let (, ) : E × E → R be the symmetric R-bilinear form given
by (es , es′ ) = − cos mπ ′ . Then σ(w) : E −→ E preserves (, ) for any w ∈ W .
                          s,s
    We say that W is tame if (e, e) ≥ 0 for any e ∈ E. It is easy to see that, if W
is finite then W is tame.
    We say that W is integral if, for any s 6= s′ in S, we have 4 cos2 mπ ′ ∈ N (or
                                                                         s,s
equivalently ms,s′ ∈ {2, 3, 4, 6, ∞}).
    We will be mainly interested in the case where W is tame. The tame, irreducible
W are of three kinds:
    (a) finite, integral;
    (b) finite, non-integral;
    (c) tame, infinite (and automatically integral).
1.12. For k ∈ Z define ρk : Z −   → Z by ρk (z) = z + k. Let n ≥ 2. Let W̃ be the
group of allP permutations σ : Z −  → Z such that σρn = ρn σ. Define χ : W̃ −     →Z
by χ(σ) = k∈X (σ(k) − k) where X is a set of representatives for the residue
classes mod n in Z. One checks that χ does not depend on the choice of X and
χ is a group homomorphism with image nZ. Now W̃ ′ = ker(χ) is generated by
{sm ; m ∈ Z/nZ} where sm : Z −    → Z is defined by
    sm (z) = z + 1 if z = m mod n,
    sm (z) = z − 1 if z = m + 1 mod n,
    sm (z) = z for all other z ∈ Z.
It is a Coxeter group on these generators, said to be of type Ãn−1 . (This description
of W̃ ′ appears in [L4].) For n ≥ 3, m, m′ ∈ Z/nZ are joined by a single edge in
the Coxeter graph if m − m′ = 1 mod n and are not joined otherwise. For n = 2,
0, 1 ∈ Z/2Z are joined by a quadruple edge in the Coxeter graph. The length
function on W̃ ′ is given by
                                    l(σ) = ♯(Yσ /τn )
16                                          G. LUSZTIG

where, for σ ∈ W̃ ′ ,
                          Yσ = {(i, j) ∈ Z × Z; i < j, σ(i) > σ(j)}
and Yσ /τn is the (finite) set of orbits of τn : Yσ −
                                                    → Yσ , (i, j) 7→ (i + n, j + n).
1.13. Assume now that n = 2p ≥ 4, where p ∈ N. Let W be the subgroup of W̃
consisting of all σ ∈ W̃ that commute with the involution Z −   → Z, z 7→ 1 − z. We
compute χ(σ) for σ ∈ W , taking X = {−(p − 1), . . . , −1, 0, 1, 2, . . . , p}:
                         X                X
               χ(σ) =        (σ(k) − k) +     (σ(1 − k) − (1 − k))
                            k∈[1,p]                k∈[1,p]
                        X                      X
                  =          (σ(k) − k) +           (1 − σ(k) − (1 − k)) = 0.
                      k∈[1,p]                 k∈[1,p]

Thus, W is a subgroup of W̃ ′ . Now W is generated by s′0 , s′1 , . . . , s′p where
           s′0 = s0 , s′1 = s1 s−1 , s′2 = s2 s−2 , . . . , s′p−1 = sp−1 s1−p , s′p = sp .

It is a Coxeter group on these generators, said to be of type C̃p . The Coxeter
graph is
                           •=•     •    ... • = •
with vertices corresponding to 0, 1, 2, . . . , p − 1, p.
   Let σ ∈ W . We have a partition Yσ = Yσ0 ⊔ Yσ1 where
            Yσ0 = {(i, j) ∈ Z × Z; i < j, σ(i) > σ(j), i + j 6= 1              mod 2p},
            Yσ1 = {(i, j) ∈ Z × Z; i < j, σ(i) > σ(j), i + j = 1               mod 2p}.
Now Yσ1 /τn is the fixed point set of the involution of Yσ /τn induced by the invo-
lution (i, j) 7→ (1 − j, 1 − i) of Yσ . Hence we have ♯(Yσ /τn ) = 2l0 (σ) + l1 (σ) where
l0 (σ) = ♯(Yσ0 /τn )/2, l1 (σ) = ♯(Yσ1 /τn ) are integers. Now (i, j) 7→ (i, i+j−1
                                                                                 2p
                                                                                    ) is a
                1
bijection of Yσ with
 {(i, h) ∈ Z × Z; 2i < 1 + 2ph, 2σ(i) > 1 + 2ph} = {(i, h) ∈ Z × Z; i ≤ ph < σ(i)}.
It follows that
    l1 (σ) = i∈[1−p,p];i<σ(i) f (i)
                P

where
    f (i) = ♯(x ∈ pZ; i ≤ x < σ(i)).
Let Z′ = [1, p] + 2pZ, Z′′ = [1 − p, 0] + 2pZ; then Z = Z′ ⊔ Z′′ . We have l1 (σ) =
l′ (σ) + l′′ (σ) where
                            X            f (i)        X            f (i)
             l′ (σ) =                          +
                                   ′′
                                           2              ′
                                                                     2
                    i∈[1−p,0];σ(i)∈Z ,i<σ(i)              i∈[1,p];σ(i)∈Z ,i<σ(i)
                         X                 f (i) + 1              X                 f (i) − 1
           +                                         +                                        ,
                                               2                                        2
               i∈[1−p,0];σ(i)∈Z′ ,i<σ(i)                 i∈[1,p];σ(i)∈Z′′ ,i<σ(i)
                    HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                                 17

                                   X                 f (i)              X               f (i)
            l′′ (σ) =                                      +
                                                       2                                  2
                        i∈[1−p,0];σ(i)∈Z′′ ,i<σ(i)             i∈[1,p];σ(i)∈Z′,i<σ(i)
                            X                f (i) − 1               X                f (i) + 1
             +                                         +                                        .
                                                 2                                        2
                 i∈[1−p,0];σ(i)∈Z′ ,i<σ(i)                 i∈[1,p];σ(i)∈Z′′ ,i<σ(i)


These are integers since f (i) is even if i, σ(i) are in the same set Z′ or Z′′ and is
odd otherwise. We see that the length of σ in W̃ ′ is 2l0 (σ) + l′ (σ) + l′′ (σ). On the
other hand, the length of σ in W is

                                        l0 (σ) + l′ (σ) + l′′ (σ).

Now l′ (σ) (resp. l′′ (σ)) is the number of times that s′0 (resp. s′p ) appears in a
reduced expression of σ in W .
   One can show that l0 , l′ , l′′ are weight functions on W in the sense of 3.1.
                                                                                ′
   Define χ′ : W −→ {±1} and χ′′ : W −                  → {±1} by χ′ (σ) = (−1)l (σ) , χ′′ (σ) =
     ′′
(−1)l (σ) . Then χ′ , χ′′ are group homomorphisms.
   Assuming that p ≥ 3, let W ′ = ker(χ′ ). This is the subgroup of W generated
by
                               s′0 s′1 s′0 , s′1 , s′2 , . . . , s′p−1 , s′p .

It is a Coxeter group on these generators, said to be of type B̃p . The Coxeter
graph has vertices 1̃, 1, 2, . . . , (p − 1), p corresponding to s′0 s′1 s′0 , s′1 , s′2 , . . . , s′p−1 , s′p
and edges
                  •           •           •         ...      • = •
                               |
                              •
Assuming that p ≥ 4, let W ′′ = ker(χ′ ) ∩ ker(χ′′ ). This is the subgroup of W (or
W ′ ) generated by
                        s′0 s′1 s′0 , s′1 , s′2 , . . . , s′p−1 , s′p s′p−1 s′p .

It is a Coxeter group on these generators, said to be of type D̃p . The Coxeter
                                               ^
graph has vertices 1̃, 1, 2, . . . , (p − 1), (p − 1) and edges

                        •         •          •          ...           •          •
                                  |                                   |
                                  •                                   •

1.14. Let p ≥ q ≥ r ≥ 1 be integers such that p−1 + q −1 + r −1 = 1. Then p, q, r is
3, 3, 3 or 4, 4, 2 or 6, 3, 2. Thus, q and r divide p. Consider the graph with vertices

               ip                            ip                          ip
          {(      , 0, 0); i ∈ [1, p]} ∪ {(0, , 0); i ∈ [1, q]} ∪ {(0, 0, ); i ∈ [1, r]}
               p                              q                           r
18                                            G. LUSZTIG

where (p, 0, 0), (0, p, 0), (0, 0, p) are identified; the edges are
  ( ip
    p , 0, 0)  ( (i+1)p
                    p   , 0, 0), 1 ≤ i < p,
     (0, ip
          q
            , 0)   (0, (i+1)p
                          q
                              , 0), 1 ≤ i < q,
  (0, 0, ip
          r ) (0, 0, (i+1)p
                        r   ), 1 ≤ i < r.
The Coxeter group W corresponding to this graph is said to be of type Ẽn where
n = p + q + r − 3. Thus, n ∈ {6, 7, 8}.
  Let W be of type Ẽ6 . Let W ′ be the subgroup of W generated by

                           s1,0,0 , s2,0,0, s3,0,0 , s0,2,0s0,0,2 , s0,1,0 s0,0,1 .

(The index of a generator of W is the corresponding vertex of the graph.) Then
W ′ is a Coxeter group on these generators, said to be of type F̃4 . The Coxeter
graph is
                             •    •    •=•      •.

Let W be of type D̃4 . The standard generators may be denoted by s0 , s1 , s2 , s3 , s4
where the Coxeter graph has vertices 0, 1, 2, 3, 4 with four edges joining 0 with
1, 2, 3, 4. Let W ′ be the subgroup of W generated by s1 , s0 , s2 s3 s4 . Then W ′ is a
Coxeter group on these generators, said to be of type G̃2 . The Coxeter graph is

                                               •     • ≡ •.

1.15. The collection of Coxeter groups of type Ãn−1 (n ≥ 2), D̃n (n ≥ 4), C̃n (n ≥
2), B̃n (n ≥ 3), Ẽn (n = 6, 7, 8), F̃4 , G̃2 (see 1.12-1.14) coincides with the collection
of infinite, tame, irreducible Coxeter groups (or affine Weyl groups).
1.16. Let W, S be an affine Weyl group. Let T be the union of all finite conjugacy
classes in W . Then T is a normal, finitely generated free abelian subgroup of W
of finite index. Let Smin be the set of all s ∈ S such that the obvious composition
hS − {s}i − →W −    → W/T is an isomorphism. (This composition is injective for any
s ∈ S.) Now Smin 6= ∅. We describe Smin in each case.
   If W is of type Ãn−1 we have Smin = S. In the setup of 1.13, Smin corresponds
to the following vertices of the Coxeter graph: 1, p, if W is of type C̃p ; 1, 1̃, if W
                                  ^
is of type B̃p ; 1, 1̃, (p − 1), (p − 1), if W is of type D̃p . In the setup of 1.14, if W is
of type Ẽn then Smin corresponds to the following vertices of the Coxeter graph:
(1, 0, 0), (0, 1, 0), (0, 0, 1) if W is of type Ẽ6 ; (1, 0, 0), (0, 1, 0) if W is of type Ẽ7 ;
(1, 0, 0) if W is of type Ẽ8 . If W is of type F̃4 then Smin = {s1,0,0 }; if W is of
type G̃2 then Smin = {s1 }.
1.17. For a Coxeter group W, S we denote by AW the group of all automorphisms
of W that map S into itself. (This is also the group of automorphisms of the
corresponding Coxeter graph.)
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                19

1.18. Let W, S be an affine Weyl group. Let T ⊂ W be as in 1.16. Let Ω be
the set of all a ∈ AW such that there exists w ∈ W with a(t) = wtw−1 for all
t ∈ T . Now Ω is a commutative normal subgroup of AW . The action of AW on
W restricts to an action of Ω on Smin which is simply transitive.
1.19. For any I ⊂ S, let WI = hIi. Then (WI , I) is a Coxeter group whose
Coxeter matrix is a submatrix of that of W, S. See §9.
1.20. Let W, S be an affine Weyl group. Let s ∈ Smin . Then WS−{s} , S − {s} is
a finite Coxeter group.
    A finite Coxeter group is said to be of type An−1 (n ≥ 2) (resp. Cn (n ≥ 2),
Bn (n ≥ 3), Dn (n ≥ 4), En (n = 6, 7, 8), F4 , G2 ) if it is isomorphic to WS−{s}
for some W, S, s as above, where W has type Ãn−1 (n ≥ 2) (resp. C̃n (n ≥ 2),
B̃n (n ≥ 3), D̃n (n ≥ 4), Ẽn (n = 6, 7, 8), F̃4 , G̃2 ).
    The collection of Coxeter groups of type An−1 (n ≥ 2), Cn (n ≥ 2), Bn (n ≥ 3),
Dn (n ≥ 4), En (n = 6, 7, 8), F4 , G2 coincides with the collection of finite, integral,
irreducible Coxeter groups 6= {1} (or Weyl groups). The group W = {1} with
S = ∅ is also considered to be a Weyl group. Note that the types Cn and Bn
coincide for n ≥ 3.
    For a Weyl group W, S we set n(W ) = 2♯(T )/♯(S)2 where T is as in 1.4. We
list below the numbers n(W ) for W of various types:
                            1
    An−1 : n(W ) = 1 + n−1
    Dn : n(W ) = 2 − n2
    Bn : n(W ) = 2
    E6 : n(W ) = 2
    E7 : n(W ) = 2.57 . . .
    F4 : n(W ) = 3
    G2 : n(W ) = 3
    E8 : n(W ) = 3.75.
We see that the maximum value of n(W ) is achieved in type E8 .
1.21. Let W, S be a Weyl group of type E8 . Let W ′ be the subgroup of W
generated by
                 s2,0,0 s0,2,0 , s3,0,0 s0,4,0 , s4,0,0s6,0,0 , s5,0,0 s0,0,3 .
(The index of a generator of W is the corresponding vertex of the graph, see 1.13.)
Then W ′ is a (finite, non-integral) Coxeter group on these generators, said to be
of type H4 . This description of H4 appeared in [L4].

                             2. Partial order on W
2.1. Let W, S be a Coxeter group. Let y, w be two elements of W . Following
Chevalley, we say that y ≤ w if there exists a sequence y = y0 , y1 , y2 , . . . , yn = w
                                                             −1
in W such that l(yk ) − l(yk−1 ) = 1 for k ∈ [1, n] and yk yk−1  ∈ T (or equivalently
      −1          −1                −1
yk−1 yk ∈ T , or yk yk−1 ∈ T , or yk−1 yk ∈ T ) for k ∈ [1, n]. This is a partial order
20                                        G. LUSZTIG

on W . Note that y ≤ w implies y −1 ≤ w−1 and l(y) ≤ l(w). We write y < w or
w > y instead of y ≤ w, y 6= w. If w ∈ W, s ∈ S then,
  sw < w if and only if l(sw) = l(w) − 1;
  sw > w if and only if l(sw) = l(w) + 1.
Lemma 2.2. Let w = s1 s2 . . . sq be a reduced expression in W and let t ∈ T . The
following are equivalent:
   (i) U (w−1 )(ǫ, t) = (−ǫ, w−1 tw) for ǫ = ±1;
   (ii) t = s1 s2 . . . si . . . s2 s1 for some i ∈ [1, q];
   (iii) l(tw) < l(w).
  The equivalence of (i),(ii) has been proved in 1.6.
  Proof of (ii) =⇒ (iii). Assume that (ii) holds. Then tw = s1 . . . si−1 si+1 . . . sq
hence l(tw) < q and (iii) holds.
  Proof of (iii) =⇒ (i). First we check that

(a)                                   U (t)(ǫ, t) = (−ǫ, t).

If t ∈ S, (a) is clear. If (a) is true for t then it is also true for sts where s ∈ S.
Indeed,

     U (sts)(ǫ, sts) = Us U (t)Us (ǫ, sts) = Us U (t)(ǫ(−1)δs,sts , t) = Us (−ǫ(−1)δs,sts , t)
                    = (−ǫ(−1)δs,sts +δs,t , sts) = (−ǫ, sts);

(a) follows. Assume now that (i) does not hold; thus, U (w−1 )(ǫ, t) = (ǫ, w−1 tw).
Then

          U ((tw)−1 )(ǫ, t) = U (w−1 )U (t)(ǫ, t) = U (w−1 )(−ǫ, t) = (−ǫ, w−1 tw)
                            = (−ǫ, (tw)−1 t(tw)).

Since (i) =⇒ (iii) we deduce that l(w) < l(tw); thus, (iii) does not hold. The
lemma is proved.
Lemma 2.3. Let y, z ∈ W and let s ∈ S. If sy ≤ z < sz, then y ≤ sz.
   We argue by induction on l(z) − l(sy). If l(z) − l(sy) = 0 then z = sy and the
result is clear. Now assume that l(z) > l(sy). Then sy < z. We can assume that
sy < y (otherwise the result is trivial). We can find t ∈ T such that sy < tsy ≤ z
and l(tsy) = l(sy) + 1. If t = s, then y ≤ z and we are done. Hence we may
assume that t 6= s. We show that

(a)                                         y < stsy.

Assume that (a) does not hold. Then y, tsy, sy, stsy have lengths q + 1, q + 1, q, q.
We can find a reduced expression y = ss1 s2 . . . sq . Since l(stsy) < l(y), we see
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                                21

from 2.2 that either sts = ss1 . . . si . . . s1 s for some i ∈ [1, q] or sts = s. (This last
case has been excluded.) It follows that

                 tsy = s1 . . . si . . . s1 sss1 s2 . . . sq = s1 . . . si−1 si+1 . . . sq .

Thus, l(tsy) ≤ q − 1, a contradiction. Thus, (a) holds. Let y ′ = stsy. We have
sy ′ ≤ z < sz and l(z) − l(sy ′ ) < l(z) − l(sy). By the induction hypothesis, y ′ ≤ sz.
We have y < y ′ by (a), hence y ≤ sz. The lemma is proved.
Proposition 2.4. The following three conditions on y, w ∈ W are equivalent:
   (i) y ≤ w;
   (ii) for any reduced expression w = s1 s2 . . . sq there exists a subsequence i1 <
i2 < · · · < ir of 1, 2, . . . , q such that y = si1 si2 . . . sir , r = l(y);
   (iii) there exists a reduced expression w = s1 s2 . . . sq and a subsequence i1 <
i2 < · · · < ir of 1, 2, . . . , q such that y = si1 si2 . . . sir .
   Proof of (i) =⇒ (ii). We may assume that y < w. Let y = y0 , y1 , y2 , . . . , yn = w
be as in 2.1. Let w = s1 s2 . . . sq be a reduced expression. Since yn−1 yn−1 ∈
T , l(yn−1 ) = l(yn ) − 1, we see from 2.2 that there exists i ∈ [1, q] such that
yn−1 yn−1 = s1 s2 . . . si . . . s2 s1 hence yn−1 = s1 s2 . . . si−1 si+1 . . . sq (a reduced ex-
                                          −1
pression). Similarly, since yn−2 yn−1         ∈ T , l(yn−2 ) = l(yn−1 ) − 1, we see from 2.2
(applied to yn−1 ) that there exists j ∈ [1, q] − {i} such that yn−2 equals

      s1 s2 . . . si−1 si+1 . . . sj−1 sj+1 . . . sq or s1 s2 . . . sj−1 sj+1 . . . si−1 si+1 . . . sq

(depending on whether i < j or i > j). Continuing in this way we see that y is of
the required form.
   The proof of (ii) =⇒ (iii) is trivial.
   Proof of (iii) =⇒ (i). Assume that w = s1 s2 . . . sq (reduced expression) and
y = si1 si2 . . . sir where i1 < i2 < · · · < ir is a subsequence of 1, 2, . . . , q. We argue
by induction on q. If q = 0 there is nothing to prove. Now assume q > 0.
   If i1 > 1, then the induction hypothesis is applicable to y, w′ = s2 . . . sq and
yields y ≤ w′ . But w′ ≤ w hence y ≤ w. If i1 = 1 then the induction hypothesis is
applicable to y ′ = si2 . . . sir , w′ = s2 . . . sq and yields y ′ ≤ w′ . Thus, s1 y ≤ s1 w <
w. By 2.3 we then have y ≤ w. The proposition is proved.
Corollary 2.5. Let y, z ∈ W and let s ∈ S.
  (a) Assume that sz < z. Then y ≤ z ⇔ sy ≤ z.
  (b) Assume that y < sy. Then y ≤ z ⇔ y ≤ sz.
    We prove (a). We can find a reduced expression of z of form z = ss1 s2 . . . sq .
Assume that y ≤ z. By 2.4 we can find a subsequence i1 < i2 < · · · < ir of
1, 2, . . . , q such that either y = si1 si2 . . . sir or y = ssi1 si2 . . . sir . In the first case
we have sy = ssi1 si2 . . . sir and in the second case we have sy = si1 si2 . . . sir . In
both cases, sy ≤ z by 2.4. The same argument shows that, if sy ≤ z then y ≤ z.
This proves (a).
22                                        G. LUSZTIG

    We prove (b). Assume that y ≤ z. We must prove that y ≤ sz. If z < sz, this
is clear. Thus we may assume that sz < z. We can find a reduced expression of
z of form z = ss1 s2 . . . sq . By 2.4 we can find a subsequence i1 < i2 < · · · < ir of
1, 2, . . . , q such that either

            y = si1 si2 . . . sir , l(y) = r or y = ssi1 si2 . . . sir , l(y) = r + 1.

In the second case we have l(sy) = r < l(y), contradicting y < sy. Thus we are
in the first case. Hence y is the product of a subsequence of s1 , s2 , . . . , sq and
using again 2.4, we deduce that y ≤ sz (note that sz = s1 s2 . . . sq is a reduced
expression). The lemma is proved.

                                   3. The algebra H
3.1. Let W, S be a Coxeter group. A map L : W −          → Z is said to be a weight
function for W if L(ww′ ) = L(w) + L(w′ ) for any w, w′ ∈ W such that l(ww′ ) =
l(w) + l(w′ ). We will assume that a weight function L : W −    → Z is fixed; we then
say that W, L is a weighted Coxeter group. (For example we could take L = l; in
that case we say that we are in the split case.) Note that L is determined by its
values on S which are subject only to the condition
   L(s) = L(s′ ) for any s 6= s′ in S such that ms,s′ is finite and odd.
We have L(w) = L(w−1 ) for all w ∈ W .
   Let A = Z[v, v −1 ] where v is an indeterminate. For s ∈ S we set vs = v L(s) ∈ A.
3.2. Let H be the A-algebra with 1 defined by the generators Ts (s ∈ S) and the
relations

(a)                        (Ts − vs )(Ts + vs−1 ) = 0 for s ∈ S


(b)                              Ts Ts′ Ts · · · = Ts′ Ts Ts′ . . .

(both products have ms,s′ factors) for any s 6= s′ in S such that ms,s′ < ∞; H is
called the Iwahori-Hecke algebra.
   For w ∈ W we define Tw ∈ H by Tw = Ts1 Ts2 . . . Tsq , where w = s1 s2 . . . sq
is a reduced expression in W . By (b) and 1.9, Tw is independent of the choice
of reduced expression. We have T1 = 1. From the definitions it is clear that for
s ∈ S, w ∈ W we have

                            Ts Tw = Tsw if l(sw) = l(w) + 1,

                  Ts Tw = Tsw + (vs − vs−1 )Tw if l(sw) = l(w) − 1.
In particular, the A-submodule of H generated by {Tw ; w ∈ W } is a left ideal of
H. It contains 1 = T1 hence it is the whole of H. Thus {Tw ; w ∈ W } generates
the A-module H.
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                   23

Proposition 3.3. {Tw ; w ∈ W } is an A-basis of H.
  We follow the lines of the proof in [Bo, Ex.23, p.55].
  We consider the free A-module E with basis (ew )w∈W . For any s ∈ S we define
A-linear maps Ps , Qs : E − → E by
  Ps (ew ) = esw if l(sw) = l(w) + 1,
  Ps (ew ) = esw + (vs − vs−1 )ew if l(sw) = l(w) − 1;
  Qs (ew ) = ews if l(ws) = l(w) + 1,
  Qs (ew ) = ews + (vs − vs−1 )ew if l(ws) = l(w) − 1.
We shall continue the proof assuming that
  (a) Ps Qt = Qt Ps for any s, t in S.
Let A be the A-subalgebra with 1 of End(E) generated by {Ps ; s ∈ S}. The map
A−→ E given by π 7→ π(e1 ) is surjective. Indeed, if w = s1 s2 . . . sq is a reduced
expression in W , then ew = Ps1 . . . Psq e1 . Assume now that π ∈ A satisfies
π(e1 ) = 0. Let π ′ = Qsq . . . Qs1 . By (a) we have ππ ′ = π ′ π hence

                0 = π ′ π(e1 ) = ππ ′ (e1 ) = π(Qsq . . . Qs1 (e1 )) = π(ew ).

Since w is arbitrary, it follows that π = 0. We see that the map A −        → E is injective,
hence an isomorphism of A-modules. Using this isomorphism we transport the
algebra structure of A to an algebra structure on E with unit element e1 . For
this algebra structure we have Ps (e1 )π(e1 ) = Ps (π(e1 )) for s ∈ S, π ∈ A. Hence
es ew = Ps (ew ) for any w ∈ W, s ∈ S. It follows that
    (b) es ew = esw if l(sw) = l(w) + 1,
    (c) es ew = esw + (vs − vs−1 )ew if l(sw) = l(w) − 1.
From (b) it follows that, if w = s1 s2 . . . sq is a reduced expression, then ew =
es1 es2 . . . esq . In particular, if s 6= s′ in S are such that m = ms,s′ < ∞ then
es es′ es · · · = es′ es es′ . . . (both products have m factors); indeed, this follows from
the equality ess′ s... = es′ ss′ ... (see 1.4). From (c) we deduce that e2s = 1 + (vs −
vs−1 )es for s ∈ S, or that (es − vs )(es + vs−1 ) = 0. We see that there is a unique
algebra homomorphism H −              → E preserving 1 such that Ts 7→ es for all s ∈ S. It
takes Tw to ew for any w ∈ W . Assume           P now that aw ∈ A (w ∈ W ) are zero
for all but
          P      finitely  many     w and  that   w aw Tw = 0 in H. Applying H −     → E we
obtain w aw ew = 0. Since (ew ) is a basis of E, it follows that aw = 0 for all
w. Thus, {Tw ; w ∈ W } is an A-basis of H. This completes the proof, modulo the
verification of (a).
    We prove (a). Let w ∈ W . We distinguish six cases.
Case 1. swt, sw, wt, w have lengths q + 2, q + 1, q + 1, q. Then

                             Ps Qt (ew ) = Qt Ps (ew ) = eswt .

Case 2. w, sw, wt, swt have lengths q + 2, q + 1, q + 1, q. Then

        Ps Qt (ew ) = Qt Ps (ew )
         = eswt + (vt − vt−1 )esw + (vs − vs−1 )ewt + (vt − vt−1 )(vs − vs−1 )ew .
24                                    G. LUSZTIG

Case 3. wt, swt, w, sw have lengths q + 2, q + 1, q + 1, q. Then
                  Ps Qt (ew ) = Qt Ps (ew ) = eswt + (vs − vs−1 )ewt .
Case 4. sw, swt, w, wt have lengths q + 2, q + 1, q + 1, q. Then
                  Ps Qt (ew ) = Qt Ps (ew ) = eswt + (vt − vt−1 )esw .
Case 5. swt, w, wt, sw have lengths q + 1, q + 1, q, q. Then
           Ps Qt (ew ) = eswt + (vt − vt−1 )esw + (vt − vt−1 )(vs − vs−1 )ew ,
           Qt Ps (ew ) = eswt + (vs − vs−1 )ewt + (vt − vt−1 )(vs − vs−1 )ew .
Case 6. sw, wt, w, swt have lengths q + 1, q + 1, q, q. Then
                         Ps Qt (ew ) = eswt + (vs − vs−1 )ewt ,
                         Qt Ps (ew ) = eswt + (vt − vt−1 )esw .
In cases 5, 6 we have sw = wt by 1.10. In case 5 we have L(t) + L(wt) =
L(w) = L(swt) = L(s) + L(wt) hence L(t) = L(s) and vs = vt . In case 6 we have
L(t) + L(swt) = L(sw) = L(wt) = L(s) + L(swt), hence L(t) = L(s) and vs = vt .
Hence Ps Qt (ew ) = Qt Ps (ew ) in each case. The proposition is proved.
3.4. There is a unique involutive antiautomorphism h 7→ h♭ of the algebra H
which carries Ts to Ts for any s ∈ S. It carries Tw to Tw−1 for any w ∈ W .
3.5. For s ∈ S, the element Ts ∈ H is invertible: Ts−1 = Ts − (vs − vs−1 ). It follows
that Tw is invertible for each w ∈ W ; if w = s1 s2 . . . sq is a reduced expression in
W , then Tw−1 = Ts−1
                   q
                      . . . Ts−1
                              2
                                 Ts−1
                                   1
                                      .
   There is a unique algebra involution of H denoted h 7→ h† such that Ts† = −Ts−1
for any s ∈ S. We have Tw† = sgn(w)Tw−1  −1 for any w ∈ W .



                              4. The bar operator
4.1. We preserve the setup of 3.1. Let ¯ : A −
                                             → A be the ring involution which
takes v n to v −n for any n ∈ Z.
Lemma 4.2. (a) There is a unique ring homomorphism ¯ : H −         → H which is
                                                           −1
A-semilinear with respect to ¯: A −
                                  → A and satisfies T s = Ts for any s ∈ S.
  (b) This homomorphism is involutive. It takes Tw to Tw−1 −1 for any w ∈ W .


    The following identities can be deduced easily from 3.2(a),(b),(d):
    (Ts−1 − vs−1 )(Ts−1 + vs ) = 0 for s ∈ S,
    Ts−1 Ts−1
           ′ Ts
               −1
                  · · · = Ts−1 −1 −1
                            ′ Ts Ts′ . . .
(both products have ms,s′ factors) for any s 6= s′ in S such that ms,s′ < ∞; (a)
follows.
    We prove (b). Let s ∈ S. Applying¯to Ts T¯s = 1 gives T¯s T¯s = 1. We have also
T¯s Ts = 1 hence T¯s = Ts . It follows that the square of¯ is 1. The second assertion
of (b) is immediate. The lemma is proved.
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                             25

                                                    P
4.3. For any w ∈ W we can write uniquely T w = y∈W ry,w Ty where ry,w ∈ A
are zero for all but finitely many y. Note that rw,w = 1.
Lemma 4.4. Let w ∈ W and s ∈ S be such that w > sw. For y ∈ W we have
  ry,w = rsy,sw if sy < y,
  ry,w = rsy,sw + (vs − vs−1 )ry,sw if sy > y.
  We have
                                                    X
      T w = Ts−1 T sw = (Ts − (vs − vs−1 ))                  r y,sw Ty
                                                     y
              X                  X                                       X
          =       r y,sw Tsy −        (vs − vs−1 )ry,sw Ty +                 (vs − vs−1 )r y,sw Ty
              y                   y                                 y;sy<y
              X                   X
          =       r sy,sw Ty −            (vs − vs−1 )ry,sw Ty .
              y                  y;sy>y

The lemma follows.
Lemma 4.5. For any y, w we have r y,w = sgn(yw)ry,w .
  We argue by induction on l(w). If l(w) = 0, then w = 1 and the result is
obvious. Assume now that l(w) ≥ 1. We can find s ∈ S such that w > sw.
Assume first that sy < y. From 4.4 we see, using the induction hypothesis, that

                   ry,w = r sy,sw = sgn(sysw)rsy,sw = sgn(yw)ry,w .

Assume next that sy > y. From 4.4 we see, using the induction hypothesis, that

  ry,w = r sy,sw + (vs−1 − vs )r y,sw = sgn(sysw)rsy,sw + (vs−1 − vs )sgn(ysw)ry,sw
      = sgn(yw)(rsy,sw + (vs − vs−1 )ry,sw ) = sgn(yw)ry,w .

The lemma is proved.
                                                    P
Lemma 4.6. For any x, z ∈ W we have                      y   r x,y ry,z = δx,z .
  Using the fact that¯is an involution, we have

              Tz = T̄¯ z =
                             X                X                    XX
                                 r y,z Ty =         ry,z T y =               ry,z rx,y Tx .
                             y                  y                   y    x

We now compare the coefficients of Tx on both sides. The lemma follows.
Proposition 4.7. Let y, w ∈ W .
  (a) If ry,w 6= 0, then y ≤ w.
  (b) Assume that L(s) > 0 for all s ∈ S. If y ≤ w, then
  ry,w = v L(w)−L(y) mod v L(w)−L(y)−1 Z[v −1 ],
  ry,w = sgn(yw)v −L(w)+L(y) mod v −L(w)+L(y)+1 Z[v].
26                                           G. LUSZTIG

     (c) Without assumption on L, ry,w ∈ v L(w)−L(y) Z[v 2 , v −2 ].
   We prove (a) by induction on l(w). If l(w) = 0 then w = 1 and the result
is obvious. Assume now that l(w) ≥ 1. We can find s ∈ S such that w > sw.
Assume first that sy < y. From 4.4 we see that rsy,sw 6= 0 hence, by the induction
hypothesis, sy ≤ sw. Thus sy ≤ sw < w and, by 2.3, we deduce y ≤ w. Assume
next that sy > y. From 4.4 we see that either rsy,sw 6= 0 or ry,sw 6= 0 hence, by
the induction hypothesis, sy ≤ sw or y ≤ sw. Combining this with y < sy and
sw < w we see that y ≤ w. This proves (a).
   We prove the first assertion of (b) by induction on l(w). If l(w) = 0 then w = 1
and the result is obvious. Assume now that l(w) ≥ 1. We can find s ∈ S such that
w > sw. Assume first that sy < y. Then we have also sy < w and, using 2.5(b),
we deduce sy ≤ sw. By the induction hypothesis,

                        rsy,sw = v L(sw)−L(sy) + strictly lower powers
                                = v L(w)−L(y) + strictly lower powers.

But ry,w = rsy,sw and the result follows. Assume next that sy > y. From y <
sy, y ≤ w we deduce using 2.5(b) that y ≤ sw. By the induction hypothesis, we
have ry,sw = v L(sw)−L(y) + strictly lower powers. Hence

               (vs − vs−1 )ry,sw = v L(s) v L(sw)−L(y) + strictly lower powers
                = v L(w)−L(y) + strictly lower powers.

On the other hand, if sy ≤ sw, then by the induction hypothesis,

                        rsy,sw = v L(sw)−L(sy) + strictly lower powers
                         = v L(w)−L(y)−2L(s) + strictly lower powers

while if sy 6≤ sw then rsy,sw = 0 by (a). Thus, in ry,w = rsy,sw +(vs −vs−1 )ry,sw , the
term rsy,sw contributes only powers of v which are strictly smaller than L(w)−L(y)
hence ry,w = v L(w)−L(y) + strictly lower powers. This proves the first assertion of
(b). The second assertion of (b) follows from the first using 4.5.
   We prove (c) by induction on l(w). If l(w) = 0 then w = 1 and the result
is obvious. Assume now that l(w) ≥ 1. We can find s ∈ S such that w > sw.
Assume first that sy < y. By the induction hypothesis,

              ry,w = rsy,sw ∈ v L(sw)−L(sy) Z[v 2 , v −2 ] = v L(w)−L(y) Z[v 2 , v −2 ]

as required. Assume next that sy > y. By the induction hypothesis,

     ry,w = rsy,sw + (vs − vs−1 )ry,sw
     ∈ v L(sw)−L(sy)Z[v 2 , v −2 ] + v L(s) v L(sw)−L(y) Z[v 2 , v −2 ] = v L(w)−L(y) Z[v 2 , v −2 ],

as required. The proposition is proved.
               HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                            27

                                                P
Proposition 4.8. For x < z in W we have           y;x≤y≤z   sgn(y) = 0 (D.N.Verma).

  Using 4.5 we can rewrite 4.6 (in our case) in the form
                             X
(a)                                sgn(xy)rx,y ry,z = 0.
                               y


Here we may restrict the summation to y such that x ≤ y ≤ z. In the rest of the
proof we shall take L = l. Then 4.7(b) holds and we see that if x ≤ y ≤ z, then
   rx,y ry,z = v l(y)−l(x) v l(z)−l(y) + strictly lower powers of v.
Hence (a) states that
                          l(z)−l(x)
   P
      y;x≤y≤z sgn(xy)v
               P
                                     + strictly lower powers of v is 0.
In particular y;x≤y≤z sgn(xy) = 0. The proposition is proved.

4.9. Now¯: H −   → H commutes with h 7→ h♭ . Hence
   (a) ry−1 ,w−1 = ry,w
                                                                         †
for any y, w ∈ W . On the other hand, it is clear that ¯: H −
                                                            → H and          :H−
                                                                               →H
commute.

                              5. The elements cw
5.1. We preserve the setup of 3.1. For any n ∈ Z let

                    A≤n = ⊕m;m≤n Zv m , A≥n = ⊕m;m≥n Zv m ,

                    A<n = ⊕m;m<n Zv m , A>n = ⊕m;m>n Zv m ,

                      H≤0 = ⊕w A≤0 Tw , H<0 = ⊕w A<0 Tw .

We have A≤0 = Z[v −1 ], H<0 ⊂ H≤0 ⊂ H.

Theorem 5.2. (a) Let w ∈ W . There exists a unique element cw ∈ H≤0 such
that cw = cw and cw = Tw mod H<0 .
   (b) {cw ; w ∈ W } is an A≤0 -basis of H≤0 and an A-basis of H.

   We prove the existence part of (a). We will construct, for any x such that
x ≤ w, an element ux ∈ A≤0 such that
   (c) uw = 1,
                            P
   (d) ux ∈ A<0 , ux − ux = y;x<y≤w rx,y uy for any x < w.
We argue by induction on l(w) − l(x). If l(w) − l(x) = 0 then x = w and we set
ux = 1. Assume now that l(w) − l(x) > 0 and that uz is already defined whenever
z ≤ w, l(w) − l(z) < l(w) − l(x) so that (c) holds and (d) holds if x is replaced by
any such z. Then the right hand side of the equality in (d) is defined. We denote
28                                               G. LUSZTIG

it by ax ∈ A. We have
                         X                       X
      ax + ax =                   rx,y uy +                r x,y uy
                       y;x<y≤w                y;x<y≤w
                         X                       X                         X
                 =                rx,y uy +                r x,y (uy +             ry,z uz )
                       y;x<y≤w                y;x<y≤w                    z;y<z≤w
                         X                       X                       X          X
                 =                rx,z uz +              r x,z uz +                        r x,y ry,z uz
                       z;x<z≤w                z;x<z≤w                 z;x<z≤w y;x<y<z
                         X          X                             X
                 =                          r x,y ry,z uz =               δx,z uz = 0.
                       z;x<z≤w y;x≤y≤z                         z;x<z≤w


(We have used 4.6 and the equality ry,y = 1.) Since ax + ax = 0, we have ax =
            n
P
                          P γn ∈ nZ satisfy γn +γ−n = 0 for all n and in particu-
   n∈Z γn v (finite sum) where
lar, γ0 = 0. Then ux = − n<0 γn v ∈ A<0 satisfies ux −ux = Pax . This completes
the inductive construction of the elements ux . We set cw = y;y≤w uy Ty ∈ H≤0 .
It is clear that cw = Tw mod H<0 . We have
                 X                    X           X                      X         X
        cw =             uy T y =           uy           rx,y Tx =           (           r x,y uy )Tx
                y;y≤w               y;y≤w        x;x≤y                x;x≤w y;x≤y≤w
               X
          =            ux Tx = cw .
              x;x≤w


(We have used the fact that rx,y 6= 0 implies x ≤ y, see 4.7, and (d).) The existence
of the element cw is established.
   To prove uniqueness, it suffices to verify the following statement:
   (e) If h ∈ H<0 satisfies hP= h then h = 0.
We can write uniquely h = y∈W fy Ty where fy ∈ A<0 are zero for all but finitely
many y. Assume that not all fy are 0. Then we can find l0 ∈ N such that

      Y0 := {y ∈ W ; fy 6= 0, l(y) = l0 } =
                                          6 ∅ and {y ∈ W ; fy 6= 0, l(y) > l0 } = ∅.
      P                P
Now      y   fy Ty =      y   fy Ty implies
                              X               X                          X
                                  fy Ty =          fy Ty      mod                 ATy
                           y∈Y0             y∈Y0                      y;l(y)<l0


hence fy = fy for any y ∈ Y0 . Since fy ∈ A<0 , it follows that fy = 0 for any
y ∈ Y0 , a contradiction. We have proved that fy = 0 for all y; (e) is verified and
(a) is proved.
   The elements cw constructed in (a) (for various w) are related to the basis Tw
by a triangular matrix (with respect to ≤) with 1 on the diagonal. Hence these
elements satisfy (b). The theorem is proved.
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                        29

                                 P
5.3. For any w ∈ W we set cw = y∈W py,w Ty where py,w ∈ A≤0 . By the proof
of 5.2 we have
   py,w = 0 unless y ≤ w,
   pw,w = 1,
   py,w ∈ A<0 if y < w.
Moreover, Pfor any x ≤ w in W we have
   p̄x,w = y;x≤y≤w rx,y py,w .
Proposition 5.4. (a) Assume that L(s) > 0 for all s ∈ S. If x ≤ w, then
  px,w = v −L(w)+L(x) mod v −L(w)+L(x)+1 Z[v].
  (b) Without assumption on L, for x ≤ w we have px,w ∈ v L(w)−L(x) Z[v 2 , v −2 ].
   We prove (a) by induction on l(w)−l(x). If l(w)−l(x) = 0 then x = w, px,w = 1
and the result is obvious. Assume Pnow that l(w) − l(x) > 0. Using 4.7(b) and the
induction hypothesis, we see that y;x<y≤w rx,y py,w is equal to
   X                                                         X
          sgn(x)sgn(y)v −L(y)+L(x) v −L(w)+L(y) =                   sgn(x)sgn(y)v −L(w)+L(x)
y;x<y≤w                                                   y;x<y≤w


plus strictly higher powers of v. Using 4.8, we see that this is −v −L(w)+L(x) plus
strictly higher powers of v. Thus,
   p̄x,w − px,w = −v −L(w)+L(x) + strictly higher powers of v.
Since p̄x,w ∈ vZ[v], it is in particular a Z-linear combination of powers of v strictly
higher than −L(w) + L(x). (We use that, if a ≤ b in W then L(a) ≤ L(b) which
follows from 2.4.) Hence
   −px,w = −v −L(w)+L(x) + strictly higher powers of v.
This proves (a).
   We prove (b) by induction on l(w) − l(x). If l(w) − l(x) = 0, then x = w,
px,w = 1 and the result is obvious. Assume now that l(w) − l(x) > 0. Using 4.7(c)
and the induction hypothesis, we see that
   X                   X
         rx,y py,w ∈           v L(y)−L(x) v L(w)−L(y) Z[v 2 , v −2 ] ⊂ v L(w)−L(x) Z[v 2 , v −2 ].
y;x<y≤w               y;x<y≤w


Thus, p̄x,w − px,w ∈ v L(w)−L(x) Z[v 2 , v −2 ]. Hence px,w ∈ v L(w)−L(x) Z[v 2 , v −2 ]. The
proposition is proved.
5.5. Let s ∈ S. From Ts−1 = Ts − (vs − vs−1 ) we see that r1,s = vs − vs−1 . We also
see that
   Ts + vs−1 = Ts − (vs − vs−1 ) + vs = Ts + vs−1 ,
   Ts − vs = Ts − (vs − vs−1 ) − vs−1 = Ts − vs .
If L(s) = 0 we have Ts−1 = Ts . Hence,
   cs = Ts + vs−1 if L(s) > 0,
   cs = Ts − vs if L(s) < 0,
   cs = Ts if L(s) = 0.
30                                   G. LUSZTIG

5.6. Now h 7→ h♭ carries H≤0 into itself; moreover, it commutes with ¯: H −    →H
(as pointed out in 4.9). Hence it carries cw to cw−1 for any w ∈ W . It follows that
   (a) py−1 ,w−1 = py,w
for any y, w ∈ W .

                    6. Left or right multiplication by cs
6.1. We preserve the setup of 3.1 and we fix s ∈ S. Assume first that L(s) = 0.
In this case we have cs = Ts ; moreover, for any y ∈ W we have Ts Ty = Tsy . Hence
for w ∈ W we have
                         X               X              X
                 cs cw =    py,w Ts Ty =     py,w Tsy =   psy,w Ty .
                          y                y               y

We see that cs cw ∈ H≤0 and cs cw = Tsw mod H<0 . Since cs cw = cs cw , it follows
that, in this case, cs cw = csw . Similarly we have cw cs = cws .
6.2. In the remainder of this chapter (except in 6.8) we assume that L(s) > 0.
Proposition 6.3. To any y, w ∈ W such that sy < y < w < sw one can assign
uniquely an element µsy,w ∈ A so that
        s      s
   (i) µP
        y,w = µy,w and
   (ii) z;y≤z<w;sz<z py,z µsz,w − vs py,w ∈ A<0
for any y, w ∈ W such that sy < y < w < sw.
   Let y, w be as above. We may assume that µsz,w are already defined for all z
such that y < z < w; sz < z. Then condition (ii) is of the form:
   µsy,w equals a known element of A modulo A<0 .
This condition determines uniquely the coefficients of v n with n ≥ 0 in µsy,w . Then
condition (i) determines uniquely the coefficients of v n with n < 0 in µsy,w . The
proposition is proved.
Proposition 6.4. Let y, w ∈ W be such that sy < y < w < sw. Then µsy,w
is a Z-linear combination of powers v n with −L(s) + 1 ≤ n ≤ L(s) − 1 and
n = L(w) − L(y) − L(s) mod 2.
   We may assume that this is already known for all µsz,w with z such that y <
z < w; sz < z. Using 6.3(ii) and 5.4(b), we see that µsy,w is a Z-linear combination
of powers v n such that, whenever n ≥ 0, we have n ≤ L(s) − 1 and n = L(w) −
L(y) − L(s) mod 2. Using now 6.3(i), we deduce the remaining assertions of the
proposition.
Corollary 6.5. Assume that L(s) = 1. Let y, w ∈ W be such that sy < y < w <
sw. Then µsy,w is an integer, equal to the coefficient of v −1 in py,w . In particular,
it is 0 unless L(w) − L(y) is odd.
    In this case, the inequalities of 6.4 become 0 ≤ n ≤ 0. They imply n = 0. Thus,
µsy,w ∈ Z. Picking up the coefficient of v 0 in the two sides of 6.3(ii), we see that
µsy,w is equal to the coefficient of v −1 in py,w . The last assertion follows from 5.4.
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                            31

Theorem 6.6. Let w ∈ W .
  (a) If w < sw, then cs cw = csw + z;sz<z<w µsz,w cz .
                                    P

  (b) If sw < w, then cs cw = (vs + vs−1 )cw .
   Since cs = Ts + vs−1 (see 5.5), we see that (b) is equivalent to (Ts − vs )cw = 0,
or to
   (c) px,w = vs−1 psx,w
(where sw < w and x < sx). We prove the theorem by induction on l(w). If
l(w) = 0, then w = 1 and the result is obvious. Assume now that l(w) ≥ 1 and
that the result holds when w is replaced by w′ with l(w′ ) < l(w).
   Case 1. Assume that w < sw. Using cs = Ts + vs−1 , we see that the coefficient
of Ty in the left hand side minus the right hand side of (a) is
                                                    X
                fy = vsσ py,w + psy,w − py,sw −              py,z µsz,w
                                                  z;y≤z<w;sz<z

where σ = 1 if sy < y and σ = −1 if sy > y. We must show that fy = 0. We first
show that
   (d) fy ∈ A<0 .
If sy < y this follows from 6.3(ii). (The contribution of psy,w − py,sw is in A<0 if
sy 6= w and is 1 − 1 = 0 if sy = w.)
   If sy > y then, by (c) (applied to z in the sum, instead of w), we have
                                                  X
             fy = vs−1 py,w + psy,w − py,sw −             vs−1 psy,z µsz,w
                                              z;y≤z<w;sz<z

               = vs−1 fsy + vs−1 psy,sw − py,sw
(the second equality holds by 2.5(a)) and this is in A<0 since fsy ∈ A<0 (by the
previous paragraph), vs−1 ∈ A<0 and since y 6= sw. PThus, (d) is proved.
   Since both sides of (a) are fixed by ¯, the sum y fy Ty is fixed by ¯. From (d)
and 5.2(e) we see that fy = 0 for all y, as required.
   Case 2. Assume that w > sw. Then case 1 is applicable to sw (by the induction
hypothesis). We see that
                                                X
                     cw = (Ts + vs−1 )csw −           µsz,sw cz .
                                             z;sz<z<sw

Now (Ts − vs )(Ts + vs−1 ) = 0 and (Ts − vs )cz = 0 for each z in the sum (by the
induction hypothesis). Hence (Ts − vs )cw = 0. The theorem is proved.
Corollary 6.7. Let w ∈ W .
  (a) If w < ws, then cw cs = cws + z;zs<z<w µsz −1 ,w−1 cz .
                                    P

  (b) If ws < w, then cw cs = (vs + vs−1 )cw .
  We write the equalities in 6.6(a),(b) for w−1 instead of w and we apply to these
equalities h 7→ h♭ which carries cw to cw−1 ; the corollary follows.
6.8. Now 6.3, 6.6, 6.7 remain valid when L(s) < 0 provided that we replace in
their statements and proofs vs by −vs−1 .
32                                         G. LUSZTIG

                                    7. Dihedral groups
7.1. We preserve the setup of 3.1; we assume that S consists of two elements s1 , s2 .
For i = 1, 2, let Li = L(si ), Ti = Tsi , ci = csi . We assume that L1 > 0, L2 > 0. Let
ζ = v L1 −L2 + v L2 −L1 ∈ A. Let m = ms1 ,s2 . Let 1k , 2k be as in 1.4. For w ∈ W
we set P
   Γw = y;y≤w v −L(w)+L(y) Ty .
Lemma 7.2. We have
  c1 Γ2k = Γ1k+1 + v L1 −L2 Γ1k−1 if k ∈ [2, m),
  c2 Γ1k = Γ2k+1 + v −L1 +L2 Γ2k−1 if k ∈ [2, m),
  c1 Γ2k = Γ1k+1 if k = 0, 1,
  c2 Γ1k = Γ2k+1 if k = 0, 1.
     Since ci = Ti + v −Li , the proof is an easy exercise.
Proposition 7.3. Assume that L1 = L2 . For any w ∈ W we have cw = Γw .
     This is clear when l(w) ≤ 1. In the present case Lemma 7.2 gives

(c)                  Γ1k+1 = c1 Γ2k − Γ1k−1 ,      Γ2k+1 = c2 Γ1k − Γ2k−1

for k ∈ [2, m). This and 7.2 shows by induction on k that Γ̄w = Γw for all w ∈ W .
Clearly, Γw = Tw mod H<0 . The lemma follows.
7.4. In 7.4-7.6 we assume that L2 > L1 . In this case, if m < ∞, then m is even.
(See 3.1.) For 2k + 1 ∈ [1, m) we set
                       X
         Γ′22k+1 =             (1 − v 2L1 + v 4L1 − · · · + (−1)s v 2sL1 )v −sL1 −sL2
                     s∈[0,k−1]

          × (T22k−2s+1 + v −L2 T22k−2s + v −L2 T12k−2s + v −2L2 T12k−2s−1 )
          + (1 − v 2L1 + v 4L1 − · · · + (−1)k v 2kL1 )v −kL1 −kL2 (T21 + v −L2 T20 ).

For 2k + 1 ∈ [3, m) we set

                Γ′12k+1 = T12k+1 + v −L1 T12k + v −L1 T22k + v −2L1 T22k−1
                      X
                +          v −L(w)+L(y) (1 + v 2L1 )Ty
                        y
                     y≤12k−1


where w = 12k+1 . For w such that l(w) is even and for w = 11 we set Γ′w = Γw .
Lemma 7.5. We have
  (a) c1 Γ′2k′ = Γ′1k′ +1 , if k ′ ∈ [0, m);
  (b) c2 Γ′1k′ = Γ′2k′ +1 + ζΓ′2k′ −1 + Γ′2k′ −3 , if k ′ ∈ [4, m);
  (c) c2 Γ′1k′ = Γ′2k′ +1 + ζΓ′2k′ −1 , if k ′ = 2, 3, k ′ < m;
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                   33

  (d) c2 Γ′1k′ = Γ′2k′ +1 if k ′ = 0, 1.
   From the definitions  we have
   (e) Γ′22k+1 = s∈[0,k] (−1)s v s(L1 −L2 ) Γ22k−2s+1 if 2k + 1 ∈ [1, m),
                 P

   (f) Γ′12k+1 = Γ12k+1 + v L1 −L2 Γ12k−1 if 2k + 1 ∈ [3, m).
We prove (a) for k ′ = 2k + 1. The left hand side can be computed using (e) and
7.2:

           c1 Γ′22k+1 = c1 (Γ22k+1 − v L1 −L2 Γ22k−1 + v 2L1 −2L2 Γ22k−3 + . . . )
           = Γ12k+2 + v L1 −L2 Γ12k − v L1 −L2 Γ12k − v 2L1 −2L2 Γ12k−2
           + v 2L1 −2L2 Γ12k−2 − v 3L1 −3L2 Γ12k−4 + · · · = Γ12k+2 = Γ′12k+2 .

This proves (a) for k ′ = 2k + 1. Now (a) for k ′ = 0 is trivial. We prove (a) for
k ′ = 2k ≥ 2. The left hand side can be computed using 7.2 and (f):

                 c1 Γ′22k = c1 Γ22k = Γ12k+1 + v L1 −L2 Γ12k−1 = Γ′12k+1 .

This proves (a) for k ′ = 2k. We prove (b) for k ′ = 2k. The left hand side can be
computed using 7.2:

                      c2 Γ′12k = c2 Γ12k = Γ22k+1 + v −L1 +L2 Γ22k−1 .

The right hand side of (b) is (using (e)):

  Γ22k+1 − v L1 −L2 Γ22k−1 + v 2L1 −2L2 Γ22k−3 + . . .
   + ζΓ22k−1 − v L1 −L2 ζΓ22k−3 + v 2L1 −2L2 ζΓ22k−5 + . . .
   + Γ22k−3 − v L1 −L2 Γ22k−5 + v 2L1 −2L2 Γ22k−7 + · · · = Γ22k+1 + v −L1 +L2 Γ22k−1 .

This proves (b) for k ′ = 2k. We prove (b) for k ′ = 2k + 1. The left hand side can
be computed using (f) and 7.2:

   c2 Γ′12k+1 = c2 (Γ12k+1 + v L1 −L2 Γ12k−1 )
    = Γ22k+2 + v −L1 +L2 Γ22k + v L1 −L2 Γ22k + Γ22k−2 = Γ′22k+2 + ζΓ′22k + Γ′22k−2 .

This proves (b) for k ′ = 2k + 1. The proof of (c),(d) is similar to that of (b). This
completes the proof.
Proposition 7.6. For any w ∈ W we have cw = Γ′w .
   Clearly, Γ′w = Tw mod H<0 . From the formulas in 7.5 we see by induction on
l(w) that Γ̄′w = Γ′w for all w. The proposition is proved. (This was proved for
m = 4 in [L7], for m = 6 in [X], for general m independently in [L15] and [GP,
p.396].)
34                                           G. LUSZTIG

Proposition 7.7. Assume that m = ∞. For a ∈ {1, P        2}, let fa = v L(a) + v −L(a) .
  (a) If L1 = L2 and k, k ′ ≥ 0 then ca2k+1 ca2k′ +1 = fa u∈[0,min(2k,2k′ )] ca2k+2k′ +1−2u .
  (b) If L2 > L1 and k, k ′ ≥ 0 then c22k+1 c22k′ +1 = f2 u∈[0,min(k,k′ )] c22k+2k′ +1−4u .
                                                         P

  (c) If L2 > L1 and k, k ′ ≥ 1 then
                                                      X
                   c12k+1 c12k′ +1 = f1                           pu c12k+2k′ +1−2u
                                           u∈[0,min(k−1,k′ −1)]


where pu = ζ for u odd, pu ∈ Z for u even.
  We prove (a). For k = k ′ = 0 the equality in (a) is clear. Assume now that
k = 0, k ′ ≥ 1. Using 7.2, 7.3, we have

                 c2 c22k′ +1 = c2 (c2 c12k′ − c22k′ −1 ) = f2 c2 c12k′ − f2 c22k′ −1
                  = f2 c22k′ +1 + f2 c22k′ −1 − f2 c22k′ −1 = f2 c22k′ +1 ,

as required. We now prove the equality in (a) for fixed k ′ , by induction on k. The
case k = 0 is already known. Assume now that k = 1. From 7.2, 7.3 we have
c23 = c2 c1 c2 − c2 . Using this and 7.2, 7.3, we have

     c23 c22k′ +1 = c2 c1 c2 c22k′ +1 − c2 c22k′ +1 = f2 c2 c12k′ +2 + f2 c2 c12k′ − f2 c22k′ +1
     = f2 c22k′ +3 + f2 c22k′ +1 + f2 c22k′ +1 + (1 − δk′ ,0 )f2 c22k′ −1 − f2 c22k′ +1
     = f2 c22k′ +3 + f2 c22k′ +1 + f2 (1 − δk′ ,0 )c22k′ −1 ,

as required. Assume now that k ≥ 2. From 7.2,7.3 we have

                           c22k+1 = c2 c1 c22k−1 − 2c22k−1 − c22k−3 .

Using this and the induction hypothesis we have

     c22k+1 c22k′ +1 = c2 c1 c22k−1 c22k′ +1 − 2c22k−1 c22k′ +1 − c22k−3 c22k′ +1
                        X                                        X
      = f2 c1 c2                     c22k+2k′ −1−2u − f2                     c22k+2k′ −1−2u
                  u∈[0,min(2k−2,k′ )]                       u∈[0,min(2k−2,k′ )]
                    X
      − f2                         c22k+2k′ −3−2u .
             u∈[0,min(2k−4,k′ )]


We now use 7.2,7.3 and (a) follows (for a = 2). The case a = 1 is similar.
  We prove (b). For k = k ′ = 0 the equality in (b) is clear. Assume now that
k = 0, k ′ = 1. Using 7.5, 7.6, we have

  c2 c23 = c2 (c2 c12 − ζc21 ) = f2 c2 c12 − f2 ζc21 = f2 c23 + f2 ζc21 − f2 ζc21 = f2 c23 ,
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                           35

as required. Assume next that k = 0, k ′ ≥ 2. Using 7.5, 7.6, we have

  c2 c22k′ +1 = c2 (c2 c12k′ − ζc22k′ −1 − c22k′ −3 ) = f2 c2 c12k′ − f2 ζc22k′ −1 − f2 c22k′ −3
   = f2 c22k′ +1 + f2 ζc22k′ −1 + f2 c22k′ −3 − f2 ζc22k′ −1 − f2 ζc22k′ −3 = f2 c22k′ +1 ,

as required. We now prove the equality in (a) for fixed k ′ , by induction on k. The
case k = 0 is already known. Assume now that k = 1. From 7.5, 7.6 we have
c23 = c2 c1 c2 − ζc2 . Using this and 7.5, 7.6, we have

          c23 c22k′ +1 = c2 c1 c2 c22k′ +1 − ζc2 c22k′ +1 = f2 c2 c12k′ +2 − f2 ζc22k′ +1
           = f2 c22k′ +3 + f2 ζc22k′ +1 + (1 − δk′ ,0 )f2 c22k′ −1 − f2 ζc22k′ +1
           = f2 c22k′ +3 + (1 − δk′ ,0 )f2 c22k′ −1

as required. Assume now that k ≥ 2. From 7.5, 7.6 we have

                          c22k+1 = c2 c1 c22k−1 − ζc22k−1 − c22k−3 .

Using this and the induction hypothesis we have

      c22k+1 c22k′ +1 = c2 c1 c22k−1 c22k′ +1 − ζc22k−1 c22k′ +1 − c22k−3 c22k′ +1
                        X                                         X
       = f2 c2 c1                   c22k+2k′ −1−4u − f2 ζ                    c22k+2k′ −1−4u
                  u∈[0,min(k−1,k′ )]                       u∈[0,min(k−1,k′ )]
                   X
      − f2                        c22k+2k′ −3−4u .
             u∈[0,min(k−2,k′ )]


We now use 7.5, 7.6 and (b) follows.
  The proof of (c) is similar to that of (b). This completes the proof.
Proposition 7.8. Assume that 4 ≤ m < ∞ and L2 > L1 , so that m = 2k + 2
with k ≥ 1. Let
   p0 = (−1)k (v L2 + v −L2 )(v k(L2 −L1 ) + v (k−2)(L2 −L1 ) + · · · + v −k(L2 −L1 ) ).
Then

(a)                               c2m−1 c2m−1 = pc2m−1 + qc2m ,

for some p, q ∈ A. Moreover, p = p0 .
   From 7.5, 7.6, we see that Ac2m−1 + Ac2m is a two-sided ideal of H. Hence
(a) holds for some (unknown) p, q ∈ A. It remains to compute p. Define an
algebra homomorphism χ : H −    → A by χ(T1 ) = −v −L1 , χ(T2 ) = v L2 . Since
c2m = (T1 + v −L1 )h for some h ∈ H (see 7.5,7.6) we see that χ(c2m ) = 0. Hence
36                                      G. LUSZTIG

applying χ to (a) gives χ(c2m−1 )2 = pχ(c2m−1 ). It is thus enough to show that
χ(c2m−1 ) = p0 . We verify this for m = 4:

           χ(T2 T1 T2 + v −L2 T2 T1 + v −L2 T1 T2 + v −2L2 T1
           + (v −L1 −L2 − v L1 −L2 )T2 + (v −L1 −2L2 − v L1 −2L2 ))
            = −v −L1 +2L2 − 2v −L1 − v −L1 −2L2 + (v −L1 −L2 − v L1 −L2 )v L2
           + v −L1 −2L2 − v L1 −2L2 = −v −L1 +2L2 − v −L1 − v L1 − v L1 −2L2
and for m = 6:
χ(T2 T1 T2 T1 T2 + v −L2 T2 T1 T2 T1 + v −L2 T1 T2 T1 T2 + v −2L2 T1 T2 T1
+ (v −L1 −L2 − v L1 −L2 )T2 T1 T2 + (v −L1 −2L2 − v L1 −2L2 )T1 T2
+ (v −L1 −2L2 − v L1 −2L2 )T2 T1 + (v −L1 −3L2 − v L1 −3L2 )T1
+ (v −2L1 −2L2 − v −2L2 + v 2L1 −2L2 )T2 + (v −2L1 −3L2 − v −3L2 + v 2L1 −3L2 ))
= v −2L1 +3L2 + 2v −2L1 +L2 + v −2L1 −L2 − v −2L1 +L2 − 2v −2L1 −L2 − v −2L1 −3L2 + v L2
+ 2v −L2 + v −3L2 + v −2L1 −L2 − v −L2 + v 2L1 −L2 + v −2L1 −3L2 − v −3L2 + v 2L1 −3L2
= v −2L1 +3L2 + v −2L1 +L2 + v L2 + v −L2 + v 2L1 −L2 + v 2L1 −3L2 .
Analogous computations can be carried out for any even m. The proposition is
proved.

                                         8. Cells
8.1. We preserve the setup of 3.1. For z ∈ W define Dz ∈ HomA (H, A) by
Dz (cw ) = δz,w for all w ∈ W . For w, w′ ∈ W we write
    w ←L w′ (or w′ →L w) if Dw (cs cw′ ) 6= 0 for some s ∈ S;
    w ←R w′ (or w′ →R w) if Dw (cw′ cs ) 6= 0 for some s ∈ S.
If w, w′ ∈ W , we say that w ≤L w′ (resp. w ≤R w′ ) if there exist w =
w0 , w1 , . . . , wn = w′ in W such that for any i ∈ [0, n − 1] we have wi ←L wi+1
(resp. wi ←R wi+1 ).
    If w, w′ ∈ W , we say that w ≤LR w′ if there exist w = w0 , w1 , . . . , wn = w′ in
W such that for any i ∈ [0, n − 1] we have either wi ←L wi+1 or wi ←R wi+1 .
    Clearly ≤L , ≤R , ≤LR are preorders on W . Let ∼L , ∼R , ∼LR be the associated
equivalence relations. (For example, we have w ∼L w′ if and only if w ≤L w′ and
w′ ≤L w.) The equivalence classes on W for ∼L , ∼R , ∼LR are called respectively
left cells, right cells, two-sided cells of W . They depend on the weight function L.
    If w, w′ ∈ W , we say that w <L w′ (resp. w <R w′ ; w <LR w′ ) if w ≤L w′ and
w 6∼L w′ (resp. w ≤R w′ and w 6∼R w′ ; w ≤LR w′ and w 6∼LR w′ ).
    For w, w′ ∈ W we have w ≤L w′ ⇔ w−1 ≤R w′−1 and w ≤LR w′ ⇔ w−1 ≤LR
w′−1 .
Hence w 7→ w−1 carries left cells to right cells, right cells to left cells and two-sided
cells to two-sided cells.
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                            37

Lemma 8.2. Let w′ ∈ W .
  (a) H≤L w′ = ⊕w;w≤L w′ Acw is a left ideal of H.
  (b) H≤R w′ = ⊕w;w≤R w′ Acw is a right ideal of H.
  (c) H≤LR w′ = ⊕w;w≤LR w′ Acw is a two-sided ideal of H.
  This follows from the definitions since cs (s ∈ S) generate H as an A-algebra.
8.3. Let Y be a left cell of W . From 8.3(a) we see that for y ∈ Y ,
                           ⊕w;w≤L y Acw / ⊕w;w<L y Acw
is a quotient of two left ideals of H (independent of the choice of y) hence it is
naturally a left H-module; it has an A-basis consisting of the images of cw (w ∈ Y ).
   Similarly, if Y ′ is a right cell of W then, for y ′ ∈ Y ′ ,
                          ⊕w;w≤R y′ Acw / ⊕w;w<R y′ Acw
is a quotient of two right ideals of H (independent of the choice of y ′ ) hence
it is naturally a right H-module; it has an A-basis consisting of the images of
cw (w ∈ Y ′ ).
   If Y ′′ is a two-sided cell of W then, for y ′′ ∈ Y ′′ ,
                         ⊕w;w≤LR y′′ Acw / ⊕w;w<LR y′′ Acw
is a quotient of two two-sided ideals of H (independent of the choice of y ′′ ) hence
it is naturally a H-bimodule; it has an A-basis consisting of the images of cw (w ∈
Y ′′ ).
Lemma 8.4. Let s ∈ S. Assume that L(s) > 0. Let Hs = ⊕w;sw<w Acw , s H =
⊕w;ws<w Acw .
  (a) {h ∈ H; (cs − vs − vs−1 )h = 0} = Hs . Hence Hs is a right ideal of H.
  (b) {h ∈ H; h(cs − vs − vs−1 ) = 0} = s H. Hence s H is a left ideal of H.
    We prove the equality in (a). If h ∈ Hs then (cs − vs − vs−1 )h = 0 by 6.6(b).
Conversely, by 6.6, we have cs h ∈ Hs for any h ∈ H. Hence, if h ∈ H is such that
cs h = (vs + vs−1 )h, then (vs + vs−1 )h ∈ Hs so that h ∈ Hs (since H/Hs is a free
A-module). This proves (a). The proof of (b) is entirely similar. The lemma is
proved.
8.5. For w ∈ W we set L(w) = {s ∈ S; sw < w}, R(w) = {s ∈ S; ws < w}.
Lemma 8.6. Let w, w′ ∈ W . Assume that L(s) > 0 for all s ∈ S.
  (a) If w ≤L w′ , then R(w′ ) ⊂ R(w). If w ∼L w′ , then R(w′ ) = R(w).
  (b) If w ≤R w′ , then L(w′ ) ⊂ L(w). If w ∼R w′ , then L(w′ ) = L(w).
   To prove the first assertion of (a), we may assume that Dw (cs cw′ ) 6= 0 for some
s ∈ S. In this case, let t ∈ R(w′ ). We must prove that t ∈ R(w). We have
cw′ ∈ t H. By 8.4, t H is a left ideal of H. Hence cs cw′ ∈ t H. By the definition of
t
  H, for h ∈ t H we have Dw (h) = 0 unless wt < w. Hence from Dw (cs cw′ ) 6= 0
we deduce wt < w, as required. This proves the first assertion of (a). The second
assertion of (a) follows immediately from the first. The proof of (b) is entirely
similar to that of (a). The lemma is proved.
38                                              G. LUSZTIG

8.7. In the remainder of this chapter we write ←, → instead of ←L , →L . We
describe the left cells of W in the setup of 7.3. From 7.2 and 7.3 we can determine
all pairs y 6= w such that y ← w
   10 → 21 ⇆ 12 ⇆ 23 ⇆ . . . ,
   20 → 11 ⇆ 22 ⇆ 13 ⇆ . . . ,
if m = ∞,
   10 → 21 ⇆ 12 ⇆ 23 ⇆ . . . ⇆ 2m−1 → 1m ,
   20 → 11 ⇆ 22 ⇆ 13 ⇆ . . . ⇆ 1m−1 → 2m ,
if m < ∞, m even,
   10 → 21 ⇆ 12 ⇆ 23 ⇆ . . . ⇆ 1m−1 → 2m ,
   20 → 11 ⇆ 22 ⇆ 13 ⇆ . . . ⇆ 2m−1 → 1m ,
if m < ∞, m odd. Hence the left cells are
   {10 }, {21 , 12 , 23 , . . . }, {11 , 22 , 13 , . . . },
if m = ∞,
   {10 }, {21 , 12 , 23 , . . . , 2m−1 }, {11 , 22 , 13 , . . . , 1m−1 }, {2m },
if m < ∞, m even,
   {10 }, {21 , 12 , 23 , . . . , 1m−1 }, {11 , 22 , 13 , . . . , 2m−1 }, {2m },
if m < ∞, m odd.
   The two-sided cells are {10 }, W − {10 } if m = ∞ and {10 }, {2m }, W − {10 , 2m }
if m < ∞.
8.8. We describe the left cells of W in the setup of 7.4. From 7.5 and 7.6 we can
determine all pairs y 6= w such that y ← w. If m = ∞, these pairs are:
         10 → 21 ⇆ 12 → 23 ⇆ 14 → . . . ,                  20 → 11 → 22 ⇆ 13 → 24 ⇆ . . . ,
and 21 ← 14 , 22 ← 15 , 23 ← 16 , . . . .
  If m = 4, these pairs are:
                  10 → 21 ⇆ 12 → 23 → 14 ,                 20 → 11 → 22 ⇆ 13 → 24 .
If m = 6, these pairs are:
     10 → 21 ⇆ 12 → 23 ⇆ 14 → 25 → 16 ,                    20 → 11 → 22 ⇆ 13 → 24 ⇆ 15 → 26 ,
and 21 ← 14 , 22 ← 15 . An analogous pattern holds for any even m.
  Hence the left cells are
                     {10 }, {21 , 12 , 23 , 14 , . . . }, {11 }, {22 , 13 , 24 , 15 , . . . },
if m = ∞,
        {10 }, {21 , 12 , 23 , . . . , 1m−2 }, {2m−1 }, {11 }, {22 , 13 , 24 , . . . , 1m−1 }, {2m },
if m < ∞.
   The two-sided cells are
   {10 }, {11 }, W − {10 , 11 }, if m = ∞ and
   {10 }, {11 }, {2m−1 }, {2m }, W − {10 , 11 , 2m−1 , 2m }, if m < ∞.
8.9. For further examples of cells (in the case where L is non-costant) see [L3],
[B], [G].
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                        39

                         9. Cosets of parabolic subgroups
   We preserve the setup of 3.1.
Lemma 9.1. Let w ∈ W . Assume that w = s1 s2 . . . sq with si ∈ S. We can
find a subsequence i1 < i2 < · · · < ir of 1, 2, . . . , q such that w = si1 si2 . . . sir is a
reduced expression in W .
    We argue by induction on q. If q = 0 the result is obvious. Assume that q > 0.
Using the induction hypothesis we can assume that s2 . . . sq is a reduced expression.
If s1 s2 . . . sq is a reduced expression, we are done. Hence we may assume that
s1 s2 . . . sq is not a reduced expression. Then l(w) ≤ q − 1. By 1.7, we can find
j ∈ [2, q] such that s1 s2 . . . sj−1 = s2 s3 . . . sj . Then w = s2 s3 . . . sj−1 sj+1 . . . sq is
a reduced expression. The lemma is proved.
9.2. Let w ∈ W . Let w = s1 s2 . . . sq be a reduced expression of w. Using 1.9, we
see that the set {s ∈ S; s = si for some i ∈ [1, q]} is independent of the choice of
reduced expression. We denote it by Sw .
9.3. In the remainder of this chapter we fix I ⊂ S. Recall that WI = hIi.
   If w ∈ WI then we can find a reduced expression w = s1 s2 . . . sq in W with all
si ∈ I (we first write w = s1 s2 . . . sq , a not necessarily reduced expression with
all si ∈ I, and then we apply 9.1). Thus, Sw ⊂ I. Conversely, it is clear that if
w′ ∈ W satisfies Sw′ ⊂ I then w′ ∈ WI . It follows that
   WI = {w ∈ W ; Sw ⊂ I}.
9.4. Replacing S, (ms,s′ )(s,s′ )∈S×S by I, (ms,s′ )(s,s′ )∈I×I in the definition of W
we obtain a Coxeter group denoted by WI∗ . We have an obvious homomorphism
f : WI∗ −
        → WI which takes s to s for s ∈ I.
Proposition 9.5. f : WI∗ −
                         → WI is an isomorphism.
     We define f ′ : WI −      → WI∗ as follows: for w ∈ WI we choose a reduced expression
w = s1 s2 . . . sq in W ; then si ∈ I for all i (see 9.3) and we set f ′ (w) = s1 s2 . . . sq
(product in WI∗ ). This map is well defined. Indeed, if s′1 s′2 . . . s′q is another re-
duced expression for w with all s′i ∈ I, then we can pass from (s1 , s2 , . . . , sq ) to
(s′1 , s′2 , . . . , s′q ) by moving along edges of the graph X (see 1.9); but each edge
involved in this move will necessarily involve only pairs (s, s′ ) in I, hence the
equation s1 s2 . . . sq = s′1 s′2 . . . s′q must hold in WI∗ . It is clear that f f ′ (w) = w for
all w ∈ WI . Hence f ′ is injective.
     We show that f ′ is a group homomorphism. It suffices to show that f ′ (sw) =
f ′ (s)f ′ (w) for any w ∈ WI , s ∈ I. This is clear if l(sw) = l(w) + 1 (in W ). Assume
now that l(sw) = l(w) − 1 (in W ). Let w = s1 s2 . . . sq be a reduced expression in
W . Then si ∈ I for all i. By 1.7 we have (in W ) sw = s1 s2 . . . si−1 si+1 . . . sq for
some i ∈ [1, q]. Since ss1 s2 . . . si−1 si+1 . . . sq is a reduced expression for w in W ,
we have f ′ (w) = ss1 s2 . . . si−1 si+1 . . . sq (product in WI∗ ). We also have f ′ (w) =
s1 s2 . . . sq (product in WI∗ ). Hence ss1 s2 . . . si−1 si+1 . . . sq = s1 s2 . . . sq (in WI∗ ).
40                                         G. LUSZTIG

Hence s1 s2 . . . si−1 si+1 . . . sq = ss1 s2 . . . sq (in WI∗ ). Hence f ′ (sw) = f ′ (s)f ′ (w),
as required.
    Since the image of f ′ contains the generators s ∈ I of WI∗ and f ′ is a group
homomorphism, it follows that f ′ is surjective. Hence f ′ is bijective. Since f f ′ = 1
it follows that f is bijective. The proposition is proved.
9.6. We identify WI∗ and WI via f . Thus, WI is naturally a Coxeter group. Let
lI : WI − → N be the length function of this Coxeter group. Let w ∈ WI . Let
w = s1 s2 . . . sq be a reduced expression of w (in W ). Then si ∈ I for all i (see
9.3). Hence lI (w) ≤ l(w). The reverse inequality l(w) ≤ lI (w) is obvious. Hence
lI (w) = l(w).
    From 2.4 we see that the partial order on WI defined in the same way as ≤ on
W is just the restriction of ≤ from W to WI .
Lemma 9.7. Let WI a be a coset in W .
  (a) This coset has a unique element w of minimal length.
  (b) If y ∈ WI then l(yw) = l(y) + l(w).
  (c) w is characterized by the property that l(sw) > l(w) for all s ∈ I.
   Let w be an element of minimal length in the coset. Let w = s1 s2 . . . sq be a
reduced expression. Let y ∈ WI and let y = s′1 s′2 . . . s′p be a reduced expression
in WI . Then yw = s′1 s′2 . . . s′p s1 s2 . . . sq . By 9.1 we can drop some of the factors
in the last product so that we are left with a reduced expression for yw. The
factors dropped cannot contain any among the last q since otherwise we would
find an element in WI a of strictly smaller length than w. Thus, we can find a
subsequence i1 < i2 < · · · < ir of 1, 2, . . . , p such that yw = s′i1 s′i2 . . . s′ir s1 s2 . . . sq
is a reduced expression. It follows that y = s′1 s′2 . . . s′p = s′i1 s′i2 . . . s′ir . Since
p = l(y), we must have r = p so that s′1 s′2 . . . s′p s1 s2 . . . sq is a reduced expression
and l(yw) = p + q = l(y) + l(w).
   If now w′ is another element of minimal length in WI a then w′ = yw for some
y ∈ WI . We have l(w) = l(w′ ) = l(y) + l(w) hence l(y) = 0 hence y = 1 and
w′ = w. This proves (a). Now (b) is already proved. Note that by (b), w has the
property in (c). Conversely, let w′ ∈ WI a be an element such that l(sw′ ) > l(w′ )
for all s ∈ I. We have w′ = yw for some y ∈ WI . If y 6= 1 then for some s ∈ I we
have l(y) = l(sy) + 1. By (b) we have l(w′ ) = l(y) + l(w), l(sw′ ) = l(sy) + l(w).
Thus l(w′ ) − l(sw′ ) = l(y) − l(sy) = 1, a contradiction. Thus y = 1 and w′ = w.
The lemma is proved.
   We shall denote by I W (resp. W I ) the set of all w ∈ W such that w has
minimal length in WI w (resp. in wWI ). If I ⊂ J ⊂ S we write I WJ , WJI instead
of I (WJ ), (WJ )I .
Lemma 9.8. Let WI a be a coset in W .
   (a) If WI is finite, this coset has a unique element w of maximal length. If WI
is infinite, this coset has no element of maximal length.
   (b) Assume that WI is finite. If y ∈ WI then l(yw) = l(w) − l(y).
                    HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                               41

   (c) Assume that WI is finite. Then w is characterized by the property that
l(sw) < l(w) for all s ∈ I.
   Assume that w has maximal length in WI a. We show that for any y ∈ WI we
have
   (d) l(yw) = l(w) − l(y).
We argue by induction on l(y). If l(y) = 0, the result is clear. Assume now that
l(y) = p + 1 ≥ 1. Let y = s1 . . . sp sp+1 be a reduced expression. By the induction
hypothesis, l(w) = l(s1 s2 . . . sp w) + p. Hence we can find a reduced expression of
w of the form sp . . . s2 s1 s′1 s′2 . . . s′q . Since sp+1 ∈ I, by our assumption on w we
have l(sp+1 w) = l(w) − 1. Using 1.7, we deduce that either
   (1) sp+1 sp . . . sj+1 = sp . . . sj+1 sj for some j ∈ [1, p] or
   (2) sp+1 sp . . . s2 s1 s′1 s′2 . . . s′i−1 = sp . . . s2 s1 s′1 s′2 . . . s′i−1 s′i for some i ∈ [1, q].
In case (1) it follows that y = s1 . . . sp sp+1 = s1 s2 . . . sj−1 sj+1 . . . sp , contradicting
l(y) = p + 1. Thus, we must be in case (2). We have

   yw = s′1 s′2 . . . s′i−1 s′i+1 . . . s′q and l(yw) ≤ q − 1 = l(w) − p − 1 = l(w) − l(y).

Thus, l(w) ≥ l(yw) + l(y). The reverse inequality is obvious. Hence l(w) =
l(yw) + l(y). This completes the induction.
   From (d) we see that l(y) ≤ l(w). Thus l : WI −
                                                 → N is bounded above. Hence
there exists y ∈ WI of maximal length in WI . Applying (d) to y, WI instead of
w, WI a we see that

                         l(y) = l(y ′−1 ) + l(y ′−1 y) = l(y ′ ) + l(y ′−1 y)

for any y ′ ∈ WI . Hence a reduced expression of y ′ followed by a reduced expression
of y ′−1 y gives a reduced expression of y. In particular y ′ ≤ y. Since the set
{y ′ ∈ W ; y ′ ≤ y} is finite, we see that WI is finite. Conversely, if WI is finite then
WI a clearly has some element of maximal length.
    If w′ is another element of maximal length in WI a then w′ = yw for some
y ∈ WI . We have l(w) = l(w′ ) = l(w) − l(y) hence l(y) = 0 hence y = 1 and
w′ = w. This proves (a) and (b). The proof of (c) is entirely similar to that of
9.7(c). The lemma is proved.
9.9. Replacing W, L by WI , L|WI in the definition of H we obtain an A-algebra HI
(naturally a subalgebra of H); instead of rx,y , px,y , cy , µsx,y we obtain for x, y ∈ WI
           I
elements rx,y ∈ A, pIx,y ∈ A≤0 , cIy ∈ HI , µs,I
                                             x,y ∈ A.

Lemma 9.10. Let z ∈ W be such that z is the element of minimal length of WI z.
Let x, y ∈ WI . We have
   (a) {u′ ∈ W ; xz ≤ u′ ≤ yz} = {u ∈ WI ; x ≤ u ≤ y}z;
                  I
   (b) rxz,yz = rx,y ;
                  I
   (c) pxz,yz = px,y ;
   (d) cIy = cy .
42                                          G. LUSZTIG

  (e) If in addition, s ∈ I, L(s) > 0 and sx < x < y < sy, then sxz < xz < yz <
syz and µs,I      s
          x,y = µxz,yz .

    We first prove the following statement.
    Assume that z1 , z2 have minimal length in WI z1 , WI z2 respectively, that u1 , u2 ∈
WI and that u1 z1 ≤ u2 z2 . Then
    (f ) z1 ≤ z2 ; if in addition, z1 = z2 then u1 ≤ u2 .
Indeed, using 2.4 we see that there exist u′1 , z1′ such that
    u1 z1 = u′1 z1′ , u′1 ≤ u2 , z1′ ≤ z2 .
Then u′1 ∈ WI and z1′ ∈ WI z1 hence z1′ = wz1 where w ∈ WI , l(z1′ ) = l(w) + l(z1 ).
Hence z1 ≤ z1′ . Since z1′ ≤ z2 , we see that z1 ≤ z2 . If we know that z1 = z2 , then
z1′ = z1 hence u1 = u′1 . Since u′1 ≤ u2 , it follows that u1 ≤ u2 and (f) is proved.
    We prove (a). If u ∈ WI and x ≤ u ≤ y, then xz ≤ uz ≤ yz by 2.4 and 9.7(b).
Conversely, assume that u′ ∈ W satisfies xz ≤ u′ ≤ yz. Then u′ = uz1 where
z1 has minimal length in WI u′ and u ∈ WI . Applying (f) to xz ≤ uz1 and to
uz1 ≤ yz we deduce z ≤ z1 ≤ z. Hence z = z1 . Applying the second part of (f) to
xz ≤ uz and to uz ≤ yz we deduce x ≤ u ≤ y. This proves (a).
                                                                             I
    We prove (b) by induction on l(y). Assume first that y = 1. Then rx,y        = δx,1 .
Now rxz,z = 0 unless xz ≤ z (see 4.7(a)) in which case x = 1 and rz,z = 1. Thus,
(b) holds for y = 1. Assume now that l(y) ≥ 1. We can find s ∈ I such that
l(sy) = l(y) − 1. We have

                  l(syz) = l(sy) + l(z) = l(y) − 1 + l(z) = l(yz) − 1.

If sx < x then we have (as above) sxz < xz. Using 4.4 and the induction hypoth-
esis, we have
                                             I        I
                        rxz,yz = rsxz,syz = rsx,sy = rx,y .

If sx > x then we have (as above) sxz > xz. Using 4.4 and the induction hypoth-
esis, we have

      rxz,yz = rsxz,syz + (vs − vs−1 )rxz,syz = rsx,sy
                                                 I
                                                       + (vs − vs−1 )rx,sy
                                                                      I       I
                                                                           = rx,y .

This completes the proof of (b).
   We prove (c). Using (a), we may assume that x ≤ y (otherwise, both sides are
zero). We argue by induction on l(y) − l(x) ≥ 0. If y = x, the result is clear (both
sides are 1). Assume now that l(y) − l(x) ≥ 1. Using 5.3, then (a),(b) and the
induction hypothesis, we have
                             X                                 X
             p̄xz,yz =                   rxz,u′ pu′ ,yz =                 rxz,uz puz,yz
                         u′ ;xz≤u′ ≤yz                      u∈WI ;x≤u≤y
                     X                                 X
                                 I                                I
              =                 rx,u puz,yz =                    rx,u pIu,y + pxz,yz .
                  u∈WI ;x≤u≤y                     u∈WI ;x<u≤y
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                               43

Using 5.3 for WI we have p̄Ix,y = y;x≤u≤y rx,u  I
                                                    pIu,y . Comparison with the previous
                                   P
equality gives
                            p̄xz,yz − p̄Ix,y = pxz,yz − pIx,y .
The right hand side of this equality is in A<0 . Since it is fixed by ¯, it must be 0.
This proves (c). Now (d) is an immediate consequence of (c) (with z = 1).
  We prove (e). By 6.3(ii),
                            X
                                          pxz,u′ µsu′ ,yz − vs pxz,yz ∈ A<0 .
                  u′ ;xz≤u′ <yz;su′ <u′


We rewrite this using (a):
                          X
                                      pxz,uz µsuz,yz − vs pxz,yz ∈ A<0 .
                  u∈WI ;x≤u<y;su<u


We may assume that for all u in the sum, other than u = x, we have µsuz,yz = µs,I
                                                                              u,y .
Using this and (d), we obtain
                                   X
                µsxz,yz +                        pIx,u µs,I       I
                                                        u,y − vs px,y ∈ A<0 .
                            u∈WI ;x<u<y;su<u


By 6.3(ii) for WI we have
                                 X
                 µs,I
                  x,y +                         pIx,u µs,I       I
                                                       u,y − vs px,y ∈ A<0 .
                          u∈WI ;x<u<y;su<u


It follows that µsxz,yz − µs,I                              s        s,I
                            x,y ∈ A<0 . On the other hand, µxz,yz − µx,y is fixed by¯
(see 6.3(i)) hence it is 0. This proves (e). The lemma is proved.
Proposition 9.11. Assume that L(s) > 0 for all s ∈ I.
  (a) Let z ∈ W be such that z is the element of minimal length of WI z. If x, y in
WI satisfy x ≤L y (relative to WI ), then xz ≤L yz (in W ). If x, y in WI satisfy
x ∼L y (relative to WI ), then xz ∼L yz (in W ).
  (b) Let z ∈ W be such that z is the element of minimal length of zWI . If x, y in
WI satisfy x ≤R y (relative to WI ), then zx ≤R zy (in W ). If x, y in WI satisfy
x ∼R y (relative to WI ), then zx ∼R zy (in W ).
   We prove the first assertion of (a). We may assume that x ←L y (relative to
WI ) and x 6= y. Thus, there exists s ∈ I such that sy > y, sx < x and we have
either x = sy or x < y and µsx,y 6= 0. If x = sy, then sxz < xz = syz > yz, hence
xz ←L yz (in W ). Thus, we may assume that x < y and µsx,y 6= 0. By 9.10(e) we
then have µsxz,yz 6= 0, hence xz ←L yz (in W ). The first assertion of (a) is proved.
The second assertion of (a) follows from the first. (b) follows by applying (a) to
z −1 , x−1 , y −1 instead of z, x, y.
44                                     G. LUSZTIG

9.12. Assume that z ∈ W is such that WI z = zWI and z is the element of minimal
length of WI z = zWI . Then y 7→ z −1 yz is an automorphism of WI . If s ∈ I then,
by 9.7, we have l(sz) = l(s) + l(z) = 1 + l(z); by 9.7 applied to WI z −1 instead of
WI z we have l((z −1 sz)z −1 ) = l(z −1 sz) +l(z −1 ) hence l(z −1 s) = l(z −1 sz) +l(z −1 );
since l(z −1 s) = l(sz) and l(z −1 ) = l(z), it follows that l(z −1 sz) +l(z −1 ) = 1 +l(z),
hence l(z −1 sz) = 1. We see that y 7→ z −1 yz maps I onto itself hence it is
an automorphism of WI as a Coxeter group. This automorphism preserves the
function L|WI . Indeed, if y ∈ WI , then

l(zyz −1 ) + l(z) = l((zyz −1 )z) = l(zy) = l(y −1 z −1 ) = l(y −1 ) + l(z −1 ) = l(y) + l(z)

(by 9.7 applied to WI z and to WI z −1 ) hence

     L(zyz −1 ) + L(z) = L((zyz −1 )z) = L(zy) = L(y −1 z −1 ) = L(y −1 ) + L(z −1 )
     = L(y) + L(z),

so that L(zyz −1 ) = L(y). In particular, this automorphism respects the preorders
≤L , ≤R , ≤LR of WI (defined in terms of L|WI ) and the associated equivalence
relations.
Proposition 9.13. Assume that L(s) > 0 for all s ∈ I. Let z be as in 9.12. If
x, y in WI satisfy x ≤LR y (relative to WI ), then xz ≤LR yz (in W ). If x, y in
WI satisfy x ∼LR y (relative to WI ), then xz ∼LR yz (in W ).
   We prove the first assertion. We may assume that either x ≤L y (in WI ) or
x ≤R y (in WI ). In the first case, by 9.11(a), we have xz ≤L yz (in W ) hence
xz ≤LR yz (in W ). In the second case, by 9.12, we have z −1 xz ≤R z −1 yz.
Applying 9.11(b) to z −1 xz, z −1 yz instead of x, y we see that xz ≤R yz (in W )
hence xz ≤LR yz (in W ). This proves the first assertion. The second assertion
follows from the first.
9.14. In the remainder of this chapter we fix two subsets K, K ′ of S and a
(WK , WK ′ )-double coset Ω in W . We have the following result.
Proposition 9.15. (a) Ω contains a unique element b of minimal length.
   (b) Setting J = K ∩ bK ′ b−1 , we have WK ∩ bWK ′ b−1 = WJ .
                   J
   (c) The map WK    × WK ′ −→ Ω, (a, c) 7→ abc is a bijection.
                      J
   (d) For any a ∈ WK , c ∈ WK ′ , we have l(abc) = l(a) + l(b) + l(c).
   (e) If WK and WK ′ are finite then Ω contains a unique element b̃ of maximal
                                    ′                    ′
length. We have b̃ = w0K w0J bw0K where w0K , w0J , w0K is the unique element of
maximal length of WK , WJ , WK ′ respectively.
   Note that (a) is stated in [Bo, Ch.IV,§1, Ex.3]; (b)-(d) are due to Kilmoyer [Ki]
under the assumption that W is a Weyl group. The proof of the proposition is
given in 9.16.
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                             45

9.16. Let b be an element of minimal length in Ω (it clearly exists). We fix a
reduced expression s1 s2 . . . sq for b. We show:
   (a) If w ∈ Ω, then w has a reduced expression of the form

                                   s′1 s′2 . . . s′p s1 s2 . . . sq s̃1 s̃1 . . . s̃r

where s′i ∈ K for i ∈ [1, p], s̃i ∈ K ′ for i ∈ [1, r].
We can find a not necessarily reduced expression w = s′1 s′2 . . . s′p s1 s2 . . . sq s̃1 s̃2 . . . s̃r
with s′i , s̃i as in the Lemma. Using 9.1, we can drop some of the simple reflec-
tions in this expression so that the resulting expression is a reduced expression
for w; none of the dropped reflections can be among s1 , s2 , . . . , sp (otherwise the
minimality of l(b) would be contradicted). The result follows.
   From (a) we see that b above is unique (hence 9.15(a) holds) and any w ∈ Ω is
of the form (b) w = abc with a ∈ WK , c ∈ WK ′ , l(w) = l(a) + l(b) + l(c).
We show:
   (c) Let y ∈ WK ∩ bWK ′ b−1 and let y = s′1 s′2 . . . s′p be a reduced expression in
WK . Then for any i ∈ [1, p] we have b−1 s′i b ∈ WK ′ .
We argue by induction on p. When p = 0 there is nothing to prove. We now
                                                                     ′
assume that p ≥ 1. Let ỹ = b−1 yb ∈ WK ′ . Since b ∈ W K and ỹ ∈ WK ′ , we see
from 9.7 that l(bỹ) = l(b) + l(ỹ). Similarly, since b ∈ K W and y ∈ WK , we have
l(yb) = l(y) + l(b). Since yb = bỹ it follows that l(y) + l(b) = l(b) + l(ỹ) hence
l(y) = l(ỹ). Let y = s′1 s′2 . . . s′p be a reduced expression in WK (it is also a reduced
expression in W ). Let ỹ = s̃1 s̃2 . . . s̃p be a reduced expression in WK ′ (it is also a
reduced expression in W ). Then s′1 s′2 . . . s′p s1 s2 . . . sq and s1 s2 . . . sq s̃1 s̃2 . . . s̃p are
reduced expressions in W for the same element yb = bỹ. Now

                      s′1 (s1 s2 . . . sq s̃1 s̃2 . . . s̃p ) < s1 s2 . . . sq s̃1 s̃2 . . . s̃p

hence by 1.7 we have either

                                  s′1 s1 s2 . . . si−1 = s1 s2 . . . si−1 si

for some i ∈ [1, q] or

                   s′1 s1 s2 . . . sq s̃1 s̃2 . . . s̃j−1 = s1 s2 . . . sq s̃1 s̃2 . . . s̃j−1 sj

for some j ∈ [1, p]. In the first case we have

                    s′2 . . . s′p s1 s2 . . . sq = s1 . . . si−1 si+1 . . . sq s̃1 s̃2 . . . s̃p

, so that Ω contains the element s1 . . . si−1 si+1 . . . sq of length < q, contradicting
the definition of b. Thus we must be in the second case so that

                   s′2 . . . s′p s1 s2 . . . sq = s1 s2 . . . sq s̃1 . . . s̃j−1 s̃j+1 . . . s̃p .
46                                       G. LUSZTIG

We then have s′2 . . . s′p b ∈ bWK ′ . We set y ′ = s′2 . . . s′p . We have y ′ ∈ WK ∩bWK ′ b−1
and l(y ′ ) = p − 1. By the induction hypothesis we have b−1 s′i b ∈ WK ′ for i ∈ [2, p].
We have
                     b−1 s′1 b = (b−1 yb)(b−1 s′p b) . . . (b−1 s′2 2b) ∈ WK ′ .
This proves (c).
   We show:
   (d) Let s′ ∈ K be such that b−1 s′ b ∈ WK ′ . Then b−1 s′ b ∈ K ′ .
We have s′ b = bz where z ∈ WK ′ . The proof of the equality l(y) = l(ỹ) in (c) can
be repeated with y, ỹ replaced by s′ , z; it yields l(z) = l(s′ ) = 1 hence z ∈ K ′ as
required.
   Now 9.15(b) follows immediately from (c),(d).
   We show:
                                         J
   (e) Let w ∈ Ω. We can find a ∈ WK       , c ∈ WK ′ so that (b) holds.
By (b) we can write w = ãbc̃ with ã ∈ WK , c̃ ∈ WK ′ , l(w) = l(ã) + l(b) + l(c̃).
Using 9.7 with W, WI replaced by WK , WJ , we see that we can write ã = az
                 J
where a ∈ WK       , z ∈ WJ and we have l(ã) = l(a) + l(z). We have w = azbc̃
         −1
where b zb ∈ WK ′ . Moreover, since b−1 Jb ⊂ K ′ we have l(z) = l(b−1 zb) and
l(w) = l(a) + l(z) + l(b) + l(c̃) = l(a) + l(b) + l(b−1 zb) + l(c̃). From l(w) =
l(a) + l(b) + l(b−1 zb) + l(c̃), w = ab(b−1 zb)c̃, we deduce that l(b−1 zb) + l(c̃) = l(c)
where c = (b−1 zb)c̃. We have c ∈ WK ′ and w = abc, l(w) = l(a) + l(b) + l(c). This
proves (e).
   We show:
   (f) Let a, a′ ∈ WK , c, c′ ∈ WK ′ be such that a ∈ WK       J
                                                                 , a′ ∈ WK   J
                                                                               and abc = a′ bc′ .
             ′           ′
Then a = a and c = c .
We have a−1 a′ = bcc′−1 b−1 ∈ WK ∩bWK ′ b−1 = WJ (see 9.15(b)). Thus a′ ∈ aWJ .
Since a′ , a belong to WK  J
                             , we have a = a′ (we use 9.7(a)). It follows that bc = bc′
hence c = c′ . This proves (f).
   From (e),(f) we see that 9.15(c) holds.
   We show:
                                                           J
   (g) Let a ∈ WK , c ∈ WK ′ be such that a ∈ WK             . Let w = abc. Then l(w) =
l(a) + l(b) + l(c).
By (e) we can write w = a′ bc′ where a′ ∈ WK       J
                                                     , c′ ∈ WK ′ and l(w) = l(a′ ) + l(b) +
l(c′ ). We have abc = a′ bc′ . By (f) we have a = a′ and c = c′ . This proves (g).
                                                                        J
   We prove 9.15(e). Let w ∈ Ω. Write w = abc with a ∈ WK                 , c ∈ WK ′ . We have
l(w0 ) ≥ l(aw0 ) = l(a) + l(w0 ) hence l(a) ≤ l(w0 ) − l(w0 ) = l(w0K w0J ) and l(c) ≤
     K          J                J                      K          J
       ′                                                                   ′                 ′
l(w0K ) hence l(w) = l(a) + l(b) + l(c) ≤ l(w0K w0J ) + l(b) + l(w0K ) = l(w0K w0J bw0K ).
                                    ′                                 ′
Moreover if l(w) = l(w0K w0J bw0K ) then w0K = aw0J , c = w0K . This proves 9.15(e).
Proposition 9.15 is proved.

                                       10. Inversion
10.1. We preserve the setup of 3.1. For y, w ∈ W we set
                         X
                   ′
                  qy,w =    (−1)n pz0 ,z1 pz1 ,z2 . . . pzn−1 ,zn ∈ A
                     HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                                47

(sum over all sequences y = z0 < z1 < z2 < · · · < zn = w in W ) and
                                                          ′
                                      qy,w = sgn(y)sgn(w)qy,w .

We have
  qw,w = 1,
  qy,w ∈ A<0 if y 6= w,
  qy,w = 0 unless y ≤ w.
                                                                            P
Proposition 10.2. For any y, w ∈ W we have q y,w =                           z;y≤z≤w qy,z rz,w .

   The (triangular) matrices Q′ = (qy,w
                                     ′
                                        ), P = (py,w ), R = (ry,w ) are related by
        ′        ′
   (a) Q P = P Q = 1, P = RP , RR = RR = 1
where¯over a matrix is the matrix obtained by applying¯to each entry. (Although
the matrices may be infinite, the products are well defined as each entry of a
product is obtained by finitely many operations.) The last three equations in (a)
are obtained from 5.3, 4.6; the equations involving Q′ follow from the definition.
                                   ′       ′                       ′
From (a) we deduce Q′ P = 1 = Q P = Q RP . Hence Q′ P = Q RP . Multiplying
                                                            ′
on the right by Q′ and using P Q′ = 1 we deduce Q′ = Q R. Multiplying on the
right by R gives
         ′
   (b) Q = Q′ R.
Let s be the matrix whose y, w entry is sgn(y)δy,w . We have s2 = 1. Let Q be the
triangular matrix (qy,w ). Note that Q = sQ′ s. By 4.5 we have R = sRs. Hence
by multiplying the two sides of (b) on the left and right by s we obtain Q = QR.
The proposition is proved.
10.3. Define an A-linear map τ : H −
                                   → A by τ (Tw ) = δw,1 for w ∈ W .
Lemma 10.4. (a) For x, y ∈ W we have τ (Tx Ty ) = δxy,1 .
  (b) For h, h′ ∈ H we have τ (hh′ ) = τ (h′ h).
  (c) Assume that L(s) ≥ 0 for all s ∈ S. Let x, y, z ∈ W and let M =
min(L(x), L(y), L(z)). We have τ (Tx Ty Tz ) ∈ v M Z[v −1 ].
   We prove (a) by induction on l(y). If l(y) = 0, the result is clear. Assume
now that l(y) ≥ 1. If l(xy) = l(x) + l(y) then Tx Ty = Txy and the result is clear.
Hence we may assume that l(xy) 6= l(x) + l(y). Then l(xy) < l(x) + l(y). Let
y = s1 s2 . . . sq be a reduced expression. We can find i ∈ [1, q] such that

(d)                  l(x) + i − 1 = l(xs1 s2 . . . si−1 ) > l(xs1 s2 . . . si−1 si ).

We show that

(e)                                 xs1 s2 . . . si−1 si+1 . . . sq 6= 1.

If (e) does not hold, then x = sq . . . si+1 si−1 . . . s1 , so that

      l(xs1 s2 . . . si−1 ) = l(sq . . . si+1 si−1 . . . s1 s1 . . . si−1 ) = l(sq . . . si+1 ) = q − i,
48                                            G. LUSZTIG

 l(xs1 s2 . . . si−1 si ) = l(sq . . . si+1 si−1 . . . s1 s1 . . . si ) = l(sq . . . si+1 si ) = q − i + 1,
contradicting (d). Thus (e) holds. We have
           τ (Tx Ty ) = τ (Tx Ts1 Ts2 . . . Tsq ) = τ (Txs1 s2 ...si−1 Tsi Tsi+1 ...sq )
            = τ (Txs1 s2 ...si−1 si Tsi+1 ...sq ) + (vs − vs−1 )τ (Txs1 s2 ...si−1 Tsi+1 ...sq ).
By the induction hypothesis and (e), this equals
            δxs1 s2 ...si−1 si si+1 ...sq ,1 + (vs − vs−1 )δxs1 s2 ...si−1 si+1 ...sq ,1 = δxy,1 .
This completes the proof of (a). To prove (b), we may assume that h = Tx , h′ = Ty
for x, y ∈ W ; we then use (a) and the obvious equality δxy,1 = δyx,1 .
   We prove (c). Using (b) we see that τ (Tx Ty Tz ) = τ (Ty Tz Tx ) = τ (Tz Tx Ty ).
Hence it is enough to show that, for any x, y, z we have
                                     τ (Tx Ty Tz ) ∈ v L(x) Z[v −1 ].
We argue by induction on l(x). If l(x) = 0, then x = 1 and the result follows from
(a). Assume now that l(x) ≥ 1. We can find s ∈ S such that xs < x. If sy > y,
then by the induction hypothesis,
             τ (Tx Ty Tz ) = τ (Txs Tsy Tz ) ∈ v L(x)−L(s) Z[v −1 ] ⊂ v L(x) Z[v −1 ].
If sy < y, then by the induction hypothesis,
                τ (Tx Ty Tz ) = τ (Txs Tsy Tz ) + (vs − vs−1 )τ (Txs Ty Tz )
                 ∈ v L(x)−L(s) Z[v −1 ] + vs v L(x)−L(s) Z[v −1 ] ⊂ v L(x) Z[v −1 ].
The lemma is proved.
10.5. Let H′ = HomA (H, A). We regard H′ as a left H-module where, for h ∈
H, φ ∈ H′ we have (hφ)(h1 ) = φ(h1 h) for all h1 ∈ H and as a right H-module
where, for h ∈ H, φ ∈ H′ , we have (φh)(h1 ) = φ(hh1 ) for all h1 ∈ H.
10.6. We sometimes identify H′ with the set of all P
                                                                  P
                                                   formal sums x∈W ax Tx with
ax ∈ A; to φ ∈ H′ corresponds the formal sum          x∈W φ(Tx−1 )Tx . Since H is
contained in the set of such formal sums (it is the set of sums such that ax = 0
for all but finitely many x), we see that H is naturally a subset of H′ . Using
10.4(a) we see that the imbedding H ⊂ H′ is an imbedding of H-bimodules; it is
an equality if W is finite.
10.7. Let z ∈ W . Recall that in 8.1 we have defined Dz ∈ H′ by Dz (cw ) = δz,w
for all w. An equivalent definition is
                   ′
   (a) Dz (Ty ) = qz,y
for all y ∈ W . Indeed, assuming that (a) holds, we have
                                      X
                                         ′
                           Dz (cw ) =   qz,y py,w = δz,w .
                                                  y
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                                      49

Proposition 10.8. Let z ∈ W, s ∈ S. Assume that L(s)
                                                  P > 0.
                                     −1
  (a) If zs < z, then cs Dz = (vs + vs )Dz + Dzs + u;z<u<us µsz −1 ,u−1 Du .
  (b) If zs > z, then cs Dz = 0.
  For a, b ∈ W we define δa<b to be 1 if a < b and 0 otherwise. Let w ∈ W . If
ws > w, then by 6.7(a), we have
                                                                          X
              (cs Dz )(cw ) = Dz (cw cs ) = Dz (cws +                            µsx−1 ,w−1 cx )
                                                                           x
                                                                        xs<x<w
                                     X
(c)            = δz,ws +                    µsx−1 ,w−1 δz,x .
                                      x
                                   xs<x<w


If ws < w, then by 6.7(b), we have

(d)       (cs Dz )(cw ) = Dz (cw cs ) = (vs + vs−1 )Dz (cw ) = (vs + vs−1 )δz,w .

If zs < z, ws > w, then by (c):
                                                                                   X
(cs Dz )(cw ) = δzs,w +δz<w µsz −1 ,w−1 = (vs +vs−1 )Dz +Dzs +                            µsz −1 ,u−1 Du )(cw ).
                                                                                   u
                                                                                 z<u<us


If zs < z, ws < w, then by (d):
                                                                                  X
 (cs Dz )(cw ) = (vs + vs−1 )δz,w = (vs + vs−1 )Dz + Dzs +                               µsz −1 ,u−1 Du )(cw ).
                                                                                  u
                                                                                z<u<us


If zs > z, ws > w, then by (c), we have (cs Dz )(cw ) = 0. If zs > z, ws < w, then
by (d), we have (cs Dz )(cw ) = 0. Since (cw ) is an A-basis of H, the proposition
follows.
10.9. We show that

(a)              {±cw ; w ∈ W } = {h ∈ H; τ (hh♭ ) ∈ 1 + A<0 ; h̄ = h}.

For any w, w′ ∈ W we have
                           X                                    X
(b)   τ (cw c♭w′ ) = τ (           py,w py′ ,w′ Ty Ty′ −1 ) =           py,w py′ ,w′ δy,y′ = δw,w′ + zw,w′
                           y,y ′                                y,y ′


where zw,w′ ∈ A<0 . In particular, τ (cw c♭w ) ∈ 1 + A<0 .
  Conversely,
    P         assume that h ∈ H satisfies τ (hh♭ ) ∈ 1 + A<0 , h̄ = h. We have
h = w∈W xw cw where xw ∈ A are 0 for all but finitely many w. We can find
50                                          G. LUSZTIG

t ∈ Z such that xw = bw v t mod A<t where bw ∈ Z for all w and bw 6= 0 for some
w. Using (b), we have
                             X                            X
            τ (hh♭ ) = τ (           xw xw′ cw c♭w′ ) =           xw xw′ (δw,w′ + zw,w′ )
                             w,w ′                        w,w ′
                 X            X
             =       x2w +           xw xw′ zw,w′ .
                 w           w,w ′

             P 2 2t
This equalsP w bw v modulo A<2t and also equals 1 modulo A<0 . It follows that
t = 0 and w b2w = 1. Since bw are integers, there exists u ∈ W such that bu = ±1
and bw = 0 for w 6= u. Thus xw ∈ A≤0 for all w. Since h̄ = h we have x̄w = xw
for all w. It follows that xw = bw for all w. Thus h = ±cu . This proves (a).
10.10. The interest of 10.9(a) is that it provides a definition of cw (up to sign)
without using the basis Tw of H (instead, it uses τ : H −→ A). The equality 10.9(a)
could be used to give a definition of cw (up to sign) in more general situations than
that considered above, when the basis (Tw ) is not defined but τ : H −→ A is defined
(it is known that τ is defined when W is replaced by certain complex reflection
groups, see [BM]). This should lead to a definition of cells for complex reflection
groups.

                 11. The longest element for a finite W
11.1. We preserve the setup of 3.1. Let I ⊂ S be such that WI is finite. By 9.8,
there is a unique element of maximal length of WI . We denote it by w0I . If w1 has
minimal length in WI a then w0I w1 has maximal length in WI a.
11.2. In the remainder of this chapter we assume that W is finite. Then w0 := w0S ,
the unique element of maximal length of W , is well defined. Since l(w0−1 ) = l(w0 ),
we must have w0−1 = w0 . By the argument in the proof of 9.8 we have w ≤ w0 for
any w ∈ W . By 9.8 we have
   (a) l(ww0 ) = l(w0 ) − l(w)
for any w ∈ W . Applying this to w−1 and using the equalities l(w−1 w0 ) =
l(w0−1 w) = l(w0 w), l(w−1 ) = l(w), we deduce that
   (b) l(w0 w) = l(w0 ) − l(w).
We can rewrite (a),(b) as l(w0 ) = l(w−1 ) + l(ww0 ), l(w0 ) = l(w0 w) + l(w−1 ).
Using this and the definition of L we deduce that
   L(w−1 ) + L(ww0 ) = L(w0 ) = L(w0 w) + L(w−1 ),
hence L(ww0 ) = L(w0 w). This implies L(w0 ww0 ) = L(w) for all w. Replacing L
by l gives l(w0 ww0 ) = l(w). Thus, the involution w 7→ w0 ww0 of W maps S into
itself hence is a Coxeter group automorphism preserving the function L.
Lemma 11.3. Let y, w ∈ W . We have
  (a) y ≤ w ⇔ w0 w ≤ w0 y ⇔ ww0 ≤ yw0 ;
  (b) ry,w = rww0 ,yw0 = rw0 w,w0 y ;
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                            51

                     P
  (c) p̄ww0 ,yw0 =   z;y≤z≤w    pzw0 ,yw0 rz,w .
   We prove (a). To prove that y ≤ w =⇒ ww0 ≤ yw0 , we may assume that
l(w) − l(y) = 1, yw−1 ∈ T . Then

        l(yw0 ) − l(ww0 ) = l(w0 ) − l(y) − (l(w0 ) − l(w)) = l(w) − l(y) = 1

and (ww0 )(yw0 )−1 = wy −1 ∈ T . Hence ww0 ≤ yw0 . The opposite implication
is proved in the same way. The second equivalence in (a) follows from the last
sentence in 11.2.
   We prove the first equality in (b) by induction on l(w). If l(w) = 0 then w = 1.
We have ry,1 = δy,1 . Now rw0 ,yw0 is zero unless w0 ≤ yw0 (see 4.7). On the
other hand we have yw0 ≤ w0 (see 11.2). Hence rw0 ,yw0 is zero unless yw0 = w0 ,
that is unless y = 1 in which case it is 1. Thus the desired equality holds when
l(w) = 0. Assume now that l(w) ≥ 1. We can find s ∈ S such that sw < w. Then
sww0 > ww0 by (a).
   Assume first that sy < y (hence syw0 > yw0 ). By 4.4 and the induction
hypothesis we have

                         ry,w = rsy,sw = rsww0 ,syw0 = rww0 ,yw0 .

Assume next that sy > y (hence syw0 < yw0 .) By 4.4 and the induction hypothesis
we have

       ry,w = rsy,sw + (vs − vs−1 )ry,sw = rsww0 ,syw0 + (vs − vs−1 )rsww0 ,yw0
        = rsww0 ,syw0 + (vs − vs−1 )rww0 ,syw0 = rww0 ,yw0 .

This proves the first equality in (b). The second equality in (b) follows from the
last sentence in 11.2.
   We prove (c). We mayPassume that y ≤ w. By 5.3 (for ww0 , yw0 instead of
y, w) we have p̄ww0 ,yw0 = z;y≤z≤w rww0 ,zw0 pzw0 ,yw0 (we have used (a)). Here we
substitute rww0 ,zw0 = rz,w (see (b)) and the result follows. The lemma is proved.
Proposition 11.4. For any y, w ∈ W we have qy,w = pww0 ,yw0 = pw0 w,w0 y .
   The second equality follows from the last sentence in 11.2. We prove the first
equality. We may assume that y ≤ w. We argue by induction on l(w) − l(y) ≥
0. If l(w) − l(y) = 0 we have y = w and both sides are 1. Assume now that
l(w) − l(y) ≥ 1. Subtracting the identity in 11.3(c) from that in 10.2 and using
the induction hypothesis, we obtain

                          q y,w − p̄ww0 ,yw0 = qy,w − pww0 ,yw0 .

The right hand side is in A<0 ; since it is fixed by ¯, it is 0. The proposition is
proved.
52                                        G. LUSZTIG

Proposition 11.5. We identify H = H′ as in 10.6. If z ∈ W , then Dz −1 ∈ H′
(see 10.7) becomes an element of H. We have Dz −1 Tw−1
                                                     0
                                                       = sgn(zw0 )c†zw0 , † as in
3.5.
     By definition, Dz −1 ∈ H is characterized by
                                  τ (Dz −1 Ty−1 ) = qz′ −1 ,y−1
for all y ∈ W . Here τ is as in 10.3. Hence, by 10.4(a), we have Dz −1 =
      ′
P
   y qz −1 ,y −1 Ty . Using 11.4, we deduce
                                     X
                             Dz −1 =    sgn(yz)pw0 y−1 ,w0 z −1 Ty .
                                      y

Multiplying on the right by Tw−1
                               0
                                 gives
                                X
                   Dz −1 Tw−1
                            0
                              =    sgn(yz)pw0 y−1 ,w0 z −1 Tw−1
                                                              0y
                                                                 −1

                                      y
since Tw0 y−1 Ty = Tw0 . On the other hand,
                    X                            X
   sgn(zw0 )c†zw0 =     sgn(zw0 x)px,zw0 Tx−1
                                            −1 =   sgn(zw0 yw0 )pyw0 ,zw0 Tw−1
                                                                             0y
                                                                                −1 .
                        x                                y
We now use the identity pyw0 ,zw0 = pw0 y−1 ,w0 z −1 . The proposition follows.
Proposition 11.6. Let u, z ∈ W, s ∈ S be such that sz < z < u < su. Assume
that L(s) > 0. Then suw0 < uw0 < zw0 < szw0 and µsuw0 ,zw0 = −sgn(uz)µsz,u .
     Using 10.8(a), we see that
                                                                  X
       (cs − (vs + vs−1 ))Dz −1 Tw−1
                                   0
                                     = Dz −1 s Tw−1
                                                  0
                                                    +                        µsz,u Du−1 Tw−1
                                                                                           0
                                                                                             ,
                                                        u;z −1 <u−1 <u−1 s
hence, using 11.5, we have
                                                                    X
 (cs − (vs + vs−1 ))sgn(zw0 )c†zw0 = sgn(zsw0 )c†szw0 +                      µsz,u sgn(uw0 )c†uw0 .
                                                                  u;z<u<su
            †
Applying        to both sides and using (cs − (vs +     vs−1 ))†
                                                             = −cs gives
                                             X
(a)                   −cs czw0 = −cszw0 +           µsz,u sgn(uz)cuw0 .
                                             u;z<u<su

Since szw0 > zw0 , we can apply 6.6(a) and we get
                                         X
                    cs czw0 = cszw0 +             µsu′ ,zw0 cu′
                                             u′ ;su′ <u′ <zw0
or equivalently                                 X
                         cs czw0 = cszw0 +              µsuw0 ,zw0 cuw0 .
                                             u;z<u<su
Comparison with (a) gives
                 X                                      X
            −           µsz,u sgn(uz)cuw0 =                       µsuw0 ,zw0 cuw0 ;
                     u;z<u<su                        u;z<u<su
the proposition follows.
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                              53

Corollary 11.7. Assume that L(s) > 0 for all s ∈ S. Let y, w ∈ W .
   (a) y ≤L w ⇔ ww0 ≤L yw0 ⇔ w0 w ≤L w0 y;
   (b) y ≤R w ⇔ ww0 ≤R yw0 ⇔ w0 w ≤R w0 y;
   (c) y ≤LR w ⇔ ww0 ≤LR yw0 ⇔ w0 w ≤LR w0 y.
   (d) Left multiplication by w0 carries left cells to left cells, right cells to right
cells, two-sided cells to two-sided cells. The same holds for right multiplication by
w0 .
   We prove the first equivalence in (a). It is enough to show that y ≤L w =⇒
ww0 ≤L yw0 . We may assume that y ←L w and y 6= w. Then there exists s ∈ S
such that sw > w, sy < y and Dy (cs cw ) 6= 0. We have syw0 > yw0 , sww0 < ww0 .
From 6.6 we see that either y = sw or y < w and µsy,w 6= 0. In the first case
we have ww0 = syw0 ; in the second case we have ww0 < yw0 and µsww0 ,yw0 6= 0
(see 11.6). In both cases, 6.6 shows that Dww0 (cs cyw0 ) 6= 0. Hence ww0 ≤L yw0 .
Thus, the first equivalence in (a) is established. The second equivalence in (a)
follows from the last sentence in 11.2.
   Now (b) follows by applying (a) to y −1 , w−1 instead of y,w; (c) follows from (a)
and (b); (d) follows from (a),(b),(c). The corollary is proved.

                        12. Examples of elements Dw
  We preserve the setup of 3.1.
Proposition 12.1. Assume that L(s) > 0 for all s ∈ S. For any y ∈ W we have
D1 (Ty ) = sgn(y)v −L(y) . Equivalently, with the identification in 10.6, we have
  D1 = y∈W sgn(y)v −L(y) Ty .
          P

                                    ′
  An equivalent statement
                P ′        is that q1,y = sgn(y)v −L(y) . Since q1,y
                                                                 ′
                                                                     are determined
by the equations y q1,y py,w = δ1,w (see 10.2(a)) it is enough to show that
                              X
                                   sgn(y)v −L(y)py,w = δ1,w
                               y


for all w ∈ W . If w = 1 this is clear. Assume now that w 6= 1. We can find s ∈ S
such that sw < w. We must prove that
                      X
                              sgn(y)v −L(y) (py,w − vs−1 psy,w ) = 0.
                     y;y<sy


Each term of the last sum is 0, by 6.6(c). The proposition is proved.
Corollary        Assume that W is finite and that L(s) > 0 for all s ∈ S. Then
        P 12.2. −L(yw 0)
  cw0 = y∈W v            Ty .
   This follows immediately from 12.1 and 11.5. Alternatively, we can argue as
follows. We prove that py,w0 = v −L(yw0 ) for all y, by descending induction on l(y).
54                                          G. LUSZTIG

If l(y) is maximal, that is y = w0 , then py,w0 = 1. Assume now that l(y) < l(w0 ).
We can find s ∈ S such that l(sy) = l(y) + 1. By the induction hypothesis we have
psy,w0 = v −L(syw0 ) . By 6.6(c), we have

py,w0
 = vs−1 psy,w0 = v −L(s)−L(syw0 ) = v −L(s)−L(w0 )+L(sy) = v −L(w0 )+L(y) = v −L(yw0 ) .

The corollary is proved.
12.3. From 11.5 we see that Dz −1 can be explicitly computed when W is finite
and czw0 is known. In particular, in the setup of 7.4 with m = 2k + 2 < ∞, we
can compute explicitly all Dz −1 using 7.6(a). For example:
                X
      Ds1 =            (1 − v 2L1 + v 4L1 − · · · + (−1)s v 2sL1 )v −sL1 −sL2
              s∈[0,k−1]

      × (T12s+1 − v −L2 T22s+2 − v −L2 T12s+2 + v −2L2 T22s+3 )
      + (1 − v 2L1 + v 4L1 − · · · + (−1)k v 2kL1 )v −kL1 −kL2 (T12k+1 − v −L2 T22k+2 ).

Using this (for larger and larger m) one can deduce that an analogous formula
holds in the setup of 7.4 with m = ∞:
                      X
              Ds1 =    (1 − v 2L1 + v 4L1 − · · · + (−1)s v 2sL1 )v −sL1 −sL2
                      s≥0

(a)           × (T12s+1 − v −L2 T22s+2 − v −L2 T12s+2 + v −2L2 T22s+3 ) ∈ H′ .

(We use the identification in 10.6.)

                                  13. The function a
13.1. We preserve the setup of 3.1.
  In the remainder of these notes we assume that L(s) > 0 for all s ∈ S.
                                          ′
  For x, y, z in W we define fx,y,z ∈ A, fx,y,z ∈ A, hx,y,z ∈ A by
                                      X                    X
                                                                 ′
                            Tx Ty =         fx,y,z Tz =         fx,y,z cz ,
                                      z∈W                 z∈W

                                                X
                                      cx cy =         hx,y,z cz .
                                                z∈W

We have
                       ′
              P
  (a) fx,y,z = u pz,u fx,y,u
       ′          ′
              P
  (b) fx,y,z = u qz,u fx,y,u ,
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                               55

    (c) hx,y,z = x′ ,y′ px′ ,x py′ ,y fx′ ′ ,y′ ,z .
                   P

All sums in (a)-(c) are finite. (a),(c) follow from the definitions; (b) follows from
(a) using 10.2(a).
    From 8.2, 5.6, we see that
    (d) hx,y,z 6= 0 =⇒ z ≤R x, z ≤L y,
    (e) hx,y,z = hy−1 ,x−1 ,z −1 .
We show:
    (f) fx,y,z 6= 0 =⇒ l(z) ≤ l(x) + l(y);
          ′
    (g) fx,y,z  6= 0 =⇒ l(z) ≤ l(x) + l(y);
    (h) hx,y,z 6= 0 =⇒ l(z) ≤ l(x) + l(y).
Now (f) follows from the definition, by induction on l(x); (g) follows from (b) and
                    ′                                ′
(f) using that qz,z   ′ = 0 unless z ≤ z ; (h) follows from (c) and (g) using that

px′ ,x = 0 unless x′ ≤ x.
13.2. We say that N ∈ N is a bound for W, L if v −N fx,y,z ∈ A≤0 for all x, y, z in
W . We say that W, L is bounded if there exists N ∈ N such that N is a bound for
W, L.
Lemma 13.3. If W is finite, then N = L(w0S ) is a bound for W, L.
  By 10.4(a) we have fx,y,z = τ (Tx Ty Tz −1 ). By 10.4(c) we have τ (Tx Ty Tz −1 ) ∈
 L(w0S )
v    Z[v −1 ]. The lemma is proved.
13.4. Conjecture. In the general case W, L admits a bound N = maxI L(w0I )
where I runs over the subsets of S such that WI is finite.
   For W is tame this is proved in [L7, 7.2] assuming that L = l, but the same
proof remains valid without the assumption L = l.
   We illustrate this in the setup of 7.1 with m = ∞. For a, b ∈ {1, 2} and
k > 0, k ′ > 0, we have
   Tak Tbk′ = Tak+k′ if b = a + k mod 2,
                        P
   Tak Tbk′ = Tak bk′ + u∈[1,min(k,k′ )] ξb+u−1 Tak+k′ −2u+1 if b = a + k + 1 mod 2;
here, for n ∈ Z we set ξn = v L1 − v −L1 if n is odd and ξn = v L2 − v −L2 if n is
even. We see that, in this case, max(L1 , L2 ) is a bound for W, L.
Lemma 13.5. Assume that W, L is bounded; let N be a bound for W, L. Then,
for any x, y, z in W we have
   (a) v −N fx,y,z
             ′
                   ∈ A≤0 ,
        −N
   (b) v hx,y,z ∈ A≤0 .
                                    ′
    (a) follows from 13.1(b) since qz,z ′ ∈ A≤0 . (b) follows from (a) and 13.1(c) since

px′ ,x ∈ A≤0 , py′ ,y ∈ A≤0 .
13.6. In the remainder of this chapter we assume that W, L is bounded. By
13.5(b), for any z ∈ W there exists a unique integer a(z) ≥ 0 such that
   (a) hx,y,z ∈ v a(z) Z[v −1 ] for all x, y ∈ W ,
56                                     G. LUSZTIG

   (b) hx,y,z ∈  / v a(z)−1 Z[v −1 ] for some x, y ∈ W .
(We use that h1,z,z = 1.) We then have for any x, y, z:
   (c) hx,y,z = γx,y,z −1 v a(z) mod v a(z)−1 Z[v −1 ]
where γx,y,z −1 ∈ Z is well defined; moreover, for any z ∈ W there exists x, y such
that γx,y,z −1 6= 0.
   For any x, y, z we have
         ′
   (d) fx,y,z   = γx,y,z −1 v a(z) mod v a(z)−1 Z[v −1 ].
This is proved (for fixed z) by induction on l(x) + l(y) using (c) and 13.1(c). (Note
that px′ ,x py′ ,y is 1 if x′ = x, y ′ = y and is in A<0 otherwise.)
Proposition 13.7. (a) a(1) = 0.
  (b) If z ∈ W − {1}, then a(z) ≥ mins∈S L(s) > 0.
   We prove (a). Let x, y ∈ W . Assume first that y 6= 1. We can find s ∈ S such
that ys < y. Then cy ∈ s H. Since s H is a left ideal (see 8.4) we have cx cy ∈ s H.
Since s1 > 1, from the definition of s H it then follows that hx,y,1 = 0.
   Similarly, if x 6= 1, then hx,y,1 = 0. Since h1,1,1 = 1, (a) follows.
   In the setup of (b) we can find s ∈ S such that sz < z. By 6.6(b) we have
hs,z,z = vs + vs−1 . This shows that a(z) ≥ L(s) > 0. The proposition is proved.
Proposition 13.8. Assume that W is finite.
  (a) We have a(w0 ) = L(w0 ).
  (b) For any w ∈ W − {w0 } we have a(w) < L(w0 ).
  From 13.5, 13.3, for any w ∈ W we have a(w) ≤ L(w0 ).
  We prove (a). From 6.6(b) we see that Ts cw0 = vs cw0 for any s ∈ S. Using this
and 12.2, weP see that
  cw0 cw0 = y∈W v −L(yw0 ) v L(y) cw0 ,
hence
                       X
         hw0 ,w0 ,w0 =    v −L(w0 ) v 2L(y) ∈ v L(w0 ) mod v L(w0 )−1 Z[v −1 ].
                        y∈W

It follows that a(w0 ) ≥ L(w0 ). Hence a(w0 ) = L(w0 ). This proves (a).
   We prove (b). Let z ∈ W be such that a(z) = L(w0 ). We must prove that
z = w0 . By 13.6(d), we can find x, y such that
                     ′
                    fx,y,z = bv L(w0 ) + strictly smaller powers of v
where b ∈ Z − {0}. For any z ′ 6= z we have fx,y,z
                                                ′
                                                      ′ ∈ v
                                                            L(w0 )
                                                                   Z[v −1 ] (by 13.6 and the
first sentence in the proof). SincePpz,z ′ = 1 for z = z ′ and pz,z ′ ∈ A<0 for z ′ < z,
                                              ′
we see that the equality fx,y,z = z ′ pz,z ′ fx,y,z ′ (see 13.1(a)) implies that


                    fx,y,z = bv L(w0 ) + strictly smaller powers of v
with b 6= 0. Now fx,y,z = τ (Tx Ty Tz −1 ). Using now 10.4(c) we see that
                           min(L(x), L(y), L(z −1)) = L(w0 ).
It follows that x = y = z −1 = w0 . The proposition is proved.
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                               57

Proposition 13.9. (a) For any z ∈ W we have a(z) = a(z −1 ).
  (b) For any x, y, z ∈ W we have γx,y,z = γy−1 ,x−1 ,z −1 .
  (a),(b) follow from 13.1(e).
13.10. We show that, in the setup of 7.1 with m = ∞ and L2 ≥ L1 , the function
a:W −  → N is given as follows:
   (a) a(1) = 0,
   (b) a(11 ) = L1 , a(21 ) = L2 ,
   (c) a(1k ) = a(2k ) = L2 if k ≥ 2.
Now (a) is contained in 13.7(a). If s2 z < z then, by the proof of 13.7(b) we have
a(z) ≥ L2 . By 13.4, L2 is a bound for W, L hence a(z) ≤ L2 so that a(z) = L2 . If
zs2 < z then the previous argument is applicable to z −1 . Using 13.9, we see that
a(z) = a(z −1 ) = L2 .
   Assume next that z = 12k+1 where k ≥ 1. By 7.5, 7.6, we have
          c12 c22k = c1 c2 c22k = (v L2 + v −L2 )c1 c22k = (v L2 + v −L2 )c12k+1 ,
hence h12 ,22k ,z = v L2 + v −L2 . Thus, a(z) ≥ L2 . By 13.4 we have a(z) ≤ L2 hence
a(z) = L2 .
   It remains to consider the case where z = s1 . Assume first that L1 = L2 . Then
a(s1 ) ≤ L1 by 13.4 and a(s1 ) ≥ L1 by 13.7(b).    P Hence a(s1 ) = L1 .
   Assume next that L1 < L2 . Then I = w∈W −{1,s1 } Acw is a two-sided ideal
I of H (see 8.8). Hence if x or y is in W − {1, s1 }, then cx cy ∈ I and hx,y,s1 = 0.
Using
               h1,1,s1 = 0, h1,s1 ,s1 = hs1 ,1,s1 = 1, hs1 ,s1 ,s1 = v L1 + v −L1
we see that a(s1 ) = L1 . Thus, (a),(b),(c) are established.
13.11. In this subsection we assume that we are in the setup of 7.1 with 4 ≤ m <
∞ and L2 > L1 . By 7.8, we have
h2m−1 ,2m−1 ,2m−1 = (−1)(m−2)/2 v (mL2 −(m−2)L1 )/2 + strictly smaller powers of v.
Hence a(2m−1 ) ≥ (mL2 − (m − 2)L1 )/2.
  One can show that the function a : W − → N is given as follows:
  a(1) = 0,
  a(11 ) = L1 , a(21 ) = L2 ,
  a(1m−1 ) = L2 , a(2m−1 ) = (mL2 − (m − 2)L1 )/2,
  a(2m ) = m(L1 + L2 )/2,
  a(1k ) = a(2k ) = L2 if 1 < k < m − 1.
This remains true in the case where L1 = L2 .
13.12. We conjecture that any two-sided cell of W would meet some finite WI ;
this would imply that there are only finitely many two-sided cells in W . (Compare
18.2.)
   On the other hand, the number of left cells in W can be infinite for some
non-tame W with L = l (Bédard [Be])
58                                     G. LUSZTIG

                                   14. Conjectures
14.1. We preserve the setup of 3.1. In this chapter we assume that W, L is
bounded, see 13.2.
                           → Z by πn ( k∈Z ak v k ) = an .
                                      P
   For n ∈ Z define πn : A −
   For z ∈ W we define an integer ∆(z) ≥ 0 by

(a)         p1,z = nz v −∆(z) + strictly smaller powers of v, nz ∈ Z − {0}.

Note that ∆(z) = ∆(z −1 ) and ∆(1) = 0, 0 < ∆(z) ≤ L(z) for z 6= 1 (see 5.4). Let

                              D = {z ∈ W ; a(z) = ∆(z)}.

Clearly, z ∈ D =⇒ z −1 ∈ D.
Conjectures 14.2. The following properties hold.
   P1. For any z ∈ W we have a(z) ≤ ∆(z).
   P2. If d ∈ D and x, y ∈ W satisfy γx,y,d 6= 0, then x = y −1 .
   P3. If y ∈ W , there exists a unique d ∈ D such that γy−1 ,y,d 6= 0.
   P4. If z ′ ≤LR z then a(z ′ ) ≥ a(z). Hence, if z ′ ∼LR z, then a(z ′ ) = a(z).
   P5. If d ∈ D, y ∈ W, γy−1 ,y,d 6= 0, then γy−1 ,y,d = nd = ±1.
   P6. If d ∈ D, then d2 = 1.
   P7. For any x, y, z ∈ W we have γx,y,z = γy,z,x .
   P8. Let x, y, z ∈ W be such that γx,y,z 6= 0. Then x ∼L y −1 , y ∼L z −1 ,
z ∼L x−1 .
   P9. If z ′ ≤L z and a(z ′ ) = a(z) then z ′ ∼L z.
   P10. If z ′ ≤R z and a(z ′ ) = a(z) then z ′ ∼R z.
   P11. If z ′ ≤LR z and a(z ′ ) = a(z) then z ′ ∼LR z.
   P12. Let I ⊂ S. If y ∈ WI , then a(y) computed in terms of WI is equal to a(y)
computed in terms of W .
   P13. Any left cell Γ of W contains a unique element d ∈ D. We have γx−1 ,x,d 6=
0 for all x ∈ Γ.
   P14. For any z ∈ W we have z ∼LR z −1 .
   P15. Let v ′ be a second indeterminate and let h′x,y,z ∈ Z[v ′ , v ′−1 ] be obtained
from
   P hx,y,z  by the substitution     v 7→ v ′ . If x, x′ , y, w ∈ W satisfy a(w) = a(y), then
          ′                                ′
                              P
     y ′ hw,x′ ,y ′ hx,y ,y =  y ′ hx,w,y hy ′ ,x′ ,y .
                        ′                ′


     In §15-§17 we will verify the conjectures above in a number of cases.
14.3. We consider the following auxiliary statement.
   P̃ . Let x, y, z, z ′ ∈ W be such that γx,y,z −1 6= 0, z ′ ←L z. Then there exists
x ∈ W such that πa(z) (hx′ ,y,z ′ ) 6= 0. In particular, a(z ′ ) ≥ a(z).
 ′

   In this chapter we will show, that, if P1-P3 and P̃ are assumed to be true, then
P4-P14 are automatically true. The arguments follow [L7],[L9].
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                        59

14.4. P̃ =⇒ P4. Let z ′ , z be as in P4. We can assume that z ←L z ′ or
z ←R z ′ . In the first case, from P̃ we get a(z ′ ) ≥ a(z). (We can find x, y such
that γx,y,z −1 6= 0.) In the second case, from P̃ we get a(z ′−1 ) ≥ a(z −1 ) hence
a(z ′ ) ≥ a(z).
                                                                            P
14.5. P1,P3 =⇒ P5. Let x, y ∈ W . Applying τ to cx cy = z∈W hx,y,z cz gives
  X                   X                              X                           X
        hx,y,z p1,z =   px′ ,x py′ ,y τ (Tx′ Ty′ ) =   px′ ,x py′ ,y δx′ y′ ,1 =   px′ ,x px′ −1 ,y
   z                 x′ ,y ′                              x′ ,y ′                   x′

hence
                               X
(a)                                 hx,y,z p1,z = δxy,1        mod v −1 Z[v −1 ].
                           z∈W

We take x = y −1 and note that hy−1 ,y,z ∈ v a(z) Z[v −1 ], p1,z ∈ v −∆(z) Z[v −1 ], hence

                                   hy−1 ,y,z p1,z ∈ v a(z)−∆(z) Z[v −1 ].

The same argument shows that, if z ∈ D, then

                               hy−1 ,y,z p1,z ∈ γy−1 ,y,z −1 nz + A<0 .

If z ∈
     / D then, by P1, we have a(z) − ∆(z) < 0 so that hy−1 ,y,z p1,z ∈ A<0 . We see
that              X                    X
                      hy−1 ,y,z p1,z =   γy−1 ,y,z −1 nz mod A<0 .
                    z∈W                         z∈D
                                      P
Comparison with (a) gives               z∈Dγy−1 ,y,z −1 nz = 1. Equivalently,
                                          X
                                            γy−1 ,y,z nz = 1.
                                          z∈D

Using this and P3 we see that, in the setup of P5 we have γy−1 ,y,d nd = 1. Since
γy−1 ,y,d , nd are integers, we must have γy−1 ,y,d = nd = ±1.
14.6. P2,P3 =⇒ P6. We can find x, y such that γx,y,d 6= 0. By P2, we have
x = y −1 so that γy−1 ,y,d 6= 0. This implies γy−1 ,y,d−1 6= 0. (See 13.9(b)). We have
d−1 ∈ D. By the uniqueness in P3 we have d = d−1 .
14.7. P2,P3,P4,P5 =⇒ P7. We first prove the following statement.
  (a) Let x, y, z ∈ W, d ∈ D be such that γx,y,z 6= 0, γz −1 ,z,d 6= 0, a(d) = a(z).
Then γx,y,z = γy,z,x .
Let n = a(d). From γx,y,z 6= 0 we deduce hx,y,z −1 6= 0 hence z −1 ≤R x, hence
n = a(z) = a(z −1 ) ≥ a(x) (see P4). Computing the coefficient of cd in two ways,
we obtain              X                        X
                           hx,y,z ′ hz ′ ,z,d =   hx,x′ ,d hy,z,x′ .
                               z′                         x′
60                                              G. LUSZTIG

Now hz ′ ,z,d 6= 0 implies d ≤R z ′ hence a(z ′ ) ≤ a(d) = n (see P4); similarly,
hx,x′ ,d 6= 0 implies d ≤L x′ hence a(x′ ) ≤ a(d) = n. Thus we have
                        X                                      X
                                     hx,y,z ′ hz ′ ,z,d =                  hx,x′ ,d hy,z,x′ .
                    z ′ ;a(z ′ )≤n                          x′ ;a(x′ )≤n


By P2 and our assumptions, the left hand side is

                    γx,y,z γz −1 ,z,d v 2n + strictly smaller powers of v.

Similarly, the right hand side is

                γx,x−1 ,d πn (hy,z,x−1 )v 2n + strictly smaller powers of v.

Hence γx,x−1 ,d πn (hy,z,x−1 ) = γx,y,z γz −1 ,z,d 6= 0. Thus,

                                 γx,x−1 ,d 6= 0, πn (hy,z,x−1 ) 6= 0.

We see that a(x−1 ) ≥ n. But we have also a(x) ≤ n hence a(x) = n and
πn (hy,z,x−1 ) = γy,z,x . Since γx,x−1 ,d 6= 0, we have (by P5) γx,x−1 ,d = γz −1 ,z,d .
Using this and γx,x−1 ,d γy,z,x = γx,y,z γz −1 ,z,d we deduce γy,z,x = γx,y,z , as required.
   Next we prove the following statement.
   (b) Let z ∈ W, d ∈ D be such that γz −1 ,z,d 6= 0. Then a(z) = a(d).
We shall assume that (b) holds whenever a(z) > N0 and we shall deduce that it
also holds when a(z) = N0 . (This will prove (b) by descending induction on a(z)
since a(z) is bounded above.) Assume that a(z) = N0 . From γz −1 ,z,d = ±1 we
deduce that hz −1 ,z,d−1 6= 0 hence d−1 ≤L z −1 hence a(d−1 ) ≥ a(z −1 ) (see P4) and
a(d) ≥ a(z). Assume that a(d) > a(z), that is, a(d) > N0 . Let d′ ∈ D be such
that γd−1 ,d,d′ 6= 0 (see P3). By the induction hypothesis applied to d, d′ instead
of z, d, we have a(d) = a(d′ ). From γz −1 ,z,d 6= 0,γd−1 ,d,d′ 6= 0, a(d) = a(d′ ),
we deduce (using (a)) that γz,d,z −1 = γz −1 ,z,d . Hence γz,d,z −1 6= 0. It follows
that hz,d,z 6= 0, hence z ≤L d, hence a(z) ≥ a(d) (see P4). This contradicts the
assumption a(d) > a(z). Hence we must have a(z) = a(d), as required.
    We now prove P7. Assume first that γx,y,z 6= 0. Let d ∈ D be such that
γz −1 ,z,d 6= 0 (see P3). By (b) we have a(z) = a(d). Using (a) we then have
γx,y,z = γy,z,x . Assume next that γx,y,z = 0; we must show that γy,z,x = 0. We
assume that γy,z,x 6= 0. By the first part of the proof, we have

             γy,z,x 6= 0 =⇒ γy,z,x = γz,x,y 6= 0 =⇒ γz,x,y = γx,y,z 6= 0,

a contradiction.
14.8. P7 =⇒ P8. If γx,y,z 6= 0, then hx,y,z −1 6= 0, hence z −1 ≤L y, z ≤L x−1 .
By P7 we also have γy,z,x 6= 0 (hence x−1 ≤L z, x ≤L y −1 ) and γz,x,y 6= 0 (hence
y −1 ≤L x, y ≤L z −1 ). Thus, we have x ∼L y −1 , y ∼L z −1 , z ∼L x−1 .
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                     61

14.9. P̃ ,P4,P8 =⇒ P9. We can find a sequence z ′ = z0 , z1 , . . . , zn = z such that
for any j ∈ [1, n] we have zj−1 ←L zj . By P4 we have a(z ′ ) = a(z0 ) ≥ a(z1 ) ≥
· · · ≥ a(zn ) = a(z). Since a(z) = a(z ′ ), we have a(z ′ ) = a(z0 ) = a(z1 ) = · · · =
a(zn ) = a(z). Thus, it suffices to show that, if z ′ ←L z and a(z ′ ) = a(z), then
z ′ ∼L z. Let x, y ∈ W be such that γx,y,z −1 6= 0. By P̃ , there exists x′ ∈ W
such that πa(z) (hx′ ,y,z ′ ) 6= 0. Since a(z ′ ) = a(z), we have γx′ ,y,z ′−1 6= 0. From
γx,y,z −1 6= 0,γx′ ,y,z ′−1 6= 0 we deduce, using P8, that y ∼L z, y ∼L z ′ , hence
z ∼L z ′ .
14.10. P9 =⇒ P10. We apply P9 to z −1 , z ′−1 .
14.11. P4,P9,P10 =⇒ P11. We can find a sequence z ′ = z0 , z1 , . . . , zn = z
such that for any j ∈ [1, n] we have zj−1 ≤L zj or zj−1 ≤R zj . By P4, we
have a(z ′ ) = a(z0 ) ≥ a(z1 ) ≥ · · · ≥ a(zn ) = a(z). Since a(z) = a(z ′ ), we have
a(z ′ ) = a(z0 ) = a(z1 ) = · · · = a(zn ) = a(z). Applying P9 or P10 to zj−1 , zj we
obtain zj−1 ∼L zj or zj−1 ∼R zj . Hence z ′ ∼LR z.
14.12. P3,P4,P8 for W and WI =⇒ P12. We write aI : WI −                  → N for the
a-function defined in terms of WI . For x, y, z ∈ WI , we write hIx,y,z , γx,y,z
                                                                           I
                                                                                 for the
analogues of hx,y,z , γx,y,z when W is replaced by WI . Let HI ⊂ H be as in 9.9.
   Let d ∈ D be such that γy−1 ,y,d 6= 0. (See P3.) Then πa(d) (hy−1 ,y,d−1 ) 6= 0. Now
cy−1 cy ∈ HI hence d ∈ WI and πa(d) (hIy−1 ,y,d−1 ) 6= 0. Thus, aI (d−1 ) ≥ a(d−1 ).
The reverse inequality is obvious hence aI (d) = a(d). We see that γyI−1 ,y,d 6= 0.
From P8 we see that y ∼L d (relative to WI ) and y ∼L d (relative to W ). From
P4 we deduce that aI (y) = aI (d) and a(y) = a(d). It follows that a(y) = aI (y).
14.13. P̃ ,P2,P3,P4,P6,P8 =⇒ P13. If x ∈ Γ then, by P3, there exists d ∈ D
such that γx−1 ,x,d 6= 0. By P8 we have x ∼L d−1 hence d−1 ∈ Γ. By P6, we
have d = d−1 hence d ∈ Γ. It remains to prove the uniqueness of d. Let d′ , d′′ be
elements of D ∩Γ. We must prove that d′ = d′′ . We can find x′ , y ′ , x′′ , y ′′ such that
γx′ ,y′ ,d′ 6= 0, γx′′ ,y′′ ,d′′ 6= 0. By P2, we have x′ = y ′−1 , x′′ = y ′′−1 . By P8, we have
y ′ ∼L d′−1 = d′ and y ′′ ∼L d′′−1 = d′′ , hence y ′ , y ′′ ∈ Γ. By the definition of left
cells, we can find a sequence y ′ = x0 , x1 , . . . , xn = y ′′ such that for any j ∈ [1, n]
we have xj−1 ←L xj . Since y ′ ∼L y ′′ , we have xj ∈ Γ for all j. For j ∈ [1, n − 1]
let dj ∈ D be such that γx−1 ,xj ,dj 6= 0. Let d0 = d′ , dn = d′′ . As in the beginning
                                      j
of the proof, we have dj ∈ Γ for each j. Let j ∈ [1, n]. Since xj−1 ←L xj , we
have (by P8) γxj ,dj ,x−1 6= 0. Applying P̃ to xj , dj , xj , xj−1 instead of x, y, z, z ′ , we
                              j
see that there exists u such that πa(xj ) (hu,dj ,xj−1 ) 6= 0. Since xj−1 ∼ xj , we have
a(xj−1 ) = a(xj ) (see P4), hence πa(xj ) (hu,dj ,xj−1 ) = γu,dj ,x−1 6= 0. Using P8, we
                                                                         j−1
deduce γx−1 ,u,dj 6= 0. Using P2 we see that u = xj−1 and γx−1 ,xj−1 ,dj 6= 0. We
              j−1                                                            j−1
have also γx−1 ,xj−1 ,dj−1 6= 0 and by the uniqueness in P3, it follows that dj−1 = dj .
                j−1
It follows that d′ = d′′ , as required.
14.14. P6,P13 =⇒ P14. By P13, we can find d ∈ D such that z ∼L d. Since
d = d−1 (see P6), it follows that z −1 ∼R d. Thus, z ∼LR z −1 .
62                                                    G. LUSZTIG

14.15. In this subsection we reformulate conjecture P15, assuming that P4,P9,
P10 hold. Let Ã = Z[v, v −1 , v ′ , v ′−1 ] where v, v ′ are indeterminates. Let H̃ be
the free Ã-module with basis ew (w ∈ W ). Let H′ , c′w , h′x,y,z be obtained from
H, cw , hx,y,z by changing the variable v to v ′ .
                                                             n
                                                                       P n
   On H̃ we have a left H-module structure given by        v   cy ew =  x v hy,w,x ex and
           ′                                    ′n ′
                                                          P ′n ′
a right H -module structure given by ew (v cy ) = x v hw,y,x ex . These module
structures do not commute in general. For each a ≥ 0 let H̃≥a be the Ã-submodule
of H̃ spanned by {ew ; a(w) ≥ a}. By P4, this is a left H-submodule and a right
H′ -submodule of H̃. We have

                                        . . . H̃≥2 ⊂ H̃≥1 ⊂ H̃≥0 = H̃

and gr H̃ = ⊕a≥0 H̃≥a /H̃≥a+1 inherits a left H-module structure and a right H′ -
module structure from H̃. Clearly, P15 is equivalent to the condition that these
module structures on gr H̃ commute. To check this last condition, it is enough to
check that
    the actions of cs , c′s′ commute on gr H̃ for s, s′ ∈ S.
Let s, s′ ∈ S, w ∈ W . A computation using 6.6, 6.7, 8.2 shows that (cs ew )c′s′ −
cs (ew c′s′ ) is 0 if sw < w or ws′ < w, while if sw > w, ws′ > w, it is
             X                                                                  X
                      (h′w,s′ ,y (vs + vs−1 ) − hs,w,y (vs′ ′ + vs′ ′ −1 ))ey +   αy ey
     y;sy<y,ys′ <y                                                                                  y;sy<y,ys′ <y

where                        X                                                X
            αy =                              h′w,s′ ,y′ hs,y′ ,y −                            hs,w,y′ h′y′ ,s′ ,y .
                     y ′ ;y ′ s′ <y ′ <sy ′                           y ′ ;sy ′ <y ′ <y ′ s′

If y satisfies sy < y, ys′ < y and either h′w,s′ ,y or hs,w,y is 6= 0, then a(y) > a(w).
(We certainly have a(y) ≥ a(w) by P4. If we had a(y) = a(w) and hs,w,y 6= 0 then
by P9 we would have y ∼L w hence R(y) = R(w) contradicting ys′ < y, ws′ > w.
If we had a(y) = a(w) and h′s,w,y 6= 0 then by P10 we would have y ∼R w hence
L(y) = L(w), contradicting sy < y, sw > w.) Hence, if sw > w, ws′ > w, we have
                                          X
        (cs ew )c′s′ − cs (ew c′s′ ) =                   αy ey mod H̃≥a(w)+1 .
                                                y;sy<y,ys′ <y,a(y)=a(w)

We see that P15 is equivalent to the following statement.
  (a) If y, w ∈ W, s, s′ ∈ S are such that sw > w, ws′ > w, sy < y, ys′ < y, a(y) =
a(w),
  P then                     ′                                                    ′
                                                 P
     y ′ ;y ′ s′ <y ′ <sy ′ hw,s′ ,y ′ hs,y ,y =   y ′ ;sy ′ <y ′ <y ′ s′ hs,w,y hy ′ ,s′ ,y .
                                           ′                                    ′



                                   15. Example: the split case
15.1. We preserve the setup of 3.1. We assume that L = l that is, we are in the
split case. From the results on Soergel bimodules in [EW], we see that
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                               63

   (a) hx,y,z ∈ N[v, v −1 ] for all x, y, z in W ,
   (b) py,w ∈ N[v −1 ] for all y, w in W .
In this chapter we assume that W, l is bounded. We will show that P̃ and P1-P3
hold for W, l hence all of P1-P14 hold for W, l; moreover we show that P15 holds.
(Note that for P1-P6, the boundedness of W, l will not be needed). The arguments
in this chapter are based on [L9].
15.2. From 14.5(a) (which does not depend on the boundedness assumption) we
see that Pfor x, y ∈ W we have−1
   (a) z∈W hx,y,z p1,z ∈ Z[v ].
From 15.1(a),(b) we see that hx,y,z p1,z ∈ N[v, v −1 ] for any z ∈ W . Hence in (a)
there are no cancellations, so that
   (b) hx,y,z p1,z ∈ N[v −1 ] for any z ∈ W .
                                                           −l(z)+j
                                                P
Let z ∈ W . By 5.4(a) we have p1,z =              j≥0 ej v         where ej ∈ Z are zero
for large j and e0 = 1; moreover, by 15.1(b) we have ej ∈ N for all j. Thus,
v −l(z) hx,y,z + j>0 ej v −l(z)+j hx,y,z ∈ N[v −1 ]. Again in this sum there are no
                 P
cancellations, hence
                                  v −l(z) hx,y,z ∈ N[v −1 ].
(This was proved for finite W in [L7] and then for general W by Springer (unpub-
lished).) This shows that the definition of a(z) in 13.6 can be given in our case
without the boundedness assumption. Hence the definition of γx,y,z in 13.6 can be
given in our case without the boundedness assumption. Note that the definition
of ∆(z) in 14.1 can be given without the boundedness assumption. Hence the def-
inition of D in 14.1 can be given in our case without the boundedness assumption.
   We show that P1 holds for (W, l).
   We fix z ∈ W and choose x, y ∈ W so that γx,y,z −1 6= 0. From the definitions,
   (c) hx,y,z p1,z ∈ γx,y,z −1 nz v a(z)−∆(z) + strictly smaller powers of v
and the coefficient of v a(z)−∆(z) is 6= 0. Comparison with (b) gives a(z)−∆(z) ≤ 0.
15.3. PProof of P2. Assume that x 6= y −1 . From 14.5(a) we see that
  (a) z∈W hx,y,z p1,z ∈ v −1 Z[v −1 ].
As in 15.2, this implies (using 15.1(a),(b)) that
  (b) hx,y,z p1,z ∈ v −1 N[v −1 ] for any z ∈ W .
Assume now that z = d−1 ∈ D. Then 15.2(c) becomes in our case

                        hx,y,z p1,z ∈ γx,y,z −1 nz + v −1 Z[v −1 ].

Comparison with (b) gives γx,y,z −1 nz = 0. Since nz 6= 0, we have γx,y,z −1 = 0.
This proves P2.
15.4. PProof of P3. From 14.5(a) we see that
   (a) z∈W hy−1 ,y,z p1,z ∈ 1 + v −1 Z[v −1 ].
As in 15.2, this implies (using 15.1(a),(b)) that there is a unique z, say z = d−1
such that
64                                         G. LUSZTIG

   (b) hy−1 ,y,d−1 p1,d−1 ∈ 1 + v −1 N[v −1 ]
and that
   (c) hy−1 ,y,z p1,z ∈ v −1 N[v −1 ]
for all z 6= d−1 . For z = d−1 , 15.2(c) becomes

      hy−1 ,y,d−1 p1,d−1 ∈ γy−1 ,y,d nd−1 v a(d)−∆(d) + strictly smaller powers of v.

Here a(d) − ∆(d) ≤ 0. Comparison with (b) gives a(d) − ∆(d) = 0 and
γy−1 ,y,d nd−1 = 1. Thus, d ∈ D and γy−1 ,y,d 6= 0. Thus, the existence part of
P3 is established.
   Assume that there exists d′ 6= d such that d′ ∈ D and γy−1 ,y,d′ 6= 0. For
z = d′−1 , 15.2(c) becomes

                      hy−1 ,y,d′−1 p1,d′ −1 ∈ γy−1 ,y,d′ nd′ −1 + v −1 Z[v −1 ].

Comparison with (c) (with z = d′−1 ) gives γy−1 ,y,d′ nd′ −1 = 0 hence γy−1 ,y,d′ = 0,
a contradiction. This proves the uniqueness part of P3.
15.5. Proof of P̃ . We may assume that z ′ 6= z. Then we can find s ∈ S such that
sz ′ < z ′ , sz > z and hs,z,z ′ 6= 0. Since hx,y,z 6= 0, we have (by 13.1(d)) z ≤R x
hence L(x) ⊂ L(z)P(by 8.6). Since s ∈      / L(z), we have s ∈ / L(x), that is, sx > x.
We have cs cx cy = u pu cu , where
                                  X                     X
                           pu =       hx,y,w hs,w,u =         hs,x,x′ hx′ ,y,u .
                                  w                      x′

In particular,
                      X                                            X
             pz ′ =        hx,y,w hs,w,z ′ = hx,y,z hs,z,z ′ +             hx,y,w hs,w,z ′ .
                       w                                          w;w6=z


By 6.5, we have hs,z,z ′ ∈ Z hence
                                                         X
(a)              πn (pz ′ ) = πn (hx,y,z )hs,z,z ′ +             πn (hx,y,w hs,w,z ′ )
                                                        w;w6=z


for any n ∈ Z. In particular, this holds for n = a(z). By assumption, we have
πn (hx,y,z ) 6= 0 and hs,z,z ′ 6= 0; hence, by 15.1(a), we have πn (hx,y,z ) > 0 and
hs,z,z ′ > 0. Again, by 15.1(a) we have πn (hx,y,w P       hs,w,z ′ ) ≥ 0 for any w 6= z. Hence
from (a) we deduce πn (pz ′ ) > 0. Since pz ′ = x′ hs,x,x′ hx′ ,y,z ′ , there exists x′
such that πn (hs,x,x′ hx′ ,y,z ′ ) 6= 0. Since sx > x, we see from 6.5 that hs,x,x′ ∈ Z
hence
                        πn (hs,x,x′ hx′ ,y,z ′ ) = hs,x,x′ πn (hx′ ,y,z ′ ).
Thus we have πn (hx′ ,y,z ′ ) 6= 0. This proves P̃ in our case.
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                   65

15.6. Since P̃ and P1-P3 are known, we see that P1-P11 and P13,P14 hold in
our case (see §14). The same arguments can be applied to WI where I ⊂ S, hence
P1-P11 and P13,P14 hold for WI . By 14.12, P12 holds for W . Thus, P1-P14 hold
for W .
15.7. Proof of P15. By 14.15, we see that it is enough to prove 14.15(a). Let
y, w, s, s′ be as in 14.15(a). In our case, by 6.5, the equation in 14.15(a) involves
only integers, hence it is enough to prove it after specializing v = v ′ . If in 14.15
we specialize v = v ′ , then the left and right module structures in 14.15 clearly
commute, since the left and right regular representations of H commute. Hence
the coefficient of ey in ((cs ew )cs′ − cs (ew cs′ ))v=v ′ is 0. By the computation in
14.15, this coefficient is
(a)                               X                             X
(hw,s′ ,y − hs,w,y )(v + v −1 ) +        hw,s′ ,y′ hs,y′ ,y −         hs,w,y′ hy′ ,s′ ,y = 0.
                                       y′                            y′
                               y ′ s′ <y ′ <sy ′               sy ′ <y ′ <y ′ s′


By 6.5, hs,w,y is the coefficient of v −1 in py,w and hw,s′ ,y = hs′ ,w−1 ,y−1 is the
coefficient of v −1 in py−1 ,w−1 = py,w . Thus, hs,w,y = hw,s′ ,y and (a) reduces to the
equation in 14.15(a) (specialized at v = v ′ ). This proves 14.15(a).

                        16. Example: the quasisplit case
16.1. In this subsection we review some results from [L12, §11].
   Let k be an algebraically closed field of characteristic zero. Let C be a k-linear
category, that is a category in which the space of morphisms between any two
objects has a given k-vector space structure such that composition of morphisms is
bilinear and such that finite direct sums exist. A functor from one k-linear category
to another is said to be k-linear if it respects the k-vector space structures.
   Let K(C) be the Grothendieck group of C that is, the free abelian group gener-
ated by symbols [A] for each A ∈ C (up to isomorphism) with relations [A ⊕ B] =
[A| + [B] for any A, B ∈ C. Let n be an integer ≥ 1. A k-linear functor M 7→ M ♯ ,
C− → C is said to be n-periodic if (♯)n : C −→ C is the identity functor. Assuming
that such a functor is given we define a new k-linear category C♯ as follows. The
objects of C♯ are pairs (A, φ) where A ∈ C and φ : A♯ −   → A is an isomorphism in
C such that the composition
                                   n−1                  n−2
                          n   φ♯           n−1     φ♯               φ
                       A♯ −−−−→ A♯                             → A♯ −
                                                   −−−−→ . . . −    →A

is the identity map of A. Let (A, φ), (A′ , φ′ ) be two objects of C♯ . We define a
k-linear map HomC (A, A′ ) −      → HomC (A, A′ ) by f 7→ f ! := φ′ f ♯ φ−1 . Note that the
n-th iteration of ! applied to f is 1. By definition, HomC♯ ((A, φ), (A′, φ′ )) = {f ∈
HomC (A, A′ ); f = f ! }, a k-vector space. The direct sum of two objects (A, φ),
(A′ , φ′ ) is (A ⊕ A′ , φ ⊕ φ′ ). Clearly, if (A, φ) ∈ C♯ , then (A, ζφ) ∈ C♯ for any ζ ∈ k
66                                        G. LUSZTIG

such that ζ n = 1. An object (A, φ) of C♯ is said to be traceless if there exists an
object B of C, an integer t ≥ 2 dividing n and an isomorphism
                                                                 t−1
                             A∼
                              = B ⊕ B♯ ⊕ . . . ⊕ B♯

under which φ corresponds to an isomorphism
                                          t−1   ∼                            t−1
                  B ⊕ B♯ ⊕ . . . ⊕ B♯           −→ B ⊕ B ♯ ⊕ . . . ⊕ B ♯
                                      j                                  j
which carries the summand of B ♯ onto the summand B ♯ for 1 ≤ j ≤ t − 1) and
                  t
the summand B ♯ onto the summand B.
   Let O be the subring of k consisting of all Z-linear combinations of n-th roots
of 1. We associate to C and ♯ an O-module K♯ (C). By definition K♯ (C) is the
O-module generated by symbols [B, φ] one for each isomorphism class of objects
(B, φ) of C♯ subject to the following relations:
   (a) [B, φ] + [B ′ , φ′ ] = [B ⊕ B ′ , φ ⊕ φ′ ];
   (b) [B, φ] = 0 if (B, φ) is traceless;
   (c) [B, ζφ] = ζ[B, φ] if ζ ∈ k satisfies ζ n = 1.
16.2. Let W̃ , S̃ be a Coxeter group. (The set S̃ of simple reflections of W̃ is
assumed to be finite.) We view S̃ as a subset of W̃ . For any I ⊂ S̃ we denote by
W̃I the subgroup of W̃ generated by I. Let ˜l : W̃ −    → N be the length function
of W̃ . Let ≤ be the standard partial order on W̃ . Let ι : W̃ −          → W̃ be an
automorphism such that ι(S̃) = S̃. We fix an integer n ≥ 1 such that ιn = 1.
Let W = {w ∈ W̃ ; ι(w) = w}. Let S be the set of ι-orbits I on S̃ such that
W̃I is finite; for such I let w0I be the longest element of W̃I (note that w0I ∈ W ).
According to Theorems A.8 and A.9 in the Appendix, W is a Coxeter group on
the set of generators {w0I ; I ∈ S} and the restriction of ˜l to W is a weight function
L:W −    → N. Let l : W −   → N be the length function of W, S. We then say that
W, L is in the quasisplit case. We define

                             H, Tx , cx , py,x , fx,y,z , hx,y,z

in terms of W, S, L as in 3.2, 5.2, 5.3 (here x, y, z ∈ W ). Let

                             H̃, T̃x , c̃x , p̃y,x , f˜x,y,z , h̃x,y,z

be the analogous objects defined in terms of W̃ , S̃, ˜l (here x, y, z ∈ W̃ ).
   Let hR be a reflection representation of W̃ over the real numbers R, as in [EW,
1.1]; for any s ∈ S̃ we fix a linear form αs : hR −  → R whose kernel is equal to
the fixed point set of s : hR −
                              → hR . Let h = C ⊗R h; we extend αs to a C-linear
function h −→ C denoted again by αs . Let R be the algebra of polynomial functions
h−→ C with the Z-grading in which linear functions h −      → C have degree 2. Note
that W̃ acts naturally on R; we write this action as w : r 7→ w r and for s ∈ S̃ we set
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                            67

Rs = {r ∈ R; s r = r}, a subalgebra of R. Let R>0 = {r ∈ R; r(0) = 0}. We can
assume that there exists a C-linear map ξ 7→ ι(ξ) of the dual space of h into itself
whose n-th power is 1 and is such that ι(wξ) = ι(w)(ι(ξ)) for w ∈ W, x ∈ h and
such that ι(αs ) = αι(s) for s ∈ S̃. It induces an algebra automorphism r 7→ ι(r) of
R.
   Let R be the category whose objects are Z-graded (R, R)-bimodules in which for
M, M ′ ∈ R, HomR (M, M ′ ) is the space of homomorphisms of (R, R)-bimodules
M−  → M ′ compatible with the Z-gradings. For M ∈ R and n ∈ Z, the shift M [n]
is the object of R equal in degree i to M in degree i + n. For M, M ′ in R we set
M M ′ = M ⊗R M ′ ; this is naturally an object of R. For M, M ′ in R we set
                         M ′M = ⊕n∈Z HomR (M, M ′ [n]),
viewed as an object of R with (rf )(m) = f (rm), (f r)(m) = f (mr) for m ∈
M, f ∈ M ′M , r ∈ R. For any M ∈ R we set M = M/M R>0 = M ⊗R C where C
is identified with R/R>0 . We view M as a Z-graded C-vector space.
    For s ∈ S̃ let Bs = R ⊗Rs R[1] ∈ R. More generally, for any x ∈ W̃ , Soergel [So,
6.16] shows that there is an object Bx of R (unique up to isomorphism) such that
Bx is an indecomposable direct summand of Bs1 Bs2 . . . Bsq for some/any reduced
expression w = s1 s2 . . . sq (si ∈ S̃) and such that Bx is not a direct summand of
Bs′1 Bs′2 . . . Bs′p whenever s′1 , . . . , s′p ∈ S̃, p < q.
    Let C̃ be the full subcategory of R whose objects are isomorphic to finite direct
sums of shifts of objects of the form Bx for various x ∈ W̃ . Let C be the full
subcategory of R whose objects are isomorphic to finite direct sums of objects of
the form Bx for various x ∈ W̃ .
    Let x ∈ W̃ . From [EW] it follows that HomR (Bx , Bx ) = C and from [So, 6.16]
it follows that dim RxBx          = 1. Thus, as noted in [LV, 2.2], RxBx ⊗C Bx is an
                        l(x)                                        l(x)
object of C isomorphic to Bx and defined up to unique isomorphism (even though
Bx was defined only up to non-unique isomorphism). From now on we will use
the notation Bx for this new object; this agrees with the earlier description of Bs .
   From [So] it follows that for M, M ′ ∈ C̃ we have M M ′ ∈ C̃. For any x ∈ W̃
let Rx be the object of R such that Rx = R as a left R-module and such that for
m ∈ Rx , r ∈ R we have mr = (x r)m. The following result appears in [So, 6.15]:
   (a) For any M ∈ C̃, RxM is a finitely generated graded free right R-module;
hence dimC RxM < ∞.
We regard K(C̃) as an A-module by v n [M ] = [M [−n]] for M ∈ C̃, n ∈ Z. Note
that K(C̃) is an associative A-algebra with product defined by [M ][M ′ ] = [M M ′ ]
for M ∈ C̃, M ′ ∈ C̃. From [So, 1.10, 5.3] we see that
   (b) the assignment M 7→ y∈W,i∈Z dim RyM ) v −i+l̃(y) Ty defines an A-algebra
                              P
                                                     i
                        ∼
isomorphism χ : K(C̃) −→ H̃.
From [EW, Theorem 1.1] it follows that for x ∈ W̃ we have
(c)                                 χ(Bx ) = c̃x .
68                                         G. LUSZTIG

16.3. For M ∈ R let M ♯ be the object of R which is equal to M as a graded
C-vector space, but left (resp. right) multiplication by r ∈ R on M ♯ equals left
(resp. right) multiplication by ι(r) on M . If f : M1 −   → M2 is a morphism in R
                                                 ♯        ♯
then f can be also viewed as a morphism M1 −         → M2 in R. Clearly, M 7→ M ♯
is a C-linear n-periodic functor R −   → R. Hence R♯ is well defined, see 16.1. If
M1 , M2 ∈ R then the identity maps gives an identification M1♯ M2♯ = (M1 M2 )♯ as
objects in R.
                                                                 ∼
    Let s ∈ S̃. We define a C-linear isomorphism ωs : Bs [−1] −→ Bι(s) [−1] given
by x ⊗Rs y 7→ ι(x) ⊗Rι(s) ι(y) for x, y ∈ R. We have ωs (rf r ′ ) = ι(r)ωs (f )ι(r ′ )
                                                                                 ∼
for r, r ′ ∈ R, f ∈ Bs [−1]. Hence ωs can be viewed as an isomorphism Bs [−1] −→
  ♯                                          ∼     ♯
Bι(s) [−1] in R or as an isomorphism Bs −→ Bι(s)       in R. Now let x ∈ W̃ and let
s1 s2 . . . sn be a reduced expression for x. Since Bx is an indecomposable direct
summand of Bs1 Bs2 . . . Bsn (and n is minimal with this property) we see that Bx♯
is an indecomposable direct summand of

        (Bs1 Bs2 . . . Bsn )♯ = Bs♯1 Bs♯2 . . . Bs♯n ∼
                                                     = Bι−1 (s1 ) Bι−1 (s2 ) . . . Bι−1 (sn )

(and n is minimal with this property) hence by [So, 6.16] we have

(a)                                      Bx♯ ∼
                                             = Bι−1 (x) .

. In particular we have Bx♯ ∈ C̃. It follows that M ∈ C =⇒ M ♯ ∈ C and
M ∈ C̃ =⇒ M ♯ ∈ C̃. Note that M 7→ M ♯ are C-linear, n-periodic functors
C −→ C and C̃ −   → C̃. Hence C♯ , C̃♯ are defined as in 16.1 and K♯ (C), K♯ (C̃) are
well defined O-modules.
   Now if x ∈ W then from (a) we have that there exists an isomorphism φ :
  ♯ ∼
Bx −→ Bx in C. Replacing φ by cφ for a suitable c ∈ C∗ we can assume that
(Bx , φ) ∈ C♯ . (We use that End(Bx ) = C, see [EW].)
16.4. For x ∈ W̃ we define fx : Rx♯ −      → Rι−1 (x) by r 7→ ι−1 (r). This is an
isomorphism in R. Now assume that x ∈ W ; then fx : Rx♯ −  → Rx and (Rx , fx) ∈ R♯ ;
thus, (Rx [i], fx[i]) ∈ R♯ for any i ∈ Z. Hence, if (M, φ) ∈ C̃♯ and i ∈ Z, then
f 7→ f ! , HomR (M, Rx [i]) −
                            → HomR (M, Rx [i]) is defined as in 16.1. Taking direct
sum over i ∈ Z we obtain a map f 7→ f ! , RxM −  → RxM whose n-th iteration is 1.
Since R>0 is ι-stable we see that f 7→ f ! maps RxM R>0 into iself hence it induces
an C-linear map RxM −   → RxM and (for any i) an C-linear map RxM − → RxM (whose
                                                                  i        i
                                 M
n-th power is 1), denoted by Zx,φ,i  . Let

                            ǫxi (M, φ) = trC (Zx,φ,i
                                               M
                                                     , RxM ) ∈ O.
                                                               i

We now take M = Bx (still assuming x ∈ W ) so that (Bx , φ) ∈ C♯ for some φ.
Then RxBx l̃(x) = C hence ǫxl̃(x) (Bx , φ) is an n-th root of 1 in C. We can normalize
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                      69

φ : Bx♯ −
        → Bx uniquely so that ǫxl̃(x) (Bx , φ) = 1. We shall denote this normalized φ
by φx .
   Next we note that if x, x′ ∈ W̃ then by [EW], HomR (Bx′ , Bx ) is C if x = x′
and is 1 if x 6= x′ . It follows that C is a semisimple abelian category and the Bx
are its simple objects. Using this and [L12, 11.1.8] we deduce that
   (a) K♯ (C) is the free O-module with basis {[Bx , φx ]; x ∈ W̃ }.
16.5. Let O′ = O[v, v −1 ] where v is an indeterminate. We view Kσ (C̃) as an O′ -
module with v n [M, φ] = [M [−n], φ] for (M, φ) ∈ C̃♯ , n ∈ Z. We have the following
result.
    (a) The O′ -linear map q : O′ ⊗O K♯ (C) −   → K♯ (C̃) given by v n ⊗ [M, φ] 7→
[M [−n], φ] is an isomorphism.
The map q is clearly well defined. To prove that it is surjective we shall use the
functors M 7→ τ≤i M from C̃ to C̃ (resp. M 7→ Hi M from C̃ to C) defined in
[EW, 6.2]. (Here i ∈ Z.) These define in an obvious way functors C̃♯ −  → C̃♯ (resp.
                                          i
C̃♯ −→ C♯ ) denoted again by τ≤i (resp. H ). Let (M, φ) ∈ C̃φ . From the definition
we have an exact sequence in C̃ (with morphisms in C̃♯ )

                                         e          e′
                        0−         → τ≤i M −→ Hi M [−i] −
                         → τ≤i−1 M −                    →0

which is split but the splitting is not necessarily given by morphisms in C̃♯ . Thus
there exist morphisms

                                         f          f′
                                     − τ≤i M ←− Hi M [−i]
                             τ≤i−1 M ←

in C̃ such that e′ f ′ = 1, f e = 1, f ′ e′ +ef = 1. Now f ! , f ′! are defined as in 1.1 and,
since e! = e, e′! = e′ (notation of 16.1), we have e′ f ′! = 1, f ! e = 1, f ′! e′ + ef ! = 1
hence, setting f˜ = (f + f ! + (f 1 )! + . . . )/n, f˜′ = (f ′ + f ′! + (f ′! )! + . . . )/n (the
last two sums have n terms) we have e′ f˜′ = 1, f˜e = 1, f˜′ e′ + ef˜ = 1 and f˜! = f˜,
f˜′! = f˜′ . Thus we obtain a new splitting of the exact sequence above which is
given by morphisms in C̃♯ . It follows that

                        (τ≤i M, φ) ∼
                                   = (τ≤i−1 M, φ) ⊕ (Hi M [−i], φ)

in C̃♯ (the maps φ are induced by M ♯ −   → M ). Hence [τ≤i M, φ] = [τ≤i−1 M, φ] +
   i
[H M [−i], φ] in K♯ (C̃). Since P[M, φ] = [τ≤i M, φ] for ig0 and 0 = [τ≤i M, φ] for
−ig0 we deduce that [M, φ] = i [Hi M [−i], φ]. This proves the surjectivity of q.
                      → O′ ⊗ K(C♯ ) by [M, φ] 7→ n∈Z v −n [Hn M, φn ] where φn
                                                      P
    We define K(C̃♯ ) −
is induced by φ. This clearly induces a homomorphism q ′ : K♯ (C̃) −   → A ⊗ K♯ (C)
                 ′
which satisfies q q = 1. It follows that q is injective, completing the proof of (a).
   Using (a) and 16.4(a) we see that
   (b) K♯ (C̃) is a free O′ -module with basis {[Bx , φx ]; x ∈ W }, (notation of 16.4).
70                                       G. LUSZTIG

16.6. Let N be the free O′ -module with basis {bx ; x ∈ W }. For any (M, φ) ∈ C̃♯
and any y ∈ W we set

                                               ǫyi (M, φ)v −i ∈ O′ .
                                         X
                           ǫy (M, φ) =
                                         i∈Z


The homomorphism K(C̃♯ ) −
                         → N,
                                         X
                             [M, φ] 7→         ǫy (M, φ)v l̃(y) by ,
                                         y∈W


clearly factors through an O′ -module homomorphism

(a)                                  χ′ : K♯ (C̃) −
                                                  → N.

We show:

(b)                                χ′ is an isomorphism.

For x ∈ W let b̃x = χ′ ([Bx , φx ]). We can write b̃x = y∈W fy,x by where fy,x ∈ O′
                                                            P

are zero for all but finitely many y. In view of 16.5(b), to prove (b) it is enough
to show:
    (c) Let y ∈ W . If y 6≤ x then fy,x = 0. If y ≤ x then fy,x = ṗy,x (v) where
ṗx,x = 1 and ṗy,x ∈ v −1 O[v −1 ] if y < x.
Assume that fy,x 6= 0. Then for some i we have ǫyi (Bx , φx ) 6= 0 hence RyBx 6=
0. Using 16.4(b),(c), we deduce that the coefficient of Ty in cx is nonzero; thus
we have y ≤ x, as required. Next we assume that y ≤ x. We have fy,x =
P y                 −i+l̃(y)
   i ǫi (Bx , φx )v          hence it is enough to show that
    ǫi (Bx , φx ) 6= 0 implies −i + ˜l(y) ≤ 0, with strict inequality unless x = y.
     y

Now ǫyi (Bx , φx ) 6= 0 implies RyBx 6= 0. Hence it is enough to show that
                                        i
    R Bx                        ˜
          6= 0 implies −i + l(y) ≤ 0, with strict inequality unless x = y.
      y
          i
By 16.2(b),(c), we have
                            X
                                  dim RyBx u−j+l̃(y) = p̃y,x (u)
                                           j
                            j∈Z


and it remains to use that p̃x,x = 1 and p̃y,x ∈ v −1 Z[v −1 ] if y < x. This proves (c)
hence also (b).
16.7. If (M, φ) ∈ C̃♯ and (M ′ , φ′ ) ∈ C̃♯ then (M M ′ , φ⊗φ′ ) is again an object of C̃♯ .
Note that if (M, φ) or (M ′ , φ′ ) is traceless then (M M ′ , φ ⊗ φ′ ) is again traceless.
It follows easily that ((M, φ), (M ′, φ′ )) 7→ (M M ′ , φ ⊗ φ′ ) defines an O′ -bilinear
                      → K♯ (C̃) which makes K♯ (C̃) into an associative O′ -algebra
map K♯ (C̃) × K♯ (C̃) −
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                      71

with 1. (The unit element is [B1 , φ1 ].) Via the isomorphism 16.6(a),(b), we obtain
an associative O′ -algebra structure (with 1 = b1 ) on N . One can show that the
following identities hold in the algebra N :

(a)                bw b′w = bww′ if w, w′ ∈ W, l(ww′ ) = l(w) + l(w′ );

                                 I                      I
(b)                 (bw0I − v l̃(w0 ) )(bw0I + v −l̃(w0 ) ) = 0 for any I ∈ S.

Thus N can be identified with the O′ -algebra O′ ⊗A H where H is as in 16.2 in
such a way that bw corresponds to Tw ∈ H for any w ∈ W .
16.8. For M ∈ C̃ let D(M ) ∈ C̃ be the “dual” of M defined as in [So, 5.9].
Now (M, φ) 7→ (D(M ), D(φ)−1 ) induces a ring homomorphism¯: K♯ (C̃) −     → K♯ (C̃)
which maps [Bx , φx ] to itself for any x ∈ W and is semilinear with respect to the
ring involution ¯: O′ −  → O′ given by v n 7→ v −n and ζ 7→ ζ −1 for any ζ ∈ O such
that ζ n = 1. Via the isomorphism 16.6(a),(b), this becomes an O′ -semilinear ring
homomorphism ¯ : N −     → N such that b̃x = b̃x for any x ∈ W . From the results
in 16.6 for any I ∈ S we have b̃w0I = bw0I + zI where zI ∈ v −1 O[v −1 ] satisfies
bw0I + zI = bw0I + zI that is bw0I = bw0I + zI − zI . Applying ¯ to the equation
b2wI = (v n − v −n )βw0I + 1 where n = ˜l(w0I ) (see 16.7(b)) we obtain
   0


                   (bw0I + zI − zI )2 = (v −n − v n )(bw0I + zI − zI ) + 1

hence

 (v n − v −n )bw0I + 1 + 2(zI − zI )bw0I + (zi − zI )2 = (v −n − v n )(bw0I + zI − zI ) + 1.

We deduce that zI − zI = v −n − v n that is zI − v −n = zI − v −n . Since n > 0 we
have zI − v −n ∈ O[v −1 ] hence zI − v −n = 0. Thus we have
                                                                  I
                                     b̃w0I = bw0I + v −l̃(w0 ) .

Since this holds for every I ∈ S we see that under our identification N = O′ ⊗A H,
¯: N −
     → N corresponds to¯: H −     → H (as in 4.1) extended semilinearly to O′ ⊗A H.
For w ∈ W , both b̃w and cw are fixed by¯and (by results in 16.6) their difference is
in y∈W ;y<w v −1 Z[v −1 ]Ty ; it follows that b̃w = cw . In particular we have b̃w ∈ H.
   P

16.9. Let x, y ∈ W be such that y ≤ x and let n ∈ Z. We show:
      (a) If the coefficient of v n in py,x is 6= 0 then the coefficient of v n in p̃y,x is 6= 0;
      (b) if the coefficient of v n in p̃y,x is 1 then the coefficient of v n in py,x is ±1.
In the setup of (a), the coefficient of v n in fy,x is 6= 0 (notation of 16.6). Hence
ǫyl̃(y)−n (Bx , φx ) 6= 0 (see 16.6) so that

                                   Bx
                             trC (Zy,φ                , RyBx             ) 6= 0
                                         x ,l̃(y)−n            l̃(y)−n
72                                       G. LUSZTIG

(notation of 16.4); in particular we have RyM                   6= 0. From 16.2(b) we see that
                                                      l̃(y)−n
v n appears in the coefficient of Ty in χ(Bx ) with 6= coefficient; from 16.2(c) we
deduce that v n appears in p̃y,x with 6= coefficient. This proves (a).
   In the setup of (b), using 16.2(b),(c) we see that dim RyM          = 1. Hence
                                                                             l̃(y)−n
                                 Bx
(with notation of 16.4),   trC (Zy,φ            , RyBx         )   is the trace of a linear trans-
                                     x ,l̃(y)−n        l̃(y)−n
formation of finite order of a one dimensional vector space so that it is a root of 1.
Thus, ǫyl̃(y)−n (Bx , φx )0 is a root of 1 so that by 16.6, the coefficient of v n in fx,y
is a root of 1 and the coefficient of v n in py,x is a root of 1. Since py,x has integer
coefficients, the coefficient of v n in py,x is ±1. This proves (b).
16.10. Let x, y, z in W and let n ∈ Z. We form (Bx By , φx ⊗φy ) ∈ C̃♯ . Now φx ⊗φy
induces an isomorphism ψn : (Hn (Bx By ))♯ −       → Hn (Bx By )) so that (Hn (Bx By ), ψn ) ∈
                                   n
 C̃♯ (notation of 16.5). Let Vx,y,z     = HomR (Bz , Hn (Bx By )). We can find a linear
 isomorphism θ : Vn −   → Vn of finite order such that under the obvious imbedding
   n                n
 Vx,y,z ⊗ Bz −→ H (Bx By ), θ ⊗ φz is compatible with ψn . From the definitions, the
 coefficient of v n in hx,y,z is equal to tr(θ, Vx,y,z
                                                    n
                                                       ). We show:
    (a) If the coefficient of v in hx,y,z is 6= 0 then the coefficient of v n in h̃x,y,z is
                                 n

6= 0;
    (b) if the coefficient of v n in h̃x,y,z is 1 then the coefficient of v n in hx,y,z is ±1.
                                          n                   n
In the setup of (a) we have tr(θ, Vx,y,z       ) 6= 0 hence Vx,y,z  6= 0. Thus Bz appears
                                      n
with nonzero multiplicity in H (Bx By ). From the definitions we see that the
coefficient of v n in h̃x,y,z is 6= 0. Thus (a) holds.
                                             n                      n          n
    In the setup of (b) we have dim Vx,y,z        = 1. Since θ : Vx,y,z  −
                                                                         → Vx,y,z   has finite
order, it follows that tr(θ, Vx,y,z ) is a root of 1. Hence the coefficient of v n in hx,y,z
                                 n

is a root of 1; but that coefficient is an integer hence it is ±1. Thus (b) holds.
16.11. We show that for x, y, z in W we have

(a)                               v −L(z) hx,y,z ∈ Z[v −1 ].

We must show that if n ∈ Z and the coefficient of v n in hx,y,z is 6= 0 then n ≤ L(z).
By 16.10(a), the coefficient of v n in h̃x,y,z is 6= 0; hence by 15.2(b) (applied to W̃ , ˜l)
we have n ≤ ˜l(z) that is n ≤ L(z), as required. Using (a) we see that definition of
a(z) ∈ N, ∆(z) ∈ N (relative to L) and γx,y,z ∈ Z (for x, y, z in W ) and D as in
§13 makes sense for W, L even without the assumption that W, L is bounded. We
                        ˜
shall denote by ã(z), ∆(z),   γ̃x,y,z (for x, y, z in W̃ ) and D̃ the analogous objects
                         ˜
defined in terms of W̃ , l, see 15.2.
    We now make the additional assumption that W̃ , ˜l is bounded. We show:
    (b) W, L is bounded.
By assumption there exists N ≥ 0 such that for all x, y, z in W̃ we have v −N h̃x,y,z ∈
Z[v −1 ]. In particular, if x, y, z ∈ W and n is such that the coefficient of v n in
h̃x,y,z is nonzero then n ≤ N ; using 16.10(a) we deduce that, if x, y, z ∈ W and
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                      73

n is such that the coefficient of v n in hx,y,z is nonzero then n ≤ N , so that
v −N hx,y,z ∈ Z[v −1 ]. This proves (b).
   Under the assumption that W̃ , ˜l is bounded, the results of §15 are applicable to
W̃ , ˜l; in this chapter we will show that, under the same assumption, P1-P15 hold
for W, L.
                                                ˜
Lemma 16.12. For z ∈ W we have a(z) = ã(z) and ∆(z) ≤ ∆(z).
   We can find x, y ∈ W such that πa(z) (hx,y,z ) 6= 0. By 16.10(a) we have
πa(z) (h̃x,y,z ) 6= 0. Hence a(z) ≤ ã(z). By P3,P5 for W̃ , there is a unique d ∈ D̃
such that γ̃z −1 ,z,d = ±1. The uniqueness of d implies that d is fixed by u. Thus
d ∈ W . By P7 for W̃ , we have γ̃z,d,z −1 = ±1. Hence πã(z) (h̃z,d,z ) = ±1. By
16.10(b), we have πã(z) (hz,d,z ) = ±1. Hence ã(z) ≤ a(z) so that ã(z) = a(z).
   By definition, we have π−∆(z) (p1,z ) 6= 0. Using 16.9(a), we deduce that
                                        ˜
π−∆(z) (p̃1,z ) 6= 0. Hence −∆(z) ≤ −∆(z).    The lemma is proved.
Lemma 16.13. We have D = D̃ ∩ W .
   Let d ∈ D. We have a(d) = ∆(d). Using 16.12, we deduce ã(d) = ∆(d). By
                               ˜
P1 for W̃ , we have ã(d) ≤ ∆(d).    Hence ∆(d) ≤ ∆(d). ˜     Using 16.12, we deduce
         ˜             ˜
∆(d) = ∆(d) so that ∆(d) = ã(d) and d ∈ D̃.
   Conversely, let d ∈ D̃ ∩ W . We have ã(d) = ∆(d).   ˜      Using 16.12 we deduce
        ˜
a(d) = ∆(d).    By P5 for W̃ , we have π−∆(d)
                                         ˜    (p̃1,d ) =  ±1. Using 16.9(b) we deduce
π−∆(d)
   ˜
                               ˜
       (p1,d ) = ±1. Hence −∆(d)    ≤ −∆(d). Using 16.12 we deduce ∆(d) = ∆(d)   ˜
so that ∆(d) = a(d) and d ∈ D. The lemma is proved.
Lemma 16.14. (a) Let x, y, z ∈ W be such that γx,y,z 6= 0. Then γ̃x,y,z 6= 0.
  (b) Let x, y, z ∈ W be such that γ̃x,y,z = ±1. Then γx,y,z = ±1.
    In the setup of (a) we have πa(z −1 ) (hx,y,z −1 ) 6= 0. Using 16.12 we deduce that
πã(z −1 ) (hx,y,z −1 ) 6= 0. Using 16.10(a), we deduce that πã(z −1 ) (h̃x,y,z −1 ) 6= 0. Hence
γ̃x,y,z 6= 0.
    In the setup of (b) we have πã(z −1 ) (h̃x,y,z −1 ) = ±1. Using 16.12, we deduce
πa(z −1 ) (h̃x,y,z −1 ) = ±1. Using 16.10(b), we deduce πa(z −1 ) (hx,y,z −1 ) = ±1. Hence
γx,y,z = ±1.
                                                                    ˜
16.15. Proof of P1. By 16.12 and P1 for W̃ , we have a(z) = ã(z) ≤ ∆(z) ≤ ∆(z),
hence a(z) ≤ ∆(z).
16.16. Proof of P2. In the setup of P2, we have (by 16.14) γ̃x,y,d 6= 0 and d ∈ D̃
(see 16.13). Using P2 for W̃ , we deduce x = y −1 .
16.17. Proof of P3. Let y ∈ W . By P3 for W̃ , there is a unique d ∈ D̃ such that
γ̃y−1 ,y,d 6= 0. By the uniqueness of d, we have u(d) = d hence d ∈ W . Using P5 for
W̃ , we see that γ̃y−1 ,y,d = ±1. Using 16.14, we deduce γy−1 ,y,d = ±1. Since d ∈ D
by 16.13, the existence part of P3 is established. Assume now that d′ ∈ D satisfies
74                                        G. LUSZTIG

γy−1 ,y,d′ 6= 0. Using 16.14, we deduce γ̃y−1 ,y,d′ 6= 0. Since d′ ∈ D̃ by 16.13, we can
use the uniqueness in P3 for W̃ to deduce that d = d′ . Thus P3 holds for W .
16.18. Proof of P4. We may assume that there exists s ∈ S such that hs,z,z ′ 6= 0
or hz,s,z ′ 6= 0. In the first case, using 16.10(a), we deduce h̃s,z,z ′ 6= 0. Hence
z ′ ≤L z (in W̃ ) and using P4 for W̃ , we deduce that ã(z ′ ) ≥ ã(z). Using now
16.12, we see that a(z ′ ) ≥ a(z). The proof in the second case is entirely similar.
16.19. Now P5 is proved as in 14.5; P6 is proved as in 14.6; P7 is proved as in
14.7; P8 is proved as in 14.8; P12 is proved as in 14.12.
16.20. Proof of P13. If z ′ ←L z in W , then there exists s ∈ S such that hs,z,z ′ 6= 0
hence, by 16.10(a), h̃s,z,z ′ 6= 0, hence z ′ ≤L z in W̃ . It follows that
   (a) z ′ ≤L z (in W ) implies z ′ ≤L z (in W̃ ).
Hence
   (b) z ′ ∼L z (in W ) implies z ′ ∼L z (in W̃ ).
Thus any left cell of W is contained in a left cell of W̃ .
   In the setup of P13, let Γ̃ be the left cell of W̃ containing Γ. Let x ∈ Γ. By P3
for W , there exists d ∈ D such that γx−1 ,x,d 6= 0. By P8 for W , we have x ∼L d−1
hence d−1 ∈ Γ. Using P6 we have d = d−1 , hence d ∈ Γ. It remains to prove the
uniqueness of d. Let d′ , d′′ be elements of D ∩ Γ. We must prove that d′ = d′′ .
Now d′ , d′′ belong to Γ̃ and, by 16.13, are in D̃. Using P13 for W̃ , it follows that
d′ = d′′ . Thus P13 holds for W .
Lemma 16.21. Let x, y ∈ W . We have x ∼L y (in W ) if and only if x ∼L y (in
W̃ ).
   If x ∼L y (in W ) then x ∼L y (in W̃ ), by 16.20(b).
   Assume now that x ∼L y (in W̃ ). Let d, d′ ∈ D be such that x ∼L d (in W )
and y ∼L d′ (in W ); see P13. By the first line of the proof we have x ∼L d (in
W̃ ) and y ∼L d′ (in W̃ ). Hence d ∼L d′ (in W̃ ). Since d, d′ ∈ D̃, we deduce (using
P13 for W̃ ) that d = d′ . It follows that x ∼L y (in W ). The lemma is proved.
16.22. Proof of P9. We assume that z ′ ≤L z (in W ) and a(z ′ ) = a(z). By
16.20(a), it follows that z ′ ≤L z (in W̃ ) and, using 16.12, that ã(z ′ ) = ã(z). Using
now P9 in W̃ , it follows that z ′ ∼L z (in W̃ ). Using 16.21, we deduce that z ′ ∼L z
(in W ).
16.23. Now P10 is proved as in 14.10; P11 is proved as in 14.11; P14 is proved
as in 14.14.
16.24. We sketch a proof of P15 in our case.
   A refinement of the proof of P15 given in 14.15, 15.7 provides, for any w, y, x, x′
in W̃ and any k, an isomorphism of vector spaces
                             ′                  ∼                                     ′
                          j            j                              j          j
       ⊕j+j ′ =k ⊕y′ ∈W̃ Vw,x′ ,y ′ ⊗ Vx,y ′ ,y −
                                                → ⊕j+j ′ =k ⊕y′ ∈W̃ Vx,w,y ′ ⊗ Vy ′ ,x′ ,y .
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                          75

which (assuming that ã(w) = ã(y)) restricts to an isomorphism
                                   ′             ∼                           ′
                            j             j                  j           j
                   ⊕y′ ∈W̃ Vw,x′ ,y ′ ⊗ Vx,y ′ ,y −
                                                  → ⊕y′ ∈W̃ Vx,w,y ′ ⊗ Vy ′ ,x′ ,y


for any j, j ′ such that j + j ′ = k.
   Assuming now that w, y, x, x′ ∈ W , we can take traces of u in both sides; we
deduce          X                                     X
                    πj ′ (hw,x′ ,y′ )πj (hx,y′ ,y ) =   πj (hx,w,y′ )πj ′ (hy′ ,x′ ,y )
               y ′ ∈W                                y ′ ∈W

(the summands corresponding to y ′ ∈ W̃ − W do not contribute to the trace) or
equivalently       X                         X
                       h′w,x′ ,y′ hx,y′ ,y =   hx,w,y′ h′y′ ,x′ ,y ,
                          y ′ ∈W                     y ′ ∈W

as required.

                        17. Example: the infinite dihedral case
17.1. In this chapter we preserve the setup of 7.1. We assume that m = ∞ and
that L2 > L1 . We will show that P1-P15 hold in this case.
   Let ζ = v L2 −L1 + v L1 −L2 . For a ∈ {1, 2}, let fa = v La + v −La . For m, n ∈ Z
we define δm<n to be 1 if m < n and to be 0 otherwise.
17.2. From 7.5, 7.6 we have for all k ′ ∈ N:
  c1 c2k′ = c1k′ +1 ,
  c2 c1k′ = c2k′ +1 + δk′ >1 ζc2k′ −1 + δk′ >3 c2k′ −3 .
                                  ′
Proposition 17.3. For P k ≥ 0, k ≥ 1 we have
  (a) c22k+1 c2k′ = f2 u∈[0,k];2u≤k′ −1 c22k+k′ −4u ,
                      P
  (b) c12k+2 c2k′ = f2 u∈[0,k];2u≤k′ −1 c12k+k′ +1−4u .
  Assume that k = 0. Using 17.2 we have c2 c2k′ = f2 c2k′ .
  Assume now that k = 1. Using 17.2, we have c23 = c2 c1 c2 − ζc2 . Using this
and 17.2, we have
     c23 c2k′ = c2 c1 c2 c2k′ − ζc2 c2k′ = f2 c2 c1k′ +1 − f2 ζc2k′
     = f2 c2k′ +2 + f2 ζc2k′ + δk′ >2 f2 c2k′ −2 − f2 ζc2k′ = f2 c2k′ +2 + δk′ >2 f2 c2k′ −2 ,
as required. We prove the equality in (a) for fixed k ′ , by induction on k. The
cases k = 0, 1 are already known. If k = 2 then using 17.2, we have c25 =
c2 c1 c23 − ζc23 − c21 . Using this, 17.2, and the induction hypothesis, we have
  c25 c2k′ = c2 c1 c23 c2k′ − ζc23 c2k′ − c21 c2k′
  = f2 c2 c1 c2k′ +2 + δk′ >2 f2 c2 c1 c2k′ −2 − ζf2 c2k′ +2 − δk′ >2 ζf2 c2k′ −2 − f2 c2k′
  = f2 c2 c1k′ +3 + δk′ >2 f2 c2 c1k′ −1 − ζf2 c2k′ +2 − δk′ >2 ζf2 c2k′ −2 − f2 c2k′
  = f2 c2k′ +4 + f2 ζc2k′ +2 + f2 c2k′ + δk′ >2 f2 c2k′ + δk′ >2 f2 ζc2k′ −2 + δk′ >4 f2 c2k′ −4
  − ζf2 c2k′ +2 − δk′ >2 ζf2 c2k′ −2 − f2 c2k′ = f2 c2k′ +4 + δk′ >2 f2 c2k′ + δk′ >4 f2 c2k′ −4 ,
76                                          G. LUSZTIG

as required. A similar argument applies for k ≥ 3. This proves (a).
   (b) is obtained by multiplying both sides of (a) by c1 on the left. The proposition
is proved.


Proposition 17.4. For k ≥ 0, k ′ ≥ 1, we have
                    P
  (a) c22k+1 c1k′ = u∈[0,2k+2] pu c2k′ +2k+1−2u ,
                    P
  (b) c12k+2 c1k′ = u∈[0,2k+2] pu c1k′ +2k+2−2u ,
                    P
  (c) c1−1′ c22k+1 = u∈[0,2k+2] pu c2−1′          ,
         k                            k +2k+1−2u
                    P
  (d) c1−1′ c1−1 = u∈[0,2k+2] pu c1−1′            ,
         k     2k+2                    k +2k+1−2u
                    P
  (e) c22k+2 c1k′ = u∈[0,2k+2] f1 pu c2k′ +2k+1−2u ,
                    P
  (f ) c12k+3 c1k′ = u∈[0,2k+2] f1 pu c1k′ +2k+2−2u ,
  (g) c11 c1k′ = f1 c1k′ ,
where
     p0 = 1, p2k+2 = δk′ >2k+3 ,
     pu = δk′ >u ζ for u = 1, 3, 5, . . . , 2k + 1,
     pu = δk′ >u−1 + δk′ >u+1 for u = 2, 4, 6, . . . , 2k.


    We prove (a). For k = 0 the equality in (a) is c2 c1k′ = c2k′ +1 + δk′ >1 ζc2k′ −1 +
δk′ >3 c2k′ −3 which is contained in 17.2. Assume now that k = 1. Using c23 =
c2 c1 c2 − ζc2 and 17.2, we have



c23 c1k′ = c2 c1 c2 c1k′ − ζc2 c1k′ = c2 c1 c2k′ +1 + δk′ >1 ζc2 c1 c2k′ −1 + δk′ >3 c2 c1 c2k′ −3
− ζc2k′ +1 − δk′ >1 ζ 2 c2k′ −1 − δk′ >3 ζc2k′ −3 = c2 c1k′ +2 + δk′ >1 ζc2 c1k′
+ δk′ >3 c2 c1k′ −2 − ζc2k′ +1 − δk′ >1 ζ 2 c2k′ −1 − δk′ >3 ζc2k′ −3
= c2k′ +3 + ζc2k′ +1 + δk′ >1 c2k′ −1 + δk′ >1 ζc2k′ +1 + δk′ >1 ζ 2 c2k′ −1 + δk′ >3 ζc2k′ −3
+ δk′ >3 c2k′ −1 + δk′ >3 ζc2k′ −3 + δk′ >5 c2k′ −5 − ζc2k′ +1 − δk′ >1 ζ 2 c2k′ −1 − δk′ >3 ζc2k′ −3
= c2k′ +3 + δk′ >1 ζc2k′ +1 + (δk′ >1 + δk′ >3 )c2k′ −1 + δk′ >3 ζc2k′ −3 + δk′ >5 c2k′ −5 ,



as required.
   We prove the equality in (a) for fixed k ′ , by induction on k. The cases k = 0, 1
are already known. Assume now that k = 2. Using c25 = c2 c1 c23 − ζc23 − c21 ,
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                             77

17.2, and the case k = 1, we have

c25 c1k′ = c2 c1 c23 c1k′ − ζc23 c1k′ − c21 c1k′
 = c2 c1 c2k′ +3 + δk′ >1 ζc2 c1 c2k′ +1 + (δk′ >1 + δk′ >3 )c2 c1 c2k′ −1 + δk′ >3 ζc2 c1 c2k′ −3
 + δk′ >5 c2 c1 c2k′ −5 − ζc2k′ +3 − δk′ >1 ζ 2 c2k′ +1 − (δk′ >1 + δk′ >3 )ζc2k′ −1
 − δk′ >3 ζ 2 c2k′ −3 − δk′ >5 ζc2k′ −5 − c2k′ +1 − δk′ >1 ζc2k′ −1 − δk′ >3 c2k′ −3
 = c2 c1k′ +4 + δk′ >1 ζc2 c1k′ +2 + (δk′ >1 + δk′ >3 )c2 c1k′ + δk′ >3 ζc2 c1k′ −2
 + δk′ >5 c2 c1k′ −4 − ζc2k′ +3 − δk′ >1 ζ 2 c2k′ +1 − (δk′ >1 + δk′ >3 )ζc2k′ −1
 − δk′ >3 ζ 2 c2k′ −3 − δk′ >5 ζc2k′ −5 − c2k′ +1 − δk′ >1 ζc2k′ −1 − δk′ >3 c2k′ −3
 = c2k′ +5 + ζc2k′ +3 + c2k′ +1 + δk′ >1 ζc2k′ +3 + δk′ >1 ζ 2 c2k′ +1 + δk′ >1 ζc2k′ −1
 + (δk′ >1 + δk′ >3 )c2k′ +1 + (δk′ >1 + δk′ >3 )ζc2k′ −1 + 2δk′ >3 c2k′ −3 + δk′ >3 ζc2k′ −1
 + δk′ >3 ζ 2 c2k′ −3 + δk′ >5 ζc2k′ −5 + δk′ >5 c2k′ −3 + δk′ >5 ζc2k′ −5 + δk′ >7 c2k′ −7
 − ζc2k′ +3 − δk′ >1 ζ 2 c2k′ +1 − (δk′ >1 + δk′ >3 )ζc2k′ −1 − δk′ >3 ζ 2 c2k′ −3 − δk′ >5 ζc2k′ −5
 − c2k′ +1 − δk′ >1 ζc2k′ −1 − δk′ >3 c2k′ −3
 = c2k′ +5 + δk′ >1 ζc2k′ +3 + (δk′ >1 + δk′ >3 )c2k′ +1 + δk′ >3 c2k′ −3 + δk′ >3 ζc2k′ −1
 + δk′ >5 c2k′ −3 + δk′ >5 ζc2k′ −5 + δk′ >7 c2k′ −7
 = c2k′ +5 + δk′ >1 ζc2k′ +3 + (δk′ >1 + δk′ >3 )c2k′ +1
 + δk′ >3 ζc2k′ −1 + (δk′ >3 + δk′ >5 )c2k′ −3 + δk′ >5 ζc2k′ −5 + δk′ >7 c2k′ −7 .

A similar argument applies for k ≥ 4. This proves (a).
  (b) is obtained by multiplying both sides of (a) by c1 on the left; (c),(d) are
obtained by applying h 7→ h♭ to both sides of (a),(b). We prove (e). We have

                          c22k+2 c1k′ = c22k+1 c1 c1k′ = f1 c22k+1 c1k′

and the last expression can be computed from (a). This proves (e). Similarly, (f)
follows from (b); (g) is a special case of 6.6. The proposition is proved.
17.5. From 7.4,7.6 we see that the function ∆ : W −     → N has the following values:
   ∆(22k ) = kL1 + kL2 ,
   ∆(22k+1 ) = −kL1 + (k + 1)L2 ,
   ∆(11 ) = L1 ,
   ∆(12k+1 ) = (k − 1)L1 + kL2 , if k ≥ 1,
   ∆(12k ) = kL1 + kL2 .
   It follows that P1 holds and that D consists of 20 = 10 , 21 , 11 , 13 . Thus, P6
holds.
   The formulas in 17.3, 17.4 determine hx,y,z for all x, y, z except when x = 1 or
y = 1, in which case h1,y,z = δy,z , hx,1,z = δx,z . From these formulas we see that
the triples (x, y, d) with d ∈ D, γx,y,d 6= 0 are:
78                                        G. LUSZTIG

   (22k+1 , 22k+1 , 21 ), (12k+2 , 22k+2 , 13 ), (11 , 11 , 11 ),
   (1, 1, 1), (22k+2 , 12k+2 , 21 ),(12k+3 , 12k+3 , 13 ),
where k ≥ 0. This implies that P2,P3 hold. From the results in 8.8 we see that
P4,P9,P13 hold. From 14.5 we see that P5 holds. From 14.7 we see that P7 holds.
From 14.8 we see that P8 holds. From 14.10 we see that P10 holds. From 14.11
we see that P11 holds. From 14.12 we see that P12 holds. From 14.14 we see that
P14 holds.
   We now verify P15 in our case. With the notation in 14.15, it is enough to show
that, if a, b ∈ {1, 2}, w ∈ W , sa w > w, wsb > w, then

                             (ca ew )c′b − ca (ew c′b ) ∈ H̃≥a(w)+1 .

Here ca = csa , c′b = c′sb . If a or b is 1, then from 17.2 we have (ca ew )c′b −ca (ew c′b ) =
0. Hence we may assume that a = b = 2 and w = 12k+1 . Using 17.2 we have

          c2 (e12k+1 c′2 ) = c2 (e12k+2 + δk>0 )ζ ′ e12k + δk>1 e12k−2
             = e22k+3 + ζe22k+1 + δk>0 e22k−1 + δk>0 ζ ′ e22k+1 + δk>0 ζζ ′ e22k−1
             + δk>1 ζ ′ e22k−3 + δk>1 e22k−1 + δk>1 ζe22k−3 + δk>2 e22k−5
             = e22k+3 + ζe22k+1 + δk>0 ζ ′ e22k+1 + δk>0 e22k−1 + δk>1 e22k−1
             + δk>0 ζζ ′ e22k−1 + δk>1 (ζ + ζ ′ )e22k−3 + δk>2 e22k−5 .

Similarly,

     (c2 e12k+1 )c′2 = e22k+3 + ζ ′ e22k+1 + δk>0 ζe22k+1 + δk>0 )e22k−1 + δk>1 e22k−1
     + δk>0 ζζ ′ e22k−1 + δk>1 (ζ + ζ ′ )e22k−3 + δk>2 e22k−5 .

Hence
                 c2 (e12k+1 c′2 ) − (c2 e12k+1 )c′2 = (ζ − ζ ′ )(1 − δk>0 )e22k+1 .

If k > 0, the right hand side is zero. Thus we may assume that k = 0. In this
case,
                       c2 (e11 c′2 ) − (c2 e11 )c′2 = (ζ − ζ ′ )e21 .

We have a(11 ) = L1 < L2 = a(21 ). This completes the verification of P15 in our
case.

                                       18. The ring J
18.1. In this chapter we assume that W, L is bounded and that P1-P15 in §14
are valid. In particular the results of this chapter are applicable if we are in the
split case (see §15) or more generally in the quasisplit case (see §16) with W, L
bounded.
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                             79

Theorem 18.2. Assume that W is tame.
  (a) W has only finitely many left cells.
  (b) W has only finitely many right cells.
  (c) W has only finitely many two-sided cells.
  (d) D is a finite set.
   We prove (a). Since a(w) is bounded above it is enough to show that, for any
a ∈ N, a−1 (a) is a union of finitely many left cells. By P4, a−1 (a) is a union of
left cells. Let H1 be the Z-algebra Z ⊗A H where Z is regarded as an A-algebra
via v 7→ 1. We write cw instead of 1 ⊗ cw . For any a′ ≥ 0 let H≥a
                                                                1
                                                                  ′ be the subgroup
      1                           ′                           1
of H spanned by {cw ; a(w) ≥ a } (a two-sided ideal of H , by P4). We have a
direct sum decomposition

                                  1    1
(e)                              H≥a /H≥a+1 = ⊕Γ EΓ

where Γ runs over the left cells contained in a−1 (a) and EΓ is generated as a
group by the images of cw , w ∈ Γ; these images form a Z-basis of EΓ . Now
  1     1
H≥a  /H≥a+1   inherits a left H1 -module structure from H1 and (by P9) each EΓ
is a H1 -submodule. Since W is tame, there exists a finitely generated abelian
subgroup W1 of finite index of W . Now H1 = Z[W ] contains Z[W1 ] as a subring.
         1     1
Since H≥a  /H≥a+1    is a subquotient of H1 (a finitely generated Z[W1 ]-module)
                                                  1    1
and Z[W1 ] is a noetherian ring, it follows that H≥a /H≥a+1  is a finitely generated
Z[W1 ]-module. Hence in the direct sum decomposition (e) with only non-zero
summands, the number of summands must be finite. This proves (a).
   Since any right cell is of the form Γ−1 where Γ is a left cell, we see that (b)
follows from (a). Since any two-sided cell is a union of left cells, we see that (c)
follows from (a). From P16 we see that (d) follows from (a). The theorem is
proved.
18.3. Let J be the free abelian group with basis (tw )w∈W . We set
                                           X
                                 tx ty =         γx,y,z −1 tz .
                                           z∈W


The sum is finite since γx,y,z −1 6= 0 =⇒ hx,y,z 6= 0 and this implies that z runs
through a finite set (for fixed x, y). We show that this defines an (associative) ring
structure on J. We must check the identity
                    X                            X
(a)                      γx,y,z −1 γz,u,u′−1 =        γy,u,w−1 γx,w,u′−1
                     z                            w


for any x, y, u, u′ ∈ W . From P8,P4 we see that both sides of (a) are 0 unless

(b)                        a(x) = a(y) = a(u) = a(u′ ) = a
80                                      G. LUSZTIG

for some a ∈ N. Hence we may assume that (b) holds. By P8,P4, in the first sum
in (a) we may assume that a(z) = a and in the second sum in (a) we may assume
that a(w) = a. The equation (cx cy )cu = cx (cy cu ) in H implies
                          X                       X
(c)                            hx,y,z hz,u,u′ =       hy,u,w hx,w,u′ .
                           z                      w


If hx,y,z hz,u,u′ 6= 0 then u′ ≤R z ≤R x hence, by P4, a(u′ ) ≥ a(z) ≥ a(x) and
a(z) = a. Hence in the first sum in (c) we may assume that a(z) = a. Similarly
in the second sum in (c) we may assume that a(w) = a. Taking the coefficient of
v 2a(z) in both sides of (c) we find (a).
    For any commutative ring A with 1 we set JA = A⊗J; this is the free A-module
with basis {tx ; x ∈ W }. It is naturally an A-algebra. P
    If D is finite, the algebra JA has a unit element    P       d∈D nd td . Here nd = ±1
is as in 14.1(a), see P5. LetP       us check that tx d nd td = tx for x ∈ W . This
is
P  equivalent     to the   identity   d nd γx,d,z −1 = δz,x . By P7 this P  is equivalent to
   d nd γz −1 ,x,d = δz,x . This follows from P2,P3,P5. The equality (        d nd td )tx = tx
is checked in a similar way.
    If D is not necessarily finite, then JA has only a generalized unit element in
the sense the elements td (d ∈ D) of JA satisfy td td′ = δd,d′ for d, d′ ∈ D and
P
   d,d′ ∈D td JA td′ = JA .
                                      X
    For any subset X of W , let JA      be the A-submodule of JA generated by {tx ; x ∈
X}. (When A = Z we write J instead of JZX .) If c is a two-sided cell of W, L then,
                                    X
           c                                           c
by P8, JA     is a subalgebra of JA and JA = ⊕c JA       is a direct
                                                                  Psum decomposition of
                                            c
JA as an algebra. If D is finite then JA has a unit element d∈D∩c nd td . Similarly,
                                     Γ∩Γ−1
if Γ is a left cell of W, L then JA         is a subalgebra of JA with unit element nd td
where d ∈ D ∩ Γ.
Proposition 18.4. Assume that we are in the setup of 15.1. Let x, y ∈ W .
   (a) The condition x ∼L y is equivalent to the condition that tx ty−1 6= 0 and to
the condition that, for some u, ty appears with 6= 0 coefficient in tu tx .
   (b) The condition x ∼R y is equivalent to the condition that tx−1 ty 6= 0 and to
the condition that, for some u, ty appears with 6= 0 coefficient in tx tu .
   (c) The condition x ∼LR y is equivalent to the condition that tx tu ty 6= 0 for
some u and to the condition that, for some u, u′ , ty appears with 6= 0 coefficient
in tu′ tx tu .
   Let J + = z Ntz . By 15.1(a) we have J + J + ⊂ J + .
               P
   We prove (a). The second condition is equivalent to γx,y−1 ,u 6= 0 for some u;
the third condition is equivalent to γu,x,y−1 6= 0 for some u. These conditions are
equivalent by P7.
   Assume that γx,y−1 ,u 6= 0 for some u. Using P8 we deduce that x ∼L y.
   Assume now that x ∼L y. Let d ∈ D be such that x ∼L d. Then we have also
y ∼L d. By P13 we have γx−1 ,x,d 6= 0, γy−1 ,y,d 6= 0. Hence γx−1 ,x,d = 1, γy−1 ,y,d =
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                 81

1. Hence tx−1 tx ∈ td + J + , ty−1 ty ∈ td + J + . Since td td = td , it follows that
tx−1 tx ty−1 ty ∈ td td + J + = td + J + . In particular, tx ty−1 6= 0. This proves (a).
    The proof of (b) is entirely similar.
    We prove (c). Using the associativity of J we see that the third condition on x, y
is a transitive relation on W . Hence to prove that the first condition implies the
third condition we may assume that either x ∼L y or x ∼R y, in which case this
follows from (a) or (b). The fact that the third condition implies the first condition
also follows from (a),(b). Thus the first and third condition are equivalent.
    Assume that tx tu ty 6= 0 for some u. By (a),(b) we then have x ∼L u−1 , u−1 ∼R
y. Hence x ∼LR y.
    Conversely, assume that x ∼LR y. By P14 we have x ∼LR y −1 . By the
earlier part of the proof, ty−1 appears with 6= 0 coefficient in tu′ tx tu for some u, u′ .
We have tu′ tx tu ∈ aty−1 + J + where a > 0. Hence tu′ tx tu ty ∈ aty−1 ty + J + .
Since ty−1 ty has a coefficient 1 and the other coefficients are ≥ 0, it folows that
tu′ tx tu ty 6= 0. Thus, tx tu ty 6= 0. We see that the first and second conditions are
equivalent. The proposition is proved.
18.5. Assume now that we are in the setup of 7.1 with m = ∞ and L2 > L1 .
From the formulas in 17.3,17.4 we can determine the multiplication table of J. We
find                  P
   t22k+1 t22k′ +1 = u∈[0,k̃] t22k+2k′ +1−4u ,
                      P
   t12k+3 t12k′ +3 = u∈[0,k̃] t12k+2k′ +3−4u ,
                      P
   t22k+1 t22k′ +2 = u∈[0,k̃] t22k+2k′ +2−4u ,
                      P
   t12k+3 t12k′ +2 = u∈[0,k̃] t12k+2k′ +2−4u ,
                      P
   t22k+2 t12k′ +3 = u∈[0,k̃] t22k+2k′ +2−4u ,
                      P
   t22k+2 t12k′ +2 = u∈[0,k̃] t22k+2k′ +1−4u ,
                      P
   t12k+2 t22k′ +1 = u∈[0,k̃] t12k+2k′ +2−4u ,
                      P
   t12k+2 t22k′ +2 = u∈[0,k̃] t12k+2k′ +3−4u ,
   t1 1 t1 1 = t1 1 ,
   t1 t1 = t1 ;
here k, k ′ ≥ 0 and k̃ = min(k, k ′ ). All other products are 0.
   Let R be the free abelian group with basis (bk )k∈N . We regard R as a commu-
tative ring with multiplication
                                            X
                             bk bk ′ =             bk+k′ −2u .
                                     u∈[0,min(k,k′ )]
           P
Let J0 = w∈W −{1,11 } Ztw . The formulas above show that J = J0 ⊕ Zt1 ⊕ Zt11
(direct sum of rings) and that the ring J0 is isomorphic to the ring of 2×2 matrices
with entries in R, via the isomorphism defined by:
                                                                         
                                   0 0                                      0 0
   t22k+1 7→ b0k 00 , t12k+3 7→ 0 bk , t22k+2 7→ 00 b0k , t12k+2 7→ bk 0 .

Note that R is canonically isomorphic to the representation ring of SL2 (C) with
its canonical basis consisting of irreducible representations.
82                                                  G. LUSZTIG

18.6. Assume that we are in the setup of 7.1 with m = ∞ and L2 = L1 . By
methods similar (but simpler) to those of §17 and 18.5, we find
                                                                X
                        t22k+1 t22k′ +1 =                                t22k+2k′ +1−2u .
                                                    u∈[0,2 min(k,k′ )]


Let J 1 be the subring of J generated by t22k+1 , k ∈ N. While, in 18.5, the analogue
of J 1 was isomorphic to R as a ring with basis, in the present case, J 1 is canonically
isomorphic to R′ , the subgroup of R generated by bk with k even. (Note that R′
is a subring of R, naturally isomorphic to the representation ring of P GL2 (C).)
18.7. In the setup of 7.1 with m = 4 and L2 = 2, L1 = 1 (a special case of the
situation in §16), we have

                                    J = Zt1 ⊕ Zt11 ⊕ J0 ⊕ Zt23 ⊕ Zt24

(direct sum of rings) where J0 is the subgroup of J generated by t21 , t22 , t12 , t13 .
The ring J0 is isomorphic to the ring of 2 × 2 matrices with entries in Z, via the
isomorphism defined by:
                                                                                                        
                       10                          00                        0 1                          00
          t21 7→       00
                                ,     t13 7→       01
                                                            ,   t22 7→       0 0
                                                                                       ,     t12 7→       10
                                                                                                                   .

Moreover, t1 , t11 , t24 are idempotent. On the other hand,

                                                   t23 t23 = −t23 .

Notice the minus sign! (It is a special case of the computation in 7.8.)
18.8. Until the end of 18.12 we assume that D is finite. In the following result,
nd = ±1 (for d ∈ D) is as in 14.1(a) (see P.5).
                                      → JA , φ′ : H −
Theorem 18.9. The A-linear maps φ : H −             → JA given by
                                               X
                   φ(c†x ) =                                    hx,d,z nd tz           (x ∈ W ),
                                      z∈W,d∈D;a(d)=a(z)

                                               X
                   φ′ (c†x ) =                                   hd,x,z nd tz              (x ∈ W ),
                                      z∈W,d∈D;a(d)=a(z)

are homomorphisms of A-algebras with 1.
                                                                                                           ∼
   Note that φ′ is the composition of the algebra isomorphism H −→ Hopp given
                                                                    ∼
by cw 7→ cw−1 (see 3.4) with φ : Hopp −
                                      → (JA )opp and with (JA )opp −→ JA given by
tw 7→ tw−1 . Hence it is enough to prove the statement of the theorem concerning
φ. Consider the equality
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                                        83

   (a) w hx1 ,x2 ,w h′w,x3 ,y = w hx1 ,w,y h′x2 ,x3 ,w
       P                       P
(see P15) with a(x2 ) = a(y) = a. In the left hand side we may assume that
y ≤R w ≤L x2 hence (by P4) a(y) ≥ a(w) ≥ a(x2 ), hence a(w) = a. Similarly in
the right hand side we may assume that a(w) = a. Picking the coefficient of v ′a
in bothPsides of (a) gives      P
   (b) w hx1 ,x2 ,w γw,x3 ,y−1 = w hx1 ,w,y γx2 ,x3 ,w−1 .
Let x, x′ ∈ W . The desired identity φ(c†x c†x′ ) = φ(c†x )φ(c†x′ ) is equivalent to
           X                                              X
                   hx,x′ ,w hw,d,u nd =                               hx,d,z hx′ ,d′ ,z ′ γz,z ′ ,u−1 nd nd′
        w∈W,d∈D                                       ′         ′
                                               z,z ∈W,d,d ∈D
         a(d)=a′                                  a(d)=a(z)
                                                 a(d′ )=a(z ′ )


for any u ∈ W such that a(u) = a′ . In the right hand we may assume that
   a(d) = a(z) = a(d′ ) = a(z ′ ) = a′
(by P8,P4). Hence the right hand side can be rewritten (using (b)):
                       X                                   X
                                       hx′ ,d′ ,z ′                 hx,d,z γz,z ′ ,u−1 nd nd′
                   ′         ′
                 z ∈W,d,d ∈D                          z;a(z)=a′
             a(d)=a(d′ )=a(z ′ )=a′
                           X                                    X
             =                             hx′ ,d′ ,z ′                 hx,w,u γd,z ′ ,w−1 nd nd′ .
                       ′          ′                        w;a(w)=a′
                     z ∈W,d,d ∈D
                 a(d)=a(d′ )=a(z ′ )=a′


By P2,P3,P5, this equals
                                        X
                                                                hx′ ,d′ ,z ′ hx,z ′ ,u nd′
                           z ′ ∈W,d′ ∈D;a(d′ )=a(z ′ )=a′


which by the identity (cx cx′ )cd′ = cx (cx′ cd′ ) equals
                                        X
                                                           hx,x′ ,w hw,d′ ,u nd′ .
                                 w∈W,d′ ∈D;a(d′ )=a′


Thus φ is compatible with multiplication.
   Next we show that φ is compatible with the unit elements of the two algebras.
P equivalent statement is that for any z ∈ W such that a(z) = a, the sum
An
  d∈D;a(d)=a h1,d,z nd equals nz if z ∈ D and is 0 if z ∈
                                                        / D. This is clear since
h1,d,z = δz,d .
18.10. If we identify the A-modules H and JA via c†w 7→ tw , the obvious left
JA -module structure on JA becomes the left JA -module structure on H given by
                                      X
                           tx ∗ c†w =    γx,w,z −1 c†z
                                                          z∈W
84                                         G. LUSZTIG

Let Ha = ⊕w;a(w)=a Ac†w , H≥a = ⊕w;a(w)≥a Ac†w . We have tx ∗ c†w ∈ Ha(w) for all
x, w. We show that for any h ∈ H, w ∈ W we have
(a)                        hc†w = φ(h) ∗ c†w        mod H≥a(w)+1 .
Indeed, we may assume that h = c†x . Using 18.9(b), we have
                                 X
                 φ(c†x ) ∗ c†w =       hx,d,z nd tz ∗ c†w
                                        d∈D,z
                                      a(d)=a(z)
                           X
                     =               hx,d,z γz,w,u−1 n̂d c†u
                          d∈D,z,u
                         a(d)=a(z)
                                X
                     =                     hx,t,u γd,w,t−1 nd c†u
                             d∈D,t,u
                         a(d)=a(w)=a(u)
                            X
                     =               hx,w,u c†u = c†x c†w mod H≥a(w)+1 ,
                             u
                         a(w)=a(u)

as required.
18.11. Let A − → R be a ring homomorphism of A into a commutative ring R with
1. Let HR = R ⊗A H, HR,≥a = R ⊗A H≥a . Then φ extends to a homomorphism
of R-algebras φR : HR −   → JR . The JA -module in 18.10 extends to a JA -module
structure on HR denoted again by ∗. From 18.10(a) we deduce
   (a) hc†w = φR (h) ∗ c†w mod HR,≥a(w)+1 for any h ∈ HR , w ∈ W .
Proposition 18.12. (a) If N is a bound for W, L, then (ker φR )N+1 = 0.
  (b) If R = R0 [v, v −1 ] where R0 is a commutative ring with 1, v is an indeter-
minate and A −
             → R is the obvious ring homomorphism, then ker φR = 0.
   We prove (a). If h ∈ ker φR then by 18.11(a), we have hHR,≥a ⊂ HR,≥a+1 for
any a ≥ 0. Applying this repeatedly, we see that, if h1 , h2 , . . . , hN+1 ∈ H, we have
h1 h2 . . . hN+1 ∈ HR,≥N+1 =   P0. This proves (a).
   We prove (b). Let h = x px c†x ∈ ker φR where px ∈ R. Assume that h 6= 0.
Then px 6= 0 for some x. We can find a ≥ 0 such that px 6= 0 =⇒ a(x) ≥ a
and X = {x ∈ W ; px 6= 0, a(x) = a} is non-empty. We can find b ∈ Z such that
px ∈ v b Z[v −1 ] for all x ∈ X and such that X ′ = {x ∈ X; πb (px ) 6= 0} is non-empty.
Let x0 ∈ X ′ . We can find d ∈ D such that γx0 ,d,x−1 = γx−1 ,x0 ,d 6= 0. We have
                                                            0         0

hc†d = x px c†x c†d . If a(x) > a, then c†x c†d ∈ HR,≥a+1 . Hence hc†d = x∈X px c†x c†d
         P                                                                  P

mod HR,≥a+1 . Since φR (h) = 0, from 18.11(a) we have hc†d ∈ mod HR,≥a+1 .
It follows that x∈X px c†x c†d ∈ HR,≥a+1 . In particular the coefficient of c†x0 in
                    P
             † †                                                                     a+b
P                                        P
   x∈X px cx cd is 0. In other words,       x∈X px hx,d,x0 = 0. The coefficient of v     in
the last sum is             X
                               πb (px )γx,d,x−1 = πb (px0 )γx0 ,d,x−1
                                               0                    0
                          x∈X
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                   85

and this is on the one hand 0 and on the other hand is non-zero since πb (px0 ) 6= 0
and γx0 ,d,x−1 6= 0, by the choice of x0 , d. This contradiction completes the proof.
            0

18.13. We fix a commutative ring A with 1. We will show that, without assuming
that D is finite, JA can be imbedded naturally in a larger A-algebra which has a
unit element.
   Let J˜A be the set of formal sums
                                           P
                                              w∈W f (w)tw where f : W −      → A is any
                          ˜
function. We regard JA as an A-module in an obvious way. For a function f :
W − → A, the support of f is supp(f ) = {w ∈ W ; f (w) 6= 0}. Note that JA may be
identified with the A-submodule of J˜A consisting of all w∈W f (w)tw such that
                                                              P
f :W −  → A has finite support.
   We say that f : W −      → A is left (resp. right) admissible if supp(f ) has finite
intersection with any left (resp. right) cell in W . If f˜ : W −        → A is given by
f˜(z) = f (z −1 ) then clearly f is left admissible if and only if f˜ is right admissible.
P For two functions      f, f ′ : W −
                                    → A we try to define f ′′ : W −     → A by f ′′ (z) =
                  ′
   x,y∈W f (x)f (y)γx,y,z −1 ; the sum may be infinite in general hence may not make
sense. We show:
   (a) If both f, f ′ are left admissible then f ′′ is well defined and left admissible.
If both f, f ′ are right admissible then f ′′ is well defined and right admissible.
Assume first that f, f ′ are left admissible. To prove the first sentence of (a) it is
enough to show that for any d ∈ D, the set

                {(x, y, z) ∈ W 3 ; f (x) 6= 0, f ′ (y) 6= 0, z ∼L d, γx,y,z −1 6= 0}

is finite. Using P8 we see that this set is contained in

U=
{(x, y, z) ∈ W 3 ; f (x) 6= 0, f ′ (y) 6= 0, z ∼L d, x ∼L y −1 , y ∼L z, l(z) ≤ l(x) + l(y)}.

(Note that if γx,y,z −1 6= 0 then hx,y,z 6= 0 hence l(z) ≤ l(x) + l(y), see 13.1.) Hence
it is enough to show that U is finite. Let
    F = {y ∈ W ; f ′ (y) 6= 0, y ∼L d},
    F ′ = {x ∈ W ; x ∼L d′ , f (x) 6= 0, x ∼L h−1 for some h ∈ F },
    F ′′ = {z ∈ W ; l(z) ≤ l(x) + l(y) for some x ∈ F ′ , y ∈ F }.
Now F is finite since f ′ is left admissible. Hence F ′ is finite. It follows that F ′′ is
finite (we use that f is left admissible). Then F ′′ must be also finite since there
are only finitely many elements of fixed length in W . If (x, y, z) ∈ U then y ∈ F
hence x ∈ F ′ . We have clearly z ∈ F ′′ . Thus, U ⊂ F ′′ × F × F ′′′ so that U is
finite. This proves the first sentence in (a).
    Next we assume that f, f ′ are right admissible. To prove the second sentence
of (a) it is enough to show that for any d ∈ D, the set

        {(x, y, z) ∈ W 3 ; f (x) 6= 0, f ′ (y) 6= 0, z ∼R d, γx,y,z −1 6= 0}
         = {(x, y, z) ∈ W 3 ; f˜(x−1 ) 6= 0, f˜′ (y −1 ) 6= 0, z −1 ∼L d, γx,y,z −1 6= 0}
86                                          G. LUSZTIG

is finite. Since f˜, f˜′ are left admissible, it is enough to show, by the first part of
the proof applied to f˜′ , f˜ instead of f, f ′ , that γx,y,z −1 6= 0 implies γy−1 ,x−1 ,z 6= 0.
But the identity hx,y,z = hy−1 ,x−1 ,z −1 implies γx,y,z −1 = γy−1 ,x−1 ,z ; this completes
the proof of (a).
    Let ˇJA (resp. JˇA ) be the set of formal sums w∈W f (w)tw ∈ J˜A where f :
                                                          P
W −  → A is a left (resp. right) admissible function. Note that ˇJA and JˇA are
A-submodules of ÃJ . We define A-algebra structures onˇJA and on JˇA by
                          X              X                X
                        (     f (x)tx )(    f ′ (y)ty ) =       f ′′ (z)tz
                         x∈W              y∈W                z∈W

with f, f ′ , f ′′ as in (a). We show:
   (b) These algebra structures are associative.
We must show that if either each of f1 , f2 , f3 : W −      → A is left admissible or each
of f1 , f2 , f3 : W − → A is right admissible, then for any u1 ∈ W we have
                           X
                                 f1 (x)f2 (y)f3 (z)γx,y,u−1 γu,z,u−1
                                                                     1
                     x,y,z,u∈W
                             X
                     =                 f1 (x)f2 (y)f3 (z)γy,z,u′−1 γx,u′ ,u−1 .
                                                                              1
                         x,y,z,u′ ∈W

(Both sums are finite by repeated application of (a).) It is enough to show that
for any x, y, z, u1 in W we have
                      X                      X
                         γx,y,u−1 γu,z,u−1 =   γy,z,u′−1 γx,u′ ,u−1
                                             1                            1
                         u                           u′

This follows from the associativity of JA .                            P
   Note that both algebras ˇJA , JˇA have a unit element, namely 1 = d∈D nd td ;
this is checked, using P2,P3,P5,P7, in the same way as in  P18.3.
   Let JˇA =ˇJA ∩JˇA . Thus JˇA consists of all formal sums w∈W f (w)tw ∈ J˜A such
that f : W − → A is both left admissible and right admissible.            ˇ
                                                            P Note that JA is an
A-subalgebra of bothˇJA and of JˇA with unit element 1 = d∈D∩c nd td . Note also
that JA is a subalgebra of JˇA . Now the map x∈W f (x)tx 7→ x∈W f (x−1 )tx
                                                    P              P
                                     ∼                   ∼              ∼
defines algebra isomorphisms ˇJA −→ (JˇA )opp , JˇA −→ (JˇA )opp , JA −→ (JA )opp
where the upperscript opp denotes the opposed algebra.
   If D is finite (which is the case if W is tame, see 18.2), we have ˇJA = JˇA =
 ˇ
JA = JA .
18.14. We show:                                    P
   (a) Let w ∈ W . The function W −    → A, z 7→ d∈D;a(d)=a(z) hw,d,z nd is left ad-
                                        P
missible. The function W −  → A, z 7→ d∈D;a(d)=a(z) hd,w,z nd is right admissible.
To prove the first assertion of (a) it is enough to show that for any d ∈ D, the
set {z ∈ W ; z ∼L d, hw,d,z 6= 0} is finite. This set is contained in {z ∈ W ; l(z) ≤
l(w) + l(d)} (see 13.1) which is clearly finite. This proves the first assertion of (a).
The second assertion of (a) is proved in a similar way.
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                            87

                                               →ˇJA , φ′ : H −
  From (a) we see that the A-linear maps φ : H −             → JˇA given by
                                            X
(b)                    φ(c†x ) =                          hx,d,z nd tz ,
                                   d∈D,z∈W ;a(z)=a(d)



                                            X
(c)                     φ′ (c†x ) =                       hd,x,z nd tz
                                      z∈c,d∈D;a(d)=a(z)


are well defined. The proof of the following result is essentially the same as that
of Theorem 18.9.
   (d) φ : H −→ˇJA and φ′ : H −→ JˇA are homomorphisms of A-algebras with 1.
Now let R, A − → R be as in 18.2(b), let HR be as in 18.11; we define an R-algebra
homomorphism φR : HR −     → ˇJR by the same formula as φ : H −     → ˇJR in which
hx,d,z is viewed as an element of R. A proof similar to that of 18.12(b) shows that
   (e) ker φR = 0.
18.15. In the remainder of this chapter we assume that L = l and we fix a two-
sided cell c of W . We shall study a categorical version C c of the ring J c . To
do this, we shall use the theory of Soergel modules as in 16.2. We shall use the
notation of 16.2 with W̃ = W . Thus, R, R>0 , R, C̃, C, Bx(x ∈ W ) are defined as
                                              ′
in 16.2. For M, M ′ ∈ R, M M ′ ∈ R, M M ∈ R are defined as in 16.2. If L ∈ C̃
and j ∈ Z we write Lj ∈ C for what in [EW, 6.2] is denoted by Hj (L). (The fact
that Lj is well defined follows from results of [So] and [EW].) For any subset X of
c, let C X be the full subcategory of C whose objects are isomorphic to finite direct
sums of objects of the form Bx (x ∈ X). For any L ∈ C there is a unique direct
sum decomposition L = L ⊕ L′ where L ∈ C c and L′ is a direct sum of objects
of the form Bx (x ∈ / c). (The uniquenes of this direct sum decomposition follows
from the results of [So] and [EW].) For M ∈ C c we have M = ⊕z∈c EzM ⊗ Bz
where EzM are well defined finite dimensional C-vector spaces which are 0 for all
but finitely many z.
    Let a be the value of the a-function on c. By arguments similar to those in [L14]
and making use of the results in [EW] we see that for L, L′ ∈ C c we have (LL′ )j = 0
if j > a and L, L′ 7→ L•L′ := (LL′ )a defines a monoidal structure on C c . (For
three objects L, L′ , L′′ of C c we have (L•L′ )•L′′ = L•(L′ •L′′ ) = (LL′ L′′ )2a .)
    For x, y ∈∈ c we have

                            Bx •By = ⊕z∈c Vx,y,z −1 ⊗ Bz

                    B •B
where Vx,y,z −1 = Ez x y are canonically defined C-vector spaces which are 0 for
all but finitely many z. Note that

(a)                            dim Vx,y,z −1 = γx,y,z −1 .
88                                     G. LUSZTIG

     For x ∈ c let dx be the unique element of D ∩ c such that x ∼L dx .
     If x ∈ c and d = dx−1 , we have canonically

                                (V̌d,d,d ⊗ Bd )•Bx = Bx .

(We shall denote the dual space of a C-vector space V by V̌ .) Indeed, by (a), it is
enough to show that V̌d,d,d ⊗ Vd,x,x−1 = C. From (Bd •Bd )•Bx = Bd •(Bd •Bx ) we
deduce using (a) that Vd,d,d ⊗ Vd,x,x−1 = Vd,x,x−1 ⊗ Vd,x,x−1 where Vd,x,x−1 , Vd,d,d
are 1-dimensional hence Vd,d,d = Vd,x,x−1 and the desired equality follows. Note
also that if d′ ∈ D ∩ c, d′ 6= dx−1 , then (V̌d′ ,d′ ,d′ ⊗ Bd′ )•Bx = 0. Similarly, if x ∈ c
and d = dx , we have canonically

                                Bx •(V̌d,d,d ⊗ Bd ) = Bx .

(We use the equality V̌d,d,d ⊗ Vx,d,x−1 = C which follows from Bx •(Bd •Bd ) =
(Bx •Bd )•Bd .) Moreover, if d′ ∈ D ∩ c and d′ 6= dx , then Bx •(V̌d′ ,d′ ,d′ ⊗ Bd′ ) = 0.
Thus, ⊕d∈Dc (V̌d,d,d ⊗ Bd ) plays the role of a unit object for the monoidal category
C c , although it does not belong to C c (unless D ∩ c is finite).
                                                                                   ′ −1
   From (a) we see that if Γ, Γ′ , Γ′′ are left cells contained in c and L ∈ C Γ ∩Γ ,
           −1  ′′                   ′ −1  ′′
L′ ∈ C Γ ∩Γ , then L•L′ ∈ C Γ ∩Γ . In particular L, L′ 7→ L•L′ defines a
                             −1
monoidal structure on C Γ ∩Γ . This monoidal structure admits a unit object,
namely V̌d,d,d ⊗ Bd , where d ∈ D ∩ Γ.
18.16. We show that for x, y, z ∈ c we have canonically

(a)                               Vx,y,z = Vy−1 ,x−1 ,z −1 .

For any M ∈ R let M ♯ be the object of R which is equal to M as a graded C-
vector space, but left (resp. right) multiplication by r ∈ R on M ♯ equals right
(resp. left) multiplication by r on M . In [LV, 3.1] it is shown that M ∈ C implies
M ♯ ∈ C and M ∈ C̃ implies M ♯ ∈ C̃; it follows that for M ∈ C̃ and j ∈ Z we
have canonically (M ♯ )j = (M j )♯ . More precisely in loc.cit. it is shown that, if
x ∈ W , then we have Bx♯ ∼= Bx−1 . Let φ : Bx♯ −
                                               → Bx−1 be an isomorphism. It is well
defined up to multiplication by a number in C∗ . We show that there is a canonical
                                                                                       ♯
choice for it. For any M ∈ R we have an obvious isomorphism (Rx )M −        → (Rx♯ )M
(identity map) of C-vector spaces. Despite the fact that this is not necessarily
                                                                                     ♯
an isomorphism in R, it induces for any i an isomorphism (Rx )M −          → (Rx♯ )M
                                                                         i             i
of C-vector spaces. (We use that R>0 (RxM ) = (RxM )R>0 , see [LV, 3.2].) Taking
                                                                    ♯
M = Bx , i = l(x), we may thus identify (Rx )Bx l(x) −     → (Rx♯ )Bx l(x) as C-vector
spaces. We now identify Rx♯ = Rx−1 as in [LV, 3.2] and we identify Bx♯ with Bx−1
via φ. We obtain an identification of (Rx )Bx   with (Rx−1 )Bx−1     that is of C
                                                    l(x)                  l(x)
with C. This is multiplication by some λ ∈ C − {0}. By replacing φ be a nonzero
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                            89

scalar multiple we can achieve that λ = 1. This gives a canonical choice for φ; we
denote it by φx . We can now identify Bx♯ = Bx−1 via φx .
   For M, M ′ ∈ C̃ we have canonically (M M ′ )♯ = (M ′ )s hM ♯ . Hence for x, y ∈ c
we have canonically

                      ⊕z∈c Vy−1 ,x−1 ,z −1 Bz = (By−1 Bx−1 )a
                      = (By♯ Bx♯ )a = ((Bx By )♯ )a = ((Bx By )a )♯
                      = ⊕z∈c (Vx,y,z Bz −1 )♯ = ⊕z∈c Vx,y,z Bz .

Now (a) follows.
18.17. In the remainder of this chapter we assume that W, S is an affine Weyl
group, see 1.15 and that I is a subset of S such that the group WI generated by
I is finite of maximum possible order. We have W = WI T , WI ∩ T = {1}, where
T is the normal subgroup of W defined in 1.16. Let w0I be the longest element
of WI . We assume that c is the two-sided cell of W containing w0I . There is a
unique automorphism w 7→ w∗ of W such that x∗ = w0I xw0I for all x ∈ WI and
y ∗ = w0I y −1 w0I for all y ∈ T . This automorphism maps S onto S, I onto I and c
onto c. We shall assume, as we may, that (with notation in [LV, 2.1]), there is an
involutive automorphism e 7→ e∗ of the dual space ȟ of the reflection representation
h of W such that (we)∗ = w∗ e∗ for all w ∈ W, e ∈ ȟ and (αs )∗ = αs∗ for all s ∈ S.
    From the definitions we see that for any x, y, z ∈ c we have canonically

(a)                                Vx∗ ,y∗ ,z ∗ = Vx,y,z .

Let Γ = {w ∈ W ; w has maximal length in wWI . According to [L7, 8.5], Γ is a
left cell of W . It is clearly contained in c.
    The set Γ−1 ∩ Γ is the set of all w ∈ W such that w has maximal length in
WI wWI . Hence each WI , WI double coset in W contains a unique element of
Γ−1 ∩ Γ, see 9.15(e).
    By [L17, 8.2], if w ∈ W has maximal length in its WI , WI double coset then
w = w−1 . In particular, we have
  ∗


(b)                        w∗ = w−1 for all w ∈ Γ−1 ∩ Γ.

18.18. We show that for x, y, z in Γ−1 ∩ Γ we have canonically

(a)                                  Vx,y,z = Vy,x,z .

The method of proof has some common features with one in [LX, 3.5]
  Using 18.17(a), 18.17(b) and 18.16(a) we see that we have canonically

                     Vx,y,z = Vx∗ ,y∗ ,z ∗ = Vx−1 ,y−1 ,z −1 = Vy,x,z .
90                                           G. LUSZTIG

This proves (a). From (a) we deduce that for x, y in Γ−1 ∩ Γ we have canonically

(b)                                       Bx •By = By •Bx
         −1                                                      −1
in C Γ ∩Γ . Now let M, M ′ be two objects of C Γ                      ∩Γ
                                                                           . We show that we have
canonically

(c)                                       M •M ′ = M ′ •M
      −1
           ∩Γ
in C Γ          . We have canonically

                 M = ⊕x∈Γ−1 ∩Γ EM,x ⊗ Bx ,           M ′ = ⊕y∈Γ−1 ∩Γ EM ′ ,y ⊗ By .

Hence, using (b), we have

                       M •M ′ = ⊕x,y∈Γ−1 ∩Γ (EM,x ⊗ EM ′ ,y ) ⊗ Bx •By
                       = ⊕x,y∈Γ−1 ∩Γ (EM ′ ,y ⊗ EM,x ) ⊗ By •Bx = M ′ •M.

                                               −1
                                                    ∩Γ
We see that the monoidal category C Γ                    has a natural commutativity constraint.
18.19. Let d be the unique element of D ∩ Γ. We define a contravariant functor
       −1        −1
D : C Γ ∩Γ −
           → C Γ ∩Γ by
                                                                                     −1
                                                                                          ∩Γ
              M 7→ DM = ⊕z∈Γ−1 ∩Γ ĚzM ⊗ V̌z,z −1 ,d ⊗ V̌d,d,d ⊗ Bz −1 ∈ C Γ                   .
                 −1
                      ∩Γ
For M ∈ C Γ                we have

      DDM = ⊕z∈Γ−1 ∩Γ EzM ⊗ Vz,z −1 ,d ⊗ Vd,d,d ⊗ V̌z −1 ,z,d ⊗ V̌d,d,d ⊗ Bz = M.

Here we have used that Vz,z −1 ,d ⊗ Vd,d,d ⊗ V̌z −1 ,z,d ⊗ V̌d,d,d = C since, by 18.15(a),
Vd,d,d and Vz,z −1 ,d = Vz −1 ,z,d are 1-dimensional (note that by 18.17(a) and 18.17(b)
we have Vz,z −1 ,d = Vz,z ∗ ,d = Vz ∗ ,z,d∗ = Vz −1 ,z,d ).
   For x ∈ Γ−1 ∩ Γ we have

                   Bx •D(Bx ) = V̌x,x−1 ,d ⊗ V̌d,d,d ⊗ Bx •Bx−1
                      = ⊕z∈Γ−1 ∩Γ V̌x,x−1 ,d ⊗ V̌d,d,d ⊗ Vx,x−1 ,z −1 ⊗ Bz
                      = V̌x,x−1 ,d ⊗ V̌d,d,d ⊗ Vx,x−1 ,d ⊗ Bd ⊕ M1 = M0 ⊕ M1

where
                                         M0 = V̌d,d,d ⊗ Bd ,

                      M1 = ⊕z∈Γ−1 ∩Γ;z6=d V̌x,x−1 ,d ⊗ V̌d,d,d ⊗ Vx,x−1 ,z −1 Bz .
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                             91

(We have again used that Vx,x−1 ,d is 1-dimensional.) Thus we have obvious mor-
            jx                j′                                       −1
                                                                            ∩Γ
                         x
phisms M0 −→ Bx •D(Bx ) −→ M0 where M0 is the unit object of C Γ                 . Now
           −1
let M ∈ C Γ ∩Γ . We have

                  M •DM = ⊕x,x′ ∈Γ−1 ∩Γ (ExM ⊗ ĚxM′ ) ⊗ Bx •DBx′

Let j : M0 −→ M •DM be the morphism whose x, x′ component is 0 if x 6= x′ and
is ax ⊗ jx when x = x′ (here ax : C −     → ExM ⊗ ĚxM is the obvious imbedding).
      ′
Let j : M •DM −    → M0 be the morphism whose x, x′ component is 0 if x 6= x′
and is a′x ⊗ jx′ when x = x′ (here a′x : ExM ⊗ ĚxM −
                                                    → C is the obvious projection).
                      j            j′
The morphisms M0 −  → M •DM −→ M0 provide a rigid structure for the monoidal
           Γ−1 ∩Γ
category C        .
18.20. Let G be the simple adjoint group over C of type dual to that of W, S. Let
RepG be the tensor category of finite dimensional rational representations of G.
Note that the simple objects of RepG are naturally indexed by the elements of W
which have maximal length in their WI , WI double coset, hence they are indexed
by Γ−1 ∩ Γ. For x ∈ Γ−1 ∩ Γ let Vx be the corresponding simple object of RepG.
Now [L5, Cor.8.7] can be interpreted as follows:
                                                           ⊕γ
   For any x, y ∈ Γ−1 ∩ Γ we have Vx ⊗ Vx′ ∼
                                                                  −1
                                              = ⊕z∈Γ−1 ∩Γ Vz x,y,z .
Using 1.1(a) this can be restated as follows:
   (a) For any x, y ∈ Γ−1 ∩ Γ we have Vx ⊗ Vx′ ∼ = ⊕z∈Γ−1 ∩Γ Vx,y,z −1 ⊗ Vz .
                                                                       −1
Using (a) we see that the rigid symmetric monoidal category C Γ ∩Γ satisfies
the assumptions in Deligne’s theorem [De, 0.6]: the finite ⊗-generation and the
property [De, 0.5(i)(b)] follow from the analogous statements for the category
                                                    −1
RepG where they are obvious. We deduce that C Γ ∩Γ is equivalent as a tensor
category to the category of representations of some supergroup. One can show
that this supergroup is in fact a group isomorphic to G (we omit the proof).
18.21. In this subsection we make no assumption on c. Let Γ be the set of all
x ∈ c such that x has minimal length in xWI . According to [LX], Γ is exactly
one left cell of W . By methods similar to those in 18.18, 18.19 we see that the
                      −1
monoidal category C Γ ∩Γ is rigid and has a natural commutativity constraint.

                          19. Algebras with trace form
19.1. Let R be a field and let A be an associative R-algebra with 1 of finite
dimension over R. We assume that A is semisimple and split over R and that we
                                                           → R such that (a, a′ ) =
are given a trace form on A that is, an R-linear map τ : A −
     ′        ′
τ (aa ) = τ (a a) is a non-degenerate (symmetric) R-bilinear form (, ) : A × A −
                                                                               → R.
                ′ ′′         ′ ′′           ′ ′′
Note that (aa , a ) = (a, a a ) for all a, a , a in A. Let ModA be the category
whose objects are left A-modules of finite dimension over R. We write E ∈ IrrA
for ”E is a simple object of ModA”.
92                                     G. LUSZTIG

   Let (ai )i∈I be an R-basis of A. Define an R-basis (a′i )i∈I of A by (ai , a′j ) = δij .
Then P
   (a) i ai ⊗ a′i ∈ A ⊗ A is independent of the choice of (ai ).
                                                  ′
                                      P
Proposition 19.2. (a) We        have    i τ (ai )ai = 1.
   (b) If E ∈ IrrA, then i tr(ai , E)a′i is in the centre of A. It acts on E as a
                            P
scalar fE ∈ R times the identity and on E ′ ∈ IrrA, not isomorphic to E, as zero.
Moreover, fE does not depend on the choice of (ai ).
   (c) One can attach uniquely to each E ∈ IrrA a scalar gE ∈ R (depending only
on Pthe isomorphism class of E), so that
      E gE tr(a, E) = τ (a) for all a ∈ A,
where the sum is taken over all E ∈ IrrA up to isomorphism.
   (d) For any E ∈ IrrA we P   have fE gE = 1. In particular, fE 6= 0, gE 6= 0.
   (e) If E, E ′ ∈ IrrA, then i tr(ai , E)tr(a′i , E ′ ) is fE dim E if E, E ′ are isomor-
phic and is 0, otherwise.
    Let A = ⊕tn=1 An be the decomposition of A as a sum of simple algebras. Let
τ n : An − → R be the restriction of τ . Then τn is a trace form for An , whose
associated form is the restriction of (, ) and (An , An′ ) = 0 for n 6= n′ . Hence
we can choose (ai ) so that each ai is contained in some An and then a′i will be
contained in the same An as ai .
    We prove (a). From 19.1(a) we see that i τ (ai )a′i is independent of the choice
                                              P
of (ai ). Hence we may choose (ai ) as in the first paragraph of the proof. We are
thus reduced to the case where A is simple. In that case the assertion is easily
verified.
    We prove (b). From 19.1(a) we see that i tr(ai , E)a′i is independent of the
                                                P
choice of (ai ). Hence we may choose (ai ) as in the first paragraph of the proof.
We are thus reduced to the case where A is simple. In that case the assertion is
easily verified.
    We prove (c). It is enough to note that a 7→ tr(a, E) form a basis of the space
of R-linear functions A −→ R which vanish on all aa′ − a′ a and τ is such a function.
    We prove (d). We consider the equation in (c) for a = ai , we multiply both
sides by a′i and sum over i. Using (a), we obtain
                       XX                       X
                             gE tr(ai , E)a′i =   τ (ai )a′i = 1.
                          i   E                    i
                                ′
                                 = 1. By (b), the left hand side acts on a E ′ ∈ IrrA
       P       P
Hence E gE         i tr(ai , E)ai
as a scalar gE ′ fE ′ times the identity. This proves (d).
   (e) follows immediately from (b). The proposition is proved.
19.3. Now let A′ be a semisimple subalgebra of A such that τ ′ , the restriction of
τ to A′ is a trace form of A′ . (We do not assume that the unit element 1A′ of A′
coincides to the unit element 1 of A.) If E ∈ ModA then 1A′ E is naturally an
object of ModA′ . Hence if E ′ ∈ IrrA′ , then the multiplicity [E ′ : 1A′ E] of E ′ in
1A′ E ′ is well defined.
   Note that, if a′ ∈ A′ , then tr(a′ , 1A′ E) = tr(a′ , E).
                     HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                                93

Lemma 19.4. Let E ′ ∈ IrrA′ . We have gE ′ =                                ′
                                                                 P
                                                                     E [E       : 1A′ E]gE , sum over all
E ∈ IrrA (up to isomorphism).
   By the
      P definition  of gE ′ , it is enough to show that
   (a) E ′ E [E : 1′ E]gE tr(a′ , E ′ ) = τ (a′ )
                  ′
           P
for any a′ ∈ A′ . Here E ′ (resp. E) runs over the isomorphism classes of simple
objects of ModA′ (resp. ModA). The left hand of (a) is
    X         X                                  X                        X
         gE        [E ′ : 1′ E]tr(a′ , E ′ ) =       gE tr(a′ , 1′ E) =         gE tr(a′ , E) = τ (a′ ).
     E        E′                                 E                        E


This completes the proof.

                                      20. The function aE
20.1. In this chapter we assume that W is finite (hence W, L is automatically
bounded) and that P1-P15 are satisfied.
   The results of §19 will be applied in the following cases.
   (a) A = HC , R = C. Here A −       → C takes v to 1. We identify HC with the group
algebra C[W ] by w 7→ Tw for all w. It is well known that C[W ] is a semisimple
split algebra. We take τ so that τ (x) = δx,1 for x ∈ W . Then the bases (x) and
(x−1 ) are dual with respect to (, ).
   We will say ”W -module” instead of ”C[W ]-module”. We will write ModW, IrrW
instead of ModC[W ], IrrC[W ].
   (b) A = JC , R = C. Since C[W ] is semisimple, we see from 18.12(a) that the
kernel of φC : C[W ] −  → JC is 0 so that φC is injective. Since dim C[W ] = dim JC =
♯W it follows that φC is an isomorphism. In particular JC is a semisimple split
algebra. We take τ : JC −    → C so that τ (tz ) is nz if z ∈ D and 0, otherwise. Then
(tx , ty ) = δxy,1 . The bases (tx ) and (tx−1 ) are dual with respect to (, ).
   (c) A = HC(v) , R = C(v). Here A −         → C takes v to v. The homomorphism
φC(v) : HC(v) −   → JC(v) is injective. This follows from 18.12(b), using the fact that
injectivity is preserved by tensoring with a field of fractions. Since HC(v) , JC(v)
have the same dimension, it follows that φC(v) is an isomorphism. Since JC(v) =
C(v) ⊗ JC , and JC is semisimple, split, it follows that JC(v) is semisimple, split,
hence HC(v) is semisimple, split. We take τ : HC(v) −     → C(v) so that τ (Tw ) = δw,1 .
The bases (Tx ) and (Tx−1 ) are dual with respect to (, ).
   Remark. The argument above shows also that,
   (d) if R = R0 (v), with R0 an arbitrary field and A −      → R carries v to v, then
φR : HR −   → JR is an isomorphism;
   (e) if R in 18.11 is a field of characteristic 0 then φR : HR −  → JR is an isomor-
phism if and only if HR is a semisimple R-algebra.
20.2. For any E ∈ ModW we denote by E♠ the corresponding JC -module. Thus,
E♠ coincides with E as a C-vector space and the action of j ∈ JC on E♠ is the
same as the action of φ−1
                       C (j) on E. The JC -module structure on E♠ extends in a
94                                     G. LUSZTIG

natural way to a JC(v) -module structure on Ev = C(v)⊗C E♠ . We will also regard
                                                                    ∼
Ev as an HC(v) -module via the algebra isomorphism φC(v) : HC(v) −→ JC(v) . If E
is simple, then E♠ and Ev are simple.
                                         c
    Let E ∈ IrrW . Then E♠ is a simple JC  -module for a unique two-sided cell c of
W . Then for any x ∈ c, we write E ∼LR x. If E, E ′ ∈ IrrW , we write E ∼LR E ′
if for some x ∈ W we have E ∼LR x, E ′ ∼LR x.
20.3. There is the following direct relationship between E and Ev (without going
through J):
                     tr(x, E) = tr(Tx , Ev )|v=1 for all x ∈ W.
Indeed,
   P it is enough to show that tr(cx , E) = tr(cx , Ev )|v=1 . Both sides are equal
to z∈W,d∈D γx,d,z −1 n̂z tr(tz , E♠ ).
20.4. Assume that E ∈ IrrW . We have
   (a) (fEv )v=1 dim(E) =P♯W .
Indeed, setting v = 1 in x∈W tr(Tx , Ev )tr(Tx−1 , Ev ) = fEv dim(E) gives
                    X
                        tr(x, E)tr(x−1 , E) = (fEv )v=1 dim(E).
                      x∈W

The left hand side equals ♯W ; (a) follows.
20.5. Let I ⊂ S, let E ′ ∈ IrrWI and let E ∈ IrrW . We have
  (a) [Ev′ : Ev ] = [E ′ : E].
The right hand side is ♯(WI )−1 x∈WI tr(x, E ′ )tr(x−1 , E). The left hand side is
                                   P

                                     X
                     fE−1       ′ −1
                         ′ dim(E )
                         v
                                       tr(Tx , Ev′ )tr(Tx−1 , Ev ).
                                      x∈WI

Since this is a constant, it is equal to its value for v = 1. Hence it is equal to
                                          X
                   (fE−1            ′ −1
                       ′ )v=1 dim(E )
                       v
                                               tr(x, Ev′ )tr(x−1 , Ev ).
                                          x∈WI

Thus it is enough to show that (fEv′ )v=1 dim(E ′ ) = ♯(WI ). But this is a special
case of 20.4(a).
Proposition 20.6. Let E ∈ IrrW .
   (a) There exists a unique integer aE ≥ 0 such that tr(Tx , Ev ) ∈ v −aE C[v] for
                           / v −aE +1 C[v] for some x ∈ W .
all x ∈ W and tr(Tx , Ev ) ∈
   (b) For x ∈ W we have tr(Tx , Ev ) = sgn(x)v −aE tr(tx , E♠ ) mod v −aE +1 C[v].
                                                        c
   (c) Let c be the two-sided cell such that E♠ ∈ IrrJC   . Then aE = a(z) for any
z ∈ c.
     Let a = a(z) for any z ∈ c. Let x ∈ W . By definition,
                                      X
                   tr(c†x , Ev ) =              hx,d,z nd tr(tz , E♠ ).
                                 z∈W,d∈D;a(d)=a(z)
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                      95

In the last sum we have tr(tz , E♠ ) = 0 unless z ∈ c in which case a(z) = a and
hx,d,z = hx,d,z = γx,d,z −1 v −a mod v −a+1 Z[v]. Thus we have
                              X
         tr(c†x , Ev ) =             γx,d,z −1 nd tr(tz , E♠ )v −a       mod v −a+1 C[v].
                           z∈W,d∈D
                                            P
For each z in the last sum we have             d∈D   γx,d,z −1 nd = δx,z . This gives

(d)                   tr(c†x , Ev ) = tr(tx , E♠ )v −a     mod v −a+1 C[v].
                           ′            ′
                                               in 10.1. Hence sgn(x)T x = Tx† =
                  P
We have Tx =        y;y≤x qy,x cy with qy,x asP
        ′    †                                          ′    †
P
 y;y≤x qy,x cy . Applying¯gives sgn(x)Tx =      y;y≤x q y,x cy . Hence
                                                     X
                           tr(Tx , Ev ) = sgn(x)           q ′y,x tr(c†y , Ev ).
                                                   y;y≤x


Using (d) together with q ′x,x = 1, q ′y,x ∈ vZ[v] for y < x (see 10.1), we deduce

                tr(Tx , Ev ) = sgn(x)tr(tx , E♠ )v −a           mod v −a+1 C[v].

Since E♠ ∈ IrrJC , we have tr(tx , E♠ ) 6= 0 for some x ∈ W . The proposition
follows.
Corollary 20.7. fEv = fE♠ v −2aE + strictly higher powers of v.
  Using 19.2(e) for HC(v) and JC , we obtain
                                    X
                 fEv dim E =             tr(Tx , Ev )tr(Tx−1 , Ev )
                                     x
                      X
                  ∈         tr(tx , E♠ )tr(tx−1 , E♠ )v −2aE + v −2aE +1 C[v]
                       x
                  = fE♠ dim Ev −2aE + v −2aE +1 C[v].

The corollary follows.
  Let ¯: C[v, v −1 ] −
                     → C[v, v −1 ] be the C-algebra homomorphism given by v n 7→
 −n
v  for all n.
Corollary 20.8. For any h ∈ H we have tr(h̄, Ev ) = tr(h, Ev ).
  We can assume that h = c†x where x ∈ W . As in the proof of 20.6 we have
                                             X
                  tr(c†x , Ev ) =                          hx,d,z nd tr(tz , E♠ ).
                                    z∈W,d∈D;a(d)=a(z)


Hence it suffices to note that hx,d,z = hx,d,z for all d, z in the last sum.
96                                         G. LUSZTIG

                                       †
     For E ∈ ModW we write E † ,Ev† , E♠ instead of E ⊗ sgn, (E ⊗ sgn)v , (E ⊗ sgn)♠ .
Lemma 20.9. Let E ∈ IrrW . For any x ∈ W we have

                               tr(Tx , Ev† ) = (−1)l(x) tr(Tx , Ev ).


   There is a unique a C(v)-algebra involution † : HC(v) −   → HC(v) extending
†
  :H− → H (see 3.5). Let (Ev )† be the HC(v) -module with underlying vector space
Ev such that the action of h ∈ VC(v) on (Ev )† is the same as the action of h† on
Ev . Clearly, (Ev )† ∈ IrrHC(v) . For x ∈ W we have

               tr(Tx , (Ev )† ) = (−1)l(x) tr(Tx−1
                                                 −1 , Ev ) = (−1)
                                                                  l(x)
                                                                       tr(Tx , Ev ).

(The last equation follows from 20.8.) Setting v = 1 we obtain

                    tr(Tx , (Ev )† )|v=1 = (−1)l(x) tr(x, E) = tr(x, E † ).

Using 20.3, we deduce that (Ev )† ∼
                                  = Ev† in ModHC(v) . The lemma follows.
Proposition 20.10. For any x ∈ W we have

                                       †
               tr(Tx , Ev ) = tr(tx , E♠ )v aE† + strictly lower powers of v.


     By 20.9 and 20.6 we have

 tr(Tx , Ev ) = sgn(x)tr(Tx , Ev† ) = tr(tx , E♠
                                               †
                                                 )v −aE† + strictly higher powers of v
                †
     = tr(tx , E♠ )v aE† + strictly lower powers of v.

The proposition is proved.
Corollary 20.11. fEv = fE † v 2aE† + strictly lower powers of v.
                                   ♠


     Using 20.10 we have
                                  X
                  fEv dim E =           tr(Tx , Ev )tr(Tx−1 , Ev )
                                    x
                                    †             †
                       X
                   ∈       tr(tx , E♠ )tr(tx−1 , E♠ )v 2aE† + v 2aE† −1 C[v −1 ]
                       x
                   = fE † dim Ev 2aE† + v 2aE† −1 C[v −1 ].
                           ♠
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                   97

Lemma 20.12. Let E ′ ∈ IrrWI . With notation of 19.2, we have
                                             X
                                 gEv′ =                [E ′ : E]gEv .
                                          E;E∈IrrW



   We apply 19.4 with A = HC(v) and A′ the analogous algebra for WI instead of
W , identified naturally with a subspace of A. (In this case the unit elements of
the two algebras are compatible hence 1A′ Ev = Ev .) It remains to use 20.5(a).
Lemma 20.13. Let E ∈ IrrW .
  (a) For any x ∈ W , tr(tx−1 , E♠ ) is the complex conjugate of tr(tx , E♠ ).
  (b) fE♠ is a strictly positive real number.
   We prove (a). Let h, i : E × E −
                                  → C be
                                       Pa positive definite  hermitian form. We
           ′                       ′ ′                ′
define h, i : E♠ × E♠ −
                      → C by he, e i = z∈W htz e, tz e i. This is again a positive
definite hermitian form on E♠ . We show that

                                     htx e, e′ i′ = he, tx−1 e′ i′

for all e, e′ . This is equivalent to
                   X                                  X
                          γz,x,y−1 hty e, tz e′ i =         γy,x−1 ,z −1 hty e, tz e′ i
                    y,z                               y,z


which follows from γz,x,y−1 = γy,x−1 ,z −1 . We see that tx−1 is the adjoint of tx with
respect to a positive definite hermitian form. (a) follows.P
   We prove (b). By 19.2(e) we have fE♠ dim(E) =             x tr(tx , E♠ )tr(tx−1 , E♠ ).
The right hand side of this equality is a real number ≥ 0, by (a). Hence so is the
left hand side. Now fE♠ 6= 0 by 19.2(d) and (b) follows.
Proposition 20.14. Let E ′ ∈ IrrWI .
   (a) For any E ∈ IrrW
                      P such    that [E ′ : E] 6= 0 we have aE ′ ≤ aE .
   (b) We have gE♠
                 ′ =    [E ′ : E]gE♠ , sum over all E ∈ IrrW (up to isomorphism)
such that aE = aE ′ .
   Let X be the set of all E (up to isomorphism) such that [E ′ : E] 6= 0 and such
that aE is minimum, say equal to a. Assume first that a < aE ′ . Using 19.2(d) we
rewrite 20.12 in the P form′
         −2a −1
   (c) v    fE ′ = E [E : E]v −2a fE−1   v
                                           .
               v
By 20.7, we have
   (d) (v −2aE fE−1
                  v
                    )|v=0 = fE−1
                               ♠
                                 , (v −2aE′ fE−1          −1
                                               ′ )|v=0 = fE ′ ,
                                               v           ♠
hence by setting v = 0 in (c) we obtain
                                            X
                                     0=          [E ′ : E]fE−1
                                                             ♠
                                                               .
                                           E∈X
98                                       G. LUSZTIG

The right hand side is a real number > 0 by 20.8(b). This is a contradiction. Thus
we must have a ≥ aE ′ and (a) is proved.
  We now rewrite (c) in the form
  (e) v −2aE′ fE−1         ′      −2aE ′ −1
                     P
                 ′ =   E [E : E]v       fEv .
                 v
Using (d) and (a) we see that, setting v = 0 in (e) gives
                                           X
                            fE−1
                               ′ =                  [E ′ : E]fE−1
                                                                ♠
                                                                  .
                                ♠
                                       E;aE =aE ′


This proves (b).
20.15. Let K(W ) be the C-vector space with basis indexed by the E ∈ IrrW (up
                                                                    P
to isomorphism). If Ẽ ∈ ModW we identify Ẽ with the element E [E : Ẽ]E ∈
K(W ) (E as above). We define a C-linear map jW    WI : K(WI ) − → K(W ) by
    W      ′           ′
                P
   jWI (E ) = E [E : E]E,
sum over all E ∈ IrrW (up to isomorphism) such that aE = aE ′ ; here E ′ ∈ IrrWI .
We call this truncated induction.
   Let I ′′ ⊂ I ′ ⊂ S. We show that the following transitivity formula holds:

                            W
(a)                    jW      I′      W
                        WI ′ jWI ′′ = jWI ′′ : K(WI ′′ ) −
                                                         → K(W ).

Let E ′′ ∈ IrrWI ′′ . We must show that
                                           X
                       [E ′′ : E] =                      [E ′′ : E ′ ][E ′ : E]
                                      E ′ ;aE ′ =aE ′′


for any E ′′ ∈ IrrWI ′′ , E ∈ IrrW such that aE ′′ = aE ; in the sum we have E ′ ∈
IrrWI ′ . Clearly,
                                         X
                            [E ′′ : E] =   [E ′′ : E ′ ][E ′ : E].
                                            E′

Hence it is enough to show that, if [E ′′ : E ′ ][E ′ : E] 6= 0, then we automatically
have aE ′ = aE ′′ . By 2.10(a) we have aE ′′ ≤ aE ′ ≤ aE . Since aE ′′ = aE , the
desired conclusion follows.
20.16. For any x ∈ W we set
                                    X
                        γx =                tr(tx , E♠ )E ∈ K(W ).
                               E;E∈IrrW


We sometimes write γxW instead of γx , to emphasize dependence on W . Note that
γx is a C-linear combination of E such that E ∼LR x. Hence, if E, E ′ appear
with 6= 0 coefficient in γx then E ∼LR E ′ .
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                          99

Proposition 20.17. If x ∈ WI , then γxW = jW    WI
                                           WI (γx ).

  An equivalent statement is
                                           X
                                                                ′
(a)                   tr(tx , E♠ ) =                   tr(tx , E♠ )[E ′ : E]
                                       E ′ ;aE =aE ′


for any E ∈ IrrW ; in the sum we have E ′ ∈ IrrWI . Clearly, we have
                                   X
(b)            v aE tr(Tx , Ev ) =         v aE tr(Tx , Ev′ )[E ′ : E].
                                   E ′ ;E ′ ∈IrrWI


In the right hand side we may assume that aE ′ ≤ aE . Using this and 20.6, we see
that setting v = 0 in (b) gives (a). The proposition is proved.
Lemma 20.18. (a) We have asgn = L(w0 ).
  (b) We have fsgn♠ = 1.
  (c) We have γw0 = sgn.
   sgnv is the one dimensional HC(v) -module on which Tx acts as sgn(x)v −L(x) .
(This follows from 20.3.) From 20.6(b) we see that asgn = L(w0 ) and that
tr(tw0 , sgn♠ ) = 1. This proves (a). To prove (c) it remains to show that, if
tr(tw0 , E♠ ) 6= 0 (E simple) then E ∼ = sgn. This assumption shows, by 20.6(c),
                  c                                                       c
that E♠ ∈ IrrJC      where c is the two-sided cell such that sgn♠ ∈ IrrJC   . Since
tr(tw0 , sgn♠ ) = 1, we have w0 ∈ c. From 13.8 it follows that {w0 } is a two-sided
                             c
cell. Thus c = {w0 } and JC    is one dimensional. Hence it cannot have more than
one simple module. Thus, E ∼    = sgn. This yields (c) and also (b). The lemma is
proved.
20.19. Assume that I, I ′ form a partition of S such that W = WI × WI ′ . If
E ∈ IrrWI and E ′ ∈ IrrWI ′ , then E ⊠ E ′ ∈ IrrW . From the definitions,

                      aE⊠E ′ = aE + aE ′ , f(E⊠E ′ )♠ = fE♠ fE♠
                                                              ′ .



Moreover, if x ∈ WI , x′ ∈ WI ′ , then
                                  W      WI               W
                                 γxx′ = γx  ⊠ γx′ I ′ .

20.20. Until the end of 20.23 we assume that w0 is in the centre of W . Then, for
any E ∈ IrrW , w0 acts on E as ǫE times identity where ǫE = ±1. Now E 7→ ǫE E
extends to a C-linear involution ζ : K(W ) −
                                           → K(W ).
Lemma 20.21. Let E ∈ IrrW . For any x ∈ W we have
  tr(Tw0 x , Ev ) = ǫE v −aE +aE† tr(Tx , Ev ).
  Since w0 is in the centre of W , Tw0 is in the centre of HC(v) hence it acts
on Ev as a scalar λ ∈ C(v) times the identity. Now tr(Tx , Ev ) ∈ C[v, v −1 ] and
100                                          G. LUSZTIG

tr(Tx−1 , Ev ) ∈ C[v, v −1 ]. In particular, λ ∈ C[v, v −1 ] and λ−1 ∈ C[v, v −1 ]. This
implies λ = cv n where c ∈ C. For v = 1, λ becomes ǫE . Hence λ = ǫE v n for some
n. We have

          tr(Tw0 x , Ev ) = tr(Tw0 Tx−1                −1
                                      −1 , Ev ) = λtr(Tx−1 , Ev ) = λtr(Tx , Ev ).



We have
           X                                                X
                tr(Tw0 x , Ev )tr(Tx−1 w0 , Ev ) = λ2            tr(Tx , Ev )tr(Tx−1 , Ev )
            x                                                x


hence fEv dim(E) = λ2 fEv dim(E) so that fEv = v 2n fEv . By 20.9, we have
                X                                       X
                         tr(Tx , Ev )tr(Tx−1 , Ev ) =       tr(Tx , Ev† )tr(Tx−1 , Ev† )
                 x                                      x


hence fEv = fEv† . We see that fEv = v 2n f(E † )v . Comparing the lowest terms we
see that −2aE = 2n − 2aE † hence n = −aE + aE † and that
   (a) fE♠ = fE † .
                     ♠


Lemma 20.22. v aE tr(Tw0 x , Ev ) = ǫE (−1)l(x) v aE† tr(Tx , Ev† ).

   We combine 20.8, 20.21.

Lemma 20.23. For any x ∈ W we have γxw0 = sgn(x)ζ(γx ) ⊗ sgn.

   An equivalent statement is

                                                               †
                               tr(txw0 , E♠ ) = sgn(x)tr(tx , E♠ )ǫE †

for any E ∈ IrrW . Setting v = 0 in the identity in 20.22 gives

                                                                     †
                              sgn(xw0 )tr(tw0 x , E♠ ) = ǫE tr(tx , E♠ ).

It remains to show that ǫE † = ǫE sgn(w0 ). This is clear.

20.24. By the Cayley-Hamilton theorem, any element r ∈ J satisfies an equation
of the form r n + a1 r n−1 + · · · + an = 0 where ai ∈ Z. (We use that the structure
constants of J are integers.) This holds in particular for r = tx where x ∈ W .
Hence for any E ∈ IrrJC , tr(tx , E) is an algebraic integer. If R is a subfield of C
such that the group algebra R[W ] is split over R, then JR is split over R and it
follows that for x, E as above, tr(tx , E) is an algebraic integer in R. In particular,
if we can take R = Q, then tr(tx , E) ∈ Z.
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                              101

                            21. Study of a left cell
21.1. In this chapter we preserve the setup of 20.1. Let ΓPbe a left cell of W, L.
Let d be the unique element in Γ ∩ D. The A-submodule y∈Γ Ac†y of H can be
regarded as an H-module by the rule c†x · c†w = z∈Γ hx,y,z c†z with x ∈ W, y ∈ W .
                                                  P
By change of scalars (v 7→ 1) this gives rise to an HC = C[W ]-module [Γ]. On the
              Γ
other hand, JC  = ⊕y∈Γ Cty is a left ideal in JC by 14.2(P8).
Lemma 21.2. The C-linear isomorphism ty 7→ c†y for y ∈ Γ is an isomorphism
                Γ ∼
of JC -modules JC −→ [Γ]♠ .

P We have† Γ ⊂ Xa = {w ∈ W ; a(x) = a} for some a ∈ N. The A-submodule
 y∈Xa Acy of H can be regarded as an H-module by the rule

                                              X
                                c†x · c†w =          hx,y,z c†z
                                              z∈Xa


with x ∈ W, y ∈ W . By change of scalars (v 7→ 1) this gives rise to an HC = C[W ]-
                                    Xa
module [Xa ]. On the other hand, JC    = ⊕y∈Xa Cty is a left (even two-sided) ideal
in JC . The C-linear map in the lemma extends by the same formula to a C-linear
               Xa ∼
isomorphism JC     −→ [Xa ]♠ . It is enough to show that this is JC -linear. This
follows from the computation in 18.10. The lemma is proved.
                                                         Γ
Lemma 21.3. Let E ∈ IrrJC . The C-linear map u : HomJC (JC , E) −
                                                                → td E given
by ξ 7→ ξ(nd td ) is an isomorphism.
   u is well defined since ξ(nd td ) = td ξ(td ) ∈ td E. We define a linear map in the
opposite direction by e 7→ [j 7→ je]. It is clear that this is the inverse of u. (We
                             Γ
use that jnd td = j for j ∈ JC .) The lemma is proved.
                                           P
Proposition 21.4. We have γd = nd E [E : [Γ]]E (sum over all E ∈ IrrW up
to isomorphism).
   An equivalent statement is that tr(nd td , E♠ ) = [E : [Γ]], for E as above. By
                                  Γ
21.2, we have [E : [Γ]] = [E♠ : JC  ]. Hence it remains to show that tr(nd td , E) =
      Γ
[E : JC ] for any E ∈ IrrJC . Since E = ⊕d′ ∈D nd′ td′ E and nd td : E − → E is the
projection to the summand nd td E, we see that tr(nd td , E) = dim(td E). It remains
                               Γ
to show that dim(td E) = [E : JC ]. This follows from 21.3.
Proposition 21.5. [Γ]† , [Γw0 ] are isomorphic in ModW .
    We may identify P [Γ]† with the W -module with C-basis (ey )y∈Γ where s ∈ S
acts by ey 7→ −ey + z∈Γ hs,y,z ez .
    On the other hand we may identify [Γw0 ] P    with the W -module with C-basis
(e′yw0 )y∈Γ where s ∈ S acts by e′yw0 7→ e′yw0 − z∈Γ hs,yw0 ,zw0 e′zw0 .
    The W -module dual to [Γ]† has a C-basis     (e′′y )y∈Γ (dual to (ey )) in which the
action of s ∈ S is given by e′′y 7→ −e′′y + z∈Γ hs,z,y e′′z . We define a C-isomorphism
                                           P
102                                  G. LUSZTIG

between this last space and [Γw0 ] by e′′y 7→ sgn(y)e′yw0 for all y. We show that this
comutes with the action of W . It suffices to show that for any s ∈ S, we have
   (a) −hs,z,y = sgn(y)sgn(z)hs,yw0 ,zw0 for all z 6= y and
   (b) 1 − hs,y,y = −1 + hs,yw0 ,yw0 for all y.
We use 6.6. Assume first that sz > z. If sy > y and y 6= z, both sides of (a) are
0. If sy < y < z then (a) follows from 11.6. If y = sz then both sides of (a) are
−1. If sy < y but y 6< z or y 6= sz then both sides of (a) are 0.
   Assume next that sz < z. If z 6= y then both sides of (a) are 0.
   If sy > y, both sides of (b) are 1. If sy < y, both sides of (b) are −1. Thus
(a),(b) are verified. Since [Γ]† and its dual are isomorphic in ModW (they are
defined over Q), the lemma follows.
Corollary 21.6. Let E ∈ IrrW and let c be the two-sided cell of W such that
         c         †       cw0
E♠ ∈ IrrJC . Then E♠ ∈ IrrJC   .

   Replacing Γ by c in the definition of [Γ] we obtain a W -module [c]. Then 21.2,
21.5 hold with Γ replaced by c with the same proof. Our assumption implies
(by 21.2 for c) that E appears in the W -module [c]. Using 21.5 for c we deduce
                                                                                †
that E † appears in the W -module [cw0 ]. Using 21.2 for cw0 , we deduce that E♠
                            cw0
appears in the JC -module JC    . The corollary follows.

Corollary 21.7. Let E, E ′ ∈ IrrW be such that E ∼LR E ′ . Then E † ∼LR E ′† .
                                                                 ′       c
   By assumption there exists a two-sided cell c such that E♠ , E♠ ∈ IrrJC . By
       †    ′†       cw0
21.6, E♠ , E ♠ ∈ IrrJC . The corollary follows.
                                                                     −1
                                                                   Γ∩Γ
21.8. The results of §19 are applicable to A, the C-subspace JC           of JC spanned
         −1
by Γ ∩ Γ and R = C. This is a C-subalgebra of JC with unit element nd td .
                               Γ∩Γ−1
In 21.9 we will show that JC          is semisimple. It is then clearly split. We take
     Γ∩Γ−1
τ : JC      −
            → C so that τ (tx ) = nd δx,d . (This is the restriction of τ : JC −  → C.)
We have (tx , ty ) = δxy,1 . The bases (tx ) and (tx−1 ) (where x runs through Γ∩Γ−1 )
are dual with respect to (, ).
                                               −1
                                        Γ∩Γ
21.9. We show that the C-algebra JC          is semisimple. It is enough to prove
the analogous statement for the Q-algebra A′ , the Q-span of Γ ∩ Γ−1 in JQ . We
define a Q-bilinear pairing (|) : A′ × A′ → Q by (tx |ty ) = δx,y for x, y ∈ Γ ∩ Γ−1 .
Let j 7→ j̃ be the Q-linear map A′ → A′ given by t̃x = tx−1 for all x. We show
that

(a)                             (j1 j2 |j3 ) = (j2 |j̃1 j3 )

for all j1 , j2 , j3 in our ring. We may assume that j1 = tx , j2 = ty , j3 = tz . Then
(a) follows from
                                   γx,y,z −1 = γx−1 ,z,y−1 .
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                  103

Now let I be a left ideal of A′ . Let I ⊥ = {a ∈ A′ ; (a|I) = 0}. Since (|) is positive
definite, we have A′ = I ⊕ I ⊥ . From (c) we see that I ⊥ is a left ideal. This proves
that A′ is semisimple.
   The same proof could be used to show directly that JC is semisimple.
Proposition 21.10. Let E, E ′ ∈ IrrW , N = x∈Γ∩Γ−1 tr(tx , E♠ )tr(tx−1 , E♠         ′
                                                  P
                                                                                      ).
                                 ′
Then N = fE♠ [E : [Γ]] if E, E are isomorphic and N = 0, otherwise.
                                                        −1
                                                     Γ∩Γ
     If E ∈ IrrJC , then td E is either 0 or in IrrJC      . Moreover, E 7→ td E defines a
bijection between the set of simple JC -modules (up to isomorphism) which appear
                       Γ                            Γ∩Γ−1
in the JC -module JC       and the set of simple JC       -modules (up to isomorphism).
                                       Γ              Γ∩Γ−1
We then have dim(td E) = [E : JC ]. For j ∈ JC               we have tr(j, E) = tr(j, td E).
                       ′
If td E♠ = 0 or td E♠      = 0, then N = 0 and the result is clear. If td E♠ 6= 0 and
t′d E♠ 6= 0 then, by 19.2(e), we see that N = ftd E♠ [E♠ : JC   Γ
                                                                  ] if E, E ′ are isomorphic
                                                                                          Γ
and to 0, otherwise. It remains to show that ftd E♠ = fE♠ , [E : [Γ]] = [E♠ : JC            ]
                                         ′
and the analogous equalities for E . Now ftd E♠ = fE♠ follows from 19.4 applied
                    Γ∩Γ−1
to (A′ , A) = (JC         , JC ); the equality [E : [Γ]] = [E♠ : JC   Γ
                                                                        ] follows from 21.2.
The proposition is proved.

                       22. Constructible representations
22.1. In this chapter we preserve the setup of 20.1.
   We define a class Con(W ) of W -modules (relative to our fixed L : W −  → N)
by induction on ♯S. If ♯S = 0 so that W = {1}, Con(W ) consists of the unit
representation. Assume now that ♯S > 0. Then Con(W ) consists of the W -
                           ′           ′
modules of the form jW            W
                      WI (E ) or jWI (E ) ⊗ sgn for various subsets I ⊂ S, I 6= S
and various E ′ ∈ Con(WI ). (If we restrict ourselves to I such that ♯(S − I) = 1
we get the same class of W -modules, by the transitivity of truncated induction.)
The W -modules in Con(W ) are said to be the constructible representations of W .
   Now the unit representation of W is constructible (it is obtained by truncated
induction from the unit representation of the subgroup with one element). Hence
sgn ∈ Con(W ).
Lemma 22.2. If E ∈ Con(W ), then there exists a left cell Γ of W such that
E = [Γ].
   We argue by induction on ♯S. If ♯S = 0 the result is obvious. Assume now that
♯S > 0. Let E ∈ Con(W ).
                       ′                             ′
   Case 1. E = jWWI (E ) where I ⊂ S, I 6= S and E ∈ Con(WI ). By the induction
hypothesis there exists a left cell Γ′ of WI such that E ′ = [Γ′ ]. Let d ∈ Γ′ ∩ D. By
21.4 we have γdWI = [Γ′ ] = E ′ . By 20.17 we have E = jW       ′      W    WI
                                                          WI (E ) = jWI (γd ) = γd .
                                                                                    W

Let Γ be the left cell of W that contains d. By 21.4 we have γdW = [Γ]. Hence
E = [Γ].
                         ′                                    ′
   Case 2. E = jWWI (E ) ⊗ sgn where I ⊂ S, I 6= S and E ∈ Con(WI ). Then by
Case 1, E ⊗ sgn = [Γ] for some left cell Γ of W . By 21.5 we have E = [Γw0 ]. The
lemma is proved.
104                                                  G. LUSZTIG

Proposition 22.3. For any E ∈ IrrW there exists a constructible representation
of W which contains a simple component isomorphic to E.
   The general case can be easily reduced to the case where W is irreducible.
Assume now that W is irreducible. If L = al for some a > 0, the constructible
representations of W are listed in [L8] and the proposition is easily checked. (See
also the discussion of types A, D in 22.5, 22.26.) In the cases where W is irreducible
but L is not of the form al, the constructible representations are described later
in this chapter and this yields the proposition in all cases.
22.4. Let W = Sn be the group of permutations of 1, 2, . . . , n. We regard W as
a Coxeter group with generators
                   s1 = (1, 2), s2 = (2, 3), . . . , sn−1 = (n − 1, n),
(transpositions). We take L = al where a > 0.
   The simple W -modules (up to isomorphism) are in 1-1 correspondence P     with the
partitions α = (α1 ≥ α2 ≥ . . . ) such that αN = 0 for large N and i αi = n. The
correspondence (denoted by α 7→ πα ) is defined as follows. Let α be as above, let
(α′1 ≥ α′2 ≥ . . . ) be the partition dual to α. Let πα be the simple W -module whose
restriction to Sα1 × Sα2 . . . contains 1 and whose restriction to Sα′1 × Sα′2 . . .
contains the sign representation. We have (a consequence of results of Steinberg):
                                   P            α′
                                           2(        ) + strictly higher powers of v.
                 f(πα )v = v −
                                                 i
                                       i        2


It follows thatP
                    α′i
                          
   (a) aπα = i a    2         and f(πα )♠ = 1.
Lemma 22.5. In the setup of 22.4, a W -module is constructible if and only if it
is simple.

P For any sequence β = (β1 , β2 , . . . ) in N such that βN = 0 for large N and
 i βi = n, we set

                  Iβ = {si ; i ∈ [1, n − 1], i 6= β1 , i 6= β1 + β2 , . . . }.
From 22.4(a) we see easily that, if β is the same as α′ up to order, then
  (a) jW
       WI (sgn) = πα .
          β
Since the sgn ∈ Con(WIβ ), it follows that πα ∈ Con(W ). Thus any simple W -
module is constructible.
   We now show that any constructible representation E of W = Sn is simple. We
may assume that n ≥ 1 and that the analogous result is true for any WI ′ 6= W . We
may assume that E = jW WIβ (C) where β is as above, WIβ 6= W and C ∈ Con(WIβ ).
By the induction hypothesis, C is simple. Since the analogue of (a) holds for WIβ
                                    WI
(instead of W ) we have C = jWIβ (sgn) for some β ′ such that WIβ′ ⊂ WIβ . By the
                                           β′
                                                                                  ′
transitivity of truncated induction we have E = jW
                                                 WI ′ (sgn). Hence, by (a), for β
                                                                       β
instead of β, E is simple. The lemma is proved.
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                    105

22.6. We now develop some combinatorics which is useful for the verification of
22.3 for W of classical type.
   Let a > 0, b ≥ 0 be integers. We can write uniquely b = ar + b′ where r, b′ ∈ N
and b′ < a. Let N ∈ N. Let MN        a,b be the set of multisets Z̃ = {z̃1 ≤ z̃2 ≤ · · · ≤
z̃2N+r } of integers ≥ 0 such that
   (a) if b′ = 0, there are at least N + r distinct entries in Z̃, no entry is repeated
more than twice and all entries of Z̃ are divisible by a;
   (b) if b′ > 0, all inequalities in Z̃ are strict and N entries of Z̃ are divisible by
a and N + r entries of Z̃ are equal to b′ modulo a.
The entries which appear in Z̃ exactly once are called the singles of Z̃; they form
a set Z. The other entries of Z̃ are called the doubles of Z̃.
   For example, the multiset Z̃ 0 whose entries are (up to order)

           0, a, 2a, . . . , (N − 1)a, b′ , a + b′ , 2a + b′ , . . . , (N + r − 1)a + b′

belongs to MN a,b . Clearly, the sum of entries of Z̃ minus the sum of entries of Z̃
                                                                                     0

is ≥ 0 and divisible by a, hence it is equal to an for a well defined n ∈ N said to
be the rank of Z̃. We have
                   2N+r                                  
                    X                                    r
                                            2
                          z̃k = an + aN + N (b − a) + a     + b′ r.
                                                         2
                    k=1


Note that Z̃ 0 has rank 0. Let MN                                            N
                                 a,b;n be the set of multisets of rank n in Ma,b .
We define an (injective) map MN    → MN+1
                               a,b −     a,b  by

      {z̃1 ≤ z̃2 ≤ · · · ≤ z̃2N+r } 7→ {0, b′ , z̃1 + a ≤ z̃2 + a ≤ · · · ≤ z̃2N+r + a}.

This restricts for any n ∈ N to an (injective) map
   (c) MN       → MN+1
          a,b;n −    a,b;n .
It is easy to see that, for fixed n, ♯(MNa,b;n ) is bounded as N → ∞, hence the
maps (c) are bijections for large N . Let Ma,b;n be the inductive limit of MN
                                                                            a,b;n
as N → ∞ (with respect to the maps (c)).
22.7. Let SyN
            a,b;n be the set consisting of all tableaux (or symbols)

                                       λ1 , λ2 , . . . , λN+r
(a)                                       µ1 , µ2 , . . . , µN

where λ1 < λ2 < · · · < λN+r are integers ≥ 0, congruent to b′ modulo a,
µ1 , µ2 , . . . , µN are integers ≥ 0, divisible by a and
                                                               
                    X        X                                 r
                        λi +                    2
                                 µj = an + aN + N (b − a) + a     + b′ r.
                     i        j
                                                               2
106                                            G. LUSZTIG

If we arrange the entries of Λ in a single row, we obtain a multiset Z̃ ∈ MNa,b;n .
                                         N         N
This defines a (surjective) map πN : Sya,b;n −→ Ma,b;n . We define an (injective)
map
   (b) SyN     → SyN+1
         a,b;n −    a,b;n
by associating to (a) the symbol

                            b′ , λ1 + a, λ2 + a, . . . , λN+r + a
                                         0, µ1 + a, µ2 + a, . . . , µN + a.

This is compatible with the map MN          → MN+1
                                        a,b −   a,b  in 22.6 (via πN , πN+1 ).
                          N
   Since for fixed n, ♯(Sya,b;n ) is bounded as N → ∞, the maps (b) are bijections
for large N . Let Sya,b;n be the inductive limit of SyNa,b;n as N → ∞ (with respect
to the maps (b)).
22.8. Let Z̃ = {z̃1 ≤ z̃2 ≤ · · · ≤ z̃2N+r } ∈ MN                a,b;n . Let t be an integer which is
large enough so that the multiset
   (a) {at + b′ − z̃1 , at + b′ − z̃2 , . . . , at + b′ − z̃2N+r }
is contained in the multiset
   (b) {0, a, 2a, . . . , ta, b′ , a + b′ , 2a + b′ , . . . , ta + b′ }
         ¯ be the complement of (a) in (b). Then Z̃
and let Z̃                                                              ¯ ∈ Mt+1−N−r . The sum of
                                                                               a,b
           ¯
entries of Z̃ is
  X                                                X
       (2ka + b′ ) − (at + b′ )(2N + r) +                z̃h
k∈[0,t]                                              h
                                                                       
                             ′             ′                           r
                                                                    2
 = at(t + 1) + (t + 1)b − (at + b )(2N + r) + an + aN + N (b − a) + a     + b′ r
                                                                       2
                                                        
                                                        r
 = an + a(t + 1 − N − r)2 + (t + 1 − N − r)(b − a) + a     + b′ r.
                                                        2
       ¯ has rank n.
Thus, Z̃
                          −1
   We define a bijection πN
                                   ∼  −1
                             (Z̃) −→ πt+1−N−r  ¯ by Λ 7→ Λ where Λ is as in
                                              (Z̃)
22.7(a) and Λ is

       {b′ , a + b′ , 2a + b′ , 3a + b′ , . . . , ta + b′ }
          − {at + b′ − µ1 , at + b′ − µ2 , . . . , at + b′ − µN }
       {0, a, 2a, 3a, . . . , ta} − {at + b′ − λ1 , at + b′ − λ2 , . . . , at + b′ − λN+r }.

22.9. Let W = Wn be the group of permutations of 1, 2, . . . , n, n′ , . . . , 2′ , 1′ which
commute with the involution i 7→ i′ , i′ 7→ i. We regard Wn as a Coxeter group
with generators s1 , s2 , . . . , sn given as products of transpositions by
   s1 = (1, 2)(1′ , 2′ ), s2 = (2, 3)(2′ , 3′ ), . . . , sn−1 = (n − 1, n)((n − 1)′ , n′ ),
   sn = (n, n′ ).
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                            107

22.10. A permutation in W defines a permutation of the n element set consisting
of the pairs (1, 1′ ), (2, 2′ ), . . . , (n, n′ ). Thus we have a natural homomorphism of
Wn onto Sn , the symmetric group in n letters. Define a homomorphism χn :
Wn − → ±1 by
   χn (σ) = 1 if {σ(1), σ(2), . . . , σ(n)} ∩ {1′ , 2′ , . . . , n′ } has even cardinal,
   χn (σ) = −1, otherwise.
The simple W -modules (up to isomorphism) are in 1-1 correspondence with the
ordered pairs α, β where α = (α1 ≥ α2 ≥ . . . ) and β                 P= (β1 P  ≥ β2 ≥ . . . ) are
partitions such that αN = βN = 0 for large N and i αi + j βj = n. The
correspondence (denoted by α, β 7→ E α,β ) is defined as follows. Let α, β be as
above, let (α′1 ≥ α′2 ≥ . . . ) be the partition  P
                                                                                  ′      ′
                                                           P to α and let (β1 ≥ β2 ≥ . . . )
                                                         dual
be the partition dual to β. Let k = i αi , l = j βj . Let πα be the simple Sk -
module defined as in 22.4 and let πβ be the analogously defined simple Sl -module.
We regard πα , πβ as simple modules of Wk , Wl via the natural homomorphisms
Wk − → Sk , Wl − → Sl as above. We identify Wk × Wl with the subgroup of W
consisting of all permutations in W which map 1, 2, . . . , k, k ′ , . . . , 2′ , 1′ into itself
hence also map k + 1, k + 2, . . . , n, n′ , . . . , (k + 2)′ , (k + 1)′ into itself. Consider
the representation πα ⊗ (πβ ⊗ χl ) of Wk × Wl . We induce it to W ; the resulting
representation of W is irreducible; we denote it by E α,β .
   We fix a > 0, b ≥ 0 and we write b = ar + b′ as in 22.6.
   Let α, β be as above. Let N be an integer such that αN+r+1 = 0, βN+1 = 0.
(Any large enough integer satisfies these conditions.) We set

λi = a(αN+r−i+1 +i−1)+b′ , (i ∈ [1, N +r]),                         µj = a(βN−j+1 +j −1), (j ∈ [1, N ]).

We have 0 ≤ λ1 < λ2 < · · · < λN+r , 0 ≤ µ1 < µ2 < · · · < µN . Let Λ denote
the tableau 22.7(a). It is easy to see that Λ ∈ SyN a,b;n . Moreover, if N is replaced
by N + 1, then Λ is replaced by its image under SyN          → SyN+1
                                                       a,b;n −    a,b;n (see 22.7). Let
          α,β
[Λ] = E . Note that [Λ] depends only on the image of Λ under the canonical
map SyN  a,b;n −
               → Sya,b;n . In this way, we see that
   the simple W -modules are naturally in bijection with the set Sya,b;n .
For i ∈ [1, N ] we have a(αN−i+1 +i−1)+b = a(αN+r−i−r+1 +i+r −1)+b′ = λi+r .
   If N is large we have λi = a(i − 1) + b′ for i ∈ [1, r] and µj = a(j − 1) for
j ∈ [1, r].
22.11. Let q, y be indeterminates. With the notation in 22.10, let

                                         P          ′     Y q αi +α′j −i−j+1 − 1
                        Hα (q) = q   −       i   (α2i )                            ,
                                                          i,j
                                                                      q−1
                                         P
                                                 α′i βi′ /2            ′
                                                              Y
                   Gα,β (q, y) = q −         i                 (q αi +βj −i−j+1 y + 1);
                                                              i,j

both products are taken over all i ≥ 1, j ≥ 1 such that αi ≥ j, α′j ≥ i.
108                                               G. LUSZTIG

   Define a weight function L : W − → N by L(s1 ) = L(s2 ) = · · · = L(sn−1 ) = a,
L(sn ) = b. We now assume that both a, b are > 0. We also assume that a, b are
such that W, L satisfies the assumptions of 18.1. Then fEvα,β is defined in terms of
this L.
Lemma 22.12 (Hoefsmit [H]). We have

                   fEvα,β = Hα (v 2a )Hβ (v 2a )Gα,β (v 2a , v 2b )Gβ,α (v 2a , v −2b ).


  We will rewrite the expression above using the following result.
Lemma 22.13. Let N be a large integer. We have

                            P
                                                     QN Q                            q h −1
                                     i
              Hα (q) = q i∈[1,N −1] (2) Q
                                                       i=1        h∈[1,αN −i+1 +i−1] q−1
                                                                                                     ,
                                                           q αN −j+1 +j−1 −q αN −i+1 +i−1
                                                   1≤i<j≤N              q−1



                                          P                  √   √ −1
                                                           i2
      Gα,β (q, y)Gβ,α (q, y −1 ) = q         i∈[1,N −1]     ( y + y )N
        QN Q                                  h
                                                           QN Q                                 h −1
             i=1     h∈[1,αN −i+1 +i−1] (q        y + 1)        j=1    h∈[1,βN −j+1 +j−1] (q     y       + 1)
      ×                                                                                                         .
                                          αN −i+1 +i−1 √              βN −j+1 +j−1 √ −1
                        Q
                           i,j∈[1,N] (q                         y+q                     y   )


  The proof is by induction on n. We omit it.
Proposition 22.14. (a) If b′ = 0 then f[Λ]♠ is equal to 2d where 2d + r is the
number of singles in Λ. If b′ > 0 then f[Λ]♠ = 1.
  (b) We have a[Λ] = AN − BN where
                   X                                   X                                    X
AN =                          min(λi , µj ) +                         min(λi , λj ) +                min(µi , µj ),
          i∈[1,N+r],j∈[1,N]                        1≤i<j≤N+r                            1≤i<j≤N



                   X
BN =                          min(a(i − 1) + b′ , a(j − 1))
          i∈[1,N+r],j∈[1,N]
          X                                                               X
 +                  min(a(i − 1) + b′ , a(j − 1) + b′ ) +                        min(a(i − 1), a(j − 1)).
      1≤i<j≤N+r                                                        1≤i<j≤N



  It is enough to prove (a) assuming that N is large. Since
                                          
                                 N      N +r
AN+1 − AN       = a(N + r)N + a     +a         + b′ N + b′ (N + r) = BN+1 − BN ,
                                 2        2
                    HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                             109

we have AN+1 − BN+1 = AN − BN hence it is enough to prove (b) assuming that
N is large. In the remainder of the proof we assume that N is large.
   For f, f ′ ∈ C(v) we write f ∼
                                = f ′ if f ′ = f g with g ∈ C(v), g|v=0 = 1. Using
22.12, 22.13, we see that

                f[Λ]v ∼
                            Y
                      =          (v 2a−2b + 1)(v 4a−2b + 1) . . . (v 2µi −2b + 1)
                          i∈[1,N]
                                      PN −1
                                              (2i2 −i)
                                                           Y
                (v b + v −b )N v 2a    i=1                       (v 2λi+r −b + v 2µj −b )−1
                                                         i,j∈[1,N]
                    Y                                                   Y
                           (v 2λj+r −2b − v 2λi+r −2b )−1                     (v 2µj − v 2µi )−1
                1≤i<j≤N                                          1≤i<j≤N


hence
                          f[Λ]v = 2d v −K + strictly higher powers of v

where d = 0 if b′ > 0,

     d = ♯(j ∈ [1, N ] : b ≤ µj ) − ♯(i, j ∈ [1, N ] : λi+r = µj )
     = N − ♯(i ∈ [1, r], j ∈ [1, N ] : (i − 1)a = µj ) − ♯(i, j ∈ [1, N ] : λi+r = µj )
     = N − ♯(i ∈ [1, r], j ∈ [1, N ] : λi = µj ) − ♯(i, j ∈ [1, N ] : λi+r = µj )
     = N − ♯(i ∈ [1, N + r], j ∈ [1, N ] : λi = µj ) = (♯ singles − r)/2,

if b′ = 0,
                                      X                         X          X
        − K = −bN + 2a                        (2i2 − i) +                       (2ak − 2b)
                                i∈[1,N−1]                      j∈[1,N] k∈[1,r]
                                                                       ak≤µj
               X                                               X
        −            (−b + 2 min(λi+r , µj )) −                          (−2b + 2 min(λi+r , λj+r ))
             i,j∈[1,N]                                      1≤i<j≤N
                X                                                X
        −                2 min(µi , µj ) = −bN + 2a                         (2i2 − i) + 2bN 2 − bN
             1≤i<j≤N                                          i∈[1,N−1]
              X            X                                 X
        +                             (2ak − 2b) −                     2 min(λi+r , µj )
             j∈[1,N] k∈[1,r],ak≤µj                        i,j∈[1,N]
                X                                         X
        −                2 min(λi+r , λj+r ) −                       2 min(µi , µj )
             1≤i<j≤N                                1≤i<j≤N
               X           X                                 X
        =                             (2ak − 2b) −                     2 min(λi+r , µj )
             j∈[1,N] k∈[1,r],ak≤µj                        i,j∈[1,N]
                X                                         X
        −                2 min(λi+r , λj+r ) −                       2 min(µi , µj ) + ⋆.
             1≤i<j≤N                                1≤i<j≤N
110                                            G. LUSZTIG

(We will generally write ⋆ for an expression which depends only on a, b, N .) We
have
             X                   X                  X
                  (2ak − 2b) =       (2ak − 2b) +        (2ak − 2b)
                 j∈[1,N]                    j∈[1,r]                j∈[r+1,N]
                 k∈[1,r]                    k∈[1,r]                 k∈[1,r]
                 ak≤µj                      ak≤µj                    ak≤µj
                          X                            X
                 =               (2ak − 2b) +                 (2ak − 2b) = ⋆,
                       j∈[1,r]                    j∈[r+1,N]
                       k∈[1,r]                     k∈[1,r]
                     ak≤a(j−1)

hence
  −K
              X                                X                                   X
  = −2(                 min(λi+r , µj ) −                min(λi+r , λj+r ) −               min(µi , µj ))
            i,j∈[1,N]                       1≤i<j≤N                              1≤i<j≤N
      ⋆
  + .
We have
    X                                       X
                   min(λi , µj ) =                     min(a(i − 1) + b′ , µj )
 i∈[1,r],j∈[1,N]                     i∈[1,r],j∈[1,N]
            X                                                      X
 =                      min(a(i − 1) + b′ , a(j − 1)) +                          min(a(i − 1) + b′ , µj )
      i∈[1,r],j∈[1,r]                                        i∈[1,r],j∈[r+1,N]
            X                                                      X
 =                      min(a(i − 1) + b′ , a(j − 1)) +                        (a(i − 1) + b′ ) = ⋆,
      i∈[1,r],j∈[1,r]                                        i∈[1,r],j∈[r+1,N]

hence                X                                     X
                              min(λi+r , µj ) =                       min(λi , µj ) + ⋆.
                  i,j∈[1,N]                       i∈[1,N+r],j∈[1,N]

We have
            X                                X                               X
                        min(λi , λj ) =               min(λi+r , λj+r ) +             λi (N + r − i)
        1≤i<j≤N+r                         1≤i<j≤N                           i∈[1,r]
              X                                  X
        =                min(λi+r , λj+r ) +           (a(i − 1) + b′ )(N + r − i)
            1≤i<j≤N                            i∈[1,r]
              X
        =                min(λi+r , λj+r ) + ⋆.
            1≤i<j≤N

We see that
(c)                                        −K = −2AN + ⋆.
In the special case where α = β = (0 ≥ 0 ≥ . . . ) we have K = 0. On the other
hand, by (c), we have 0 = −2BN + ⋆ where ⋆ is as in (c). Hence in general we have
−K = −2AN + 2BN . This proves the proposition, in view of 20.11 and 20.21(a).
                    HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                            111

22.15. We identify Sk × Wl (k + l = n) with the subgroup of W consisting
of all permutations in W which map {1, 2, . . . , k} into itself (hence also map
{1′ , 2′ , . . . , k ′ } and {k+1, . . . , n, n′ , . . . , (k+1)′ } into themselves. This is a standard
parabolic subgroup of W . We consider an irreducible representation of Sk × Wl of
the form sgnk ⊠ [Λ′ ] where sgnk is the sign representation of Sk and Λ′ ∈ SyN                     a,b;l .
We may assume that Λ′ has at least k entries. We want to associate to Λ′ a symbol
                                                                               ′
in SyN a,b;n by increasing each of the k largest entries in Λ by a. It may happen
that the set of r largest entries of Λ′ is not uniquely defined but there are two
choices for it. (This can only happen if b′ = 0.) Then the same procedure gives
rise to two distinct symbols ΛI , ΛII in SyN                 a,b;n .

Lemma 22.16. (a) g(sgnk ⊗[Λ′ ])♠ = g[Λ′ ]♠ is equal to g[Λ]♠ or to g[ΛI ]♠ + g[ΛII ]♠ .
  (b) asgnk ⊗[Λ′ ] = a k2 + a[Λ′ ] is equal to a[Λ] or to a[ΛI ] = a[ΛII ] .
                         

   Λ, if defined, has the same number of singles as Λ′ . Moreover, ΛI (and ΛII ), if
defined, has one more single than Λ′ . Hence (a) follows from 22.14(a) using 20.18,
20.19.
   By 22.14(b), the difference a[Λ̃] − a[Λ] (where Λ̃ is either Λ or ΛI or ΛII ) is a
times the number of i < j in [1, k]. Thus, it is a k2 . Hence (a) follows from 20.18,
                                                     

20.19. The lemma is proved.
                               ′
Lemma 22.17. jW                                    I      II
              Sk ×Wl (sgnk ⊗ [Λ ]) equals [Λ] or [Λ ] + [Λ ].

   By a direct computation (involving representations of symmetric groups) we
see that:
   (a) if Λ is defined then [[Λ′ ] : [Λ]] ≥ 1;
   (b) if ΛI , ΛII are defined then [[Λ′ ] : [ΛI ]] ≥ 1 and [[Λ′ ] : [ΛII ]] ≥ 1.
In the setupPof (a) we have (by 20.14(b)):
   g[Λ′ ]♠ = E;aE =aE′ [[Λ′ ] : E]gE♠ hence using 22.16(a) we have

                                               X
(c)                              g[Λ]♠ =                 [[Λ′ ] : E]gE♠ .
                                            E;aE =aE ′

By 22.16(b), E = [Λ] enters in the last sum and its contribution is ≥ g[Λ]♠ ; the
contribution of the other E is ≥ 0 (see 20.13(b)). Hence (c) forces [[Λ′ ] : [Λ]] = 1
and [[Λ′ ] : E] = 0 for all other E in the sum. In this caseP the lemma follows.
                                                                              ′
   In the setup of (b) we have (by 20.14(b)) g[Λ′ ]♠ =          E;aE =aE ′ [[Λ ] : E]gE♠
hence, by 22.16(a),
                                             X
(d)                    g[ΛI ]♠ + g[ΛII ]♠ =       [[Λ′ ] : E]gE♠ .
                                                  E;aE =aE ′

By 22.16(b), E = [ΛI ] and E = [ΛII ] enter in the last sum and their contribution
is ≥ g[ΛI ]♠ + g[ΛII ]♠ ; the contribution of the other E is ≥ 0 (see 20.13(b)). Hence
(d) forces [[Λ′ ] : [ΛI ]] = [[Λ′ ] : [ΛII ]] = 1 and [[Λ′ ] : E] = 0 for all other E in the
sum. The lemma follows.
112                                     G. LUSZTIG

Lemma 22.18. [Λ] ⊗ sgn = [Λ]. (Notation of 22.14.)
  This can be reduced to a known statement about the symmetric group. We
omit the details.
22.19. Let Z be a totally ordered finite set z1 < z2 < · · · < zM . For any r ∈ [0, M ]
such that r = M mod 2 let Z r be the set of subsets of Z of cardinal (M − r)/2.
An involution ι : Z − → Z is said to be r-admissible if the following hold:
   (a) ι has exactly r fixed points;
   (b) if M = r, there is no further condition; if M > r, there exist two consecutive
elements z, z ′ of Z such that ι(z) = z ′ , ι(z ′ ) = z and the induced involution of
Z − {z, z ′ } is r-admissible.
Let Invr (Z) be the set of r-admissible involutions of Z. To ι ∈ Invr (Z) we associate
a subset Sι of Z r as follows: a subset Y ⊂ Z is in Sι if it contains exactly one
element in each non-trivial ι-orbit. Clearly, ♯(Sι ) = 2p0 where p0 = (M − r)/2.
(In fact, Sι is naturally an affine space over the field F2 .)
Lemma 22.20. Assume that p0 > 0. Let Y ∈ Z r .
    (a) We can find two consecutive elements z, z ′ of Z such that exactly one of
z, z ′ is in Y .
    (b) There exists ι ∈ Invr (Z) such that Y ∈ Sι .
    (c) Assume that for some k ∈ [0, p0 −1], z1 , z2 , . . . , zk belong to Y but zk+1 ∈
                                                                                       / Y.
Let l be the smallest number such that l > k and zl ∈ Y . There exists ι ∈ Invr (Z)
such that Y ∈ Sι and ι(zl ) = zl−1 .
   We prove (a). Let zk be the smallest element of Y . If k > 1 then we can
take (z, z ′ ) = (zk−1 , zk ). Hence we may assume that z1 ∈ Y . Let zk′ be the next
smallest element of Y . If k ′ > 2 then we can take (z, z ′ ) = (zk′ −1 , zk′ ). Continuing
like this we see that we may assume that Y = {z1 , z2 , . . . , zp0 }. Since p0 < M , we
may take (z, z ′ ) = (zp0 , zp0 +1 ).
   We prove (b). Let z, z ′ be as in (a). Let Z ′ = Z − {z, z ′ } with the induced
order. Let Y ′ = Y ∩ Z ′ . If p0 ≥ 2 then by induction on p0 we may assume that
there exists ι′ ∈ Invr (Z ′ ) such that Y ′ ∈ Sι′ . Extend ι′ to an involution ι of Z by
z 7→ z ′ , z ′ 7→ z. Then ι ∈ Invr (Z) and Y ∈ Sι . If p0 = 1, define ι : Z −  → Z so that
z 7→ z ′ , z ′ 7→ z and ι = 1 on Z − {z, z ′ }. Then ι ∈ Invr (Z) and Y ∈ Sι .
   We prove (c). We have l ≥ k + 2. Hence zl−1 ∈           / Y . Let (z, z ′ ) = (zl−1 , zl ).
We continue as in the proof of (b), except that instead of invoking an induction
hypothesis, we invoke (b) itself.
22.21. Assume that M > r. We consider the graph whose set of vertices is Z r
and in which two vertices Y 6= Y ′ are joined if there exists ι ∈ Invr (Z) such that
Y ∈ Sι , Y ′ ∈ Sι .
Lemma 22.22. This graph is connected.
  We show that any vertex Y = {zi1 , zi2 , . . . , zip0 } is in the same connected
component as Y0 = {z1 , z2 , . . . , zp0 }. We argue by induction on mY = i1 + i2 +
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                     113

· · · + ip0 . If mY = 1 + 2 + · · · + p0 then Y = Y0 and there is nothing to prove.
Assume now that m > 1 + 2 + · · · + p0 so that Y 6= Y0 . Then the assumption of
Lemma 22.20(c) is satisfied. Hence we can find l such that zl ∈ Y, zl−1 ∈    / Y and
                                                       ′
ι ∈ Invr (Z) such that Y ∈ Sι and ι(zl ) = zl−1 . Let Y = (Y − {zl }) ∪ {zl−1 }. Then
Y ′ ∈ Sι hence Y, Y ′ are joined in our graph. We have mY ′ = mY − 1 hence by the
induction hypothesis Y ′ , Y0 are in the same connected component. It follows that
Y, Y0 are in the same connected component. The lemma is proved.
22.23. Assume that b′ = 0. Let Z̃ ∈ MN    a,b;n . Let Z be the set of singles of Z̃.
                                                 −1
Each set Y ∈ Z r gives rise to a symbol ΛY in πN    (Z̃): the first row of ΛY consists
of Z − Y and one element in each double of Z̃; the second row consists of Y and
one element in each double of Z̃. For any ι ∈ Invr (Z) we set
                             c(Z̃, ι) = ⊕Y ∈Sι [ΛY ] ∈ ModW.
Proposition 22.24. (a) In the setup of 22.23, let ι ∈ Invr (Z). Then c(Z̃, ι) ∈
Con(W ).
  (b) All constructible representations of W are obtained as in (a).
   We prove (a) by induction on n. If n = 0 the result is clear. Assume that n ≥ 1.
We may assume that 0 is not a double of Z̃. Let at be the largest entry of Z̃.
   (A) Assume that there exists i, 0 ≤ i < t, such that ai does not appear in Z̃.
Then Z̃ is obtained from Z̃ ′ ∈ MN      a,b;n−k with n − k < n by increasing each of
the k largest entries by a and this set of largest entries is unambiguously defined.
The set Z ′ of singles of Z̃ ′ is naturally in order preserving bijection with Z. Let
ι′ correspond to ι under this bijection. By the induction hypothesis, c(Z̃ ′ , ι′ ) ∈
Con(Wn−k ). Since, by 22.5, the sign representation sgnk of Sk is constructible, it
follows that sgnk ⊠ c(Z̃ ′ , ι′ ) ∈ Con(Sk × Wn−k ). Using 22.17, we have
                                                ′ ′
                          jW
                           Sk ×Wn−k (sgnk ⊠ c(Z̃ , ι )) = c(Z̃, ι)

hence c(Z̃, ι) ∈ Con(W ).
                                                                                  ¯ be
    (B) Assume that there exists i, 0 < i ≤ t such that ai is a double of Z̃. Let Z̃
                                                               ¯ and the largest entry
as in 22.8 (with respect to our t). Then 0 is not a double of Z̃
    ¯ is at. Let Z̄ be the set of singles of Z̃.
of Z̃                                          ¯ We have Z̄ = {at − z; z ∈ Z}. Thus
Z̄, Z are naturally in (order reversing) bijection under j 7→ at −j. Let ι′ ∈ Invr (Z̄)
correspond to ι under this bijection. Since at − ai does not appear in Z̃,    ¯ (A) is
applicable to Z̃.   ¯ Hence c(Z̃,
                              ¯ ι′ ) ∈ Con(W ). By 22.18 we have c(Z̃,
                                                                   ¯ ι′ )⊗sgn = c(Z̃, ι)
hence c(Z̃, ι) ∈ Con(W ).
    (C) Assume that we are not in case (A) and not in case (B). Then Z̃ =
{0, a, 2a, . . . , ta} = Z. We can find ia, (i + 1)a in Z such that ι interchanges
ia, (i + 1)a and induces on Z − {ia, (i + 1)a} an r-admissible involution ι1 . We
have
       Z̃ ′ = {0, a, 2a, . . . , ia, ia, (i + 1)a, (i + 2)a, . . . , (t − 1)a} ∈ MN
                                                                                  a,b;n−k
114                                         G. LUSZTIG

with n − k < n. The set of singles of Z̃ ′ is

                    Z ′ = {0, a, 2a, . . . , (i − 1)a, (i + 1)a, . . . , (t − 1)a}.

It is in natural (order preserving) bijection with Z −{ia, (i+1)a}. Hence ι1 induces
ι′ ∈ Invr (Z ′ ). By the induction hypothesis we have c(Z̃ ′ , ι′ ) ∈ Con(Wn−k ). Hence
sgnk ⊠ c(Z̃ ′ , ι′ ) ∈ Con(Sk × Wn−k ) where sgnk is as in (A). By 22.17 we have
                                                  ′ ′
                            jW
                             Sk ×Wn−k (sgnk ⊠ c(Z̃ , ι )) = c(Z̃, ι)


hence c(Z̃, ι) ∈ Con(W ). This proves (a).
   We prove (b) by induction on n. If n = 0 the result is clear. Assume now
that n ≥ 1. By an argument like the ones used in (B) we see that the class of
representations of W obtained in (a) is closed under ⊗sgn. Therefore, to show
                                                                           ′
that C ∈ Con(W ) is obtained in (a), we may assume that C = jW  Sk ×Wn−k (C ) for
some k > 0 and some C ′ ∈ Con(Sk × Wn−k ). By 22.5 we have C ′ = E ⊠ C ′′
where E is a simple Sk -module and C ′′ ∈ Con(Wn−k ). Using 22.5(a) we have
E = jS                  ′         ′   ′′     ′         ′
      Sk′ ×Sk′′ (sgn ⊠ E ) where k + k = k, k > 0 and E is a simple Sk -module.
       k
                                                                      ′′

           W    ′
Let C̃ = jSkn−k
             ′′ ×Wn−k
                      (E ′ ⊗ C ′ ) ∈ Con(Wn−k′ ). Then C = jW
                                                            Sk′ ×Wn−k′ (sgnk′ ⊗ C̃).
By the induction hypothesis, C̃ is of the form described in (a). Using an argument
as in (A) or (C) we deduce that C is of the form described in (a). The proposition
is proved.
Proposition 22.25. Assume that b′ > 0.
  (a) Let E ∈ IrrW . Then E ∈ Con(W ).
  (b) All constructible representations of W are obtained as in (a).
     We prove (a). We may assume that E = [Λ] where Λ ∈ SyN       a,b;n does not contain
                ′
both 0 and b . We argue by induction on n. If n = 0 the result is clear. Assume
now that n ≥ 1.
     (A) Assume that either (1) there exist two entries z, z ′ of Λ such that z ′ − z > a
and there is no entry z ′′ of Λ such that z < z ′′ < z ′ , or (2) there exists an
entry z ′ of Λ such that z ′ ≥ a and there is no entry z ′′ of Λ such that z ′′ <
z ′ . Let Λ′ be the symbol obtained from Λ by substracting a from each entry
z̃ of Λ such that z̃ ≥ z ′ and leaving the other entries of Λ unchanged. Then
Λ′ ∈ SyN                                                                ′
          a,b;n−k with n − k < n. By the induction hypothesis, [Λ ] ∈ Con(Wn−k ).
Since, by 22.5, the sign representation sgnk of Sk is constructible, it follows that
sgnk ⊠ [Λ′ ] ∈ Con(Sk × Wn−k ). Using 22.17, we have jW                          ′
                                                           Sk ×Wn−k (sgnk ⊠ [Λ ]) = [Λ]
hence [Λ] ∈ Con(W ).
     (B) Assume that there exist two entries z, z ′ of Λ such that 0 < z ′ − z < a. Let
t be the smallest integer such that at + b′ ≥ λi for all i ∈ [1, N + r] and at ≥ µj
                               t+1−N−r
for all j ∈ [1, N ]. Let Λ ∈ Sya,b;n    be as in 22.8 with respect to this t. Then Λ
                                ′
does not contain both 0 and b . Now (A) is applicable to Λ. Hence [Λ] ∈ Con(W ).
By 22.18 we have [Λ] ⊗ sgn = [Λ] hence [Λ] ∈ Con(W ).
                  HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                        115

   (C) Assume that we are not in case (A) and not in case (B). Then the entries
of Λ are either 0, a, 2a, . . . , ta or b′ , a + b′ , 2a + b′ , . . . , ta + b′ . This cannot happen
for n ≥ 1. This proves (a).
   The proof of (b) is entirely similar to that of 22.24(b). The proposition is
proved.
22.26. We now assume that n ≥ 2 and that W ′ = Wn′ is the kernel of χn : Wn −             →
±1 in 22.10. We regard Wn′ as a Coxeter group with generators s1 , s2 , . . . , sn−1 as
in 22.9 and s′n = (n−1, n′ )((n−1)′ , n) (product of transpositions). Let L : W ′ −    →N
be the weight function given by L(w) = al(w) for all w. Here a > 0.
   For Λ ∈ SyN  a,0 we denote by Λ
                                        tr
                                            the symbol whose first (resp. second) row is
the second (resp. first) row of Λ. We then have Λtr ∈ SyN         a,0 . From the definitions
we see that the simple Wn -modules [Λ], [Λ ] have the same restriction to W ′ ;
                                                   tr

this restriction is a simple W ′ -module [Λ] if Λ 6= Λtr and is a direct sum of two
non-isomorphic simple W ′ -modules [I Λ],[II Λ] if Λ = Λtr . In this way we see that
   the simple W ′ -modules are naturally in bijection with the set of orbits of the
involution of Sya,0;n induced by Λ 7→ Λtr except that each fixed point of this invo-
lution corresponds to two simple W ′ -modules.
   Let Z̃ ∈ MN   a,0;n . Let Z be the set of singles of Z̃. Assume first that Z 6= ∅.
Each set Y ∈ Z 0 gives rise to a symbol ΛY in SyN       a,0;n : the first row of ΛY consists
of Z − Y and one element in each double of Z̃; the second row consists of Y and
one element in each double of Z̃. For any ι ∈ Inv0 (Z) we define c(Z̃, ι) ∈ ModW
by
                         c(Z̃, ι) ⊕ c(Z̃, ι) = ⊕Y ∈Sι [ΛY ] ∈ ModW.
Note that Y and Z − Y have the same contribution to the sum. A proof entirely
similar to that of 22.24 shows that c(Z̃, ι) ∈ Con(W ). Moreover, if Z = ∅ and Λ =
Λtr ∈ SyN                                       I                  II
         a,1;n is defined by πN (Λ) = Z̃, then [ Λ] ∈ Con(W ) and [ Λ] ∈ Con(W ).
All constructible representations of W are obtained in this way.
22.27. Assume that W is of type F4 and that the values of L : W −
                                                                → N on S are
a, a, b, b where a > b > 0.
   Case 1. Assume that a = 2b. There are four simple W -modules ρ1 , ρ2 , ρ8 , ρ9
(subscript equals dimension) with a = 3b. Then

                            ρ1 ⊕ ρ8 , ρ2 ⊕ ρ9 , ρ8 ⊕ ρ9 ∈ Con(W ).

(They are obtained by j from the WI of type B3 with parameters a, b, b.)
  The simple W -modules ρ†1 , ρ†2 , ρ†8 , ρ†9 have a = 15b and

                            ρ†1 ⊕ ρ†8 , ρ†2 ⊕ ρ†9 , ρ†8 ⊕ ρ†9 ∈ Con(W ).

There are five simple W -modules ρ12 , ρ16 , ρ6 , ρ′6 , ρ4 (subscript equals dimension)
with a = 7b. Then

                   ρ4 ⊕ ρ16 , ρ12 ⊕ ρ16 ⊕ ρ6 , ρ12 ⊕ ρ16 ⊕ ρ′6 ∈ Con(W ).
116                                   G. LUSZTIG

All 12 simple W -modules other than the 13 listed above, are constructible. All
constructible representations of W are thus obtained.
   Case 2. Assume that a ∈  / {b, 2b}. The simple W -modules ρ12 , ρ16 , ρ6 , ρ′6 , ρ4 in
Case 1 now have a = 3a + b and

                 ρ4 ⊕ ρ16 , ρ12 ⊕ ρ16 ⊕ ρ6 , ρ12 ⊕ ρ16 ⊕ ρ′6 ∈ Con(W ).

All 20 simple W -modules other than the 5 listed above, are constructible. All
constructible representations of W are thus obtained.
22.28. Assume that W is of type G2 and that the values of L : W −       → N on S
are a, b where a > b > 0. Let ρ2 , ρ′2 be the two 2-dimensional simple W -modules.
They have a = a and ρ2 ⊕ ρ′2 is constructible. All 4 simple W -modules other than
the 2 listed above, are constructible. All constructible representations of W are
thus obtained.
22.29. Let L be the set of all weight functions L : W −   → N such that L(s) > 0
for all s ∈ S. We assume that P 1 − P 15 in §14 hold for any L ∈ L. For L, L′ ∈ L
we write L ∼ L′ if the constructible representations of W with respect to L are
the same as those with respect to L′ . This is an equivalence relation on L. From
the results in this chapter we see that any equivalence class for ∼ contains some
L which is attached to some (G, F, P, E) as in 0.3.
   We expect that the constructible representations of W are exactly the represen-
tations of W carried by the left cells of W (for fixed L ∈ L). (For L = l this holds
by [L8]. For W of type F4 and general L this holds by [G].) This would imply
that for L, L′ ∈ L we have L ∼ L′ if and only if the representations of W carried
by the left cells of W with respect to L are the same as those with respect to L′ .

                               23. Two-sided cells
23.1. We preserve the setup of 20.1. We define a graph GW as follows. The
vertices of GW are the simple W -modules up to isomorphism. Two non-isomorphic
simple W -modules are joined in GW if they both appear as components of some
constructible representation of W . Let G∼W be the set of connected components of
GW . The connected components of GW are determined explicitly by the results in
§22 for W irreducible.
   For example, in the setup of 22.4,22.5 we have GW = G∼W . In the setup of 22.24,
GW
 ∼ is naturally in bijection with Ma,b;n . (Here, 22.22 is used). In the setup of
22.25, we have GW = G∼W .
   We show that:
   (a) if E, E ′ are in the same connected component of GW then E ∼LR E ′ .
We may assume that both E, E ′ appear in some constructible representation of
W . By 22.2, there exists a left cell Γ such that [E : [Γ]] 6= 0, [E ′ : [Γ]] 6= 0. By
                                    ′
21.2, we have [E♠ : JC  Γ
                          ] 6= 0, [E♠    Γ
                                      : JC ] 6= 0. Hence E ∼LR E ′ , as desired.
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                 117

23.2. Let cW be the set of two-sided cells of W, L. Consider the (surjective) map
IrrW − → cW which to E associates the two-sided cell c such that E ∼LR x for
x ∈ c. By 23.1 this induces a (surjective) map
   (a) ωW : G∼W −
                → cW .
We conjecture that ωW is a bijection. This is made plausible by:
Proposition 23.3. Assume that W, L is split. Then ωW is a bijection.
    Let E, E ′ ∈ IrrW be such that E ∼LR E ′ . By 22.3, we can find constructible
representations C, C ′ such that [E : C] 6= 0, [E ′ : C ′ ] 6= 0. By 22.2, we can find
left cells Γ, Γ′ such that C = [Γ], C ′ = [Γ′ ]. Then [E : [Γ]] 6= 0, [E ′ : [Γ′ ]] 6= 0.
Let d ∈ D ∩ Γ, d′ ∈ D ∩ Γ′ . Since γd = [Γ] and [E : [Γ] 6= 0, we have E ∼LR d.
Similarly, E ′ ∼LR d′ . Hence d′ ∼LR d′ . By 18.4(c), there exists u ∈ W such that
td tu td′ 6= 0. (Here we use the splitness assumption.) Note that j 7→ jtu td′ is a
                    Γ     Γ′
JC -linear map JC     −
                      → JC   . This map is non-zero since it takes td to td tu td′ 6= 0.
                       Γ′
Thus, HomJC (JC , JC ) 6= 0. Using 21.2, we deduce that HomW ([Γ], [Γ′ ]) 6= 0.
                   Γ

Hence there exists Ẽ ∈ IrrW such that Ẽ is a component of both [Γ] = C and
[Γ′ ] = C ′ . Thus, both E, Ẽ appear in C and both Ẽ, E ′ appear in C ′ . Hence E, E ′
are in the same connected component of GW . The proposition is proved.
23.4. Assume now that W, S, L, W̃ , ι are as in 16.2 and W̃ is an irreducible Weyl
group.
   Let c!W̃ be the set of all ι-stable two-sided cells of W̃ . Let c⋆W̃ be the set of all
two-sided cells of W̃ which meet W . We have c⋆W̃ ⊂ c!W̃ ⊂ cW̃ . Let f : cW −     → c⋆W̃
be the map which attaches to a two-sided cell of W the unique two-sided cell of
W̃ containing it; this map is well defined by 16.20(b) and is obviously surjective.
                                                                     → c⋆W̃ is
Proposition 23.5. In the setup of 23.4, ωW is a bijection and f : cW −
a bijection.
   Since ωW , f are surjective, the composition f ωW : G∼W − → c⋆W̃ is surjective.
Hence it is enough to show that this composition is injective. For this it suffices
to check one of the two statements below:
   (a) ♯( G∼W ) = ♯(c⋆W̃ );
                              f ωW               f′
   (b) the composition G∼W −−−→ c⋆W̃ ⊂ cW̃ −→ N⊕N (where f ′ (c) = (a(x), a(xw0 ))
for x ∈ c) is injective.
Note that the value of the composition (b) at E is (aE , aE † ).
   Case 1. W is of type G2 and W̃ is of type D4 . Then (b) holds: the composition
(b) takes distinct values (0, 12), (1, 7), (3, 3), (7, 1), (12, 0) on the 5 elements of G∼W .
   Case 2. W is of type F4 and W̃ is of type E6 . Then again (b) holds.
   Case 3. W is of type Bn with n ≥ 2 and W̃ is of type A2n or A2n+1 . Then ι is
conjugation by the longest element w̃0 of W̃ . We show that (a) holds.
   Let Y be the set of all E ∈ IrrW̃ (up to isomorphism) such that tr(w̃0 , E) 6= 0.
Let Y ′ be the set of all E ′ ∈ IrrW (up to isomorphism). By 23.4 and 23.1 we have
118                                 G. LUSZTIG

a natural bijection between cW̃ and the set of isomorphism classes of E ∈ IrrW̃ .
If c ∈ cW̃ corresponds to E, then the number of fixed points of ι on c is clearly
± dim(E)tr(w̃0 , E). Hence ♯(c⋆W̃ ) = ♯Y . From 23.1 we have ♯( G∼W ) = ♯Y . Hence
to show (a) it suffices to show that ♯Y = ♯Y ′ . But this is shown in [L3].
   Case 4. Assume that W̃ is of type Dn and W is of type Bn−1 with n ≥ 3. We
will show that (a) holds. We change notation and write W ′ instead of W̃ , W ′ι
instead of W . Then W ′ is as in 22.26 and we may assume that ι : W ′ −     → W ′ is
                                          N,!
conjugation by sn (as in 22.26). Let M1,0;n be the set of all elements in MN   1,0;n
whose set of singles is non-empty. Let

                              M!1,0;n = lim MN,!
                                             1,0;n .
                                        N→∞

                                                                                G
By 22.26 and 23.3, c!W ′ is naturally in bijection with M!1,0;n . By 23.1, W     ∼
                                                                                   ′ι


is naturally in bijection with M1,2;n−1 . The identity map is clearly a bijection
             ∼   N+1,!                                    ∼
MN 1,2;n−1 − → M1,0;n  . It induces a bijection M1,2;n−1 −→ M!1,0;n . Hence to prove
that ♯( GW  ′ι      ⋆                                  !             ⋆
         ∼ ) ≤ ♯(cW ′ ) it suffices to prove that ♯(M1,0;n ) = ♯(M1,0;n ). In other
words, we must show that
   (c) any ι-stable two-sided cell of W ′ meets W ′ι .
Now 22.26 and 23.3 provide an inductive procedure to obtain any ι-stable two-sided
cell of W ′ . Namely such a cell is obtained by one of two procedures:
   (i) we consider a ι-stable two-sided cell in a parabolic subgroup of type Sk ×
Dn−k (where n − k ∈ [2, n − 1]) and we attach to it the unique two-sided cell of
W ′ that contains it;
   (ii) we take a two-sided cell obtained in (i) and multiply it on the right by the
longest element of W ′ .
Since we may assume that (c) holds when n is replaced by n − k ∈ [2, n − 1], we
see that the procedures (i) and (ii) yield only two-sided cells that contain ι-fixed
elements. This proves (c). The proposition is proved.

                               24. Virtual cells
24.1. In this chapter we preserve the setup of 20.1.
   A virtual cell of W (with respect to L : W −
                                              → N) is an element of K(W ) of the
form γx (see 20.16) for some x ∈ W .
Lemma 24.2. Let x ∈ W and let Γ be the left cell containing x.
  (a) If γx 6= 0 then x ∈ Γ ∩ Γ−1 .
  (b) γx is a C-linear combination of E ∈ IrrW such that [E : [Γ]] 6= 0.
    Assume that γx 6= 0. Then there exists E ∈ IrrJC such that tr(tx , E) 6= 0. We
have E = ⊕d∈D td E and tx : E − → E maps the summand td E (where x ∼L d) into
td′ E, where d′ ∼L x−1 and all other summands to 0. Since tr(tx , E) 6= 0, we must
                  6 0 hence d = d′ and x ∼L x−1 . This proves (a).
have td E = td′ E =
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                              119

   We prove (b). Let d ∈ D ∩ Γ. Assume that E ∈ IrrW appears with 6= 0
coefficient in γx . Then tr(tx , E♠ ) 6= 0. As we have seen in the proof of (a), we
                                                       Γ
have td E♠ 6= 0. Using 21.3,21.2, we deduce [E♠ : JC     ] 6= 0 and [E♠ : [Γ]♠ ] 6= 0.
Hence [E : [Γ]] 6= 0. The lemma is proved.
24.3. In the remainder of this chapter we will give a number of explicit compu-
tations of virtual cells.
Lemma 24.4.P In the setup of 22.10, w0 acts on [Λ] as multiplication by
                  −1
  ǫ[Λ] = (−1) j (a µj −j+1) .
   Using the definitions we are reduced to the case where k = n or l = n. If k = n
we have ǫ[Λ] = 1 since [Λ] factors through Sn and the longest element of Wn is
in the kernel of Wn − → Sn . Similarly, if l = n we have ǫ[Λ] = ǫχn = (−1)n . The
lemma is proved.
Proposition 24.5. Assume that we are in the setup of 22.23. Let ι ∈ Invr (Z)
and let κ : Sι −
               →
               PF2 be an κ(Y
                          affine-linear function. Let
  c(Z̃, ι, κ) = Y ∈Sι (−1) ) [ΛY ] ∈ K(W ).
There exists x ∈ W such that γx = ±c(Z̃, ι, κ).
   To some extent the proof is a repetition of the proof of 22.24(a), but we have
to keep track of κ, a complicating factor.
   We argue by induction on the rank n of Z̃. If n = 0 the result is clear. Assume
now that n ≥ 1. We may assume that 0 is not a double of Z̃. Let at be the largest
entry of Z̃.
   (A) Assume that there exists i, 0 ≤ i < t, such that ai does not appear in Z̃.
Then Z̃ is obtained from a multiset Z̃ ′ of rank n − k < n by increasing each of the
k largest entries by a and this set of largest entries is unambiguously defined. The
set Z ′ of singles of Z̃ ′ is naturally in bijection with Z.
   Let ι′ , κ′ correspond to ι, κ under this bijection. By the induction hypothesis,
                                         W
there exists x′ ∈ Wn−k such that γx′ n−k = ±c(Z̃ ′ , ι′ , κ′ ) ∈ K(Wn−k ). Let w0,k be
the longest element of Sk . Then
                        S ×W
                        k      n−k    Sk       W                 W
(a)                   γw0,k x′     = γw 0,k
                                            ⊠ γx′ n−k = sgnk ⊠ γx′ n−k

and
   W           W           kS ×W  n−k
  γw 0,k x
          ′ = jS ×W
                k   n−k
                        (γw0,k x′     )
(b)
                             W                               ′ ′     ′
      = jW
         Sk ×Wn−k (sgnk ⊠ γx′
                              n−k
                                  ) = ±jW
                                        Sk ×Wn−k (sgnk ⊠ c(Z̃ , ι , κ )) = ±c(Z̃, ι, κ),

as required.
                                                                                 ¯
   (B) Assume that there exists i, 0 < i ≤ t such that ai is a double of Z̃. Let Z̃
                                                                 ¯ and the largest
be as in 22.8 (with respect to our t). Then 0 is not a double of Z̃
120                                        G. LUSZTIG


entry of Z̃¯ is at. Let Z̄ be the set of singles of Z̃.
                                                    ¯ We have Z̄ = {at − z; z ∈ Z}.
Thus Z̄, Z are naturally in (order reversing) bijection under j 7→ at − j. Let
ι′ ∈ Invr (Z̄) correspond to ι under this bijection and let κ′ : Sι′ − → F2 P
                                                                            correspond
to κ under this bijection. Define κ′′ : Sι′ − → F2 by κ′′ (Y ) = κ′ (Y ) + y∈Y a−1 y
(an affine-linear function). Since at − ai does not appear in Z̃,  ¯ (A) is applicable
    ¯ Hence there exists x′ ∈ W such that γ ′ = ±c(Z̃,
to Z̃.                                                    ¯ ι′ , κ′′ ). By 20.23, 22.18,
                                                         x
24.4, we have
                                           ′               ¯ ι′ , κ′′ )) ⊗ sgn
                 γx′ w0 ⊗ sgn = (−1)l(x ) ζ(γx′ ) = ±ζ(c(Z̃,
                         ¯ ι′ , κ′ ) ⊗ sgn = ±c(Z̃, ι, κ),
                  = ±c(Z̃,

as desired.
   (C) Assume that we are not in case (A) and not in case (B). Then Z̃ =
{0, a, 2a, . . . , ta} = Z. We can find ia, (i + 1)a in Z such that ι interchanges
ia, (i + 1)a and induces on Z − {ia, (i + 1)a} an r-admissible involution ι1 .
   (C1) Assume first that κ(Y ) = κ(Y ∗ {ia, (i + 1)a}) for any Y ∈ Sι . (∗ is
symmetric difference.) Let

               Z̃ ′ = {0, a, 2a, . . . , ia, ia, (i + 1)a, (i + 2)a, . . . , (t − 1)a}.

This has rank n − k < n. The set of singles of Z̃ ′ is

                   Z ′ = {0, a, 2a, . . . , (i − 1)a, (i + 1)a, . . . , (t − 1)a}.

It is in natural (order preserving) bijection with Z −{ia, (i+1)a}. Hence ι1 induces
ι′ ∈ Invr (Z ′ ). We have an obvious surjective map of affine spaces π : Sι −  → Sι′
and κ is constant on the fibres of this map. Hence there is an affine-linear map
κ′ : Sι′ − → F2 such that κ = κ′ π. By the induction hypothesis, there exists
                         W
x′ ∈ Wn−k such that γx′ n−k = ±c(Z̃ ′ , ι′ , κ′ ) ∈ K(Wn−k ). Let w0,k be the longest
element of Sk . Then (a), (b) hold and we are done.
    (C2) Assume next that κ(Y ) 6= κ(Y ∗ {ia, (i + 1)a}) for some (or equivalently
any) Y ∈ Sι . We have

      ¯ = {0, 0, a, a, 2a, 2a, . . . , ta, ta} − {at − 0, at − a, . . . , at − at} = Z̃ = Z.
      Z̃

Let ι′ ∈ Invr (Z) correspond to ι under the bijection z 7→ ta − z of Z with itself; let
κ′ : Sι′ − → F2 correspond      to κ under this bijection. Let κ′′ : Sι′ −
                                                                         → F2 be given by
κ (Y ) = κ (Y ) + y∈Y a y (an affine-linear function). Note that ι′ interchanges
  ′′           ′               −1
                       P

(t − i − 1)a, (t − i)a and induces on Z − {(t − i − 1)a, (t − i)a} an r-admissible
involution. We show that for any Y ∈ Sι′ we have
     κ′′ (Y ) = κ′′ (Y ∗ {(t − i − 1)a, (t − i)a}),
or equivalently
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                           121

  κ′ (Y ) = κ′ (Y ∗ {(t − i − 1)a, (t − i)a}) + 1.
This follows from our assumption κ(Y ) = κ(Y ∗ {ia, (i + 1)a}) + 1 for any Y ∈ Sι .
We see that case (C1) applies to ι′ , κ′′ so that there exists x′ ∈ W with γx′ =
±c(Z̃, ι′ , κ′′ ). By 20.23, 22.18, 24.4, we have
                                  ′                     ¯ ι′ , κ′′ )) ⊗ sgn
                   γ ′ = (−1)l(x ) ζ(γ ′ ) ⊗ sgn = ±ζ(c(Z̃,
                 x w0                     x
                      ¯ ι′ , κ′ ) ⊗ sgn = ±c(Z̃, ι, κ),
                 = ±c(Z̃,
as desired. The proposition is proved.
24.6. Assume that we are in the setup of 22.27. By 22.27,
                          ρ4 + ρ16 , ρ12 + ρ16 + ρ6 , ρ12 + ρ16 + ρ′6
are constructible, hence (by 22.2, 21.4) are of the form nd γd for suitable d ∈ D,
hence are ± virtual cells.
   Let d ∈ D be such that nd γd = ρ12 + ρ16 + ρ6 . Let Γ be the left cell that con-
tains d. Recall (21.4) that [Γ] = A ⊕ B ⊕ C where A = ρ12 , B = ρ16 , C = ρ6 . By
                                       Γ∩Γ−1
the discussion in 21.10 we see that JC          has exactly three simple modules (up
to isomorphism), namely td A♠ , td B♠ , td C♠ , and these are 1-dimensional. Since
       −1
J Γ∩Γ is a semisimple algebra (21.9), it follows that it is commutative of dimen-
sion 3. Hence Γ ∩ Γ−1 consists of three elements d, x, y. Let pA , pB , pC denote the
traces of tx on A♠ , B♠ , C♠ respectively. Let qA , qB , qC denote the traces of ty on
A♠ , B♠ , C♠ respectively. By 20.26, pA , pB , pC , qA , qB , qC are integers. Recall that
the traces of nd td on A♠ , B♠ , C♠ are 1, 1, 1 respectively. Since fA♠ , fB♠ , fC♠ are
6, 2, 3 we see that the orthogonality formula 21.10 gives
                            2
                 1 + p2A + qA                 2
                              = 6, 1 + p2B + qB                 2
                                                = 2, 1 + p2C + qC = 3,
        1 + pA pB + qA qB = 0, 1 + pA pC + qA qC = 0, 1 + pB pC + qB qC = 0.
Solving these equations with integer unknowns we see that there exist ǫ, ǫ′ ∈
{1, −1} so that (up to interchanging x, y) we have
             (pA , qA ) = (2ǫ, ǫ′ ), (pB , qB ) = (0, −ǫ′ ), (pC , qC ) = (−ǫ, ǫ′ ).
Then ǫγx = 2ρ12 − ρ6 , ǫ′ γy = ρ12 − ρ16 + ρ6 . Hence
   2ρ12 − ρ6 , ρ12 − ρ16 + ρ6 are ± virtual cells.
The same argument shows that 2ρ12 − ρ6′ , ρ12 − ρ16 + ρ6′ are ± virtual cells. A
similar (but simpler) argument shows that ρ4 − ρ16 is ± a virtual cell.
   Assume now that we are in the setup of 22.27 (Case 1). By 22.27,
        ρ1 + ρ2 , ρ1 + ρ8 , ρ2 + ρ9 , ρ8 + ρ9 , ρ†1 + ρ†2 , ρ†1 + ρ†8 , ρ†2 + ρ†9 , ρ†8 + ρ†9 ,
are constructible, hence by 22.2, 21.4 are of the form nd γd for suitable d ∈ D,
hence are ± virtual cells. By an argument similar to that above (but simpler) we
see that
        ρ1 − ρ2 , ρ1 − ρ8 , ρ2 − ρ9 , ρ8 − ρ9 , ρ†1 − ρ†2 , ρ†1 − ρ†8 , ρ†2 − ρ†9 , ρ†8 − ρ†9 ,
are ± virtual cells.
122                                 G. LUSZTIG

24.7. Assume that we are in the setup of 22.29. By 22.29, ρ2 + ρ′2 is constructible,
hence by 22.2, 21.4, is of the form nd γd for some d ∈ D, hence is ± a virtual cell.
As in 24.6, we see that ρ2 − ρ′2 is ± a virtual cell.

                        25. Relative Coxeter groups
25.1. Let W, S be a Coxeter group and let u ∈ AW (see 1.17). We assume that W
is a Weyl group or an affine Weyl group. Let J be a u-stable subset of S such that
WJ is finite (that is, J 6= S when W is infinite). Let U : W −
                                                             → {permutations of R}
be as in 1.5. Let W be the set of all w ∈ W such that U (w) carries {(1, s); s ∈ J}
onto itself. (A subgroup of W .) Alternatively,

      W = {w ∈ W ; wWJ = WJ w, w has minimal length in wWJ = WJ w}.

Let K be the set of all u-orbits k on S − J such that WJ∪k is finite. (In the case
where W is infinite, K consists of all u-orbits on S − J if ♯(u\(S − J)) ≥ 2 and
K = ∅ if ♯(u\(S − J)) = 1.) We assume that J is u-excellent in the following sense:
for any k ∈ K we have w0J∪k Jw0J∪k = J.
   For k ∈ K we have w0J∪k w0J w0J∪k = w0J hence

                             τk := w0J∪k w0J = w0J w0J∪k

satisfies τk2 = 1.
   If k ∈ K then U (w0J∪k ) maps {(1, s); s ∈ J ∪ k} onto {(−1, s); s ∈ J ∪ k}. It
also maps {(±1, s); s ∈ J} onto {(±1, s); s ∈ J}. Hence it maps {(1, s); s ∈ J}
onto {(−1, s); s ∈ J}. Similarly, U (w0J ) maps {(−1, s); s ∈ J} onto {(1, s); s ∈ J}.
Hence U (τk ) = U (w0J )U (w0J∪k ) maps {(1, s); s ∈ J} onto {(1, s); s ∈ J}. Thus,
τk ∈ W. More precisely, τk ∈ W u , the fixed point set of u : W − → W.
   The following result is proved in [L1] assuming that W is a Weyl group (see
[L13] for the case where W is an affine Weyl group).
   (a) W u is a Coxeter group on the generators {τk ; k ∈ K}. Moreover, if W
is a Weyl group then W u is a Weyl group; if W is an affine Weyl group and
♯(u\(S − J)) ≥ 2 then W u is an affine Weyl group; if W is an affine Weyl group
and ♯(u\(S − J)) = 1 then W u = {1}.
25.2. We now strengthen our assumption on J by assuming that there exists
an adjoint reductive group GJ defined over Fq whose Coxeter graph is J (a full
subgraph of the Coxeter graph of W ), such that u : J −     → J is induced by the
Frobenius map of GJ and that GJ (Fq ) admits a unipotent cuspidal representation
E; let c0 be the two-sided cell of WJ (with the weight function given by length)
corresponding to this unipotent representation in the classification [L6]. The func-
tion a : W −→ N (see 13.6) (defined in terms of the weight function given by the
length) takes a constant value a on c0 and a constant value ak on c0 τk for k ∈ K
(see 9.13, P.11, 15.6). The function {τk ; k ∈ K} −→ Z given by τk 7→ ak − a takes
equal values at two elements τk , τk′ that are conjugate in W u (case by case check)
               HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                           123

hence it is the restriction of a weight function L : W u −
                                                         → Z. This weight function
                                                u
takes > 0 values on {τk ; k ∈ K}. Let aL : W −    → N be the function defined like
a:W −  → N (see 13.6) in terms of W u (instead of W ) and the weight function just
defined. Define a′ : W u −→ N by a′ (x) = a(yx) where y is any element of c0 . This
is independent of the choice of y, by 9.13, P.11, 15.6.
Conjecture 25.3. (a) aL = a′ .
   (b) Let c be a two-sided cell of W u (relative to the weight function L) as in
25.2. There exists a (necessarily unique) two-sided cell c̃ of W (relative to the
weight function given by length) such that yx ∈ c̃ for any y ∈ c0 , x ∈ c. Moreover
the map c 7→ c̃ is injective.
   This would reduce the problem of computing the two-sided cells of W u (relative
to the weight function L) to the analogous problem for W (relative to the weight
function given by length).

                             26. Representations
26.1. Let W, S be an affine Weyl group and let u ∈ AW (see 1.17). Let J be
a u-stable subset of S with J 6= S. Let U(J) be the set of isomorphism classes
of unipotent cuspidal representations of GJ (Fq ) (as in 25.2). Note that U(J) is
independent of the choice of GJ . Let E ∈ U(J). Let H(W, J, E) be the Iwahori-
Hecke algebra attached to W u (defined as in 25.1 in terms of W, S, J) and to the
weight function L : W u −
                        → N (defined as in 25.2). Let Ω be as in 1.18. Let
               Ωu = {a ∈ Ω; ua = au}, Ωu,J = {a ∈ Ωu ; a(J) = J}.
If a ∈ Ωu,J then a : W −→ W restricts to an automorphism of W u as a Coxeter
group; this automorphism is compatible with the weight function L : W u − →N
hence it induces an automorphism of the algebra H(W, J, E). Hence we may form
a semidirect product algebra H(W, J, E) ⊗A A[Ωu,J ] where A[Ωu,J ] is the group
algebra of Ωu,J over A.
   Let v0 ∈ C∗ be such that v0 = 1 or v0 is not a root of 1. Let
                           (H(W, J, E) ⊗A A[Ωu,J ])v0
be the C-algebra obtained from H(W, J, E) ⊗A A[Ωu,J ] by the change of scalars
A−→ C, v 7→ v0 . Let
                       I = ⊔Irr(H(W, J, E) ⊗A A[Ωu,J ])v0
where Irr stands for the set of isomorphism classes of simple modules of an algebra
and the disjoint union is taken over all (J, E) as above modulo the action of Ωu .
   On the other hand, let G be a connected, simply connected almost simple re-
ductive group over C, of type ”dual” to that of W . Let A(G) be the group of
automorphisms of G modulo the group of inner automorphisms of G. There is
a natural action of A(G) on G (well defined up to conjugacy) and we form the
semidirect product G̃ of G and A(G) via this action. Note that G may be identified
with the identity component of G̃. Let J be the set of all pairs (C, E) where C is
a G-conjugacy class in G̃ and E is an irreducible G-equivariant local system on C.
124                                      G. LUSZTIG

Theorem 26.2. There is a natural bijection I ↔ J .
   This is shown in [L13],[L16]. Using this bijection we may transfer the partition
of I into pieces indexed by the various (J, E) into a partition of J into pieces again
indexed by the various (J, E). This partition can be described purely in terms of
the geometry of G̃ (see [L16]).

                  27. A new realization of Hecke algebras
27.1. Let G, F, P, E, W, S, J, W, u, . . . be as in 0.3. Let H = H(GF , P F , E). In
this chapter we give a new realization of the Hecke algebra H as a function space.
We will identify Q̄l = C (where l is a prime number invertible in Fq ) via some
field isomorphism.
    Let P0 ∈ P F . Let L be an F -stable Levi subgroup of P0 , N L the normalizer of
L in G, ZL the centre of L. Let M = N L/ZL . We have canonically N L/L = W
hence M = ⊔w∈W Mw where Mw is the inverse image of w under the obvious map
N L/ZL −   → N L/L. We have M1 = L/ZL = Lad . The conjugation action defines
an (injective) homomorphism M −    → Aut(L) which restricts, for any w ∈ W, to an
    (a) isomorphism of Mw onto an Lad -coset Aut(L)w in Aut(L).
By known properties of unipotent representations, there is a unique LF    ad -module
                                                F
structure on EP0 that extends the given P0 -module structure on EP0 via the
obvious homomorphism P0F −     → LF                          F
                                     ad . We choose an M -module structure ι :
MF −  → GL(EP0 ) on EP0 that extends this LF    ad -module structure. (This exists by
known properties of unipotent cuspidal representations.)
    Let w ∈ W and let Ow be the corresponding good G-orbit on P × P. For
                          P
                        ψP 2
                           1
(P1 , P2 ) ∈ Ow let P̄2 −−→   P̄1 be the unique isomorphism which takes the image
of any x ∈ P1 ∩ P2 under P1 ∩ P2 −       → P̄2 to the image of x ∈ P1 ∩ P2 under
P1 ∩ P2 −  → P̄1 . Then the composition

                                             P
                               Ad(g2 )      ψP 2            Ad(g −1 )
                                          1
                          P̄0 −−−−→ P̄2 −−→ P̄1 −−−−1−→ P̄0

where g1 , g2 ∈ G, g1 P0 g1−1 = P1 , g2 P0 g2−1 = P2 , may be regarded as an element
of Aut(L)w (we identify P̄0 = L). This corresponds under (a) to an element
αg1 ,g2 ∈ Mw .
27.2. Assume now that F (w) = w. Define w φ ∈ H as follows: if (P1 , P2 ) ∈ Ow
then (w φ)P
          P1 : EP2 −
            2
                   → EP1 is the composition

                             2 g −1    1 2
                                           ι(αg    ,g   )         g1
                        EP2 −−→ EP0 −−−−−→ EP0 −→ EP1

where g1 , g2 ∈ GF , g2 P0 g2−1 = P2 , g1 P0 g1−1 = P1 ; if (P1 , P2 ) ∈
                                                                       / Ow then (w φ)P
                                                                                      P1 :
                                                                                        2


    → EP1 is 0. ((w φ)P
EP2 −                    P1 is independent of the choices of g1 , g2 .)
                          2
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                  125

27.3. For w as in 27.2 we have Ow−1 = {(P2 , P1 ) ∈ P × P; (P1 , P2 ) ∈ Ow }. Let
  U = {P1 ∈ P F ; (P0 , P1 ) ∈ Ow }.
                                                                       −1
Then ♯U = q l(w) where l is length in W . The composition (w φ)(w φ) has as
(P0 , P0 )-component the sum over all P1 ∈ U of the compositions

                        ι(αg   ,1 )    g1        g −1       ι(α1,g )
                  EP0 −−−−1−→ EP0 −→ EP1 −−
                                          1
                                           → EP0 −−−−−1→ EP0

where g1 ∈ GF , g1 P0 g1−1 = P1 , that is q l(w) times the identity map of EP0 . Thus,
             −1                                               ′
  (a) (w φ)(w φ) = q l(w) (1 φ) + linear combination of w φ with w′ 6= 1.
27.4. Let w, w′ ∈ W u be such that l(ww′ ) = l(w) + l(w′ ). (Here l is length in
W .) Then
   (a) (P1 , P2 ) ∈ Ow , (P2 , P3 ) ∈ Ow′ =⇒ (P1 , P3 ) ∈ Oww′ ,
   (b) if (P1 , P3 ) ∈ Oww′ then there is a unique P2 ∈ P such that (P1 , P2 ) ∈
Ow , (P2 , P3 ) ∈ Ow′ .
If P1 , P2 , P3 are as in (a) we have ψPP13 = ψPP12 ψPP23 : EP3 −
                                                                → EP1 . From the definitions
we see that
                 ′         ′
   (c) (w φ)(w φ) = ww φ.
27.5. For w ∈ W u , w φ is a basis element of HOw . If w = tk1 tk2 . . . tkr is a reduced
expression in W u (see 0.3) then l(w) = l(tk1 ) + l(tk2 ) + · · · + l(tkr ) (where l is as in
27.4) and Tw = Tτk1 Tτk2 . . . Tτkr (notation of 0.3) is a well defined basis element
of HOw independent of the reduced expression. Hence w φ = xw Tw where
   (a) xw = xτk1 xτk2 . . . xτkr
with xw ∈ C∗ for all w ∈ W u . From 27.4(c) we see that 1 φ is the unit element of
H. Hence 1 φ = T1 . By 27.3(a), we have (τk φ)(τk φ) = q l(τk ) (1 φ) + . . . hence
   (b) x2τk Tτ2k = q l(τk ) T1 + linear combination of Tw′ with w′ 6= 1.
On the other hand, by 0.3(d) we have Tτ2k = (q Nk /2 − q −Nk /2 )Tτk + T1 . Comparing
with (b) we see that x2τk = q l(τk ) hence xτk = ǫk q l(τk )/2 where ǫk ∈ {1, −1}. From
(a) we see that for w ∈ W u we have xw = ǫw q l(w)/2 where w 7→ ǫw is a function
Wu − → {1, −1} satisfying ǫk ǫk′ ǫk · · · = ǫk′ ǫk ǫk′ . . . for k 6= k ′ (both products have
a number of terms equal to the order of τk τk′ in W u ). It follows that w 7→ ǫw is a
group homomorphism W u −         → {1, −1}. Since M F /LF              u
                                                               ad = W , we may regard ǫ as
                          F       ∗                          F
a homomorphism M −           → C which is trivial on Lad .
27.6. Replacing ι : M F −                                                   → C∗
                              → GL(EP0 ) by its tensor product with ǫ : M F −
we obtain a new homomorphism ι0 : M F −      → GL(EP0 ). If we now redefine w φ in
terms of ι0 rather than ι, then the ǫ-factors disappear and we have
   (a) w φ = q l(w)/2 Tw , w ∈ W u .
Note that ι0 is uniquely determined by property (a) and by its restriction to LF
                                                                               ad .

27.7. Let D = dim EP0 . Let Y be the set of all triples (P, P ′ , gUP ) where P, P ′ ∈
P and gUP ∈ G/UP is such that gP g −1 = P ′ (hence gUP = UP ′ g). Now Y is
naturally defined over Fq , with Frobenius map
126                                                 G. LUSZTIG

   F : (P, P ′ , gUP ) −
                       → (F (P ), F (P ′), F (g)UF (P )).
Let Y0 be the set of all triples (P, P ′ , gUPF ) where P, P ′ ∈ P F and gUPF ∈ GF /UPF
                                                                                 ∼
is such that gP g −1 = P ′ (hence gUPF = UPF′ g). We have a bijection Y0 −→ Y F
given by (P, P ′ , gUPF ) 7→ (P, P ′ , gUP ).
   Let B be the vector space of all functions f : Y0 −    → C. We define a multiplica-
tion B × B −   → B, f ′ , f ′′ 7→ f ′ ∗ f ′′ by

                                             D               X
(a)     (f ′ ∗ f ′′ )(P, P ′ , gUPF ) =                                          f ′ (P, P̃ , g ′ UPF )f ′′ (P̃ , P ′ , g ′′ UP̃F )
                                            ♯P̄ F             F ,g ′′ U F
                                                     P̃ ,g ′ UP
                                                                            P̃




where the sum is taken over all

                          P̃ ∈ P F , g ′ UPF ∈ GF /UPF , g ′′ UP̃F ∈ GF /UP̃F

such that
                    g ′ P g ′−1 = P̃ , g ′′ P̃ g ′′−1 = P ′ , g ′′ g ′ ∈ UPF′ g = gUPF .

Equivalently,

                                           D             X
(b) (f ′ ∗ f ′′ )(P, P ′ , gUPF ) =           F
                                                ♯(U F −1
                                                    P )     f ′ (P, P̃ , g ′ UPF )f ′′ (P̃ , P ′ , gg ′−1 UP̃F )
                                          ♯P̄             ′         P̃ ,g



where the sum is taken over all P̃ ∈ P F , g ′ ∈ GF such that g ′ P g ′−1 = P̃ . With
this multiplication, B becomes an associative algebra.
   Define κ : H − → B by φ 7→ κ(φ) where κ(φ)(P, P ′ , gUPF ) is the trace of the
composition
                                                                         ′
                                                    g               φP
                                               → EP ′ −−P→ EP .
                                            EP −
                                                                                                   ′
(This is independent of the choice of g in its UPF -coset; φP
                                                            P is as in 0.1.)

Lemma 27.8. κ : H −
                  → B is an algebra homomorphism.

   Let φ, φ′ ∈ H and let (P, P ′ , gUPF ) ∈ Y0 . Then

                                                                                                    ′
                           ′          ′                                      g            (φφ′ )P
                     κ(φφ )(P, P          , gUPF )   = tr(EP −
                                                             →E                     P′
                                                                                                P
                                                                                         −−−−−→ EP )
                                                             ′P ′
                          X                 g P̃       P
                                                         φ                       φP̃
                      =        tr(EP −
                                     → EP ′ −−−→ EP̃ −−→ EP ).
                          P̃
                             HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                                                         127

On the other hand,

 κ(φ) ∗ κ(φ′ )(P, P ′ , gUPF )
               D           X
 = ♯(UPF )−1 F                                             κ(φ)(P, P̃ , g ′ UPF )κ(φ′ )(P̃ , P ′ , gg ′−1 UP̃F )
              ♯P̄        ′ ′   ′−1
                                 P̃ ,g ;g P g       =P̃
                                                                                                                         P    ′
     D                     X                             g′             φP̃
                                                                         P                        gg ′−1                φP̃
  =                                            tr(EP −→ EP̃ −−→ EP )tr(EP̃ −−−→ EP ′ −−→ EP̃ )
    ♯P F
                  P̃ ,g ′ ;g ′ P g ′−1 =P̃
                                                                                                                    ′
     D                     X                             g′             φP̃
                                                                         P                        g         φP
                                                                                                             P̃                     g ′−1
  =                                            tr(EP −→ EP̃ −−→ EP )tr(EP −
                                                                          → EP ′ −−→ EP̃ −−−→ EP ).
    ♯P F
                  P̃ ,g ′ ;g ′ P g ′−1 =P̃


It is then enough to show that for any P̃ ∈ P F , we have

                                          ′
                    g         P
                                   φ′P
                                     P̃            φP̃
            → EP ′ −−−→ EP̃ −−→
      tr(EP −                   EP )
                                                                                                                ′
           D               X                        g′   P         φP̃                       g             φP                     g ′−1
      =                                   tr(EP −→ EP̃ −−→           → EP ′ −−P̃→ EP̃ −−−→ EP ).
                                                           EP )tr(EP −
          ♯P F
                         g ′ ∈GF
                     g ′ P g ′−1 =P̃


Let γ ∈ GF be such that γP γ −1 = P̃ . We rewrite the equality to be proved using
the substitution g ′ = γh:

                              AB                     D     X        Ah            h−1 B
(a)               tr(EP −−→ EP ) =                            tr(EP −
                                                                    −→ EP )tr(EP −− −→ EP )
                                                   ♯(P F )  F     h∈P


                                      P                       γ               φP̃                                                             g
                              → EP̃ −−→
where A is the composition EP −         EP and B is the composition EP −
                                                                       →
              ′                                                                                                                         ′
        φP
         P̃                 γ −1                                               P                            g
                                                                                                                                   P
                                                                                                                                  φP̃       φP̃
EP ′ −−→ EP̃ −−→ EP . (Then AB is the composition EP −        → EP ′ −−→ EP̃ −−→
EP .) Now (a) follows immediately from the Schur orthogonality relations for the
matrix coefficients of the irreducible representation of P F on EP . The lemma is
proved.
27.9. Let w ∈ W u . Let fw : Y0 −         → C be the image of q −l(w)/2 (w φ) (defined as in
27.2 in terms of ι0 ) under κ : H −       → B.
                    F
   If (P1 , P2 , gUP1 ) ∈ Y0 , (P1 , P2 ) ∈/ Ow then fw (P1 , P2 , gUPF1 ) = 0.
   If (P1 , P2 , gUPF1 ) ∈ Y0 , (P1 , P2 ) ∈ Ow then fw (P1 , P2 , gUPF1 ) is q −l(w)/2 times the
trace of the composition

                                                  g −1 g             ι0 (αg         ,g   )       g1
                                                                1 2
                                              EP1 −−2−→ EP0 −−−−−−→ EP0 −→ EP1
128                                    G. LUSZTIG

where g1 , g2 ∈ GF , g2 P0 g2−1 = P2 , g1 P0 g1−1 = P1 ; here we may assume that
g1 = g −1 g2 hence
                                                          ι0 (αg −1 g   ,g   )
               fw (P1 , P2 , gUPF1 ) = q −l(w)/2 tr(EP0 −−−−−−−2−−
                                                                 2
                                                                 → EP0 )

where g2 ∈ GF , g2 P0 g2−1 = P2 (with αg −1 g2 ,g2 as in 27.1).
   In particular, if (P1 , P2 , gUPF1 ) ∈ Y0 , P1 6= P2 then f1 (P1 , P2 , gUPF1 ) = 0; if
P1 ∈ P F , g ∈ P1F then
                                                           g
                         f1 (P1 , P1 , gUPF1 ) = tr(EP1 −
                                                        → EP1 ).

Thus, f1 is not identically zero.
   Here are some properties of the functions fw which follow immediately from the
corresponding properties of the functions w φ using 27.8.
   (a) (fτk − q −Nk /2 f1 )(fτk + q Nk /2 f1 ) = 0 for all k,
   (b) fw fw′ = fww′ , w, w′ ∈ W u , l(ww′ ) = l(w) + l(w′ ).
Let H̄ = κ(H). This is a subalgebra of B generated as a vector space by {fw ; w ∈
W u }. From (b) we see that f1 fw = fw f1 = fw for all w ∈ W u , hence f1 is the unit
element of the algebra H̄. From (a) we see that fτk is invertible in this algebra for
any k and then from (b) we see that fw is invertible in this algebra for any w ∈ W .
Since f1 6= 0 we have fw 6= 0 for any w ∈ W u . Now the fw have disjoint supports.
(The support of fw is contained in YwF where Yw = {(P1 , P2 , gUPF1 ) ∈ Y ; (P1 , P2 ) ∈
Ow }.) It follows that the elements fw (w ∈ W u ) are linearly independent in the
vector space H̄. Hence κ : H −    → H̄ is an isomorphism of algebras.
   We have thus obtained a new model H̄ for the Hecke algebra H as the vector
space of functions f : Y0 −     → C spanned by the functions fw (w ∈ W u ) with
multiplication ∗ as in 27.7.
27.10. Let
    Z = {(P ′ , gUP0 ); P ′ ∈ P, g ∈ G/UP0 ; gP0 g −1 = P ′ }.
Let w ∈ W u . Let
   Zw = {(P ′ , gUP0 ) ∈ Z, (P0 , P ′ ) ∈ Ow }.
We have a morphism λ : Zw −        → Aut(L)w = Mw where λ(P ′ , gUP0 ) is the compo-
sition                                              ′
                                                   P
                                      Ad(g)       ψP
                           L = P̄0 −−−→ P̄ ′ −−→
                                               0
                                                 P̄0 = L.
Note that λ is a smooth morphism with connected fibres.
  Now Zw , Mw are naturally defined over Fq with Frobenius maps F and λ com-
mutes with F . Hence λ restricts to a map
                                        F     λ
(a)                                    Zw → MwF .
                                          −

Define fw0 : Zw
              F
                −
                → C by

                          fw0 (P ′ , gUP0 ) = fw (P0 , P ′ , gUP0 ).
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                            129

(Here g ∈ GF /UPF0 .) We have

                              fw0 = q −l(w)/2 λ∗ (χ(ι0 )w )

where χ(ι0 )w : MwF −
                    → C is the character of ι0 : M F −
                                                     → GL(EP0 ) restricted to
  F
Mw .
27.11. The obvious homomorphism Aut(L) −         → Aut(Lad ) defines for any w ∈ W u
an isomorphism of Mw = Aut(L)w with a connected component of the reductive
algebraic group Aut(Lad ) with identity component Lad . Hence we have the notion
of character sheaf on Mw (see [L10]). Let M̂w be the set of isomorphism classes of
character sheaves on Mw . Let A ∈ M̂w . Then A is Lad -equivariant for the conju-
gation action of Mw . Since λ is smooth with connected fibres of fixed dimension,
a suitable shift of λ∗ (A) is a simple perverse sheaf Ã on Zw . Let Ã♯ be the unique
simple perverse sheaf on Z, whose support is the closure in Z of the support of Ã
and which satisfies Ã♯ |Zw = Ã.
   Let M̂wF be the set of all A ∈ M̂w such that F ∗ A ∼     = A. For any A ∈ M̂wF
                                           ∼
we choose an isomorphism φ : F ∗ A −→ A. There are induced isomorphisms
            ∼                  ∼
φ : F ∗ Ã −→ Ã, φ : F ∗ Ã♯ −→ Ã♯ . Let

              χA,φ : MwF −
                         → Q̄l , χÃ,φ : Zw F −
                                              → Q̄l , χÃ♯ ,φ : Z F −
                                                                    → Q̄l

be the corresponding characteristic functions (alternating sums of traces of Frobe-
nius at stalks of cohomology sheaves at various F -fixed points). We have cÃ,φ =
(−1)N λ∗ (cA,φ ) where N = dim Zw − dim Mw and cÃ,φ = cÃ♯ ,φ |ZwF .
   It is known [L10] that the functions χA,φ (where A runs through M̂wF ) form a
basis for the vector space of functions MwF −→ C that are constant on the orbits
of M 0F (acting on MwF by conjugation). Hence
                                             X
                               χ(ι0 )w =            ξA χA,φ
                                                F
                                            A∈M̂w


where ξA ∈ C are uniquely determined. Applying λ∗ to both sides we deduce
                                            X
                           q l(w)/2 fw0 =       ξA (−1)N χÃ,φ .
                                            A

Hence                                            X
                       fw0 = q −l(w)/2 (−1)N          ξA χÃ♯ ,φ |ZwF .
                                                  A

The following conjecture provides a geometric interpretation of the polynomials
py,w (see 5.3) attached to the Coxeter group W u with its weight function L :
Wu −→ N.
130                                   G. LUSZTIG

Conjecture 27.12. Assume that y ∈ W u . We have
                                     X
                   q −l(w)/2 (−1)N       ξA χÃ♯ ,φ |ZyF = py,w |v=√q fy0 ,
                                     A

                           X
                                ξA χÃ♯ ,φ |Z F −∪y∈W u ZyF = 0.
                            A


27.13. We now consider the special case where P is the set of Borel subgroups
of G and E is the trivial vector bundle C. Then W = W . In this case the
homomorphism ι0 is trivial. For w ∈ W u = W u and (P1 , P2 , gUPF1 ) ∈ Y0 we have
   fw (P1 , P2 , gUPF1 ) = 0 if (P1 , P2 ) ∈/ Ow ,
                     F      −l(w)/2
   fw (P1 , P2 , gUP1 ) = q          , if (P1 , P2 ) ∈ Ow .
In particular, the functions in κ(H) do not depend on the third coordinate gUPF1
which can therefore be omitted. For f ′ , f ′′ in κ(H) we have
   (f ′ ∗ f ′′ )(P, P ′ ) = P̃ ∈P F f ′ (P, P̃ )f ′′ (P̃ , P ′ ).
                           P
In the present case, Conjecture 27.12 states that py,w |v=√q is (up to normalization)
the restriction to ZyF of the characteristic function of the intersection cohomology
sheaf of the closure of Zw in Z. Equivalently, if for w ∈ W u we set
   Pw = {P ′ ∈ P; (P0 , P ′ ) ∈ Ow ),
then py,w |v=√q is (up to normalization) the restriction to PyF of the characteristic
function of the intersection cohomology sheaf of the closure of Pw in P.
   This property is known to be true; it is proved in [KL2] in the case where u = 1
on W and is stated in the general case in [L3].
27.14. Let G, F, P, E, W, S, J, W, u, . . . be as in 0.6. Let H = H(GF , P F , E).
Everything in 27.1-27.13 extends to this case (we replace G by G throughout)
with the following modifications. In the definition of B (see 27.7) we must now
restrict ourselves to functions f : Y0 −
                                       → C such that

            {(P, P ′ ) ∈ P F × P F ; f (P, P ′ , gUPF ) 6= 0 for some g ∈ GF }

is contained in the union of finitely many G-orbits on P × P. Also, when defining
the multiplication ∗ in 27.7 only the definition 27.7(a) makes now sense (in 27.7(b)
the quantity ♯(UPF ) is infinite hence does not make sense). In 27.13 one should use
Iwahori subgroups instead of Borel subgroups.

                                         Appendix
A.1. Let W̃ be the Coxeter group associated to a finite set S̃ and to the Coxeter
matrix (ms,s′ )s,s′ ∈S̃ . We view S̃ as a subset of W̃ ; for any I ⊂ S̃ we denote by W̃I
the subgroup of W̃ generated by I. For any I ⊂ S̃ let [I] the full subgraph of the
Coxeter graph of W̃ with set of vertices I. Let ˜l : W̃ −   → N be the length function
of W̃ . Let ≤ be the standard partial order on W̃ .
                 HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                  131

     For any m ∈ Z≥1 ∪ {∞} we set κm = 2 cos(π/m) ∈ R.
     Let E be the R-vector space with basis {es ; s ∈ S̃}. Following [Bo,Ch.V, 4.1],
for any s ∈ S̃ we define a linear map σs : E −     → E by σs (es′ ) = es′ + κms,s′ es for all
  ′
s ∈ S̃. According to [Bo, Ch.V, 4.3] there is a unique group homomorphism σ :
W̃ −  → GL(E) (“reflection representation” of W̃ ) such that σ(s) = σs for all s ∈ S̃.
Let (, ) : E × E − → R be the symmetric bilinear form given by (es , es′ ) = −κms,s′ /2
         ′
for s, s ∈ S̃. Note that for any w ∈ W̃ , σ(w) is an isometry of this form.
     Assume that we are given a group automorphism τ : W̃ −        → W̃ such that τ (S̃) =
                                                              ′
S̃; we have necessarily mτ (s),τ (s′ ) = ms,s′ for any s, s in S̃. We define a vector
                                ∼
space isomorphism τ : E −→ E by τ (es ) = eτ (s) for any s ∈ S̃. For any s, s′ ∈ S̃ we
have τ (σs (es′ ) = στ (s) (τ (es′ )). Hence for any w ∈ W̃ we have τ σ(w)) = σ(τ (w))τ :
E−   → E.
     Let S be the set of τ -orbits I on S̃ such that W̃I is finite; for any I ∈ S let w0I
be the longest element of the finite Coxeter group W̃I . Let ′ W̃ be the subgroup of
W̃ generated by {w0I ; I ∈ S}. Let W = {w ∈ W̃ ; τ (w) = w}. We show:
     (a) W = ′ W̃ .
In the proof we shall make use of the following fact.
     (b) If I ⊂ S̃ and w ∈ W̃ satisfies sw < w for any s ∈ I then ˜l(yw) = ˜l(w) − l̃(y)
for any y ∈ W̃I . In particular, y 7→ ˜l(y) is bounded on W̃I so that W̃I is finite.
The proof of the first sentence in (b) is identical to the proof of 9.8(d) (with the
assumption that w has maximal length in its W̃I coset replaced by sw < w for
any s ∈ I). The second sentence in (b) follows from the first since ˜l(y) ≤ ˜l(w) for
any y ∈ W̃I .
     We prove (a). The inclusion ′ W̃ ⊂ W is obvious. We now prove the reverse
inclusion. Let w ∈ W . We show that w ∈ ′ W̃ by induction on ˜l(w). If ˜l(w) = 0
then w = 1 and the result is obvious. Assume now that ˜l(w) ≥ 1. We can
find s ∈ S̃ such that sw < w. Then for any i we have τ i (sw) < τ i (w) that is
τ i (s)w < w. Thus s′ w < w for any s′ ∈ I where I is the τ -orbit of s. Using (b)
we see that W̃I is finite and ˜l(w0I w) = ˜l(w) − ˜l(w0I ). The induction hypothesis is
applicable to w0I w instead of w and yields w0I w ∈ ′ W̃ . It follows that w ∈ ′ W̃ .
This proves (a).
     Next we show:
     (c) Let I 6= I ′ in S be such that W̃I∪I ′ is infinite. Then the subgroup W of W̃
                              ′
generated by w0I and w0I is infinite.
Note that each element of W is fixed by τ . Assume that W is finite. Then we
can find w ∈ W of maximal length among the elements of W. If sw > w for some
s ∈ I then for any i we have τ i (sw) > τ i (w) hence τ i (s)w > w; thus s′ w > w for
any s′ ∈ I. Using 9.7 we deduce that ˜l(w0I w) = ˜l(w0I ) + ˜l(w) > ˜l(w) contradicting
the maximality of ˜l(w). Thus we have sw < w for any s ∈ I. Similarly we have
sw < w for any s ∈ I ′ . Using (b) we see that W̃I∪I ′ is finite. This contradiction
proves (c).
132                                      G. LUSZTIG

     Let I ∈ S. We set m = max{ms,s′ ; s ∈ I, s′ ∈ I}. We show that if m ≥ 3 then
the following holds.
     (d) There exists i ∈ Z such that τ i : I −→ I is a fixed point free involution and
ms,s′ = m if s, s′ ∈ I, s 6= s′ are in the same τ i -orbit and ms,s′ = 2 if s, s′ ∈ I are
not in the same τ i -orbit.
We can find s0 ∈ I, s′0 ∈ I such that ms0 ,s′0 = m ≥ 3. Let K ⊂ I be set of vertices of
the connected component [K] of the Coxeter graph of W̃I that contains s0 and s′0 .
If s, s′ ∈ K then s′ = τ i (s) for some i and we have necessarily τ i (K) = K (indeed,
τ i (K), K are sets of vertices of connected components of the Coxeter graph of W̃I
containing s′ ). Thus the group of automorphisms of [K] acts transitively on K.
Using the known classification of finite Coxeter groups we see that ♯(K) = 2 that
is, K = {s0 , s′0 }. We also see that for some i ∈ Z we have τ i (s0 ) = s′0 , τ i (s′0 ) = s0 .
Since I is a τ -orbit, we deduce that I is a disjoint union of τ i -orbits of size 2
and τ i : I −→ I is an involution; moreover for each τ i -orbit {s, s′ } on I we have
ms,s′ = m. We also see that if s, s′ are not in the same τ i -orbit, then ms,s′ = 2.
This proves (d).

   Now let I 6= I ′ in S be such that W̃I∪I ′ is finite. Let
   m = max{ms,s′ ; s ∈ I, s′ ∈ I}, m′ = max{ms,s′ ; s ∈ I ′ , s′ ∈ I ′ }, µ =
max{ms,s′ ; s ∈ I, s′ ∈ I ′ }.
Note that m < ∞, m′ < ∞, µ < ∞. We show that if µ ≥ 3 then (after possibly
interchanging I, I ′ ), (e),(f) below hold.
   (e) There exists p ∈ {1, 2, 3} (with p = 1 if µ > 3) and a p-fold covering
u:I −  → I ′ which commutes with the action of τ , such that for any s ∈ I, s′ ∈ I ′
we have ms,s′ = µ if s′ = u(s) and ms,s′ = 2 if s′ 6= u(s).
   (f) If p ∈ {2, 3} then m ≤ 2, m′ ≤ 2. If p = 1 and µ ≥ 4 then m ≤ 2, m′ ≤ 2. If
p = 1 and µ = 3 then (m, m′ ) is (4, 2) or (3, 2) or (2, 2) or (1, 1).
We can find s0 ∈ I, s′0 ∈ I ′ such that ms0 ,s′0 = µ ≥ 3. Let K ⊂ I be the set
of vertices of the connected component [K] of the Coxeter graph of W̃I∪I ′ that
contains s0 and s′0 . Let Aut[K] be the group of automorphisms of the Coxeter
graph [K].
   If s1 , s2 ∈ I ∩ J then we can find i ∈ Z such that τ i (s1 ) = s2 . Then K, ti (K)
are sets of vertices of connected components of the Coxeter graph of W̃I∪I ′ and
both contain s2 ; hence K = ti (K). We see that
   (g) for any s1 , s2 in I ∩ K there exists an element of Aut[K] which carries s1
to s2 . Similarly, for any s′1 , s′2 in I ′ ∩ K there exists an element of Aut[K] which
carries s′1 to s′2 . In particular, Aut[K] acts on K with at most two orbits.
For any s ∈ I we set Ks′ = {s′ ∈ I ′ ; ms,s′ ≥ 3}; for any s′ ∈ I ′ we set Ks′ = {s ∈
I; ms,s′ ≥ 3}. Let K′ = Ks′ 0 , K = Ks′0 . We have K′ ⊂ I ′ ∩ K, K ⊂ I ∩ K.
   Assume first that µ ≥ 4. If there exists s′ ∈ Ks′ 0 − {s′0 }, then using the known
classification of finite Coxeter groups we see that µ ∈ {4, 5}. Since s′ , s′0 ∈ I ′ ∩ K
we can find i such that τ i ∈ Aut[K] and τ i carries s′0 to s′ hence is nontrivial in
Aut[K]. By the classification of finite Coxeter groups we deduce that µ = 4 and τ i
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                         133

interchanges s0 , s′0 . This contradicts the fact that s0 , s′0 are in different τ -orbits.
Thus ♯(Ks′ 0 ) = 1. Using the fact that I is a τ -orbit, we deduce that ♯(Ks′ ) = 1 for
any s ∈ I. Similarly, we have ♯(Ks′ ) = 1 for any s′ ∈ I ′ . Hence we have a bijection
u:I −    → I ′ given by s 7→ s′ where Ks′ = {s′ }, Ks′ = {s} and (e) is verified in this
case. Assume now that s ∈ I satisfies ms,s0 ≥ 3. Then s, s0 ∈ I ∩ K hence we can
find j such that τ j ∈ Aut[K] and τ j carries s0 to s. Thus [K] has at least three
distinct vertices s, s0 , s′0 with ms0 ,s′0 = 4 and has an automorphism which carries
s0 to s. This is impossible, by the classification of finite Coxeter groups. We see
that m ≤ 2. Similarly we have m′ ≤ 2. Thus (f) holds in this case.
    Next we assume that µ = 3. If m ≥ 3 then by (d) we have ms0 ,s1 = m for
some s1 ∈ I and by (g) some automorphism r of [K] carries s0 to s1 . Also, using
(g) and the classification of finite Coxeter groups we see that m ∈ {3, 4} and
there exists s′1 ∈ I ′ − {s′0 } such that K = {s′0 , s0 , s1 , s′1 } and the edges of [K] are
(s′0 , s0 ), (s0 , s1 ), (s1 , s′1 ). Note that r interchanges s0 with s1 and s′0 with s′1 . In
particular s′0 is not connected with any s′ ∈ I ′ −{s′0 } in the Coxeter graph of W̃I∪I ′
so that m′ ≤ 2. We also see that in this case K = {s0 }, K′ = {s′0 }. Similarly, if
m′ ≥ 3, then m′ ∈ {3, 4}, m ≤ 2 and K = {s0 }, K′ = {s′0 }. Assume now that
♯(K′ ) ≥ 3. Since K′ ⊂ I ′ ∩ K, Aut[K] has at least three distinct elements (see
(g)). Using the classification of finite Coxeter groups, we deduce that ♯(K′ ) = 3,
K = K′ , hence K = {s0 }; using the fact that I and I ′ are τ -orbits, we see that we
have ♯(Ks′ ) = 3 for any s ∈ I and ♯(Ks′ ) = 1 for any s′ ∈ I ′ , so that if we define
u : I′ − → I by u(s′ ) = s where s is such that s ∈ Ks′ , then u satisfies (e) with I, I ′
interchanged and (f) holds as well.
    Thus we can assume that ♯(K′ ) ≤ 2; similarly we can assume that ♯(K) ≤ 2.
Assume now that ♯(K′ ) = 2, ♯(K) ≤ 2; we write K′ = {s′0 , s′1 }. This is not
compatible with the inequality m ≥ 3, by a previous argument. Thus m ≤ 2 and
similarly, m′ ≤ 2. Hence [K] is a graph of type An , n ≥ 2. From (g) we see that
n ≤ 3. Since {s0 , s′0 , s′1 } ⊂ K it follows that {s0 , s′0 , s′1 } = K that is K′ = K; hence
K = {s0 }. Using the fact that I and I ′ are τ -orbits, we see that we have ♯(Ks′ ) = 2
for any s ∈ I and ♯(Ks′ ) = 1 for any s′ ∈ I ′ so that if we define u : I ′ −          → I by
     ′                                                                           ′
u(s ) = s where s is such that s ∈ Ks′ , then u satisfies (e) with I, I interchanged
and (f) holds as well.
    Thus (e),(f) hold if ♯(K′ ) ≥ 2; similarly they hold if ♯(K) ≥ 2. We may assume
therefore that ♯(K′ ) = ♯(K) = 1. Using the fact that I and I ′ are τ -orbits, we see
that we have ♯(Ks′ ) = 1 for any s ∈ I and ♯(Ks′ ) = 1 for any s′ ∈ I ′ so that if we
define u : I ′ −   → I by u(s′ ) = s where s is such that s ∈ Ks′ then u satisfies (e) with
I, I ′ interchanged. Thus (e) is proved. It remains to prove (f) in the case where
p = 1 and µ = 3. If m ≥ 3 then by an earlier argument we have m ∈ {3, 4} and
m′ ≤ 2. If m′ ≥ 3 then again by an earlier argument we have m′ ∈ {3, 4}, m ≤ 2.
Interchanging I, I ′ we have again m ∈ {3, 4} and m′ ≤ 2. Thus we can assume
that m ≤ 2, m′ ≤ 2. Then (f) is clear. This completes the proof of (f).
A.2. Let E be an R-vector space  √                             . , ek , f1 , f2 , . . . , fk . Let µ ∈
                                      with basis e1 , e2 , . . √
Z≥3 . Let e = (e1 + · · · + ek )/ k, f = (f1 + · · · + fk )/ k.
134                                                     G. LUSZTIG

   For i ∈ [1, k] we define a linear map si : E −        → E by
   si (ei ) = −ei , si (ej ) = ej for j 6= i, si (fi ) = fi + κµ ei , si (fj ) = fj for j 6= i.
For i ∈ [1, k] we define a linear map ti : E −        → E by
   ti (fi ) = −fi , ti (fj ) = fj for j 6= i, ti (ei ) = ei + κµ fi , ti (ej ) = ej for j 6= i.
Note that s1 , . . . , sk commute and t1 , . . . , tk commute. We set σ = s1 s2 . . . sk ,
σ̃ = t1 t2 . . . tk . For all j we have
   σ(ej ) = −ej , σ(fj ) = fj + κµ ej , σ̃(ej ) = ej + κµ fj , σ̃(fj ) = −fj .
Hence
   (a) σσ̃(ej ) = (κ2µ − 1)ej + κµ fj , σσ̃(fj ) = −κµ ej − fj for all j.
We see that
   (b) σ(e) = −e, σ(f ) = f + κµ e, σ̃(e) = e + κµ f , σ̃(f ) = −f .
Note that Ej = Rej + Rfj is σσ̃-stable. From (a) we see that the characteristic
polynomial of σσ̃ on Ej is X 2 − (κ2µ − 2)X + 1. Hence
   (c) (σσ̃)m = 1 on E.
A.3. Let E be an R-vector space with √                     basis e1 , e2 , . . . , ek , e′1 , e′2 , .√. . , e′k , f1 , . . . , fk .
Let e = (e1 + · · · + ek + e′1 + · · · + e′k )/ 2k, f = (f1 + · · · + fk )/ k. For i ∈ [1, k]
we define a linear map si : E −               → E by
    si (ei ) = −ei , si (ej ) = ej for j 6= i, si (e′j ) = e′j for all j,
    si (fi ) = fi + ei , si (fj ) = fj for j 6= i.
For i ∈ [1, k] we define a linear map s′i : E −                 → E by
    si (ej ) = ej for all j, si (ei ) = −ei , si (ej ) = e′j for j 6= i,
      ′                                ′ ′             ′  ′ ′

    s′i (fi ) = fi + e′i , s′i (fj ) = fj for j 6= i.
For i ∈ [1, k] we define a linear map ti : E −                  → E by
    ti (ei ) = ei + fi , ti (ej ) = ej for j 6= i,
    ti (e′i ) = e′i + fi , ti (e′j ) = e′j for j 6= i,
    ti (fi ) = −fi , ti (fj ) = fj for j 6= i.
Note that s1 , . . . , sk , s′1 , . . . , s′k commute and t1 , . . . , tk commute. We set σ =
s1 s2 . . . sk s′1 s′2 . . . s′k , σ̃ = t1 t2 . . . tk . For all j we have
    σ(ej ) = −ej , σ(e′j ) = −e′j , σ(fj ) = fj + ej + e′j , σ̃(ej ) = ej + fj , σ̃(e′j ) = e′j + fj ,
σ̃(fj ) = −fj .
Hence
    (a) σσ̃(ej ) = fj + e′j , σσ̃(e′j ) = fj + ej , σσ̃(fj ) = −fj − ej − e′j .
We see that                                   √                     √
    (b) σ(e) = −e, σ(f ) = f + 2e, σ̃(e) = e + 2f , σ̃(f ) = −f .
Note that Ej = Rej + Re′j + Rfj is σσ̃-stable. The characteristic polynomial of
σσ̃ on Ej is (X 2 + 1)(X + 1). Hence
    (c) (σσ̃)4 = 1 on E.
A.4. Let E be an R-vector space with basis
  e1 , e2 , . . . , ek , e′1 , e′2 , . . . , e′k , e′′1 , . . . , e′′k , f1 , . . . , fk . √     √
Let e = (e1 + · · · + ek + e′1 + · · · + e′k + e′′1 + · · · + e′′k )/ 3k, f = (f1 + · · · + fk )/ k.
  For i ∈ [1, k] we define a linear map si : E −                                  → E by
  si (ei ) = −ei , si (ej ) = ej for j 6= i, si (ej ) = e′j for all j,    ′
                    HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                             135

   si (e′′j ) = e′′j for all j, si (fi ) = fi + ei , si (fj ) = fj for j 6= i.
For i ∈ [1, k] we define a linear map s′i : E −                      → E by
   si (ej ) = ej for all j, si (ei ) = −ei , si (ej ) = e′j for j 6= i,
     ′                               ′ ′                ′    ′ ′

   s′i (e′′j ) = e′′j , for all j, s′i (fi ) = fi + e′i , s′i (fj ) = fj for j 6= i.
For i ∈ [1, k] we define a linear map s′′i : E −                     → E by
     ′′                               ′′ ′
   si (ej ) = ej for all j, si (ej ) = ej for all j, s′′i (e′′i ) = −e′′i ,
                                                      ′

   s′′i (e′′j ) = e′′j for j 6= i, s′′i (fi ) = fi + e′′i , s′′i (fj ) = fj for j 6= i.
For i ∈ [1, k] we define a linear map ti : E −                      → E by
   ti (ei ) = ei + fi , ti (ej ) = ej for j 6= i,
   ti (e′i ) = e′i + fi , ti (e′j ) = e′j for j 6= i,
   ti (e′′i ) = e′′i + fi , ti (e′′j ) = e′′j for j 6= i,
   ti (fi ) = −fi , ti (fj ) = fj for j 6= i.
Note that s1 , . . . , sk , s′1 , . . . , s′k , s′′1 , . . . , s′′k commute and t1 , . . . , tk commute. We
set
   σ = s1 s2 . . . sk s′1 s′2 . . . s′k s′′1 . . . s′′k , σ̃ = t1 t2 . . . tk .
For all j we have
   σ(ej ) = −ej , σ(e′j ) = −e′j , σ(e′′j ) = −e′′j , σ(fj ) = fj + ej + e′j + e′′j ,
   σ̃(ej ) = ej + fj , σ̃(e′j ) = e′j + fj , σ̃(e′′j ) = e′′j + fj , σ̃(fj ) = −fj .
Hence
   (a) σσ̃(ej ) = e′j + e′′j + fj , σσ̃(e′j ) = ej + e′′j + fj , σσ̃(e′′j ) = ej + e′j + fj ,
σσ̃(fj ) = −fj − ej − e′j − e′′j .
We see that                                   √                         √
   (b) σ(e) = −e, σ(f ) = f + 3e, σ̃(e) = e + 3f , σ̃(f ) = −f .
   Note that Ej = Rej + Re′j + Re′′j + Rfj is σσ̃-stable. From (a) we see that
(σσ̃)6 = 1 on Ej . (Its characteristic polynomial is (X 2 − X + 1)(X + 1)2 .) Hence
   (c) (σσ̃)6 = 1 on E.
A.5. Let E be an R-vector space with basis
  e1 , e2 , . . . , ek , e′1 , e′2 , . . . , e′k , f1 , . .√     , f1′ , . . . , fk′ .
                                                           . , fk√                     √
Let e = (e1 +· · ·+ek +e′1 +· · ·+e′k ) 2/ 2k, f = (f1 +· · ·+fk +f1′ +· · ·+fk′ )/ 2k.
  For i ∈ [1, k] we define a linear map si : E −                             → E by
  si (ei ) = −ei , si (ej ) = ej for j 6= i, si (e′i ) = e′i + ei ,
  si (e′j ) = e′j for j 6= i, si (fi ) = fi + ei , si (fj ) = fj for j 6= i,
  si (fj′ ) = fj′ for all j.
For i ∈ [1, k] we define a linear map s′i : E −                         → E by
  s′i (ei ) = ei + e′i , s′i (ej ) = ej for j 6= i,
  s′i (e′i ) = −e′i , s′i (e′j ) = e′j for j 6= i,
  s′i (fj ) = fj for all j, s′i (fi′ ) = fi′ + e′i , s′i (fj′ ) = fj′ for j 6= i.
  For i ∈ [1, k] we define a linear map ti : E −                             → E by
                                                                         ′
  ti (ei ) = ei + fi , ti (ej ) = ej for j 6= i, ti (ej ) = e′j for all j,
  ti (fi ) = −fi , ti (fj ) = fj for j 6= i, ti (fj′ ) = fj′ for all j.
For i ∈ [1, k] we define a linear map t′i : E −                         → E by
   ′                           ′                                   ′ ′
  ti (ei ) = ei + fi , ti (ej ) = ej for j 6= i, ti (ej ) = e′j for all j,
136                                             G. LUSZTIG

  t′i (fi ) = −fi , t′i (fj ) = fj for j 6= i, t′i (fj′ ) = fj′ for all j.
We set
  σ = s1 s′1 s1 s2 s′2 s2 . . . sk s′k sk , σ̃ = t1 t2 . . . tk t′1 t′2 . . . t′k .
For all j we have
  σ(ej ) = −e′j , σ(e′j ) = −ej , σ(fj ) = fj + ej + e′j , σ(fj′ ) = fj′ + ej + e′j ,
  σ̃(ej ) = ej + fj , σ̃(e′j ) = e′j + fj′ , σ̃(fj ) = −fj , σ̃(fj′ ) = −fj′ .
Hence
  (a) σσ̃(ej ) = ej + fj , σσ̃(e′j ) = e′j + fj′ , σσ̃(fj ) = −ej − e′j − fj , σσ̃(fj′ ) =
−ej − e′j − fj′ .
We see that                               √                        √
  (b) σ(e) = −e, σ(f ) = f + 2e, σ̃(e) = e + 2f , σ̃(f ) = −f .
Note that Ej = Rej + Re′j + Rfj + Rfj′ is σσ̃-stable. From (a) we see that the
characteristic polynomial of σσ̃ on Ej is (X 2 + 1)(X 2 − 1). Hence
  (c) (σσ̃)4 = 1 on E.

A.6. Let E be an R-vector space with basis
     e1 , e2 , . . . , ek , e′1 , e′2 , . . . , e′k , f1 , . . . , fkp
                                                                     , f1′ , . . . , fk′ .
                                                                                 √ √
Let e = (e√1 + · · · + ek + e′1 + · · · + e′k ) 2 + 2/ 2k, f = (f1 + · · · + fk + f1′ +
· · · + fk′ )/ 2k.
     For i ∈ [1, k] we define a linear map si : E −                              → E by
                                                                                           √
     si (ei ) = −ei , si (ej ) = ej for j 6= i, si (ei ) = e′i + 2ei , si (e′j ) = e′j for j 6= i,
                                                                        ′

     si (fi ) = fi + ei , si (fj ) = fj for j 6= i, si (fj′ ) = fj′ for all j.
For i ∈ [1, k] we define a linear map s′i : E −                             → E by
       ′
                           √ ′ ′
     si (ei ) = ei + 2ei , si (ej ) = ej for j 6= i,
     s′i (e′i ) = −e′i , s′i (e′j ) = e′j for j 6= i,
     s′i (fj ) = fj for all j, s′i (fi′ ) = fi′ + e′i , s′i (fj′ ) = fj′ for j 6= i.
For i ∈ [1, k] we define a linear map ti : E −                              → E by
     ti (ei ) = ei + fi , ti (ej ) = ej for j 6= i, ti (e′j ) = e′j for all j,
     ti (fi ) = −fi , ti (fj ) = fj for j 6= i, ti (fj′ ) = fj′ for all j.
For i ∈ [1, k] we define a linear map t′i : E −                             → E by
       ′                          ′                                    ′ ′
     ti (ei ) = ei + fi , ti (ej ) = ej for j 6= i, ti (ej ) = e′j for all j,
     t′i (fi ) = −fi , t′i (fj ) = fj for j 6= i, t′i (fj′ ) = fj′ for all j.
We set σ = s1 s′1 s1 s′1 s2 s′2 s2 s′2 . . . sk s′k sk s′k , σ̃ = t1 t2 . . . tk t′1 t′2 . . . t′k . For all j we
have                                                                                   √
     σ(ej ) = −ej , σ(e′j ) = −e′j , σ(fj ) = fj + 2ej + 2e′j ,
                           √
     σ(fj′ ) = fj′ + 2ej + 2e′j , σ̃(ej ) = ej + fj , σ̃(e′j ) = e′j + fj′ ,
     σ̃(fj ) = −fj , σ̃(fj′ ) = −fj′ .
Hence                                √                                    √
     (a) σσ̃(ej ) = ej + 2e′j + fj , σσ̃(e′j ) = 2ej + e′j + fj′ ,
                                   √                                        √
     σσ̃(fj ) = −2ej − 2e′j − fj , σσ̃(fj′ ) = − 2ej − 2e′j − fj′ .
We see that
                HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                               137
                              p      √              p    √
  (b) σ(e) = −e, σ(f ) = f + 2 + 2e, σ̃(e) = e + 2 + 2f , σ̃(f ) = −f .
Note that Ej = Rej + Re′j + Rfj + Rfj′ is σσ̃-stable. From (a) we see that the
                                                √             √
characteristic polynomial of σσ̃ on Ej is (X 2 − 2X + 1)(X 2 + 2X + 1). Hence
  (c) (σσ̃)8 = 1 on E.
A.7. For any I, I ′ in S we define MI,I ′ ∈ Z>0 ∪ {∞} as follows. If I = I ′ we set
MI,I ′ = 1. If W̃I∪I ′ is infinite we set MI,I ′ = ∞. Now assume that I 6= I ′ and
W̃I∪I ′ is finite. Let
   (a) m = max{ms,s′ ; s ∈ I, s′ ∈ I}, m′ = max{ms,s′ ; s ∈ I ′ , s′ ∈ I ′ }, µ =
max{ms,s′ ; s ∈ I, s′ ∈ I ′ }.
If µ = 2 we set MI,I ′ = 2.
   If µ = 3 and p in A.1(e) is 2 or 3 we set MI,I ′ = 2p.
   If µ = 3, p in A.1(e) is 1 and (m, m′ ) is (4, 2) or (2, 4), we set MI,I ′ = 8.
   If µ = 3, p in A.1(e) is 1 and (m, m′ ) is (3, 2) or (2, 3), we set MI,I ′ = 4.
   If µ ≥ 3 and m ≤ 2, m′ ≤ 2 we set MI,I ′ = µ.
Let W ′ be the Coxeter group with generators gI (I ∈ S) with relations (gI gI ′ )MI,I ′ =
1 for any I, I ′ ∈ S such that MI∪I ′ < ∞. We have the following result.
Theorem A.8. The map gI 7→ w0I (I ∈ S) extends uniquely to a group ho-
momorphism λ : W ′ −  → W̃ which is an isomorphism of W ′ onto the subgroup
W = {w ∈ W̃ ; τ (w) = w} of W̃ .

   We show that for any I, I ′ ∈ S such that W̃I∪I ′ is finite we have
               ′
   (a) (w0I w0I )MI,I ′ = 1 in W̃ .
If I = I ′ this is a well known property of the longest element in a finite Coxeter
group. Now assume that I 6= I ′ . By the injectivity of σ, see [Bo, Ch.V,4.4], it is
                                   ′
enough to show that (σ(w0I w0I ))MI,I ′ = 1 in GL(E). Let m, m′ , µ be as in A.7(a).
                                                                                        ′
Let EI∪I ′ be the subspace of E spanned by {es ; s ∈ I ∪ I ′ }. Note that σ(w0I w0I )
leaves stable this subspace and induces the identity map on E/EI∪I ′ . Moreover,
the bilinear form (, ) is positive definite on EI∪I ′ (see [Bo, Ch.5,4.8]) hence E is the
                                                                                        ′
direct sum of EI∪I ′ and its perpendicular in E on which the isometry σ(w0I w0I )
                                                                         ′
must act as the identity. Thus it is enough to show that (σ(w0I w0I ))MI,I ′ = 1 on
the subspace EI∪I ′ .
                            ′
   If µ = 2 then w0I , w0I commute hence
           ′                  ′                 ′
   (w0I w0I )MI,I ′ = (w0I w0I )2 = (w0I )2 (w0I )2 = 1,
as required.
   If µ = 3 and p in A.1(e) is 2 (resp. 3) then from A.3(c) (resp. A.4(c)) we see
                                                         ′
that the 4-th power (resp. 6-th power) of σ(w0I w0I )|EI∪I ′ is 1, as required.
   If µ = 3 and p in A.1(e) is 1 and (m, m′ ) is (4, 2) or (2, 4) (resp. (m, m′ ) is
(3, 2) or (2, 3)) then from A.6(c) (resp. A.5(c)) we see that the 8-th power (resp.
                           ′
4-th power) of σ(w0I w0I )|EI∪I ′ is 1, as required.
   If µ = 3 and p in A.1(e) is 1 or if µ > 3 then from A.2(c) we see that the µ-th
                     ′
power of σ(w0I w0I )|EI∪I ′ is 1, as required. This proves (a).
138                                   G. LUSZTIG

  From (a) we see that the map gI 7→ w0I (I ∈ S) extends (uniquely) to a group
homomorphism λ : W ′ − → W̃ . From A.1(a) we see that the image of λ is exactly
W . It remains to show that λ is injective.
                            P
  For any I ∈ S we set ǫ̃I = s∈I es , ψI = sqrt(ẽI , ẽI ) ∈ R>0 (we have (ẽI , ẽI ) ∈
R>0 by [Bo, Ch.V,4.8,Thm.2]); we also set

                                      eI = ẽI /ψI .

Note that (eI , eI ) = 1. Setting m = max{ms,s′ ; s, s′ ∈ I}, we have ψI = 1 if m = 1
and                                  p
                                ψI = ♯(I)(1 − κm /2)

if m ≥ 2. (If m ≤ 2 this is obvious;
                                 p if m ≥ 3, this follows from A.1(d).) For
                                                                      −1
                                                               p
example, if m ≤ 2 we
                   phave −1ψI = ♯(I); if m = 3 we have ψI = ♯(I)κ4 ; if
m = 4 we have ψI = ♯(I)κ8 .

   We show that for I, I ′ ∈ S such that W̃I∪I ′ is finite we have
   (b) σ(w0I )(eI ′ ) = eI ′ + κMI,I ′ eI .
When I = I ′ this reduces to σ(w0I )(eI ) = −eI which follows easily from the
definitions.
   We now assume that I 6= I ′ . Let m, m′ , µ be as in A.7(a).
   If µ = 2 we have from the definitions σ(w0I )(eI ′ ) = eI ′ , as required (since
κMI,I ′ = 0).
   If µ = 3 and p in A.1(e) is 2 (resp.     √ 3) then
                                                    √ from A.3(b) (resp. A.4(b)) we see
that (b) holds. (We use that κ4 = 2, κ6 = 3.)
   If µ = 3 and p in A.1(e) is 1 and (m, m′ ) is (4, 2) or (2, 4) (resp. (m, m′ ) is
(3, 2) or (2, 3)) thenp  from A.6(b) (resp. A.5(b)) we see that (b) holds. (We use
           √                    √
that κ4 = 2, κ8 = 2 + 2.)
   If µ = 3 and p in A.1(e) is 1 or if µ > 3 then from A.2(b) we see that (b) holds.
This proves (b).

   We show that for I, I ′ ∈ S such that W̃I∪I ′ is infinite we have
                                             ′
   (c) σ(w0I )(eI ′ ) = eI ′ + xeI , σ(w0I )(eI ) = eI + xeI ′ where x ∈ R≥2 ; moreover,
we have x = −2(eI , eI ′ ).
                                      ′
By A.1(c), the product w0I w0I has infinite order in W .
   Next we remark that, by a standard argument, if si1 si2 . . . siq is a reduced
expression in W̃ (q ≥ 1) then σ(si1 si2 . . . siq−1 )esiq is an R≥0 -linear combination
of elements esir , r ∈ [1, q] and at least one coefficient is > 0; moreover if siq is
different from si1 , si2 , . . . , siq−1 then the coefficient of esiq is 1.
                                                                                ′
   Now let s′ ∈ I ′ . We have ms,s′ ≥ 3 for some s ∈ I. (Otherwise, w0I , w0I would
                      ′
commute and w0I w0I would have order 2, which is not the case, since it has infinite
order). Hence we can find a reduced expression si1 si2 . . . siq for w0I with sir ∈ I
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                         139

and siq such that msiq ,s′ ≥ 3. We have σ(siq )es′ = es′ + cesiq where c ∈ R>0 and
                     σ(w0I )es′ = σ(si1 si2 . . . siq )es′
                      = σ(si1 si2 . . . siq−1 )(es′ + cesiq )
                      = σ(si1 si2 . . . siq−1 )es′ + cσ(si1 si2 . . . siq−1 )esiq .
By the remark above this is equals es′ plus an R≥0 -linear combination of elements
esir , r ∈ [1, q] and at least one of the esir appears with coefficient > 0. Taking sum
over all s′ ∈ I ′ we see that σ(w0I )eI ′ is equal to eI ′ plus an R≥0 -linear combination
of elements es , s ∈ I, and at least one of the es , s ∈ I, appears with coefficient
> 0. Since τ : E −  → E commutes with the action of σ(w0I ) and it keeps fixed eI ′ it
follows that σ(w0I )eI ′ − eI ′ is fixed by τ hence is of the form xeI for a well defined
x ∈ R>0 . Thus we have σ(w0I )eI ′ = eI ′ + xeI with x ∈ R>0 . Similarly we have
       ′                                                                            ′
σ(w0I )(eI ) = eI + yeI ′ with y ∈ R>0 . Since σ(w0I )eI = −eI , σ(w0I )eI ′ = −eI ′ , we
see that the 2-dimensional subspace E = ReI + ReI ′ is stable under σ(w0I ) and
       ′
σ(w0I ).
                            ′                                                 ′
   We have σ(w0I )σ(w0I )(eI ) = (xy − 1) + yeI ′ , σ(w0I )σ(w0I )(eI ′ ) = −xeI − eI ′ .
                             ′
We see that σ(w0I )σ(w0I ) : EI,I ′ −     → EI,I ′ has determinant 1 and trace xy − 2.
   Assume that the bilinear form (, ) is positive definite on E. Then E is the direct
sum of E and E ⊥ , the perpendicular to χ with respect to (, ), and both σ(w0I )
            ′
and σ(w0I ) are contained in the group G of isometries of (, ) which preserve E and
                                                                                             ′
induces the identity map on E ⊥ . By [Bo, V,4.4,Cor.3] the powers of w0I w0I form a
discrete subgroup of the group of isometries of (, ) hence a discrete subgroup of G.
This discrete subgroup is also infinite, as we have seen, and G is compact. This is
a contradiction.
   We see that (, ) is not positive definite on E; however, as we have seen above, we
have (eI , eI ) = 1. It follows that the set of isotropic vectors in E is either a union of
two lines L, L′ (if (, ) is nondegenerate on E) or a line L (if (, ) is degenerate on E).
                                                                                           ′
In the first case both L, L′ must be stable under the isometry σ(w0I )σ(w0I ) (which
                                                               ′
has determinant 1); it follows that σ(w0I )σ(w0I ) is diagonalizable over R; hence
it has real eigenvalues (with product 1). In the second case L must be stable
                                        ′                           ′
under the isometry σ(w0I )σ(w0I ) hence σ(w0I )σ(w0I ) has again real eigenvalues
                                                                             ′
(with product 1). Thus in both cases the trace of σ(w0I w0I ) on E must be ≥ 2.
In other words we have xy − 2 ≥ 2 that is xy ≥ 4. Since σ(w0I ) is an isometry
for (, ) we have (eI ′ + xeI , eI ′ + xeI ) = (eI ′ , eI ′ ) hence 2x(eI , eI ′ ) + x2 (eI , eI ) = 0.
Since x > 0 and (eI , eI ) = 1 it follows that x = −2(eI , eI ′ ). Similarly, we have
y = −2(eI , eI ′ . Thus we have x = y and x2 ≥ 4 hence x ≥ 2. This proves (c).
   Let Ē be the subspace of E spanned by the vectors eI ; I ∈ S ′ . From (b) we see
that the action of W ′ on E (by w 7→ σ(λ(w))) leaves Ē stable and the action of
the generators gI is given on Ē by the formulas for the reflection representation
of W ′ with the following modification: when I, I ′ ∈ S ′ are such that MI,I ′ = ∞
then
                      gI (eI ′ ) = eI ′ + xI,I ′ eI , gI ′ (eI ) = eI + xI,I ′ eI ′
140                                       G. LUSZTIG

where xI,I ′ ∈ R≥2 , while in the actual reflection representation we would have
xI,I ′ = 2. Hence if w ∈ W ′ satisfies λ(w) = 1 then w acts as identity on the (mod-
ified) reflection representation of W ′ . But the proof of faithfulness of the reflection
representation in [Bo,Ch.V,4.4] extends to a proof of faithfulness of the modified
reflection representation. (The only place where the proof must be changed is
in [Bo,ChV, 4.5, case (a)] which is an easily verified statement about an infinite
dihedral group.) This proves that λ is injective. The theorem is proved.
 Theorem A.9. Let L : W −   → N be the restriction to W of the length function
˜l : W̃ −
        → N. Then L is a weight function for W, S.
     Let l : W − → N be the length function of the Coxeter group W, S. It is enough
 to prove the following statement.
     (a) If w ∈ W and I ∈ S are such that l(w0I w) = 1 + l(w) then ˜l(w0I w) =
˜l(wI ) + ˜l(w).
      0
 Our assumption implies that σ(w−1 )eI is an R≥0 -linear combination of elements
 eI ′ ∈ Ē with I ′ ∈ S; hence for some s ∈ I, σ(w−1 )es is an R≥0 -linear combination
 of elements es′ ∈ E with s′ ∈ S̃ (notation as in the proof of A.8). It follows
 that ˜l(sw) = ˜l(w) + 1. Hence for any i we have ˜l(τ i (sw)) = ˜l(τ i (w)) + 1 that is
˜l(τ i (s)w) = ˜l(w) + 1. Hence we have s′ w > w for any s′ ∈ I. Using 9.7 we deduce
 that ˜l(w0I w) = ˜l(w0I ) + ˜l(w), as required.

                                         References
[Be]    R.Bédard, Cells in two Coxeter groups, Commun. Alg. 14 (1986), 1253-1286.
[Bo]    N.Bourbaki, Groupes et algèbres de Lie, Ch. 4,5,6, Hermann, Paris, 1968.
[B]     K.Bremke, On generalized cells in affine Weyl groups, J. Algebra 191 (1997), 149-173.
[BM]    K.Bremke and G.Malle, Reduced words and a length function for G(e, 1, n), Indag.Math.
        8 (1997), 453-469.
[De]    P.Deligne, Catégories tensorielles, Moscow Math.J. 2 (2002), 227-248.
[DL]    P.Deligne and G.Lusztig, Representations of reductive groups over finite fields, Ann.Math.
        103 (1976), 103-161.
[EW]    B.Elias and G.Williamson, The Hodge theory of Soergel bimodules, arXiv:1212.0791.
[G]     M.Geck, Constructible characters, leading coefficients and left cells for finite Coxeter
        groups with unequal parameters, Represent.theory 6 (2002), 1-30.
[GP]    M.Geck and G.Pfeiffer, Characters of finite Coxeter groups and Iwahori-Hecke algebras,
        London Math.Soc.Monographs 21, Clarendon Press, Oxford, 2000.
[H]     P.N.Hoefsmit, Representations of Hecke algebras of finite groups with BN-pairs of clas-
        sical type, Thesis, Univ. of British Columbia, Vancouver (1974).
[I]     N.Iwahori, On the structure of the Hecke ring of a Chevalley group over a finite field,
        J.Fac.Sci.Tokyo Univ. 10 (1964), 215-236.
[IM]    N.Iwahori and H.Matsumoto, On some Bruhat decomposition and the structure of the
        Hecke ring of p-adic Chevalley groups, Publ.Math. I.H.E.S. 25 (1965), 5-48.
[KL1]   D.Kazhdan and G.Lusztig, Representations of Coxeter groups and Hecke algebras, Inv.
        Math. 53 (1979), 165-184.
[KL2]   D.Kazhdan and G.Lusztig, Schubert varieties and Poincaré duality, Proc.Symp.Pure
        Math. 36 (1980), Amer. Math. Soc., 185-203.
[Ki]    R.Kilmoyer, Some irreducible complex representations of a finite group with BN pair,
        PhD dissertation, MIT (1969).
                   HECKE ALGEBRAS WITH UNEQUAL PARAMETERS                                     141

[L1]    G.Lusztig, Coxeter orbits and eigenspaces of Frobenius, Inv.Math. 28 (1976), 101-159.
[L2]            , Irreducible representations of finite classical groups, Inv.Math. 43 (1977), 125-
        175.
[L3]            , Left cells in Weyl groups, Lie group representations, I, Lect. Notes Math. 1024,
        Springer, 1983, pp. 99-111.
[L4]            , Some examples of square integrable representations of semisimple p-adic groups,
        Trans.Amer.Math.Soc. 227 (1983), 623-653.
[L5]    G.Lusztig, Singularities, character formulas and a q-analog of weight multiplicities,
        Astérisque 101-102 (1983), 208-229.
[L6]            , Characters of reductive groups over a finite field, Ann.Math.Studies 107, Prince-
        ton Univ. Press, 1984, 384p.
[L7]            , Cells in affine Weyl groups, Algebraic groups and related topics, Adv.Stud.Pure
        Math. 6, North-Holland and Kinokuniya, Tokyo and Amsterdam, 1985, pp. 255-287.
[L8]            , Sur les cellules gauches des groupes de Weyl, C.R.Acad.Sci.Paris(A) 302 (1986),
        5-8.
[L9]            , Cells in affine Weyl groups, II, J.Algebra 109 (1987), 536-548.
[L10]           , Introduction to character sheaves, Proc. Symp. Pure Math. 47(1) (1987), Amer.
        Math. Soc., 165-180.
[L11]           , Intersection cohomology methods in representation theory, Proc.Int.Congr.Math.
        Kyoto 1990, Springer, Tokyo, 1991, pp. 155-174.
[L12]           , Introduction to quantum groups, Progr.in Math., vol. 110, Birkhäuser Boston,
        1993.
[L13]           , Classification of unipotent representations of simple p-adic groups, Int. Math.
        Res. Notices 1995, 517-589.
[L14]           , Cells in affine Weyl groups and tensor categories, Adv.Math. 129 (1997), 85-98.
[L15]           , Lectures on Hecke algebras with unequal parameters, MIT Lectures (1999),
        RT/0108172.
[L16]           , Classification of unipotent representations of simple p-adic groups II, Repre-
        sent.Theory 6 (2002), 243-289, RT/0111248.
[L17]   G.Lusztig, A bar operator for involutions in a Coxeter group, Bull.Inst.Math.Acad. Sinica
        (N.S.) 7 (2012), 355-404.
[LV]    G.Lusztig and D.Vogan, Hecke algebras and involutions in Coxeter groups, arXiv:1312.3237.
[LX]    G.Lusztig and N.Xi, Canonical left cells in affine Weyl groups, Adv.in Math. 72 (1988),
        284-288.
[So]    W.Soergel, Kazhdan-Lusztig Polynome und unzerlegbare Bimoduln über Polynomringen,
        J. Inst. Math. Jussieu 6 (2007), 501-525.
[X]     N.Xi, Representations of affine Hecke algebras, Lect. Notes Math., vol. 1587, Springer,
        1994.

      Department of Mathematics, M.I.T., Cambridge, MA 02139
